local base64 = {}
local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
function base64.dec(data)
    data = string.gsub(data, '[^'..b..'=]', '')
    return (data:gsub('.', function(x)
        if (x == '=') then return '' end
        local r,f='',(b:find(x)-1)
        for i=6,1,-1 do r=r..(f%2^i-f%2^(i-1)>0 and '1' or '0') end
        return r;
    end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
        if (#x ~= 8) then return '' end
        local c=0
        for i=1,8 do c=c+(x:sub(i,i)=='1' and 2^(8-i) or 0) end
        return string.char(c)
    end))
end

function base64.enc(data)
    return ((data:gsub('.', function(x) 
        local r,b='',x:byte()
        for i=8,1,-1 do r=r..(b%2^i-b%2^(i-1)>0 and '1' or '0') end
        return r;
    end)..'0000'):gsub('%d%d%d?%d?%d?%d?', function(x)
        if (#x < 6) then return '' end
        local c=0
        for i=1,6 do c=c+(x:sub(i,i)=='1' and 2^(6-i) or 0) end
        return b:sub(c+1,c+1)
    end)..({ '', '==', '=' })[#data%3+1])
end

local function load_illu(param)
	local string = base64.dec([[LS0tIEBjbGFzcyB2b2lkDQpsb2NhbCBmdW5jdGlvbiB2b2lkKCkNCglyZXR1cm4gbmlsDQplbmQNCi0tcmVnaW9uIGRlcGVuZGVuY2llcw0KLS1yZWdpb24gc3RkX2FwaQ0KLS1yZWdpb24gbWF0aA0KLS0tIFJvdW5kIGEgbnVtYmVyIHRvIHRoZSBuZWFyZXN0IHByZWNpc2lvbiwgb3Igbm9uZSBieSBkZWZhdWx0Lg0KLS0tIEBwYXJhbSBudW1iZXIgbnVtYmVyDQotLS0gQHBhcmFtIHByZWNpc2lvbiBudW1iZXINCi0tLSBAcmV0dXJuIG51bWJlcg0KZnVuY3Rpb24gbWF0aC5yb3VuZChudW1iZXIsIHByZWNpc2lvbikNCglsb2NhbCBtdWx0ID0gMTAgXiAocHJlY2lzaW9uIG9yIDApDQoNCglyZXR1cm4gbWF0aC5mbG9vcihudW1iZXIgKiBtdWx0ICsgMC41KSAvIG11bHQNCmVuZA0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gdGFibGUNCi0tLSBSZXR1cm5zIHRydWUgaWYgdGhlIHRhYmxlIGNvbnRhaW5zIHRoZSB2YWx1ZSBiZWluZyBzZWFyY2hlZCBmb3IuDQotLS0gQHBhcmFtIHNlYXJjaF90YWJsZSB0YWJsZQ0KLS0tIEBwYXJhbSBzZWFyY2hfdmFsdWUgYW55DQotLS0gQHJldHVybiBib29sZWFuDQpmdW5jdGlvbiB0YWJsZS5jb250YWlucyhzZWFyY2hfdGFibGUsIHNlYXJjaF92YWx1ZSkNCglmb3IgXywgdGFibGVfdmFsdWUgaW4gcGFpcnMoc2VhcmNoX3RhYmxlKSBkbw0KCQlpZiAoc2VhcmNoX3ZhbHVlID09IHRhYmxlX3ZhbHVlKSB0aGVuDQoJCQlyZXR1cm4gdHJ1ZQ0KCQllbmQNCgllbmQNCg0KCXJldHVybiBmYWxzZQ0KZW5kDQotLWVuZHJlZ2lvbg0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gaHZjX2FwaQ0KLS0tIFNvcnRlZCBwYWlycyBpdGVyYXRpb24uDQotLS0gQHBhcmFtIHQgdGFibGU8YW55LCBhbnk+DQotLS0gQHBhcmFtIG9yZGVyIGZ1bmN0aW9uDQotLS0gQHJldHVybiB0YWJsZTxhbnksIGFueT4NCmxvY2FsIGZ1bmN0aW9uIHNwYWlycyh0LCBvcmRlcikNCgktLSBDb2xsZWN0IHRoZSBrZXlzDQoJbG9jYWwga2V5cyA9IHt9DQoNCglmb3IgayBpbiBwYWlycyh0KSBkbyBrZXlzWyNrZXlzKzFdID0gayBlbmQNCgktLSBJZiBvcmRlciBmdW5jdGlvbiBnaXZlbiwgc29ydCBieSBpdCBieSBwYXNzaW5nIHRoZSB0YWJsZSBhbmQga2V5cyBhLCBiLA0KCS0tIG90aGVyd2lzZSBqdXN0IHNvcnQgdGhlIGtleXMNCglpZiBvcmRlciB0aGVuDQoJCXRhYmxlLnNvcnQoa2V5cywgZnVuY3Rpb24oYSxiKSByZXR1cm4gb3JkZXIodCwgYSwgYikgZW5kKQ0KCWVsc2UNCgkJdGFibGUuc29ydChrZXlzKQ0KCWVuZA0KDQoJbG9jYWwgaSA9IDANCg0KCS0tIFJldHVybiB0aGUgaXRlcmF0b3IgZnVuY3Rpb24uDQoJcmV0dXJuIGZ1bmN0aW9uKCkNCgkJaSA9IGkgKyAxDQoJCWlmIGtleXNbaV0gdGhlbg0KCQkJcmV0dXJuIGtleXNbaV0sIHRba2V5c1tpXV0NCgkJZW5kDQoJZW5kDQplbmQNCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIGRlcGVuZGVuY3k6IGhhdm9jX3BhbmljXzFfMF8xDQotLS0gQWN0cyBhcyBhIGZhaWwtc2FmZSB0aGF0IHRyaXBzIGEgc2NyaXB0IGludG8gc2h1dHRpbmcgZG93biBzYWZlbHksIGFuZCByZXNldHRpbmcgcGxheWVycyB0byB1c2UgdGhlIEdhbWVzZW5zZSByZXNvbHZlci4NCi0tLSBAY2xhc3MgcGFuaWNfYw0KbG9jYWwgcGFuaWNfYyA9IHt9DQpsb2NhbCBwYW5pY19tdCA9IHsgX19pbmRleCA9IHBhbmljX2MgfQ0KDQotLS0gSW5zdGFuaWF0ZSBwYW5pY19jLg0KLS0tIEByZXR1cm4gcGFuaWNfYw0KZnVuY3Rpb24gcGFuaWNfYy5uZXcocGFuaWNfY2FsbGJhY2spDQoJcmV0dXJuIHNldG1ldGF0YWJsZSgNCgkJew0KCQkJaW50ZXJydXB0ID0gZmFsc2UsIC0tIFdhcyB0aGUgcHJldmlvdXMgY3ljbGUgaW50ZXJydXB0ZWQ/DQoJCQlwYW5pYyA9IGZhbHNlLCAtLSBIYXMgdGhlIHN5c3RlbSBlbnRlcmVkIHBhbmljIG1vZGU/DQoJCQlwYW5pY19jYWxsYmFjayA9IHBhbmljX2NhbGxiYWNrLCAtLSBDYWxsYmFjayB0byBydW4gdXBvbiBhIHBhbmljLg0KCQl9LA0KCQlwYW5pY19tdA0KCSkNCmVuZA0KDQotLS0gVGVzdCB0byBlbnN1cmUgdGhhdCBhbGwgcnVubmluZyBwcm9jZXNzZXMgZnJvbSB0aGUgcHJldmlvdXMgY3ljbGUgd2VyZSBzdWNjZXNzZnVsIGFuZCBkaWQgbm90IGVuY291bnRlciBlcnJvcnMuDQotLS0gQHZhcmFyZyBhbnkNCmZ1bmN0aW9uIHBhbmljX2M6dGVzdCguLi4pDQoJaWYgKHNlbGYuaW50ZXJydXB0ID09IHRydWUgYW5kIHNlbGYucGFuaWMgPT0gZmFsc2UpIHRoZW4NCgkJLS0gUGFuaWMgaWYgdGhlIGludGVycnVwdCB3YXMgbmV2ZXIgcmVzZXQgZnJvbSB0aGUgcHJldmlvdXMgY3ljbGUuDQoJCXNlbGYucGFuaWMgPSB0cnVlDQoJZWxzZWlmIChzZWxmLmludGVycnVwdCA9PSB0cnVlIGFuZCBzZWxmLnBhbmljID09IHRydWUpIHRoZW4NCgkJLS0gT3RoZXJ3aXNlLCBpZiB0aGUgcHJldmlvdXMgY3ljbGUgYWxyZWFkeSBpbml0aWF0ZWQgdGhlIHBhbmljLCBubyBmdXJ0aGVyIGFjdGlvbiBpcyByZXF1aXJlZC4NCgkJLS0gTGV0IHRoZSBleGVjdWRpbmcgY29kZSBrbm93IHRoYXQgdGhlIHRlc3QgZmFpbGVkLg0KCQlyZXR1cm4gZmFsc2UNCgllbmQNCg0KCS0tIEluaXRpYXRlIHRoZSBwYW5pYy4NCglpZiAoc2VsZi5pbnRlcnJ1cHQgPT0gdHJ1ZSkgdGhlbg0KCQlzZWxmLnBhbmljID0gdHJ1ZQ0KDQoJCS0tIFJ1biB0aGUgcGFuaWMgY2FsbGJhY2sgZ2l2ZW4gdG8gdXMuDQoJCXNlbGYucGFuaWNfY2FsbGJhY2soLi4uKQ0KCWVuZA0KDQoJLS0gTGV0IHRoZSBleGVjdXRpbmcgY29kZSBrbm93IHRoYXQgdGhlIHRlc3QgcGFzc2VkLg0KCXJldHVybiB0cnVlDQplbmQNCg0KLS0tIEJlZ2luIHRoZSBwYW5pYyB0ZXN0Lg0KLS0tIFJ1biB0aGlzIGF0IHRoZSBzdGFydCBvZiBldmVudHMuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBwYW5pY19jOnN0YXJ0KCkNCglzZWxmLmludGVycnVwdCA9IHRydWUNCmVuZA0KDQotLS0gRW5kIHRoZSBwYW5pYyB0ZXN0Lg0KLS0tIFJ1biB0aGlzIGF0IHRoZSBlbmQgb2YgZXZlbnRzLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gcGFuaWNfYzpzdG9wKCkNCglzZWxmLmludGVycnVwdCA9IGZhbHNlDQplbmQNCg0KLS0tIEZvcmNlZnVsbHkgdHJpZ2dlciBhIHBhbmljIGF0dGFjay4NCi0tLSBDYWxsIHRoaXMgbWlkLXRlc3QuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBwYW5pY19jOnRyaXAoKQ0KCXNlbGYuaW50ZXJydXB0ID0gdHJ1ZQ0KZW5kDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBkZXBlbmRlbmN5OiBoYXZvY192ZWN0b3JfMl8yXzANCi0tcmVnaW9uIG1hdGgNCmZ1bmN0aW9uIG1hdGgucm91bmQobnVtYmVyLCBwcmVjaXNpb24pDQoJbG9jYWwgbXVsdCA9IDEwIF4gKHByZWNpc2lvbiBvciAwKQ0KDQoJcmV0dXJuIG1hdGguZmxvb3IobnVtYmVyICogbXVsdCArIDAuNSkgLyBtdWx0DQplbmQNCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIGFuZ2xlDQotLS0gQGNsYXNzIGFuZ2xlX29sZF9jDQotLS0gQGZpZWxkIHB1YmxpYyBwIG51bWJlciBBbmdsZSBwaXRjaC4NCi0tLSBAZmllbGQgcHVibGljIHkgbnVtYmVyIEFuZ2xlIHlhdy4NCi0tLSBAZmllbGQgcHVibGljIHIgbnVtYmVyIEFuZ2xlIHJvbGwuDQpsb2NhbCBhbmdsZV9vbGRfYyA9IHt9DQpsb2NhbCBhbmdsZV9tdCA9IHsNCglfX2luZGV4ID0gYW5nbGVfb2xkX2MNCn0NCg0KLS0tIE92ZXJ3cml0ZSB0aGUgYW5nbGUncyBhbmdsZXMuIE5pbCB2YWx1ZXMgbGVhdmUgdGhlIGFuZ2xlIHVuY2hhbmdlZC4NCi0tLSBAcGFyYW0gYW5nbGUgYW5nbGVfb2xkX2MNCi0tLSBAcGFyYW0gcF9uZXcgbnVtYmVyDQotLS0gQHBhcmFtIHlfbmV3IG51bWJlcg0KLS0tIEBwYXJhbSByX25ldyBudW1iZXINCi0tLSBAcmV0dXJuIHZvaWQNCmFuZ2xlX210Ll9fY2FsbCA9IGZ1bmN0aW9uKGFuZ2xlLCBwX25ldywgeV9uZXcsIHJfbmV3KQ0KCXBfbmV3ID0gcF9uZXcgb3IgYW5nbGUucA0KCXlfbmV3ID0geV9uZXcgb3IgYW5nbGUueQ0KCXJfbmV3ID0gcl9uZXcgb3IgYW5nbGUucg0KDQoJYW5nbGUucCA9IHBfbmV3DQoJYW5nbGUueSA9IHlfbmV3DQoJYW5nbGUuciA9IHJfbmV3DQplbmQNCg0KLS0tIENyZWF0ZSBhIG5ldyB2ZWN0b3Igb2JqZWN0Lg0KLS0tIEBwYXJhbSBwIG51bWJlcg0KLS0tIEBwYXJhbSB5IG51bWJlcg0KLS0tIEBwYXJhbSByIG51bWJlcg0KLS0tIEByZXR1cm4gYW5nbGVfb2xkX2MNCmxvY2FsIGZ1bmN0aW9uIGFuZ2xlKHAsIHksIHIpDQoJcmV0dXJuIHNldG1ldGF0YWJsZSgNCgkJew0KCQkJcCA9IHAgYW5kIHAgb3IgMCwNCgkJCXkgPSB5IGFuZCB5IG9yIDAsDQoJCQlyID0gciBhbmQgciBvciAwDQoJCX0sDQoJCWFuZ2xlX210DQoJKQ0KZW5kDQoNCi0tLSBPZmZzZXQgdGhlIGFuZ2xlJ3MgYW5nbGVzLiBOaWwgdmFsdWVzIGxlYXZlIHRoZSBhbmdsZSB1bmNoYW5nZWQuDQotLS0gQHBhcmFtIHBfb2Zmc2V0IG51bWJlcg0KLS0tIEBwYXJhbSB5X29mZnNldCBudW1iZXINCi0tLSBAcGFyYW0gcl9vZmZzZXQgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBhbmdsZV9vbGRfYzpvZmZzZXQocF9vZmZzZXQsIHlfb2Zmc2V0LCByX29mZnNldCkNCglwX29mZnNldCA9IHNlbGYucCArIHBfb2Zmc2V0IG9yIDANCgl5X29mZnNldCA9IHNlbGYueSArIHlfb2Zmc2V0IG9yIDANCglyX29mZnNldCA9IHNlbGYuciArIHJfb2Zmc2V0IG9yIDANCg0KCXNlbGYucCA9IHNlbGYucCArIHBfb2Zmc2V0DQoJc2VsZi55ID0gc2VsZi55ICsgeV9vZmZzZXQNCglzZWxmLnIgPSBzZWxmLnIgKyByX29mZnNldA0KZW5kDQoNCi0tLSBDbG9uZSB0aGUgYW5nbGUgb2JqZWN0Lg0KLS0tIEByZXR1cm4gYW5nbGVfb2xkX2MNCmZ1bmN0aW9uIGFuZ2xlX29sZF9jOmNsb25lKCkNCglyZXR1cm4gc2V0bWV0YXRhYmxlKA0KCQl7DQoJCQlwID0gc2VsZi5wLA0KCQkJeSA9IHNlbGYueSwNCgkJCXIgPSBzZWxmLnINCgkJfSwNCgkJYW5nbGVfbXQNCgkpDQplbmQNCg0KLS0tIENsb25lIGFuZCBvZmZzZXQgdGhlIGFuZ2xlJ3MgYW5nbGVzLiBOaWwgdmFsdWVzIGxlYXZlIHRoZSBhbmdsZSB1bmNoYW5nZWQuDQotLS0gQHBhcmFtIHBfb2Zmc2V0IG51bWJlcg0KLS0tIEBwYXJhbSB5X29mZnNldCBudW1iZXINCi0tLSBAcGFyYW0gcl9vZmZzZXQgbnVtYmVyDQotLS0gQHJldHVybiBhbmdsZV9vbGRfYw0KZnVuY3Rpb24gYW5nbGVfb2xkX2M6Y2xvbmVfb2Zmc2V0KHBfb2Zmc2V0LCB5X29mZnNldCwgcl9vZmZzZXQpDQoJcF9vZmZzZXQgPSBzZWxmLnAgKyBwX29mZnNldCBvciAwDQoJeV9vZmZzZXQgPSBzZWxmLnkgKyB5X29mZnNldCBvciAwDQoJcl9vZmZzZXQgPSBzZWxmLnIgKyByX29mZnNldCBvciAwDQoNCglyZXR1cm4gYW5nbGUoDQoJCXNlbGYucCArIHBfb2Zmc2V0LA0KCQlzZWxmLnkgKyB5X29mZnNldCwNCgkJc2VsZi5yICsgcl9vZmZzZXQNCgkpDQplbmQNCg0KLS0tIFVucGFjayB0aGUgYW5nbGUuDQotLS0gQHJldHVybiBudW1iZXIsIG51bWJlciwgbnVtYmVyDQpmdW5jdGlvbiBhbmdsZV9vbGRfYzp1bnBhY2soKQ0KCXJldHVybiBzZWxmLnAsIHNlbGYueSwgc2VsZi5yDQplbmQNCg0KLS0tIFNldCB0aGUgYW5nbGUncyBldWxlciBhbmdsZXMgdG8gMC4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGFuZ2xlX29sZF9jOm51bGxpZnkoKQ0KCXNlbGYucCA9IDANCglzZWxmLnkgPSAwDQoJc2VsZi5yID0gMA0KZW5kDQoNCi0tLSBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBhbmdsZS4NCmZ1bmN0aW9uIGFuZ2xlX210Ll9fdG9zdHJpbmcob3BlcmFuZF9hKQ0KCXJldHVybiBzdHJpbmcuZm9ybWF0KCIlcywgJXMsICVzIiwgb3BlcmFuZF9hLnAsIG9wZXJhbmRfYS55LCBvcGVyYW5kX2EucikNCmVuZA0KDQotLS0gQ29uY2F0ZW5hdGVzIHRoZSBhbmdsZSBpbiBhIHN0cmluZy4NCmZ1bmN0aW9uIGFuZ2xlX210Ll9fY29uY2F0KG9wZXJhbmRfYSkNCglyZXR1cm4gc3RyaW5nLmZvcm1hdCgiJXMsICVzLCAlcyIsIG9wZXJhbmRfYS5wLCBvcGVyYW5kX2EueSwgb3BlcmFuZF9hLnIpDQplbmQNCg0KLS0tIEFkZHMgdGhlIGFuZ2xlIHRvIGFub3RoZXIgYW5nbGUuDQpmdW5jdGlvbiBhbmdsZV9tdC5fX2FkZChvcGVyYW5kX2EsIG9wZXJhbmRfYikNCglpZiAodHlwZShvcGVyYW5kX2EpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiBhbmdsZSgNCgkJCW9wZXJhbmRfYSArIG9wZXJhbmRfYi5wLA0KCQkJb3BlcmFuZF9hICsgb3BlcmFuZF9iLnksDQoJCQlvcGVyYW5kX2EgKyBvcGVyYW5kX2Iucg0KCQkpDQoJZW5kDQoNCglpZiAodHlwZShvcGVyYW5kX2IpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiBhbmdsZSgNCgkJCW9wZXJhbmRfYS5wICsgb3BlcmFuZF9iLA0KCQkJb3BlcmFuZF9hLnkgKyBvcGVyYW5kX2IsDQoJCQlvcGVyYW5kX2EuciArIG9wZXJhbmRfYg0KCQkpDQoJZW5kDQoNCglyZXR1cm4gYW5nbGUoDQoJCW9wZXJhbmRfYS5wICsgb3BlcmFuZF9iLnAsDQoJCW9wZXJhbmRfYS55ICsgb3BlcmFuZF9iLnksDQoJCW9wZXJhbmRfYS5yICsgb3BlcmFuZF9iLnINCgkpDQplbmQNCg0KLS0tIFN1YnRyYWN0cyB0aGUgYW5nbGUgZnJvbSBhbm90aGVyIGFuZ2xlLg0KZnVuY3Rpb24gYW5nbGVfbXQuX19zdWIob3BlcmFuZF9hLCBvcGVyYW5kX2IpDQoJaWYgKHR5cGUob3BlcmFuZF9hKSA9PSAibnVtYmVyIikgdGhlbg0KCQlyZXR1cm4gYW5nbGUoDQoJCQlvcGVyYW5kX2EgLSBvcGVyYW5kX2IucCwNCgkJCW9wZXJhbmRfYSAtIG9wZXJhbmRfYi55LA0KCQkJb3BlcmFuZF9hIC0gb3BlcmFuZF9iLnINCgkJKQ0KCWVuZA0KDQoJaWYgKHR5cGUob3BlcmFuZF9iKSA9PSAibnVtYmVyIikgdGhlbg0KCQlyZXR1cm4gYW5nbGUoDQoJCQlvcGVyYW5kX2EucCAtIG9wZXJhbmRfYiwNCgkJCW9wZXJhbmRfYS55IC0gb3BlcmFuZF9iLA0KCQkJb3BlcmFuZF9hLnIgLSBvcGVyYW5kX2INCgkJKQ0KCWVuZA0KDQoJcmV0dXJuIGFuZ2xlKA0KCQlvcGVyYW5kX2EucCAtIG9wZXJhbmRfYi5wLA0KCQlvcGVyYW5kX2EueSAtIG9wZXJhbmRfYi55LA0KCQlvcGVyYW5kX2EuciAtIG9wZXJhbmRfYi5yDQoJKQ0KZW5kDQoNCi0tLSBNdWx0aXBsaWVzIHRoZSBhbmdsZSB3aXRoIGFub3RoZXIgYW5nbGUuDQpmdW5jdGlvbiBhbmdsZV9tdC5fX211bChvcGVyYW5kX2EsIG9wZXJhbmRfYikNCglpZiAodHlwZShvcGVyYW5kX2EpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiBhbmdsZSgNCgkJCW9wZXJhbmRfYSAqIG9wZXJhbmRfYi5wLA0KCQkJb3BlcmFuZF9hICogb3BlcmFuZF9iLnksDQoJCQlvcGVyYW5kX2EgKiBvcGVyYW5kX2Iucg0KCQkpDQoJZW5kDQoNCglpZiAodHlwZShvcGVyYW5kX2IpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiBhbmdsZSgNCgkJCW9wZXJhbmRfYS5wICogb3BlcmFuZF9iLA0KCQkJb3BlcmFuZF9hLnkgKiBvcGVyYW5kX2IsDQoJCQlvcGVyYW5kX2EuciAqIG9wZXJhbmRfYg0KCQkpDQoJZW5kDQoNCglyZXR1cm4gYW5nbGUoDQoJCW9wZXJhbmRfYS5wICogb3BlcmFuZF9iLnAsDQoJCW9wZXJhbmRfYS55ICogb3BlcmFuZF9iLnksDQoJCW9wZXJhbmRfYS5yICogb3BlcmFuZF9iLnINCgkpDQplbmQNCg0KLS0tIERpdmlkZXMgdGhlIGFuZ2xlIGJ5IHRoZSBhbm90aGVyIGFuZ2xlLg0KZnVuY3Rpb24gYW5nbGVfbXQuX19kaXYob3BlcmFuZF9hLCBvcGVyYW5kX2IpDQoJaWYgKHR5cGUob3BlcmFuZF9hKSA9PSAibnVtYmVyIikgdGhlbg0KCQlyZXR1cm4gYW5nbGUoDQoJCQlvcGVyYW5kX2EgLyBvcGVyYW5kX2IucCwNCgkJCW9wZXJhbmRfYSAvIG9wZXJhbmRfYi55LA0KCQkJb3BlcmFuZF9hIC8gb3BlcmFuZF9iLnINCgkJKQ0KCWVuZA0KDQoJaWYgKHR5cGUob3BlcmFuZF9iKSA9PSAibnVtYmVyIikgdGhlbg0KCQlyZXR1cm4gYW5nbGUoDQoJCQlvcGVyYW5kX2EucCAvIG9wZXJhbmRfYiwNCgkJCW9wZXJhbmRfYS55IC8gb3BlcmFuZF9iLA0KCQkJb3BlcmFuZF9hLnIgLyBvcGVyYW5kX2INCgkJKQ0KCWVuZA0KDQoJcmV0dXJuIGFuZ2xlKA0KCQlvcGVyYW5kX2EucCAvIG9wZXJhbmRfYi5wLA0KCQlvcGVyYW5kX2EueSAvIG9wZXJhbmRfYi55LA0KCQlvcGVyYW5kX2EuciAvIG9wZXJhbmRfYi5yDQoJKQ0KZW5kDQoNCi0tLSBSYWlzZXMgdGhlIGFuZ2xlIHRvIHRoZSBwb3dlciBvZiBhbiBhbm90aGVyIGFuZ2xlLg0KZnVuY3Rpb24gYW5nbGVfbXQuX19wb3cob3BlcmFuZF9hLCBvcGVyYW5kX2IpDQoJaWYgKHR5cGUob3BlcmFuZF9hKSA9PSAibnVtYmVyIikgdGhlbg0KCQlyZXR1cm4gYW5nbGUoDQoJCQltYXRoLnBvdyhvcGVyYW5kX2EsIG9wZXJhbmRfYi5wKSwNCgkJCW1hdGgucG93KG9wZXJhbmRfYSwgb3BlcmFuZF9iLnkpLA0KCQkJbWF0aC5wb3cob3BlcmFuZF9hLCBvcGVyYW5kX2IucikNCgkJKQ0KCWVuZA0KDQoJaWYgKHR5cGUob3BlcmFuZF9iKSA9PSAibnVtYmVyIikgdGhlbg0KCQlyZXR1cm4gYW5nbGUoDQoJCQltYXRoLnBvdyhvcGVyYW5kX2EucCwgb3BlcmFuZF9iKSwNCgkJCW1hdGgucG93KG9wZXJhbmRfYS55LCBvcGVyYW5kX2IpLA0KCQkJbWF0aC5wb3cob3BlcmFuZF9hLnIsIG9wZXJhbmRfYikNCgkJKQ0KCWVuZA0KDQoJcmV0dXJuIGFuZ2xlKA0KCQltYXRoLnBvdyhvcGVyYW5kX2EucCwgb3BlcmFuZF9iLnApLA0KCQltYXRoLnBvdyhvcGVyYW5kX2EueSwgb3BlcmFuZF9iLnkpLA0KCQltYXRoLnBvdyhvcGVyYW5kX2Euciwgb3BlcmFuZF9iLnIpDQoJKQ0KZW5kDQoNCi0tLSBQZXJmb3JtcyBtb2R1bG8gb24gdGhlIGFuZ2xlIHdpdGggYW5vdGhlciBhbmdsZS4NCmZ1bmN0aW9uIGFuZ2xlX210Ll9fbW9kKG9wZXJhbmRfYSwgb3BlcmFuZF9iKQ0KCWlmICh0eXBlKG9wZXJhbmRfYSkgPT0gIm51bWJlciIpIHRoZW4NCgkJcmV0dXJuIGFuZ2xlKA0KCQkJb3BlcmFuZF9hICUgb3BlcmFuZF9iLnAsDQoJCQlvcGVyYW5kX2EgJSBvcGVyYW5kX2IueSwNCgkJCW9wZXJhbmRfYSAlIG9wZXJhbmRfYi5yDQoJCSkNCgllbmQNCg0KCWlmICh0eXBlKG9wZXJhbmRfYikgPT0gIm51bWJlciIpIHRoZW4NCgkJcmV0dXJuIGFuZ2xlKA0KCQkJb3BlcmFuZF9hLnAgJSBvcGVyYW5kX2IsDQoJCQlvcGVyYW5kX2EueSAlIG9wZXJhbmRfYiwNCgkJCW9wZXJhbmRfYS5yICUgb3BlcmFuZF9iDQoJCSkNCgllbmQNCg0KCXJldHVybiBhbmdsZSgNCgkJb3BlcmFuZF9hLnAgJSBvcGVyYW5kX2IucCwNCgkJb3BlcmFuZF9hLnkgJSBvcGVyYW5kX2IueSwNCgkJb3BlcmFuZF9hLnIgJSBvcGVyYW5kX2Iucg0KCSkNCmVuZA0KDQotLS0gUGVyZm9ybSBhIHVuYXJ5IG1pbnVzIG9wZXJhdGlvbiBvbiB0aGUgYW5nbGUuDQpmdW5jdGlvbiBhbmdsZV9tdC5fX3VubShvcGVyYW5kX2EpDQoJcmV0dXJuIGFuZ2xlKA0KCQktb3BlcmFuZF9hLnAsDQoJCS1vcGVyYW5kX2EueSwNCgkJLW9wZXJhbmRfYS5yDQoJKQ0KZW5kDQoNCi0tLSBDbGFtcHMgdGhlIGFuZ2xlJ3MgYW5nbGVzIHRvIHdob2xlIG51bWJlcnMuIEVxdWl2YWxlbnQgdG8gImFuZ2xlOnJvdW5kIiB3aXRoIG5vIHByZWNpc2lvbi4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGFuZ2xlX29sZF9jOnJvdW5kX3plcm8oKQ0KCXNlbGYucCA9IG1hdGguZmxvb3Ioc2VsZi5wICsgMC41KQ0KCXNlbGYueSA9IG1hdGguZmxvb3Ioc2VsZi55ICsgMC41KQ0KCXNlbGYuciA9IG1hdGguZmxvb3Ioc2VsZi5yICsgMC41KQ0KZW5kDQoNCi0tLSBSb3VuZCB0aGUgYW5nbGUncyBhbmdsZXMuDQotLS0gQHBhcmFtIHByZWNpc2lvbiBudW1iZXINCmZ1bmN0aW9uIGFuZ2xlX29sZF9jOnJvdW5kKHByZWNpc2lvbikNCglzZWxmLnAgPSBtYXRoLnJvdW5kKHNlbGYucCwgcHJlY2lzaW9uKQ0KCXNlbGYueSA9IG1hdGgucm91bmQoc2VsZi55LCBwcmVjaXNpb24pDQoJc2VsZi5yID0gbWF0aC5yb3VuZChzZWxmLnIsIHByZWNpc2lvbikNCmVuZA0KDQotLS0gQ2xhbXBzIHRoZSBhbmdsZSdzIGFuZ2xlcyB0byB0aGUgbmVhcmVzdCBiYXNlLg0KLS0tIEBwYXJhbSBiYXNlIG51bWJlcg0KZnVuY3Rpb24gYW5nbGVfb2xkX2M6cm91bmRfYmFzZShiYXNlKQ0KCXNlbGYucCA9IGJhc2UgKiBtYXRoLnJvdW5kKHNlbGYucCAvIGJhc2UpDQoJc2VsZi55ID0gYmFzZSAqIG1hdGgucm91bmQoc2VsZi55IC8gYmFzZSkNCglzZWxmLnIgPSBiYXNlICogbWF0aC5yb3VuZChzZWxmLnIgLyBiYXNlKQ0KZW5kDQoNCi0tLSBDbGFtcHMgdGhlIGFuZ2xlJ3MgYW5nbGVzIHRvIHdob2xlIG51bWJlcnMuIEVxdWl2YWxlbnQgdG8gImFuZ2xlOnJvdW5kIiB3aXRoIG5vIHByZWNpc2lvbi4NCi0tLSBAcmV0dXJuIGFuZ2xlX29sZF9jDQpmdW5jdGlvbiBhbmdsZV9vbGRfYzpyb3VuZGVkX3plcm8oKQ0KCXJldHVybiBhbmdsZSgNCgkJbWF0aC5mbG9vcihzZWxmLnAgKyAwLjUpLA0KCQltYXRoLmZsb29yKHNlbGYueSArIDAuNSksDQoJCW1hdGguZmxvb3Ioc2VsZi5yICsgMC41KQ0KCSkNCmVuZA0KDQotLS0gUm91bmQgdGhlIGFuZ2xlJ3MgYW5nbGVzLg0KLS0tIEBwYXJhbSBwcmVjaXNpb24gbnVtYmVyDQotLS0gQHJldHVybiBhbmdsZV9vbGRfYw0KZnVuY3Rpb24gYW5nbGVfb2xkX2M6cm91bmRlZChwcmVjaXNpb24pDQoJcmV0dXJuIGFuZ2xlKA0KCQltYXRoLnJvdW5kKHNlbGYucCwgcHJlY2lzaW9uKSwNCgkJbWF0aC5yb3VuZChzZWxmLnksIHByZWNpc2lvbiksDQoJCW1hdGgucm91bmQoc2VsZi5yLCBwcmVjaXNpb24pDQoJKQ0KZW5kDQoNCi0tLSBDbGFtcHMgdGhlIGFuZ2xlJ3MgYW5nbGVzIHRvIHRoZSBuZWFyZXN0IGJhc2UuDQotLS0gQHBhcmFtIGJhc2UgbnVtYmVyDQotLS0gQHJldHVybiBhbmdsZV9vbGRfYw0KZnVuY3Rpb24gYW5nbGVfb2xkX2M6cm91bmRlZF9iYXNlKGJhc2UpDQoJcmV0dXJuIGFuZ2xlKA0KCQliYXNlICogbWF0aC5yb3VuZChzZWxmLnAgLyBiYXNlKSwNCgkJYmFzZSAqIG1hdGgucm91bmQoc2VsZi55IC8gYmFzZSksDQoJCWJhc2UgKiBtYXRoLnJvdW5kKHNlbGYuciAvIGJhc2UpDQoJKQ0KZW5kDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiB2ZWN0b3INCi0tLSBAY2xhc3MgdmVjdG9yX29sZF9jDQotLS0gQGZpZWxkIHB1YmxpYyB4IG51bWJlciBYIGNvb3JkaW5hdGUuDQotLS0gQGZpZWxkIHB1YmxpYyB5IG51bWJlciBZIGNvb3JkaW5hdGUuDQotLS0gQGZpZWxkIHB1YmxpYyB6IG51bWJlciBaIGNvb3JkaW5hdGUuDQpsb2NhbCB2ZWN0b3Jfb2xkX2MgPSB7fQ0KbG9jYWwgdmVjdG9yX210ID0gew0KCV9faW5kZXggPSB2ZWN0b3Jfb2xkX2MsDQp9DQoNCi0tLSBPdmVyd3JpdGUgdGhlIHZlY3RvcidzIGNvb3JkaW5hdGVzLiBOaWwgd2lsbCBsZWF2ZSBjb29yZGluYXRlcyB1bmNoYW5nZWQuDQotLS0gQHBhcmFtIHhfbmV3IG51bWJlcg0KLS0tIEBwYXJhbSB5X25ldyBudW1iZXINCi0tLSBAcGFyYW0gel9uZXcgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQp2ZWN0b3JfbXQuX19jYWxsID0gZnVuY3Rpb24odmVjdG9yLCB4X25ldywgeV9uZXcsIHpfbmV3KQ0KCXhfbmV3ID0geF9uZXcgb3IgdmVjdG9yLngNCgl5X25ldyA9IHlfbmV3IG9yIHZlY3Rvci55DQoJel9uZXcgPSB6X25ldyBvciB2ZWN0b3Iueg0KDQoJdmVjdG9yLnggPSB4X25ldw0KCXZlY3Rvci55ID0geV9uZXcNCgl2ZWN0b3IueiA9IHpfbmV3DQplbmQNCg0KLS0tIENyZWF0ZSBhIG5ldyB2ZWN0b3Igb2JqZWN0Lg0KLS0tIEBwYXJhbSB4IG51bWJlcg0KLS0tIEBwYXJhbSB5IG51bWJlcg0KLS0tIEBwYXJhbSB6IG51bWJlcg0KLS0tIEByZXR1cm4gdmVjdG9yX29sZF9jDQpsb2NhbCBmdW5jdGlvbiB2ZWN0b3IoeCwgeSwgeikNCglyZXR1cm4gc2V0bWV0YXRhYmxlKA0KCQl7DQoJCQl4ID0geCBhbmQgeCBvciAwLA0KCQkJeSA9IHkgYW5kIHkgb3IgMCwNCgkJCXogPSB6IGFuZCB6IG9yIDANCgkJfSwNCgkJdmVjdG9yX210DQoJKQ0KZW5kDQoNCi0tLSBPZmZzZXQgdGhlIHZlY3RvcidzIGNvb3JkaW5hdGVzLiBOaWwgd2lsbCBsZWF2ZSB0aGUgY29vcmRpbmF0ZXMgdW5jaGFuZ2VkLg0KLS0tIEBwYXJhbSB4X29mZnNldCBudW1iZXINCi0tLSBAcGFyYW0geV9vZmZzZXQgbnVtYmVyDQotLS0gQHBhcmFtIHpfb2Zmc2V0IG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOm9mZnNldCh4X29mZnNldCwgeV9vZmZzZXQsIHpfb2Zmc2V0KQ0KCXhfb2Zmc2V0ID0geF9vZmZzZXQgb3IgMA0KCXlfb2Zmc2V0ID0geV9vZmZzZXQgb3IgMA0KCXpfb2Zmc2V0ID0gel9vZmZzZXQgb3IgMA0KDQoJc2VsZi54ID0gc2VsZi54ICsgeF9vZmZzZXQNCglzZWxmLnkgPSBzZWxmLnkgKyB5X29mZnNldA0KCXNlbGYueiA9IHNlbGYueiArIHpfb2Zmc2V0DQplbmQNCg0KLS0tIENsb25lIHRoZSB2ZWN0b3Igb2JqZWN0Lg0KLS0tIEByZXR1cm4gdmVjdG9yX29sZF9jDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6Y2xvbmUoKQ0KCXJldHVybiBzZXRtZXRhdGFibGUoDQoJCXsNCgkJCXggPSBzZWxmLngsDQoJCQl5ID0gc2VsZi55LA0KCQkJeiA9IHNlbGYueg0KCQl9LA0KCQl2ZWN0b3JfbXQNCgkpDQplbmQNCg0KLS0tIENsb25lIHRoZSB2ZWN0b3Igb2JqZWN0IGFuZCBvZmZzZXQgaXRzIGNvb3JkaW5hdGVzLiBOaWwgd2lsbCBsZWF2ZSB0aGUgY29vcmRpbmF0ZXMgdW5jaGFuZ2VkLg0KLS0tIEBwYXJhbSB4X29mZnNldCBudW1iZXINCi0tLSBAcGFyYW0geV9vZmZzZXQgbnVtYmVyDQotLS0gQHBhcmFtIHpfb2Zmc2V0IG51bWJlcg0KLS0tIEByZXR1cm4gdmVjdG9yX29sZF9jDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6Y2xvbmVfb2Zmc2V0KHhfb2Zmc2V0LCB5X29mZnNldCwgel9vZmZzZXQpDQoJeF9vZmZzZXQgPSB4X29mZnNldCBvciAwDQoJeV9vZmZzZXQgPSB5X29mZnNldCBvciAwDQoJel9vZmZzZXQgPSB6X29mZnNldCBvciAwDQoNCglyZXR1cm4gc2V0bWV0YXRhYmxlKA0KCQl7DQoJCQl4ID0gc2VsZi54ICsgeF9vZmZzZXQsDQoJCQl5ID0gc2VsZi55ICsgeV9vZmZzZXQsDQoJCQl6ID0gc2VsZi56ICsgel9vZmZzZXQNCgkJfSwNCgkJdmVjdG9yX210DQoJKQ0KZW5kDQoNCi0tLSBVbnBhY2sgdGhlIHZlY3Rvci4NCi0tLSBAcmV0dXJuIG51bWJlciwgbnVtYmVyLCBudW1iZXINCmZ1bmN0aW9uIHZlY3Rvcl9vbGRfYzp1bnBhY2soKQ0KCXJldHVybiBzZWxmLngsIHNlbGYueSwgc2VsZi56DQplbmQNCg0KLS0tIFNldCB0aGUgdmVjdG9yJ3MgY29vcmRpbmF0ZXMgdG8gMC4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHZlY3Rvcl9vbGRfYzpudWxsaWZ5KCkNCglzZWxmLnggPSAwDQoJc2VsZi55ID0gMA0KCXNlbGYueiA9IDANCmVuZA0KDQotLS0gUmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgdmVjdG9yLg0KZnVuY3Rpb24gdmVjdG9yX210Ll9fdG9zdHJpbmcob3BlcmFuZF9hKQ0KCXJldHVybiBzdHJpbmcuZm9ybWF0KCIlcywgJXMsICVzIiwgb3BlcmFuZF9hLngsIG9wZXJhbmRfYS55LCBvcGVyYW5kX2EueikNCmVuZA0KDQotLS0gQ29uY2F0ZW5hdGVzIHRoZSB2ZWN0b3IgaW4gYSBzdHJpbmcuDQpmdW5jdGlvbiB2ZWN0b3JfbXQuX19jb25jYXQob3BlcmFuZF9hKQ0KCXJldHVybiBzdHJpbmcuZm9ybWF0KCIlcywgJXMsICVzIiwgb3BlcmFuZF9hLngsIG9wZXJhbmRfYS55LCBvcGVyYW5kX2EueikNCmVuZA0KDQoNCi0tLSBSZXR1cm5zIHRydWUgaWYgdGhlIHZlY3RvcidzIGNvb3JkaW5hdGVzIGFyZSBlcXVhbCB0byBhbm90aGVyIHZlY3Rvci4NCmZ1bmN0aW9uIHZlY3Rvcl9tdC5fX2VxKG9wZXJhbmRfYSwgb3BlcmFuZF9iKQ0KCXJldHVybiAob3BlcmFuZF9hLnggPT0gb3BlcmFuZF9iLngpIGFuZCAob3BlcmFuZF9hLnkgPT0gb3BlcmFuZF9iLnkpIGFuZCAob3BlcmFuZF9hLnogPT0gb3BlcmFuZF9iLnopDQplbmQNCg0KLS0tIFJldHVybnMgdHJ1ZSBpZiB0aGUgdmVjdG9yIGlzIGxlc3MgdGhhbiBhbm90aGVyIHZlY3Rvci4NCmZ1bmN0aW9uIHZlY3Rvcl9tdC5fX2x0KG9wZXJhbmRfYSwgb3BlcmFuZF9iKQ0KCWlmICh0eXBlKG9wZXJhbmRfYSkgPT0gIm51bWJlciIpIHRoZW4NCgkJcmV0dXJuIChvcGVyYW5kX2EgPCBvcGVyYW5kX2IueCkgb3IgKG9wZXJhbmRfYSA8IG9wZXJhbmRfYi55KSBvciAob3BlcmFuZF9hIDwgb3BlcmFuZF9iLnopDQoJZW5kDQoNCglpZiAodHlwZShvcGVyYW5kX2IpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiAob3BlcmFuZF9hLnggPCBvcGVyYW5kX2IpIG9yIChvcGVyYW5kX2EueSA8IG9wZXJhbmRfYikgb3IgKG9wZXJhbmRfYS56IDwgb3BlcmFuZF9iKQ0KCWVuZA0KDQoJcmV0dXJuIChvcGVyYW5kX2EueCA8IG9wZXJhbmRfYi54KSBvciAob3BlcmFuZF9hLnkgPCBvcGVyYW5kX2IueSkgb3IgKG9wZXJhbmRfYS56IDwgb3BlcmFuZF9iLnopDQplbmQNCg0KLS0tIFJldHVybnMgdHJ1ZSBpZiB0aGUgdmVjdG9yIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byBhbm90aGVyIHZlY3Rvci4NCmZ1bmN0aW9uIHZlY3Rvcl9tdC5fX2xlKG9wZXJhbmRfYSwgb3BlcmFuZF9iKQ0KCWlmICh0eXBlKG9wZXJhbmRfYSkgPT0gIm51bWJlciIpIHRoZW4NCgkJcmV0dXJuIChvcGVyYW5kX2EgPD0gb3BlcmFuZF9iLngpIG9yIChvcGVyYW5kX2EgPD0gb3BlcmFuZF9iLnkpIG9yIChvcGVyYW5kX2EgPD0gb3BlcmFuZF9iLnopDQoJZW5kDQoNCglpZiAodHlwZShvcGVyYW5kX2IpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiAob3BlcmFuZF9hLnggPD0gb3BlcmFuZF9iKSBvciAob3BlcmFuZF9hLnkgPD0gb3BlcmFuZF9iKSBvciAob3BlcmFuZF9hLnogPD0gb3BlcmFuZF9iKQ0KCWVuZA0KDQoJcmV0dXJuIChvcGVyYW5kX2EueCA8PSBvcGVyYW5kX2IueCkgb3IgKG9wZXJhbmRfYS55IDw9IG9wZXJhbmRfYi55KSBvciAob3BlcmFuZF9hLnogPD0gb3BlcmFuZF9iLnopDQplbmQNCg0KLS0tIEFkZCBhIHZlY3RvciB0byBhbm90aGVyIHZlY3Rvci4NCmZ1bmN0aW9uIHZlY3Rvcl9tdC5fX2FkZChvcGVyYW5kX2EsIG9wZXJhbmRfYikNCglpZiAodHlwZShvcGVyYW5kX2EpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiB2ZWN0b3IoDQoJCQlvcGVyYW5kX2EgKyBvcGVyYW5kX2IueCwNCgkJCW9wZXJhbmRfYSArIG9wZXJhbmRfYi55LA0KCQkJb3BlcmFuZF9hICsgb3BlcmFuZF9iLnoNCgkJKQ0KCWVuZA0KDQoJaWYgKHR5cGUob3BlcmFuZF9iKSA9PSAibnVtYmVyIikgdGhlbg0KCQlyZXR1cm4gdmVjdG9yKA0KCQkJb3BlcmFuZF9hLnggKyBvcGVyYW5kX2IsDQoJCQlvcGVyYW5kX2EueSArIG9wZXJhbmRfYiwNCgkJCW9wZXJhbmRfYS56ICsgb3BlcmFuZF9iDQoJCSkNCgllbmQNCg0KCXJldHVybiB2ZWN0b3IoDQoJCW9wZXJhbmRfYS54ICsgb3BlcmFuZF9iLngsDQoJCW9wZXJhbmRfYS55ICsgb3BlcmFuZF9iLnksDQoJCW9wZXJhbmRfYS56ICsgb3BlcmFuZF9iLnoNCgkpDQplbmQNCg0KLS0tIFN1YnRyYWN0IGEgdmVjdG9yIGZyb20gYW5vdGhlciB2ZWN0b3IuDQpmdW5jdGlvbiB2ZWN0b3JfbXQuX19zdWIob3BlcmFuZF9hLCBvcGVyYW5kX2IpDQoJaWYgKHR5cGUob3BlcmFuZF9hKSA9PSAibnVtYmVyIikgdGhlbg0KCQlyZXR1cm4gdmVjdG9yKA0KCQkJb3BlcmFuZF9hIC0gb3BlcmFuZF9iLngsDQoJCQlvcGVyYW5kX2EgLSBvcGVyYW5kX2IueSwNCgkJCW9wZXJhbmRfYSAtIG9wZXJhbmRfYi56DQoJCSkNCgllbmQNCg0KCWlmICh0eXBlKG9wZXJhbmRfYikgPT0gIm51bWJlciIpIHRoZW4NCgkJcmV0dXJuIHZlY3RvcigNCgkJCW9wZXJhbmRfYS54IC0gb3BlcmFuZF9iLA0KCQkJb3BlcmFuZF9hLnkgLSBvcGVyYW5kX2IsDQoJCQlvcGVyYW5kX2EueiAtIG9wZXJhbmRfYg0KCQkpDQoJZW5kDQoNCglyZXR1cm4gdmVjdG9yKA0KCQlvcGVyYW5kX2EueCAtIG9wZXJhbmRfYi54LA0KCQlvcGVyYW5kX2EueSAtIG9wZXJhbmRfYi55LA0KCQlvcGVyYW5kX2EueiAtIG9wZXJhbmRfYi56DQoJKQ0KZW5kDQoNCi0tLSBNdWx0aXBseSBhIHZlY3RvciB3aXRoIGFub3RoZXIgdmVjdG9yLg0KZnVuY3Rpb24gdmVjdG9yX210Ll9fbXVsKG9wZXJhbmRfYSwgb3BlcmFuZF9iKQ0KCWlmICh0eXBlKG9wZXJhbmRfYSkgPT0gIm51bWJlciIpIHRoZW4NCgkJcmV0dXJuIHZlY3RvcigNCgkJCW9wZXJhbmRfYSAqIG9wZXJhbmRfYi54LA0KCQkJb3BlcmFuZF9hICogb3BlcmFuZF9iLnksDQoJCQlvcGVyYW5kX2EgKiBvcGVyYW5kX2Iueg0KCQkpDQoJZW5kDQoNCglpZiAodHlwZShvcGVyYW5kX2IpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiB2ZWN0b3IoDQoJCQlvcGVyYW5kX2EueCAqIG9wZXJhbmRfYiwNCgkJCW9wZXJhbmRfYS55ICogb3BlcmFuZF9iLA0KCQkJb3BlcmFuZF9hLnogKiBvcGVyYW5kX2INCgkJKQ0KCWVuZA0KDQoJcmV0dXJuIHZlY3RvcigNCgkJb3BlcmFuZF9hLnggKiBvcGVyYW5kX2IueCwNCgkJb3BlcmFuZF9hLnkgKiBvcGVyYW5kX2IueSwNCgkJb3BlcmFuZF9hLnogKiBvcGVyYW5kX2Iueg0KCSkNCmVuZA0KDQotLS0gRGl2aWRlIGEgdmVjdG9yIGJ5IGFub3RoZXIgdmVjdG9yLg0KZnVuY3Rpb24gdmVjdG9yX210Ll9fZGl2KG9wZXJhbmRfYSwgb3BlcmFuZF9iKQ0KCWlmICh0eXBlKG9wZXJhbmRfYSkgPT0gIm51bWJlciIpIHRoZW4NCgkJcmV0dXJuIHZlY3RvcigNCgkJCW9wZXJhbmRfYSAvIG9wZXJhbmRfYi54LA0KCQkJb3BlcmFuZF9hIC8gb3BlcmFuZF9iLnksDQoJCQlvcGVyYW5kX2EgLyBvcGVyYW5kX2Iueg0KCQkpDQoJZW5kDQoNCglpZiAodHlwZShvcGVyYW5kX2IpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiB2ZWN0b3IoDQoJCQlvcGVyYW5kX2EueCAvIG9wZXJhbmRfYiwNCgkJCW9wZXJhbmRfYS55IC8gb3BlcmFuZF9iLA0KCQkJb3BlcmFuZF9hLnogLyBvcGVyYW5kX2INCgkJKQ0KCWVuZA0KDQoJcmV0dXJuIHZlY3RvcigNCgkJb3BlcmFuZF9hLnggLyBvcGVyYW5kX2IueCwNCgkJb3BlcmFuZF9hLnkgLyBvcGVyYW5kX2IueSwNCgkJb3BlcmFuZF9hLnogLyBvcGVyYW5kX2Iueg0KCSkNCmVuZA0KDQotLS0gUmFpc2VkIGEgdmVjdG9yIHRvIHRoZSBwb3dlciBvZiBhbm90aGVyIHZlY3Rvci4NCmZ1bmN0aW9uIHZlY3Rvcl9tdC5fX3BvdyhvcGVyYW5kX2EsIG9wZXJhbmRfYikNCglpZiAodHlwZShvcGVyYW5kX2EpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiB2ZWN0b3IoDQoJCQltYXRoLnBvdyhvcGVyYW5kX2EsIG9wZXJhbmRfYi54KSwNCgkJCW1hdGgucG93KG9wZXJhbmRfYSwgb3BlcmFuZF9iLnkpLA0KCQkJbWF0aC5wb3cob3BlcmFuZF9hLCBvcGVyYW5kX2IueikNCgkJKQ0KCWVuZA0KDQoJaWYgKHR5cGUob3BlcmFuZF9iKSA9PSAibnVtYmVyIikgdGhlbg0KCQlyZXR1cm4gdmVjdG9yKA0KCQkJbWF0aC5wb3cob3BlcmFuZF9hLngsIG9wZXJhbmRfYiksDQoJCQltYXRoLnBvdyhvcGVyYW5kX2EueSwgb3BlcmFuZF9iKSwNCgkJCW1hdGgucG93KG9wZXJhbmRfYS56LCBvcGVyYW5kX2IpDQoJCSkNCgllbmQNCg0KCXJldHVybiB2ZWN0b3IoDQoJCW1hdGgucG93KG9wZXJhbmRfYS54LCBvcGVyYW5kX2IueCksDQoJCW1hdGgucG93KG9wZXJhbmRfYS55LCBvcGVyYW5kX2IueSksDQoJCW1hdGgucG93KG9wZXJhbmRfYS56LCBvcGVyYW5kX2IueikNCgkpDQplbmQNCg0KLS0tIFBlcmZvcm1zIGEgbW9kdWxvIG9wZXJhdGlvbiBvbiBhIHZlY3RvciB3aXRoIGFub3RoZXIgdmVjdG9yLg0KZnVuY3Rpb24gdmVjdG9yX210Ll9fbW9kKG9wZXJhbmRfYSwgb3BlcmFuZF9iKQ0KCWlmICh0eXBlKG9wZXJhbmRfYSkgPT0gIm51bWJlciIpIHRoZW4NCgkJcmV0dXJuIHZlY3RvcigNCgkJCW9wZXJhbmRfYSAlIG9wZXJhbmRfYi54LA0KCQkJb3BlcmFuZF9hICUgb3BlcmFuZF9iLnksDQoJCQlvcGVyYW5kX2EgJSBvcGVyYW5kX2Iueg0KCQkpDQoJZW5kDQoNCglpZiAodHlwZShvcGVyYW5kX2IpID09ICJudW1iZXIiKSB0aGVuDQoJCXJldHVybiB2ZWN0b3IoDQoJCQlvcGVyYW5kX2EueCAlIG9wZXJhbmRfYiwNCgkJCW9wZXJhbmRfYS55ICUgb3BlcmFuZF9iLA0KCQkJb3BlcmFuZF9hLnogJSBvcGVyYW5kX2INCgkJKQ0KCWVuZA0KDQoJcmV0dXJuIHZlY3RvcigNCgkJb3BlcmFuZF9hLnggJSBvcGVyYW5kX2IueCwNCgkJb3BlcmFuZF9hLnkgJSBvcGVyYW5kX2IueSwNCgkJb3BlcmFuZF9hLnogJSBvcGVyYW5kX2Iueg0KCSkNCmVuZA0KDQotLS0gUGVyZm9ybSBhIHVuYXJ5IG1pbnVzIG9wZXJhdGlvbiBvbiB0aGUgdmVjdG9yLg0KZnVuY3Rpb24gdmVjdG9yX210Ll9fdW5tKG9wZXJhbmRfYSkNCglyZXR1cm4gdmVjdG9yKA0KCQktb3BlcmFuZF9hLngsDQoJCS1vcGVyYW5kX2EueSwNCgkJLW9wZXJhbmRfYS56DQoJKQ0KZW5kDQoNCi0tLSBSZXR1cm5zIHRoZSB2ZWN0b3IncyAyIGRpbWVuc2lvbmFsIGxlbmd0aCBzcXVhcmVkLg0KLS0tIEByZXR1cm4gbnVtYmVyDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6bGVuZ3RoMl9zcXVhcmVkKCkNCglyZXR1cm4gKHNlbGYueCAqIHNlbGYueCkgKyAoc2VsZi55ICogc2VsZi55KTsNCmVuZA0KDQotLS0gUmV0dXJuJ3MgdGhlIHZlY3RvcidzIDIgZGltZW5zaW9uYWwgbGVuZ3RoLg0KLS0tIEByZXR1cm4gbnVtYmVyDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6bGVuZ3RoMigpDQoJcmV0dXJuIG1hdGguc3FydChzZWxmOmxlbmd0aDJfc3F1YXJlZCgpKQ0KZW5kDQoNCi0tLSBSZXR1cm5zIHRoZSB2ZWN0b3IncyAzIGRpbWVuc2lvbmFsIGxlbmd0aCBzcXVhcmVkLg0KLS0tIEByZXR1cm4gbnVtYmVyDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6bGVuZ3RoX3NxdWFyZWQoKQ0KCXJldHVybiAoc2VsZi54ICogc2VsZi54KSArIChzZWxmLnkgKiBzZWxmLnkpICsgKHNlbGYueiAqIHNlbGYueik7DQplbmQNCg0KLS0tIFJldHVybidzIHRoZSB2ZWN0b3IncyAzIGRpbWVuc2lvbmFsIGxlbmd0aC4NCi0tLSBAcmV0dXJuIG51bWJlcg0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOmxlbmd0aCgpDQoJcmV0dXJuIG1hdGguc3FydChzZWxmOmxlbmd0aF9zcXVhcmVkKCkpDQplbmQNCg0KLS0tIFJldHVybnMgdGhlIHZlY3RvcidzIGRvdCBwcm9kdWN0Lg0KLS0tIEBwYXJhbSBvdGhlcl92ZWN0b3IgdmVjdG9yX29sZF9jDQotLS0gQHJldHVybiBudW1iZXINCmZ1bmN0aW9uIHZlY3Rvcl9vbGRfYzpkb3RfcHJvZHVjdChvdGhlcl92ZWN0b3IpDQoJcmV0dXJuIChzZWxmLnggKiBvdGhlcl92ZWN0b3IueCkgKyAoc2VsZi55ICogb3RoZXJfdmVjdG9yLnkpICsgKHNlbGYueiAqIG90aGVyX3ZlY3Rvci56KQ0KZW5kDQoNCi0tLSBSZXR1cm5zIHRoZSB2ZWN0b3IncyBjcm9zcyBwcm9kdWN0Lg0KLS0tIEBwYXJhbSBvdGhlcl92ZWN0b3IgdmVjdG9yX29sZF9jDQotLS0gQHJldHVybiB2ZWN0b3Jfb2xkX2MNCmZ1bmN0aW9uIHZlY3Rvcl9vbGRfYzpjcm9zc19wcm9kdWN0KG90aGVyX3ZlY3RvcikNCglyZXR1cm4gdmVjdG9yX29sZF9jKA0KCQkoc2VsZi55ICogb3RoZXJfdmVjdG9yLnopIC0gKHNlbGYueiAqIG90aGVyX3ZlY3Rvci55KSwNCgkJKHNlbGYueiAqIG90aGVyX3ZlY3Rvci54KSAtIChzZWxmLnggKiBvdGhlcl92ZWN0b3IueiksDQoJCShzZWxmLnggKiBvdGhlcl92ZWN0b3IueSkgLSAoc2VsZi55ICogb3RoZXJfdmVjdG9yLngpDQoJKQ0KZW5kDQoNCi0tLSBSZXR1cm5zIHRoZSAyIGRpbWVuc2lvbmFsIGRpc3RhbmNlIGJldHdlZW4gdGhlIHZlY3RvciBhbmQgYW5vdGhlciB2ZWN0b3IuDQotLS0gQHBhcmFtIG90aGVyX3ZlY3RvciB2ZWN0b3Jfb2xkX2MNCi0tLSBAcmV0dXJuIG51bWJlcg0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOmRpc3RhbmNlMihvdGhlcl92ZWN0b3IpDQoJcmV0dXJuIChvdGhlcl92ZWN0b3IgLSBzZWxmKTpsZW5ndGgyKCkNCmVuZA0KDQotLS0gUmV0dXJucyB0aGUgMyBkaW1lbnNpb25hbCBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB2ZWN0b3IgYW5kIGFub3RoZXIgdmVjdG9yLg0KLS0tIEBwYXJhbSBvdGhlcl92ZWN0b3IgdmVjdG9yX29sZF9jDQotLS0gQHJldHVybiBudW1iZXINCmZ1bmN0aW9uIHZlY3Rvcl9vbGRfYzpkaXN0YW5jZShvdGhlcl92ZWN0b3IpDQoJcmV0dXJuIChvdGhlcl92ZWN0b3IgLSBzZWxmKTpsZW5ndGgoKQ0KZW5kDQoNCi0tLSBSZXR1cm5zIHRoZSBkaXN0YW5jZSBvbiB0aGUgWCBheGlzIGJldHdlZW4gdGhlIHZlY3RvciBhbmQgYW5vdGhlciB2ZWN0b3IuDQotLS0gQHBhcmFtIG90aGVyX3ZlY3RvciB2ZWN0b3Jfb2xkX2MNCi0tLSBAcmV0dXJuIG51bWJlcg0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOmRpc3RhbmNlX3gob3RoZXJfdmVjdG9yKQ0KCXJldHVybiBtYXRoLmFicyhzZWxmLnggLSBvdGhlcl92ZWN0b3IueCkNCmVuZA0KDQotLS0gUmV0dXJucyB0aGUgZGlzdGFuY2Ugb24gdGhlIFkgYXhpcyBiZXR3ZWVuIHRoZSB2ZWN0b3IgYW5kIGFub3RoZXIgdmVjdG9yLg0KLS0tIEBwYXJhbSBvdGhlcl92ZWN0b3IgdmVjdG9yX29sZF9jDQotLS0gQHJldHVybiBudW1iZXINCmZ1bmN0aW9uIHZlY3Rvcl9vbGRfYzpkaXN0YW5jZV95KG90aGVyX3ZlY3RvcikNCglyZXR1cm4gbWF0aC5hYnMoc2VsZi55IC0gb3RoZXJfdmVjdG9yLnkpDQplbmQNCg0KLS0tIFJldHVybnMgdGhlIGRpc3RhbmNlIG9uIHRoZSBaIGF4aXMgYmV0d2VlbiB0aGUgdmVjdG9yIGFuZCBhbm90aGVyIHZlY3Rvci4NCi0tLSBAcGFyYW0gb3RoZXJfdmVjdG9yIHZlY3Rvcl9vbGRfYw0KLS0tIEByZXR1cm4gbnVtYmVyDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6ZGlzdGFuY2VfeihvdGhlcl92ZWN0b3IpDQoJcmV0dXJuIG1hdGguYWJzKHNlbGYueiAtIG90aGVyX3ZlY3Rvci56KQ0KZW5kDQoNCi0tLSBSZXR1cm5zIHRydWUgaWYgdGhlIHZlY3RvciBpcyB3aXRoaW4gdGhlIGdpdmVuIGRpc3RhbmNlIHRvIGFub3RoZXIgdmVjdG9yLg0KLS0tIEBwYXJhbSBvdGhlcl92ZWN0b3IgdmVjdG9yX29sZF9jDQotLS0gQHBhcmFtIGRpc3RhbmNlIG51bWJlcg0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOmluX3JhbmdlKG90aGVyX3ZlY3RvciwgZGlzdGFuY2UpDQoJcmV0dXJuIHNlbGY6ZGlzdGFuY2Uob3RoZXJfdmVjdG9yKSA8PSBkaXN0YW5jZQ0KZW5kDQoNCi0tLSBDbGFtcHMgdGhlIHZlY3RvcidzIGNvb3JkaW5hdGVzIHRvIHdob2xlIG51bWJlcnMuIEVxdWl2YWxlbnQgdG8gInZlY3Rvcjpyb3VuZCIgd2l0aCBubyBwcmVjaXNpb24uDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6cm91bmRfemVybygpDQoJc2VsZi54ID0gbWF0aC5mbG9vcihzZWxmLnggKyAwLjUpDQoJc2VsZi55ID0gbWF0aC5mbG9vcihzZWxmLnkgKyAwLjUpDQoJc2VsZi56ID0gbWF0aC5mbG9vcihzZWxmLnogKyAwLjUpDQplbmQNCg0KLS0tIFJvdW5kIHRoZSB2ZWN0b3IncyBjb29yZGluYXRlcy4NCi0tLSBAcGFyYW0gcHJlY2lzaW9uIG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOnJvdW5kKHByZWNpc2lvbikNCglzZWxmLnggPSBtYXRoLnJvdW5kKHNlbGYueCwgcHJlY2lzaW9uKQ0KCXNlbGYueSA9IG1hdGgucm91bmQoc2VsZi55LCBwcmVjaXNpb24pDQoJc2VsZi56ID0gbWF0aC5yb3VuZChzZWxmLnosIHByZWNpc2lvbikNCmVuZA0KDQotLS0gQ2xhbXBzIHRoZSB2ZWN0b3IncyBjb29yZGluYXRlcyB0byB0aGUgbmVhcmVzdCBiYXNlLg0KLS0tIEBwYXJhbSBiYXNlIG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOnJvdW5kX2Jhc2UoYmFzZSkNCglzZWxmLnggPSBiYXNlICogbWF0aC5yb3VuZChzZWxmLnggLyBiYXNlKQ0KCXNlbGYueSA9IGJhc2UgKiBtYXRoLnJvdW5kKHNlbGYueSAvIGJhc2UpDQoJc2VsZi56ID0gYmFzZSAqIG1hdGgucm91bmQoc2VsZi56IC8gYmFzZSkNCmVuZA0KDQotLS0gQ2xhbXBzIHRoZSB2ZWN0b3IncyBjb29yZGluYXRlcyB0byB3aG9sZSBudW1iZXJzLiBFcXVpdmFsZW50IHRvICJ2ZWN0b3I6cm91bmQiIHdpdGggbm8gcHJlY2lzaW9uLg0KLS0tIEByZXR1cm4gdmVjdG9yX29sZF9jDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6cm91bmRlZF96ZXJvKCkNCglyZXR1cm4gdmVjdG9yKA0KCQltYXRoLmZsb29yKHNlbGYueCArIDAuNSksDQoJCW1hdGguZmxvb3Ioc2VsZi55ICsgMC41KSwNCgkJbWF0aC5mbG9vcihzZWxmLnogKyAwLjUpDQoJKQ0KZW5kDQoNCi0tLSBSb3VuZCB0aGUgdmVjdG9yJ3MgY29vcmRpbmF0ZXMuDQotLS0gQHBhcmFtIHByZWNpc2lvbiBudW1iZXINCi0tLSBAcmV0dXJuIHZlY3Rvcl9vbGRfYw0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOnJvdW5kZWQocHJlY2lzaW9uKQ0KCXJldHVybiB2ZWN0b3IoDQoJCW1hdGgucm91bmQoc2VsZi54LCBwcmVjaXNpb24pLA0KCQltYXRoLnJvdW5kKHNlbGYueSwgcHJlY2lzaW9uKSwNCgkJbWF0aC5yb3VuZChzZWxmLnosIHByZWNpc2lvbikNCgkpDQplbmQNCg0KLS0tIENsYW1wcyB0aGUgdmVjdG9yJ3MgY29vcmRpbmF0ZXMgdG8gdGhlIG5lYXJlc3QgYmFzZS4NCi0tLSBAcGFyYW0gYmFzZSBudW1iZXINCi0tLSBAcmV0dXJuIHZlY3Rvcl9vbGRfYw0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOnJvdW5kZWRfYmFzZShiYXNlKQ0KCXJldHVybiB2ZWN0b3IoDQoJCWJhc2UgKiBtYXRoLnJvdW5kKHNlbGYueCAvIGJhc2UpLA0KCQliYXNlICogbWF0aC5yb3VuZChzZWxmLnkgLyBiYXNlKSwNCgkJYmFzZSAqIG1hdGgucm91bmQoc2VsZi56IC8gYmFzZSkNCgkpDQplbmQNCg0KLS0tIE5vcm1hbGl6ZSB0aGUgdmVjdG9yLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOm5vcm1hbGl6ZSgpDQoJbG9jYWwgbGVuZ3RoID0gc2VsZjpsZW5ndGgoKQ0KDQoJLS0gUHJldmVudCBwb3NzaWJsZSBkaXZpZGUtYnktemVybyBlcnJvcnMuDQoJaWYgKGxlbmd0aCB+PSAwKSB0aGVuDQoJCXNlbGYueCA9IHNlbGYueCAvIGxlbmd0aA0KCQlzZWxmLnkgPSBzZWxmLnkgLyBsZW5ndGgNCgkJc2VsZi56ID0gc2VsZi56IC8gbGVuZ3RoDQoJZWxzZQ0KCQlzZWxmLnggPSAwDQoJCXNlbGYueSA9IDANCgkJc2VsZi56ID0gMQ0KCWVuZA0KZW5kDQoNCi0tLSBSZXR1cm5zIHRoZSBub3JtYWxpemVkIGxlbmd0aCBvZiBhIHZlY3Rvci4NCi0tLSBAcmV0dXJuIG51bWJlcg0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOm5vcm1hbGl6ZWRfbGVuZ3RoKCkNCglyZXR1cm4gc2VsZjpsZW5ndGgoKQ0KZW5kDQoNCi0tLSBSZXR1cm5zIGEgY29weSBvZiB0aGUgdmVjdG9yLCBub3JtYWxpemVkLg0KLS0tIEByZXR1cm4gdmVjdG9yX29sZF9jDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6bm9ybWFsaXplZCgpDQoJbG9jYWwgbGVuZ3RoID0gc2VsZjpsZW5ndGgoKQ0KDQoJaWYgKGxlbmd0aCB+PSAwKSB0aGVuDQoJCXJldHVybiB2ZWN0b3IoDQoJCQlzZWxmLnggLyBsZW5ndGgsDQoJCQlzZWxmLnkgLyBsZW5ndGgsDQoJCQlzZWxmLnogLyBsZW5ndGgNCgkJKQ0KCWVsc2UNCgkJcmV0dXJuIHZlY3RvcigwLCAwLCAxKQ0KCWVuZA0KZW5kDQoNCi0tLSBSZXR1cm5zIGEgbmV3IDIgZGltZW5zaW9uYWwgdmVjdG9yIG9mIHRoZSBvcmlnaW5hbCB2ZWN0b3Igd2hlbiBtYXBwZWQgdG8gdGhlIHNjcmVlbiwgb3IgbmlsIGlmIHRoZSB2ZWN0b3IgaXMgb2ZmLXNjcmVlbi4NCi0tLSBAcmV0dXJuIHZlY3Rvcl9vbGRfYw0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOnRvX3NjcmVlbigpDQoJbG9jYWwgeCwgeSA9IHJlbmRlcmVyLndvcmxkX3RvX3NjcmVlbihzZWxmLngsIHNlbGYueSwgc2VsZi56KQ0KDQoJaWYgKHggPT0gbmlsIG9yIHkgPT0gbmlsKSB0aGVuDQoJCXJldHVybiBuaWwNCgllbmQNCg0KCXJldHVybiB2ZWN0b3IoeCwgeSkNCmVuZA0KDQotLS0gUmV0dXJucyB0aGUgbWFnbml0dWRlIG9mIHRoZSB2ZWN0b3IsIHVzZSB0aGlzIHRvIGRldGVybWluZSB0aGUgc3BlZWQgb2YgdGhlIHZlY3RvciBpZiBpdCdzIGEgdmVsb2NpdHkgdmVjdG9yLg0KLS0tIEByZXR1cm4gbnVtYmVyDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6bWFnbml0dWRlKCkNCglyZXR1cm4gbWF0aC5zcXJ0KA0KCQltYXRoLnBvdyhzZWxmLngsIDIpICsNCgkJCW1hdGgucG93KHNlbGYueSwgMikgKw0KCQkJbWF0aC5wb3coc2VsZi56LCAyKQ0KCSkNCmVuZA0KDQotLS0gUmV0dXJucyB0aGUgYW5nbGUgb2YgdGhlIHZlY3RvciBpbiByZWdhcmRzIHRvIGFub3RoZXIgdmVjdG9yLg0KLS0tIEBwYXJhbSBkZXN0aW5hdGlvbiB2ZWN0b3Jfb2xkX2MNCi0tLSBAcmV0dXJuIGFuZ2xlX29sZF9jDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6YW5nbGVfdG8oZGVzdGluYXRpb24pDQoJLS0gQ2FsY3VsYXRlIHRoZSBkZWx0YSBvZiB2ZWN0b3JzLg0KCWxvY2FsIGRlbHRhX3ZlY3RvciA9IHZlY3RvcihkZXN0aW5hdGlvbi54IC0gc2VsZi54LCBkZXN0aW5hdGlvbi55IC0gc2VsZi55LCBkZXN0aW5hdGlvbi56IC0gc2VsZi56KQ0KDQoJaWYgKGRlbHRhX3ZlY3Rvci54ID09IDAgYW5kIGRlbHRhX3ZlY3Rvci55ID09IDApIHRoZW4NCgkJcmV0dXJuIGFuZ2xlKChkZWx0YV92ZWN0b3IueiA+IDAgYW5kIDI3MCBvciA5MCksIDApDQoJZWxzZQ0KCQktLSBDYWxjdWxhdGUgdGhlIHlhdy4NCgkJbG9jYWwgeWF3ID0gbWF0aC5kZWcobWF0aC5hdGFuMihkZWx0YV92ZWN0b3IueSwgZGVsdGFfdmVjdG9yLngpKQ0KDQoJCS0tIENhbGN1bGF0ZSB0aGUgcGl0Y2guDQoJCWxvY2FsIGh5cCA9IG1hdGguc3FydChkZWx0YV92ZWN0b3IueCAqIGRlbHRhX3ZlY3Rvci54ICsgZGVsdGFfdmVjdG9yLnkgKiBkZWx0YV92ZWN0b3IueSkNCgkJbG9jYWwgcGl0Y2ggPSBtYXRoLmRlZyhtYXRoLmF0YW4yKC1kZWx0YV92ZWN0b3IueiwgaHlwKSkNCg0KCQlyZXR1cm4gYW5nbGUocGl0Y2gsIHlhdykNCgllbmQNCmVuZA0KDQotLS0gUmV0dXJucyB0aGUgcmVzdWx0IG9mIGNsaWVudC50cmFjZV9saW5lIGJldHdlZW4gdHdvIHZlY3RvcnMuDQotLS0gQHBhcmFtIGRlc3RpbmF0aW9uIHZlY3Rvcl9vbGRfYw0KLS0tIEBwYXJhbSBza2lwX2VudGluZGV4IG51bWJlcg0KLS0tIEByZXR1cm4gbnVtYmVyLCBudW1iZXJ8bmlsDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6dHJhY2VfbGluZV90byhkZXN0aW5hdGlvbiwgc2tpcF9lbnRpbmRleCkNCglza2lwX2VudGluZGV4ID0gc2tpcF9lbnRpbmRleCBvciAtMQ0KDQoJcmV0dXJuIGNsaWVudC50cmFjZV9saW5lKA0KCQlza2lwX2VudGluZGV4LA0KCQlzZWxmLngsDQoJCXNlbGYueSwNCgkJc2VsZi56LA0KCQlkZXN0aW5hdGlvbi54LA0KCQlkZXN0aW5hdGlvbi55LA0KCQlkZXN0aW5hdGlvbi56DQoJKQ0KZW5kDQoNCi0tLSBMZXJwIHRvIGFub3RoZXIgdmVjdG9yLg0KLS0tIEBwYXJhbSB0YXJnZXQgdmVjdG9yX29sZF9jDQotLS0gQHBhcmFtIHBlcmNlbnRhZ2UgbnVtYmVyDQotLS0gQHJldHVybiB2ZWN0b3Jfb2xkX2MNCmZ1bmN0aW9uIHZlY3Rvcl9vbGRfYzpsZXJwKHRhcmdldCwgcGVyY2VudGFnZSkNCglyZXR1cm4gc2VsZiArICh0YXJnZXQgLSBzZWxmKSAqIHBlcmNlbnRhZ2UNCmVuZA0KDQotLS0gVHJhY2UgbGluZSB0byBhbm90aGVyIHZlY3RvciBhbmQgcmV0dXJuIHRoZSBpbXBhY3QgcG9pbnQuDQotLS0gQHBhcmFtIGRlc3RpbmF0aW9uIHZlY3Rvcl9vbGRfYw0KLS0tIEBwYXJhbSBza2lwX2VudGluZGV4IG51bWJlcg0KLS0tIEByZXR1cm4gbnVtYmVyLCBudW1iZXIsIHZlY3Rvcl9vbGRfYw0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOnRyYWNlX2xpbmVfaW1wYWN0KGRlc3RpbmF0aW9uLCBza2lwX2VudGluZGV4KQ0KCXNraXBfZW50aW5kZXggPSBza2lwX2VudGluZGV4IG9yIC0xDQoNCglsb2NhbCBmcmFjdGlvbiwgZWlkID0gY2xpZW50LnRyYWNlX2xpbmUoc2tpcF9lbnRpbmRleCwgc2VsZi54LCBzZWxmLnksIHNlbGYueiwgZGVzdGluYXRpb24ueCwgZGVzdGluYXRpb24ueSwgZGVzdGluYXRpb24ueikNCglsb2NhbCBpbXBhY3QgPSBzZWxmOmxlcnAoZGVzdGluYXRpb24sIGZyYWN0aW9uKQ0KDQoJcmV0dXJuIGZyYWN0aW9uLCBlaWQsIGltcGFjdA0KZW5kDQoNCi0tLSBUcmFjZSBsaW5lIHRvIGFub3RoZXIgdmVjdG9yLCBza2lwcGluZyBhbnkgZW50aXR5IGluZGljZXMgcmV0dXJuZWQgYnkgdGhlIGNhbGxiYWNrLg0KLS0tIEBwYXJhbSBkZXN0aW5hdGlvbiB2ZWN0b3Jfb2xkX2MNCi0tLSBAcGFyYW0gY2FsbGJhY2sgZnVuKGVpZDogbnVtYmVyKTogYm9vbGVhbg0KLS0tIEBwYXJhbSBtYXhfdHJhY2VzIG51bWJlcg0KLS0tIEByZXR1cm4gbnVtYmVyLCBudW1iZXIsIHZlY3Rvcl9vbGRfYw0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOnRyYWNlX2xpbmVfc2tpcChkZXN0aW5hdGlvbiwgY2FsbGJhY2ssIG1heF90cmFjZXMpDQoJbWF4X3RyYWNlcyA9IG1heF90cmFjZXMgb3IgMTANCg0KCWxvY2FsIGZyYWN0aW9uLCBlaWQgPSAwLCAtMQ0KCWxvY2FsIGltcGFjdCA9IHNlbGYNCglsb2NhbCBpID0gMA0KDQoJd2hpbGUgKG1heF90cmFjZXMgPj0gaSBhbmQgZnJhY3Rpb24gPCAxIGFuZCAoKGVpZCA+IC0xIGFuZCBjYWxsYmFjayhlaWQpKSBvciBpbXBhY3QgPT0gc2VsZikpIGRvDQoJCWZyYWN0aW9uLCBlaWQsIGltcGFjdCA9IGltcGFjdDp0cmFjZV9saW5lX2ltcGFjdChkZXN0aW5hdGlvbiwgZWlkKQ0KCQlpID0gaSArIDENCgllbmQNCg0KCXJldHVybiBzZWxmOmRpc3RhbmNlKGltcGFjdCkgLyBzZWxmOmRpc3RhbmNlKGRlc3RpbmF0aW9uKSwgZWlkLCBpbXBhY3QNCmVuZA0KDQotLS0gUmV0dXJucyB0aGUgcmVzdWx0IG9mIGNsaWVudC50cmFjZV9idWxsZXQgYmV0d2VlbiB0d28gdmVjdG9ycy4NCi0tLSBAcGFyYW0gZnJvbV9wbGF5ZXIgbnVtYmVyDQotLS0gQHBhcmFtIGRlc3RpbmF0aW9uIHZlY3Rvcl9vbGRfYw0KLS0tIEByZXR1cm4gbnVtYmVyfG5pbCwgbnVtYmVyDQpmdW5jdGlvbiB2ZWN0b3Jfb2xkX2M6dHJhY2VfYnVsbGV0X3RvKGZyb21fcGxheWVyLCBkZXN0aW5hdGlvbikNCglyZXR1cm4gY2xpZW50LnRyYWNlX2J1bGxldCgNCgkJZnJvbV9wbGF5ZXIsDQoJCXNlbGYueCwNCgkJc2VsZi55LA0KCQlzZWxmLnosDQoJCWRlc3RpbmF0aW9uLngsDQoJCWRlc3RpbmF0aW9uLnksDQoJCWRlc3RpbmF0aW9uLnoNCgkpDQplbmQNCg0KLS0tIFJldHVybnMgdGhlIHZlY3RvciBvZiB0aGUgY2xvc2VzdCBwb2ludCBhbG9uZyBhIHJheS4NCi0tLSBAcGFyYW0gc291cmNlIHZlY3Rvcl9vbGRfYw0KLS0tIEBwYXJhbSBkZXN0aW5hdGlvbiB2ZWN0b3Jfb2xkX2MNCi0tLSBAcmV0dXJuIHZlY3Rvcl9vbGRfYw0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOmNsb3Nlc3RfcmF5X3BvaW50KHNvdXJjZSwgZGVzdGluYXRpb24pDQoJbG9jYWwgZGlyZWN0aW9uID0gKGRlc3RpbmF0aW9uIC0gc291cmNlKSAvIHNvdXJjZTpkaXN0YW5jZShkZXN0aW5hdGlvbikNCglsb2NhbCB2ID0gc2VsZiAtIHNvdXJjZQ0KCWxvY2FsIGxlbmd0aCA9IHY6ZG90X3Byb2R1Y3QoZGlyZWN0aW9uKQ0KDQoJcmV0dXJuIHNvdXJjZSArIGRpcmVjdGlvbiAqIGxlbmd0aA0KZW5kDQoNCi0tLSBSZXR1cm5zIGEgcG9pbnQgYWxvbmcgYSByYXkgYWZ0ZXIgZGl2aWRpbmcgaXQuDQotLS0gQHBhcmFtIGRlc3RpbmF0aW9uIHZlY3Rvcl9vbGRfYw0KLS0tIEBwYXJhbSByYXRpbyBudW1iZXINCi0tLSBAcmV0dXJuIHZlY3Rvcl9vbGRfYw0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOmRpdmlkZV9yYXkoZGVzdGluYXRpb24sIHJhdGlvKQ0KCXJldHVybiAoc2VsZiAqIHJhdGlvICsgZGVzdGluYXRpb24pIC8gKDEgKyByYXRpbykNCmVuZA0KDQotLS0gSW50ZXJuYWxseSBkaXZpZGUgYSByYXkuDQotLS0gQHBhcmFtIHNvdXJjZSB2ZWN0b3Jfb2xkX2MNCi0tLSBAcGFyYW0gZGVzdGluYXRpb24gdmVjdG9yX29sZF9jDQotLS0gQHBhcmFtIG0gbnVtYmVyDQotLS0gQHBhcmFtIG4gbnVtYmVyDQotLS0gQHJldHVybiB2ZWN0b3Jfb2xkX2MNCmxvY2FsIGZ1bmN0aW9uIHZlY3Rvcl9pbnRlcm5hbF9kaXZpc2lvbihzb3VyY2UsIGRlc3RpbmF0aW9uLCBtLCBuKQ0KCXJldHVybiB2ZWN0b3IoKHNvdXJjZS54Km4gKyBkZXN0aW5hdGlvbi54Km0pIC8gKG0rbiksDQoJCShzb3VyY2UueSpuICsgZGVzdGluYXRpb24ueSptKSAvIChtK24pLA0KCQkoc291cmNlLnoqbiArIGRlc3RpbmF0aW9uLnoqbSkgLyAobStuKSkNCmVuZA0KDQotLS0gUmV0dXJucyBhIHJheSBkaXZpZGVkIGludG8gYSBudW1iZXIgb2Ygc2VnbWVudHMuDQotLS0gQHBhcmFtIGRlc3RpbmF0aW9uIHZlY3Rvcl9vbGRfYw0KLS0tIEBwYXJhbSBzZWdtZW50cyBudW1iZXINCi0tLSBAcmV0dXJuIHRhYmxlPG51bWJlciwgdmVjdG9yX29sZF9jPg0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOnNlZ21lbnRfcmF5KGRlc3RpbmF0aW9uLCBzZWdtZW50cykNCglsb2NhbCBwb2ludHMgPSB7fQ0KDQoJZm9yIGkgPSAwLCBzZWdtZW50cyBkbw0KCQlwb2ludHNbaV0gPSB2ZWN0b3JfaW50ZXJuYWxfZGl2aXNpb24oc2VsZiwgZGVzdGluYXRpb24sIGksIHNlZ21lbnRzIC0gaSkNCgllbmQNCg0KCXJldHVybiBwb2ludHMNCmVuZA0KDQotLS0gUmV0dXJucyB0aGUgYmVzdCBzb3VyY2UgdmVjdG9yIGFuZCBkZXN0aW5hdGlvbiB2ZWN0b3IgdG8gZHJhdyBhIGxpbmUgb24tc2NyZWVuIHVzaW5nIHdvcmxkLXRvLXNjcmVlbi4NCi0tLSBAcGFyYW0gZGVzdGluYXRpb24gdmVjdG9yX29sZF9jDQotLS0gQHBhcmFtIHRvdGFsX3NlZ21lbnRzIG51bWJlcg0KLS0tIEByZXR1cm4gdmVjdG9yX29sZF9jfG5pbCwgdmVjdG9yX29sZF9jfG5pbA0KZnVuY3Rpb24gdmVjdG9yX29sZF9jOnJheShkZXN0aW5hdGlvbiwgdG90YWxfc2VnbWVudHMpDQoJdG90YWxfc2VnbWVudHMgPSB0b3RhbF9zZWdtZW50cyBvciAxMjgNCg0KCWxvY2FsIHNlZ21lbnRzID0ge30NCglsb2NhbCBzdGVwID0gc2VsZjpkaXN0YW5jZShkZXN0aW5hdGlvbikgLyB0b3RhbF9zZWdtZW50cw0KCWxvY2FsIGFuZ2xlID0gc2VsZjphbmdsZV90byhkZXN0aW5hdGlvbikNCglsb2NhbCBkaXJlY3Rpb24gPSBhbmdsZTp0b19mb3J3YXJkX3ZlY3RvcigpDQoNCglmb3IgaSA9IDEsIHRvdGFsX3NlZ21lbnRzIGRvDQoJCXRhYmxlLmluc2VydChzZWdtZW50cywgc2VsZiArIChkaXJlY3Rpb24gKiAoc3RlcCAqIGkpKSkNCgllbmQNCg0KCWxvY2FsIHNyY19zY3JlZW5fcG9zaXRpb24gPSB2ZWN0b3IoMCwgMCwgMCkNCglsb2NhbCBkc3Rfc2NyZWVuX3Bvc2l0aW9uID0gdmVjdG9yKDAsIDAsIDApDQoJbG9jYWwgc3JjX2luX3NjcmVlbiA9IGZhbHNlDQoJbG9jYWwgZHN0X2luX3NjcmVlbiA9IGZhbHNlDQoNCglmb3IgaSA9IDEsICNzZWdtZW50cyBkbw0KCQlzcmNfc2NyZWVuX3Bvc2l0aW9uID0gc2VnbWVudHNbaV06dG9fc2NyZWVuKCkNCg0KCQlpZiBzcmNfc2NyZWVuX3Bvc2l0aW9uIH49IG5pbCB0aGVuDQoJCQlzcmNfaW5fc2NyZWVuID0gdHJ1ZQ0KDQoJCQlicmVhaw0KCQllbmQNCgllbmQNCg0KCWZvciBpID0gI3NlZ21lbnRzLCAxLCAtMSBkbw0KCQlkc3Rfc2NyZWVuX3Bvc2l0aW9uID0gc2VnbWVudHNbaV06dG9fc2NyZWVuKCkNCg0KCQlpZiBkc3Rfc2NyZWVuX3Bvc2l0aW9uIH49IG5pbCB0aGVuDQoJCQlkc3RfaW5fc2NyZWVuID0gdHJ1ZQ0KDQoJCQlicmVhaw0KCQllbmQNCgllbmQNCg0KCWlmIHNyY19pbl9zY3JlZW4gYW5kIGRzdF9pbl9zY3JlZW4gdGhlbg0KCQlyZXR1cm4gc3JjX3NjcmVlbl9wb3NpdGlvbiwgZHN0X3NjcmVlbl9wb3NpdGlvbg0KCWVuZA0KDQoJcmV0dXJuIG5pbA0KZW5kDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBhbmdsZV92ZWN0b3JfbWV0aG9kcw0KLS0tIFJldHVybnMgYSBmb3J3YXJkIHZlY3RvciBvZiB0aGUgYW5nbGUuIFVzZSB0aGlzIHRvIGNvbnZlcnQgYW4gYW5nbGUgaW50byBhIGNhcnRlc2lhbiBkaXJlY3Rpb24uDQotLS0gQHJldHVybiB2ZWN0b3Jfb2xkX2MNCmZ1bmN0aW9uIGFuZ2xlX29sZF9jOnRvX2ZvcndhcmRfdmVjdG9yKCkNCglsb2NhbCBkZWdyZWVzX3RvX3JhZGlhbnMgPSBmdW5jdGlvbihkZWdyZWVzKSByZXR1cm4gZGVncmVlcyAqIG1hdGgucGkgLyAxODAgZW5kDQoNCglsb2NhbCBzcCA9IG1hdGguc2luKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnApKQ0KCWxvY2FsIGNwID0gbWF0aC5jb3MoZGVncmVlc190b19yYWRpYW5zKHNlbGYucCkpDQoJbG9jYWwgc3kgPSBtYXRoLnNpbihkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi55KSkNCglsb2NhbCBjeSA9IG1hdGguY29zKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnkpKQ0KDQoJcmV0dXJuIHZlY3RvcihjcCAqIGN5LCBjcCAqIHN5LCAtc3ApDQplbmQNCg0KLS0tIFJldHVybiBhbiB1cCB2ZWN0b3Igb2YgdGhlIGFuZ2xlLiBVc2UgdGhpcyB0byBjb252ZXJ0IGFuIGFuZ2xlIGludG8gYSBjYXJ0ZXNpYW4gZGlyZWN0aW9uLg0KLS0tIEByZXR1cm4gdmVjdG9yX29sZF9jDQpmdW5jdGlvbiBhbmdsZV9vbGRfYzp0b191cF92ZWN0b3IoKQ0KCWxvY2FsIGRlZ3JlZXNfdG9fcmFkaWFucyA9IGZ1bmN0aW9uKGRlZ3JlZXMpIHJldHVybiBkZWdyZWVzICogbWF0aC5waSAvIDE4MCBlbmQNCg0KCWxvY2FsIHNwID0gbWF0aC5zaW4oZGVncmVlc190b19yYWRpYW5zKHNlbGYucCkpDQoJbG9jYWwgY3AgPSBtYXRoLmNvcyhkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi5wKSkNCglsb2NhbCBzeSA9IG1hdGguc2luKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnkpKQ0KCWxvY2FsIGN5ID0gbWF0aC5jb3MoZGVncmVlc190b19yYWRpYW5zKHNlbGYueSkpDQoJbG9jYWwgc3IgPSBtYXRoLnNpbihkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi5yKSkNCglsb2NhbCBjciA9IG1hdGguY29zKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnIpKQ0KDQoJcmV0dXJuIHZlY3RvcihjciAqIHNwICogY3kgKyBzciAqIHN5LCBjciAqIHNwICogc3kgKyBzciAqIGN5ICogLTEsIGNyICogY3ApDQplbmQNCg0KLS0tIFJldHVybiBhIHJpZ2h0IHZlY3RvciBvZiB0aGUgYW5nbGUuIFVzZSB0aGlzIHRvIGNvbnZlcnQgYW4gYW5nbGUgaW50byBhIGNhcnRlc2lhbiBkaXJlY3Rpb24uDQotLS0gQHJldHVybiB2ZWN0b3Jfb2xkX2MNCmZ1bmN0aW9uIGFuZ2xlX29sZF9jOnRvX3JpZ2h0X3ZlY3RvcigpDQoJbG9jYWwgZGVncmVlc190b19yYWRpYW5zID0gZnVuY3Rpb24oZGVncmVlcykgcmV0dXJuIGRlZ3JlZXMgKiBtYXRoLnBpIC8gMTgwIGVuZA0KDQoJbG9jYWwgc3AgPSBtYXRoLnNpbihkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi5wKSkNCglsb2NhbCBjcCA9IG1hdGguY29zKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnApKQ0KCWxvY2FsIHN5ID0gbWF0aC5zaW4oZGVncmVlc190b19yYWRpYW5zKHNlbGYueSkpDQoJbG9jYWwgY3kgPSBtYXRoLmNvcyhkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi55KSkNCglsb2NhbCBzciA9IG1hdGguc2luKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnIpKQ0KCWxvY2FsIGNyID0gbWF0aC5jb3MoZGVncmVlc190b19yYWRpYW5zKHNlbGYucikpDQoNCglyZXR1cm4gdmVjdG9yKHNyICogc3AgKiBjeSAqIC0xICsgY3IgKiBzeSwgc3IgKiBzcCAqIHN5ICogLTEgKyAtMSAqIGNyICogY3ksIC0xICogc3IgKiBjcCkNCmVuZA0KDQotLS0gUmV0dXJuIGEgYmFja3dhcmQgdmVjdG9yIG9mIHRoZSBhbmdsZS4gVXNlIHRoaXMgdG8gY29udmVydCBhbiBhbmdsZSBpbnRvIGEgY2FydGVzaWFuIGRpcmVjdGlvbi4NCi0tLSBAcmV0dXJuIHZlY3Rvcl9vbGRfYw0KZnVuY3Rpb24gYW5nbGVfb2xkX2M6dG9fYmFja3dhcmRfdmVjdG9yKCkNCglsb2NhbCBkZWdyZWVzX3RvX3JhZGlhbnMgPSBmdW5jdGlvbihkZWdyZWVzKSByZXR1cm4gZGVncmVlcyAqIG1hdGgucGkgLyAxODAgZW5kDQoNCglsb2NhbCBzcCA9IG1hdGguc2luKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnApKQ0KCWxvY2FsIGNwID0gbWF0aC5jb3MoZGVncmVlc190b19yYWRpYW5zKHNlbGYucCkpDQoJbG9jYWwgc3kgPSBtYXRoLnNpbihkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi55KSkNCglsb2NhbCBjeSA9IG1hdGguY29zKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnkpKQ0KDQoJcmV0dXJuIC12ZWN0b3IoY3AgKiBjeSwgY3AgKiBzeSwgLXNwKQ0KZW5kDQoNCi0tLSBSZXR1cm4gYSBsZWZ0IHZlY3RvciBvZiB0aGUgYW5nbGUuIFVzZSB0aGlzIHRvIGNvbnZlcnQgYW4gYW5nbGUgaW50byBhIGNhcnRlc2lhbiBkaXJlY3Rpb24uDQotLS0gQHJldHVybiB2ZWN0b3Jfb2xkX2MNCmZ1bmN0aW9uIGFuZ2xlX29sZF9jOnRvX2xlZnRfdmVjdG9yKCkNCglsb2NhbCBkZWdyZWVzX3RvX3JhZGlhbnMgPSBmdW5jdGlvbihkZWdyZWVzKSByZXR1cm4gZGVncmVlcyAqIG1hdGgucGkgLyAxODAgZW5kDQoNCglsb2NhbCBzcCA9IG1hdGguc2luKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnApKQ0KCWxvY2FsIGNwID0gbWF0aC5jb3MoZGVncmVlc190b19yYWRpYW5zKHNlbGYucCkpDQoJbG9jYWwgc3kgPSBtYXRoLnNpbihkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi55KSkNCglsb2NhbCBjeSA9IG1hdGguY29zKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnkpKQ0KCWxvY2FsIHNyID0gbWF0aC5zaW4oZGVncmVlc190b19yYWRpYW5zKHNlbGYucikpDQoJbG9jYWwgY3IgPSBtYXRoLmNvcyhkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi5yKSkNCg0KCXJldHVybiAtdmVjdG9yKHNyICogc3AgKiBjeSAqIC0xICsgY3IgKiBzeSwgc3IgKiBzcCAqIHN5ICogLTEgKyAtMSAqIGNyICogY3ksIC0xICogc3IgKiBjcCkNCmVuZA0KDQotLS0gUmV0dXJuIGEgZG93biB2ZWN0b3Igb2YgdGhlIGFuZ2xlLiBVc2UgdGhpcyB0byBjb252ZXJ0IGFuIGFuZ2xlIGludG8gYSBjYXJ0ZXNpYW4gZGlyZWN0aW9uLg0KLS0tIEByZXR1cm4gdmVjdG9yX29sZF9jDQpmdW5jdGlvbiBhbmdsZV9vbGRfYzp0b19kb3duX3ZlY3RvcigpDQoJbG9jYWwgZGVncmVlc190b19yYWRpYW5zID0gZnVuY3Rpb24oZGVncmVlcykgcmV0dXJuIGRlZ3JlZXMgKiBtYXRoLnBpIC8gMTgwIGVuZA0KDQoJbG9jYWwgc3AgPSBtYXRoLnNpbihkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi5wKSkNCglsb2NhbCBjcCA9IG1hdGguY29zKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnApKQ0KCWxvY2FsIHN5ID0gbWF0aC5zaW4oZGVncmVlc190b19yYWRpYW5zKHNlbGYueSkpDQoJbG9jYWwgY3kgPSBtYXRoLmNvcyhkZWdyZWVzX3RvX3JhZGlhbnMoc2VsZi55KSkNCglsb2NhbCBzciA9IG1hdGguc2luKGRlZ3JlZXNfdG9fcmFkaWFucyhzZWxmLnIpKQ0KCWxvY2FsIGNyID0gbWF0aC5jb3MoZGVncmVlc190b19yYWRpYW5zKHNlbGYucikpDQoNCglyZXR1cm4gLXZlY3RvcihjciAqIHNwICogY3kgKyBzciAqIHN5LCBjciAqIHNwICogc3kgKyBzciAqIGN5ICogLTEsIGNyICogY3ApDQplbmQNCg0KLS0tIENhbGN1bGF0ZSB3aGVyZSBhIHZlY3RvciBpcyBpbiBhIGdpdmVuIGZpZWxkIG9mIHZpZXcuDQotLS0gQHBhcmFtIHNvdXJjZV92ZWN0b3IgdmVjdG9yX29sZF9jDQotLS0gQHBhcmFtIHRhcmdldF92ZWN0b3IgdmVjdG9yX29sZF9jDQotLS0gQHJldHVybiBudW1iZXINCmZ1bmN0aW9uIGFuZ2xlX29sZF9jOmZvdl90byhzb3VyY2VfdmVjdG9yLCB0YXJnZXRfdmVjdG9yKQ0KCWxvY2FsIGZ3ZCA9IHNlbGY6dG9fZm9yd2FyZF92ZWN0b3IoKTsNCglsb2NhbCBkZWx0YSA9ICh0YXJnZXRfdmVjdG9yIC0gc291cmNlX3ZlY3Rvcik6bm9ybWFsaXplZCgpOw0KCWxvY2FsIGZvdiA9IG1hdGguYWNvcyhmd2Q6ZG90X3Byb2R1Y3QoZGVsdGEpIC8gZGVsdGE6bGVuZ3RoKCkpOw0KDQoJcmV0dXJuIG1hdGgubWF4KDAuMCwgbWF0aC5kZWcoZm92KSk7DQplbmQNCi0tZW5kcmVnaW9uDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBkZXBlbmRlbmN5OiBoYXZvY19zaGFkZXJfMV81XzANCi0tLSBAY2xhc3Mgc2hhZGVyX2MNCi0tLSBAZmllbGQgcHVibGljIHIgbnVtYmVyDQotLS0gQGZpZWxkIHB1YmxpYyBnIG51bWJlcg0KLS0tIEBmaWVsZCBwdWJsaWMgYiBudW1iZXINCi0tLSBAZmllbGQgcHVibGljIGggbnVtYmVyDQotLS0gQGZpZWxkIHB1YmxpYyBzIG51bWJlcg0KLS0tIEBmaWVsZCBwdWJsaWMgbCBudW1iZXINCi0tLSBAZmllbGQgcHVibGljIGEgbnVtYmVyDQotLS0gQGZpZWxkIHB1YmxpYyB1cGRhdGVfbWV0aG9kIGZ1bihzaGFkZXI6IHNoYWRlcl9jLCBzcGFjZTogbnVtYmVyKTogdm9pZA0KLS0tIEBmaWVsZCBwdWJsaWMgcmdiX3VwZGF0ZWQgYm9vbGVhbg0KLS0tIEBmaWVsZCBwdWJsaWMgaHNsX3VwZGF0ZWQgYm9vbGVhbg0KbG9jYWwgc2hhZGVyX2MgPSB7fQ0KbG9jYWwgc2hhZGVyX210ID0gew0KCV9faW5kZXggPSBzaGFkZXJfYywNCgktLS0gQHBhcmFtIHNoYWRlciBzaGFkZXJfYw0KCV9fY2FsbCA9IGZ1bmN0aW9uKHNoYWRlciwgciwgZywgYiwgYSkNCgkJaWYgKHIgfj0gbmlsKSB0aGVuDQoJCQlzaGFkZXI6c2V0X3IocikNCgkJCXNoYWRlcjpzZXRfZyhnKQ0KCQkJc2hhZGVyOnNldF9iKGIpDQoJCQlzaGFkZXI6c2V0X2EoYSkNCgkJZWxzZQ0KCQkJcmV0dXJuIHNoYWRlcjp1bnBhY2soKQ0KCQllbmQNCgllbmQNCn0NCg0KLS0tIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHNoYWRlcidzIFJHQiB2YWx1ZXMuDQpmdW5jdGlvbiBzaGFkZXJfbXQuX190b3N0cmluZyhzaGFkZXJfb2JqZWN0KQ0KCXJldHVybiBzdHJpbmcuZm9ybWF0KCIlcywgJXMsICVzLCAlcyIsIHNoYWRlcl9vYmplY3Quciwgc2hhZGVyX29iamVjdC5nLCBzaGFkZXJfb2JqZWN0LmIsIHNoYWRlcl9vYmplY3QuYSkNCmVuZA0KDQotLS0gQ29uY2F0ZW5hdGVzIHRoZSBzaGFkZXIgaW4gYSBzdHJpbmcuDQpmdW5jdGlvbiBzaGFkZXJfbXQuX19jb25jYXQoc2hhZGVyX29iamVjdCkNCglyZXR1cm4gc3RyaW5nLmZvcm1hdCgiJXMsICVzLCAlcywgJXMiLCBzaGFkZXJfb2JqZWN0LnIsIHNoYWRlcl9vYmplY3QuZywgc2hhZGVyX29iamVjdC5iLCBzaGFkZXJfb2JqZWN0LmEpDQplbmQNCg0KLS0tIENyZWF0ZSBhIG5ldyBzaGFkZXIgZnJvbSBSR0JBLg0KLS0tIEBwYXJhbSByIG51bWJlcg0KLS0tIEBwYXJhbSBnIG51bWJlcg0KLS0tIEBwYXJhbSBiIG51bWJlcg0KLS0tIEBwYXJhbSBhIG51bWJlcg0KLS0tIEBwYXJhbSBhdXRvbWF0aWNhbGx5X3VwZGF0ZV9zcGFjZXMgYm9vbGVhbg0KLS0tIEByZXR1cm4gc2hhZGVyX2MNCmZ1bmN0aW9uIHNoYWRlcl9jLnJnYihyLCBnLCBiLCBhLCBhdXRvbWF0aWNhbGx5X3VwZGF0ZV9zcGFjZXMpDQoJaWYgKGEgPT0gbmlsKSB0aGVuDQoJCWEgPSAyNTUNCgllbmQNCg0KCWxvY2FsIG9iamVjdCA9IHNoYWRlcl9jLm5ldyhyLCBnLCBiLCAwLCAwLCAwLCBhLCBhdXRvbWF0aWNhbGx5X3VwZGF0ZV9zcGFjZXMpDQoNCglvYmplY3Q6dmFsaWRhdGVfcmdiX3NwYWNlKCkNCglvYmplY3Q6dXBkYXRlX2hzbF9zcGFjZSgpDQoNCglyZXR1cm4gb2JqZWN0DQplbmQNCg0KLS0tIENyZWF0ZSBhIG5ldyBzaGFkZXIgZnJvbSBIU0xBLg0KLS0tIEBwYXJhbSBoIG51bWJlcg0KLS0tIEBwYXJhbSBzIG51bWJlcg0KLS0tIEBwYXJhbSBsIG51bWJlcg0KLS0tIEBwYXJhbSBhIG51bWJlcg0KLS0tIEBwYXJhbSBhdXRvbWF0aWNhbGx5X3VwZGF0ZV9zcGFjZXMgYm9vbGVhbg0KLS0tIEByZXR1cm4gc2hhZGVyX2MNCmZ1bmN0aW9uIHNoYWRlcl9jLmhzbChoLCBzLCBsLCBhLCBhdXRvbWF0aWNhbGx5X3VwZGF0ZV9zcGFjZXMpDQoJaWYgKGEgPT0gbmlsKSB0aGVuDQoJCWEgPSAyNTUNCgllbmQNCg0KCWxvY2FsIG9iamVjdCA9IHNoYWRlcl9jLm5ldygwLCAwLCAwLCBoLCBzLCBsLCBhLCBhdXRvbWF0aWNhbGx5X3VwZGF0ZV9zcGFjZXMpDQoNCglvYmplY3Q6dmFsaWRhdGVfaHNsX3NwYWNlKCkNCglvYmplY3Q6dXBkYXRlX3JnYl9zcGFjZSgpDQoNCglyZXR1cm4gb2JqZWN0DQplbmQNCg0KLS0tIENyZWF0ZSBhIG5ldyBzaGFkZXIgZnJvbSBoZXguDQotLS0gQHBhcmFtIGhleCBzdHJpbmcNCi0tLSBAcGFyYW0gYXV0b21hdGljYWxseV91cGRhdGVfc3BhY2VzIGJvb2xlYW4NCi0tLSBAcmV0dXJuIHNoYWRlcl9jDQpmdW5jdGlvbiBzaGFkZXJfYy5oZXgoaGV4LCBhdXRvbWF0aWNhbGx5X3VwZGF0ZV9zcGFjZXMpDQoJbG9jYWwgciwgZywgYiwgYSA9IHNoYWRlcl9jLmhleF90b19yZ2IoaGV4KQ0KDQoJbG9jYWwgb2JqZWN0ID0gc2hhZGVyX2MubmV3KHIsIGcsIGIsIDAsIDAsIDAsIGEsIGF1dG9tYXRpY2FsbHlfdXBkYXRlX3NwYWNlcykNCg0KCW9iamVjdDp2YWxpZGF0ZV9yZ2Jfc3BhY2UoKQ0KCW9iamVjdDp1cGRhdGVfaHNsX3NwYWNlKCkNCg0KCXJldHVybiBvYmplY3QNCmVuZA0KDQotLS0gQ3JlYXRlcyBhIG5ldyBzaGFkZXIuDQotLS0gQHBhcmFtIHIgbnVtYmVyDQotLS0gQHBhcmFtIGcgbnVtYmVyDQotLS0gQHBhcmFtIGIgbnVtYmVyDQotLS0gQHBhcmFtIGggbnVtYmVyDQotLS0gQHBhcmFtIHMgbnVtYmVyDQotLS0gQHBhcmFtIGwgbnVtYmVyDQotLS0gQHBhcmFtIGEgbnVtYmVyDQotLS0gQHBhcmFtIGF1dG9tYXRpY2FsbHlfdXBkYXRlX3NwYWNlcyBib29sZWFuDQotLS0gQHJldHVybiBzaGFkZXJfYw0KZnVuY3Rpb24gc2hhZGVyX2MubmV3KHIsIGcsIGIsIGgsIHMsIGwsIGEsIGF1dG9tYXRpY2FsbHlfdXBkYXRlX3NwYWNlcykNCglhdXRvbWF0aWNhbGx5X3VwZGF0ZV9zcGFjZXMgPSBhdXRvbWF0aWNhbGx5X3VwZGF0ZV9zcGFjZXMgb3IgdHJ1ZQ0KDQoJbG9jYWwgdXBkYXRlX21ldGhvZA0KDQoJLS0gRWl0aGVyIGF1dG9tYXRpY2FsbHkgdXBkYXRlIHNwYWNlcyBlYWNoIGNoYW5nZSBvciB3YWl0IGZvciBhIGNhbGwgdG8gZG8gc28uDQoJaWYgKGF1dG9tYXRpY2FsbHlfdXBkYXRlX3NwYWNlcyA9PSB0cnVlKSB0aGVuDQoJCXVwZGF0ZV9tZXRob2QgPSBmdW5jdGlvbihzaGFkZXIsIHNwYWNlKQ0KCQkJaWYgKHNwYWNlID09IDApIHRoZW4NCgkJCQlzaGFkZXI6dXBkYXRlX3JnYl9zcGFjZSgpDQoJCQllbHNlDQoJCQkJc2hhZGVyOnVwZGF0ZV9oc2xfc3BhY2UoKQ0KCQkJZW5kDQoJCWVuZA0KCWVsc2UNCgkJdXBkYXRlX21ldGhvZCA9IGZ1bmN0aW9uKHNoYWRlciwgc3BhY2UpDQoJCQlpZiAoc3BhY2UgPT0gMCkgdGhlbg0KCQkJCXNoYWRlci5yZ2JfdXBkYXRlZCA9IGZhbHNlDQoJCQllbHNlDQoJCQkJc2hhZGVyLmhzbF91cGRhdGVkID0gZmFsc2UNCgkJCWVuZA0KCQllbmQNCgllbmQNCg0KCWxvY2FsIHByb3BlcnRpZXMgPSB7DQoJCXIgPSByLA0KCQlnID0gZywNCgkJYiA9IGIsDQoJCWggPSBoLA0KCQlzID0gcywNCgkJbCA9IGwsDQoJCWEgPSBhLA0KCQl1cGRhdGVfbWV0aG9kID0gdXBkYXRlX21ldGhvZCwNCgkJcmdiX3VwZGF0ZWQgPSB0cnVlLA0KCQloc2xfdXBkYXRlZCA9IHRydWUNCgl9DQoNCglyZXR1cm4gc2V0bWV0YXRhYmxlKHByb3BlcnRpZXMsIHNoYWRlcl9tdCkNCmVuZA0KDQotLS0gQ2xvbmVzIHRoZSBzaGFkZXIuDQotLS0gQHJldHVybiBzaGFkZXJfYw0KZnVuY3Rpb24gc2hhZGVyX2M6Y2xvbmUoKQ0KCWxvY2FsIHByb3BlcnRpZXMgPSB7DQoJCXIgPSBzZWxmLnIsDQoJCWcgPSBzZWxmLmcsDQoJCWIgPSBzZWxmLmIsDQoJCWggPSBzZWxmLmgsDQoJCXMgPSBzZWxmLnMsDQoJCWwgPSBzZWxmLmwsDQoJCWEgPSBzZWxmLmEsDQoJCXJnYl91cGRhdGVkID0gdHJ1ZSwNCgkJaHNsX3VwZGF0ZWQgPSB0cnVlLA0KCQl1cGRhdGVfbWV0aG9kID0gc2VsZi51cGRhdGVfbWV0aG9kDQoJfQ0KDQoJcmV0dXJuIHNldG1ldGF0YWJsZShwcm9wZXJ0aWVzLCBzaGFkZXJfbXQpDQplbmQNCg0KLS0tIFVucGFja3MgdGhlIHNoYWRlcidzIFJHQkEgcHJvcGVydGllcy4NCi0tLSBAcmV0dXJuIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcg0KZnVuY3Rpb24gc2hhZGVyX2M6dW5wYWNrKCkNCglyZXR1cm4gc2VsZi5yLCBzZWxmLmcsIHNlbGYuYiwgc2VsZi5hDQplbmQNCg0KLS0tIENvbnZlcnRzIGEgaGV4IHN0cmluZyBpbnRvIFJHQkEuDQotLS0gQHBhcmFtIGhleCBzdHJpbmcNCi0tLSBAcmV0dXJuIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcg0KZnVuY3Rpb24gc2hhZGVyX2MuaGV4X3RvX3JnYihoZXgpDQoJbG9jYWwgbGVuZ3RoID0gaGV4OmxlbigpDQoNCglpZiAobGVuZ3RoID09IDMpIHRoZW4NCgkJbG9jYWwgaW5zZXJ0ID0gaGV4OnN1YigyKQ0KDQoJCWhleCA9IGhleCAuLiBpbnNlcnQgLi4gaW5zZXJ0DQoJZWxzZWlmIChsZW5ndGggPT0gNCkgdGhlbg0KCQloZXggPSBoZXggLi4gaGV4OnN1YigyKQ0KCWVuZA0KDQoJaGV4ID0gaGV4OmdzdWIoIiMiLCIiKQ0KDQoJbG9jYWwgciA9IHRvbnVtYmVyKCIweCIuLmhleDpzdWIoMSwyKSkNCglsb2NhbCBnID0gdG9udW1iZXIoIjB4Ii4uaGV4OnN1YigzLDQpKQ0KCWxvY2FsIGIgPSB0b251bWJlcigiMHgiLi5oZXg6c3ViKDUsNikpDQoJbG9jYWwgYSA9IHRvbnVtYmVyKCIweCIuLmhleDpzdWIoNyw4KSkNCg0KCWlmIChhID09IG5pbCkgdGhlbg0KCQlhID0gMjU1DQoJZW5kDQoNCglyZXR1cm4gciwgZywgYiwgYQ0KZW5kDQoNCi0tLSBVcGRhdGVzIHNoYWRlciBzcGFjZXMuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBzaGFkZXJfYzp1cGRhdGVfc3BhY2VzKCkNCglpZiAoc2VsZi5yZ2JfdXBkYXRlZCA9PSBmYWxzZSkgdGhlbg0KCQlzZWxmOnVwZGF0ZV9yZ2Jfc3BhY2UoKQ0KDQoJCXNlbGYucmdiX3VwZGF0ZWQgPSB0cnVlDQoJZWxzZWlmIChzZWxmLmhzbF91cGRhdGVkID09IGZhbHNlKSB0aGVuDQoJCXNlbGY6dXBkYXRlX2hzbF9zcGFjZSgpDQoNCgkJc2VsZi5oc2xfdXBkYXRlZCA9IHRydWUNCgllbmQNCmVuZA0KDQotLS0gVXBkYXRlcyB0aGUgUkdCIHNwYWNlLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gc2hhZGVyX2M6dXBkYXRlX3JnYl9zcGFjZSgpDQoJbG9jYWwgciwgZywgYg0KDQoJaWYgKHNlbGYucyA9PSAwKSB0aGVuDQoJCXIsIGcsIGIgPSBzZWxmLmwsIHNlbGYubCwgc2VsZi5sDQoJZWxzZQ0KCQlsb2NhbCBmdW5jdGlvbiBodWVfdG9fcmdiKHAsIHEsIHQpDQoJCQlpZiB0IDwgMCAgIHRoZW4gdCA9IHQgKyAxIGVuZA0KCQkJaWYgdCA+IDEgICB0aGVuIHQgPSB0IC0gMSBlbmQNCgkJCWlmIHQgPCAxLzYgdGhlbiByZXR1cm4gcCArIChxIC0gcCkgKiA2ICogdCBlbmQNCgkJCWlmIHQgPCAxLzIgdGhlbiByZXR1cm4gcSBlbmQNCgkJCWlmIHQgPCAyLzMgdGhlbiByZXR1cm4gcCArIChxIC0gcCkgKiAoMi8zIC0gdCkgKiA2IGVuZA0KDQoJCQlyZXR1cm4gcA0KCQllbmQNCg0KCQlsb2NhbCBxID0gMA0KDQoJCWlmIChzZWxmLmwgPCAwLjUpIHRoZW4NCgkJCXEgPSBzZWxmLmwgKiAoMSArIHNlbGYucykNCgkJZWxzZQ0KCQkJcSA9IHNlbGYubCArIHNlbGYucyAtIHNlbGYubCAqIHNlbGYucw0KCQllbmQNCg0KCQlsb2NhbCBwID0gMiAqIHNlbGYubCAtIHENCgkJbG9jYWwgaCA9IHNlbGYuaCAvIDM2MA0KDQoJCXIgPSBodWVfdG9fcmdiKHAsIHEsIGggKyAxLzMpDQoJCWcgPSBodWVfdG9fcmdiKHAsIHEsIGgpDQoJCWIgPSBodWVfdG9fcmdiKHAsIHEsIGggLSAxLzMpDQoJZW5kDQoNCglzZWxmLnIgPSByICogMjU1DQoJc2VsZi5nID0gZyAqIDI1NQ0KCXNlbGYuYiA9IGIgKiAyNTUNCmVuZA0KDQotLS0gVXBkYXRlcyB0aGUgc2hhZGVyJ3MgSFNMIHNwYWNlLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gc2hhZGVyX2M6dXBkYXRlX2hzbF9zcGFjZSgpDQoJbG9jYWwgciwgZywgYiA9IHNlbGYuciAvIDI1NSwgc2VsZi5nIC8gMjU1LCBzZWxmLmIgLyAyNTUNCglsb2NhbCBtYXgsIG1pbiA9IG1hdGgubWF4KHIsIGcsIGIpLCBtYXRoLm1pbihyLCBnLCBiKQ0KCWxvY2FsIGgsIHMsIGwNCg0KCWwgPSAobWF4ICsgbWluKSAvIDINCg0KCWlmIChtYXggPT0gbWluKSB0aGVuDQoJCWgsIHMgPSAwLCAwDQoJZWxzZQ0KCQlsb2NhbCBkID0gbWF4IC0gbWluDQoNCgkJaWYgKGwgPiAwLjUpIHRoZW4NCgkJCXMgPSBkIC8gKDIgLSBtYXggLSBtaW4pDQoJCWVsc2UNCgkJCXMgPSBkIC8gKG1heCArIG1pbikNCgkJZW5kDQoNCgkJaWYgKG1heCA9PSByKSB0aGVuDQoJCQloID0gKGcgLSBiKSAvIGQNCg0KCQkJaWYgKGcgPCBiKSB0aGVuDQoJCQkJaCA9IGggKyA2DQoJCQllbmQNCgkJZWxzZWlmIChtYXggPT0gZykgdGhlbg0KCQkJaCA9IChiIC0gcikgLyBkICsgMg0KCQllbHNlaWYgKG1heCA9PSBiKSB0aGVuDQoJCQloID0gKHIgLSBnKSAvIGQgKyA0DQoJCWVuZA0KDQoJCWggPSAoaCAvIDYpICogMzYwDQoJZW5kDQoNCglzZWxmLmgsIHNlbGYucywgc2VsZi5sID0gaCwgcywgbCBvciAyNTUNCmVuZA0KDQotLS0gVmFsaWRhdGVzIHRoZSBzaGFkZXIncyBSR0Igc3BhY2UuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBzaGFkZXJfYzp2YWxpZGF0ZV9yZ2Jfc3BhY2UoKQ0KCXNlbGYuciA9IG1hdGgubWluKDI1NSwgbWF0aC5tYXgoMCwgc2VsZi5yKSkNCglzZWxmLmcgPSBtYXRoLm1pbigyNTUsIG1hdGgubWF4KDAsIHNlbGYuZykpDQoJc2VsZi5iID0gbWF0aC5taW4oMjU1LCBtYXRoLm1heCgwLCBzZWxmLmIpKQ0KCXNlbGYuYSA9IG1hdGgubWluKDI1NSwgbWF0aC5tYXgoMCwgc2VsZi5hKSkNCmVuZA0KDQotLS0gVmFsaWRhdGVzIHRoZSBzaGFkZXIncyBIU0wgc3BhY2UuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBzaGFkZXJfYzp2YWxpZGF0ZV9oc2xfc3BhY2UoKQ0KCXNlbGYuaCA9IG1hdGgubWluKDM2MCwgbWF0aC5tYXgoMCwgc2VsZi5oKSkNCglzZWxmLnMgPSBtYXRoLm1pbigxLCBtYXRoLm1heCgwLCBzZWxmLnMpKQ0KCXNlbGYubCA9IG1hdGgubWluKDEsIG1hdGgubWF4KDAsIHNlbGYubCkpDQoJc2VsZi5hID0gbWF0aC5taW4oMjU1LCBtYXRoLm1heCgwLCBzZWxmLmEpKQ0KZW5kDQoNCi0tLSBTZXQncyB0aGUgc2hhZGVyJ3MgcmVkIGNoYW5uZWwuDQotLS0gQHBhcmFtIHIgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBzaGFkZXJfYzpzZXRfcihyKQ0KCXNlbGYuciA9IHINCg0KCXNlbGYudXBkYXRlX21ldGhvZChzZWxmLCAxKQ0KZW5kDQoNCi0tLSBTZXQncyB0aGUgc2hhZGVyJ3MgZ3JlZW4gY2hhbm5lbC4NCi0tLSBAcGFyYW0gZyBudW1iZXINCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHNoYWRlcl9jOnNldF9nKGcpDQoJc2VsZi5nID0gZw0KDQoJc2VsZi51cGRhdGVfbWV0aG9kKHNlbGYsIDEpDQplbmQNCg0KLS0tIFNldCdzIHRoZSBzaGFkZXIncyBibHVlIGNoYW5uZWwuDQotLS0gQHBhcmFtIGIgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBzaGFkZXJfYzpzZXRfYihiKQ0KCXNlbGYuYiA9IGINCg0KCXNlbGYudXBkYXRlX21ldGhvZChzZWxmLCAxKQ0KZW5kDQoNCi0tLSBTZXQncyB0aGUgc2hhZGVyJ3MgaHVlIHByb3BlcnR5Lg0KLS0tIEBwYXJhbSBoIG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gc2hhZGVyX2M6c2V0X2goaCkNCglzZWxmLmggPSBoDQoNCglzZWxmLnVwZGF0ZV9tZXRob2Qoc2VsZiwgMCkNCmVuZA0KDQotLS0gU2V0J3MgdGhlIHNoYWRlcidzIHNhdHVyYXRpb24gcHJvcGVydHkuDQotLS0gQHBhcmFtIHMgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBzaGFkZXJfYzpzZXRfcyhzKQ0KCXNlbGYucyA9IHMNCg0KCXNlbGYudXBkYXRlX21ldGhvZChzZWxmLCAwKQ0KZW5kDQoNCi0tLSBTZXQncyB0aGUgc2hhZGVyJ3MgbGlnaHRuZXNzIHByb3BlcnR5Lg0KLS0tIEBwYXJhbSBsIG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gc2hhZGVyX2M6c2V0X2wobCkNCglzZWxmLmwgPSBsDQoNCglzZWxmLnVwZGF0ZV9tZXRob2Qoc2VsZiwgMCkNCmVuZA0KDQotLS0gU2V0J3MgdGhlIHNoYWRlcidzIGFscGhhIGNoYW5uZWwuDQotLS0gQHBhcmFtIGEgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBzaGFkZXJfYzpzZXRfYShhKQ0KCXNlbGYuYSA9IGENCmVuZA0KDQotLS0gUmV0dXJucyAwIGZvciB3aGl0ZSwgYW5kIDEgZm9yIGJsYWNrIGRlcGVuZGluZyBvbiB3aGV0aGVyIGEgY29sb3VyIGlzIG1vc3QgdmlzaWJsZSBhZ2FpbnN0IHdoaXRlIG9yIGJsYWNrLg0KLS0tIEBwYXJhbSB0b2xlcmFuY2UgbnVtYmVyDQotLS0gQHJldHVybiBudW1iZXINCmZ1bmN0aW9uIHNoYWRlcl9jOmNvbnRyYXN0KHRvbGVyYW5jZSkNCgl0b2xlcmFuY2UgPSB0b2xlcmFuY2Ugb3IgMTUwDQoNCglsb2NhbCBjb250cmFzdCA9IHNlbGYuciAqIDAuMjEzICsgc2VsZi5nICogMC43MTUgKyBzZWxmLmIgKiAwLjA3Mg0KDQoJaWYgKGNvbnRyYXN0IDwgdG9sZXJhbmNlKSB0aGVuDQoJCXJldHVybiAwDQoJZW5kDQoNCglyZXR1cm4gMQ0KZW5kDQoNCi0tLSBTaGlmdCB0aGUgaHVlIG9mIHRoZSBzaGFkZXIuDQotLS0gQHBhcmFtIGFtb3VudCBudW1iZXINCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHNoYWRlcl9jOnNoaWZ0X2h1ZShhbW91bnQpDQoJc2VsZi5oID0gKHNlbGYuaCArIGFtb3VudCkgJSAzNjANCg0KCXNlbGYudXBkYXRlX21ldGhvZChzZWxmLCAwKQ0KZW5kDQoNCi0tLSBTaGlmdCB0aGUgc2F0dXJhdGlvbiBvZiB0aGUgc2hhZGVyLS0tIEBwYXJhbSBhbW91bnQgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBzaGFkZXJfYzpzaGlmdF9zYXR1cmF0aW9uKGFtb3VudCkNCglzZWxmLnMgPSBtYXRoLm1pbigxLCBtYXRoLm1heCgwLCBzZWxmLnMgKyBhbW91bnQpKQ0KDQoJc2VsZi51cGRhdGVfbWV0aG9kKHNlbGYsIDApDQplbmQNCg0KLS0tIFNoaWZ0IHRoZSBsaWdodG5lc3Mgb2YgdGhlIHNoYWRlci4NCi0tLSBAcGFyYW0gYW1vdW50IG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gc2hhZGVyX2M6c2hpZnRfbGlnaHRuZXNzKGFtb3VudCkNCglzZWxmLmwgPSBtYXRoLm1pbigxLCBtYXRoLm1heCgwLCBzZWxmLmwgKyBhbW91bnQpKQ0KDQoJc2VsZi51cGRhdGVfbWV0aG9kKHNlbGYsIDApDQplbmQNCg0KLS0tIExpZ2h0ZW4gdGhlIHNoYWRlci4NCi0tLSBAcGFyYW0gYW1vdW50IG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gc2hhZGVyX2M6bGlnaHRlbihhbW91bnQpDQoJc2VsZi5sID0gbWF0aC5taW4oMSwgbWF0aC5tYXgoMCwgc2VsZi5sICsgYW1vdW50KSkNCg0KCXNlbGYudXBkYXRlX21ldGhvZChzZWxmLCAwKQ0KZW5kDQoNCi0tLSBEYXJrZW4gdGhlIHNoYWRlci4NCi0tLSBAcGFyYW0gYW1vdW50IG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gc2hhZGVyX2M6ZGFya2VuKGFtb3VudCkNCglzZWxmLmwgPSBtYXRoLm1pbigxLCBtYXRoLm1heCgwLCBzZWxmLmwgLSBhbW91bnQpKQ0KDQoJc2VsZi51cGRhdGVfbWV0aG9kKHNlbGYsIDApDQplbmQNCg0KLS0tIFNhdHVyYXRlIHRoZSBzaGFkZXIuDQotLS0gQHBhcmFtIGFtb3VudCBudW1iZXINCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHNoYWRlcl9jOnNhdHVyYXRlKGFtb3VudCkNCglzZWxmLnMgPSBtYXRoLm1pbigxLCBtYXRoLm1heCgwLCBzZWxmLnMgKyBhbW91bnQpKQ0KDQoJc2VsZi51cGRhdGVfbWV0aG9kKHNlbGYsIDApDQplbmQNCg0KLS0tIERlc2F0dXJhdGUgdGhlIHNoYWRlci4NCi0tLSBAcGFyYW0gYW1vdW50IG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gc2hhZGVyX2M6ZGVzYXR1cmF0ZShhbW91bnQpDQoJc2VsZi5zID0gbWF0aC5taW4oMSwgbWF0aC5tYXgoMCwgc2VsZi5zIC0gYW1vdW50KSkNCg0KCXNlbGYudXBkYXRlX21ldGhvZChzZWxmLCAwKQ0KZW5kDQoNCi0tLSBGYWRlIHRoZSBzaGFkZXIncyBvcGFjaXR5IGluLg0KLS0tIEBwYXJhbSBhbW91bnQgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBzaGFkZXJfYzpmYWRlX2luKGFtb3VudCkNCglpZiAoc2VsZi5hID09IDI1NSkgdGhlbg0KCQlyZXR1cm4NCgllbmQNCg0KCXNlbGYuYSA9IHNlbGYuYSArIGFtb3VudA0KDQoJaWYgKHNlbGYuYSA+IDI1NSkgdGhlbg0KCQlzZWxmLmEgPSAyNTUNCgllbmQNCmVuZA0KDQotLS0gRmFkZSB0aGUgc2hhZGVyJ3Mgb3BhY2l0eSBvdXQuDQotLS0gQHBhcmFtIGFtb3VudCBudW1iZXINCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHNoYWRlcl9jOmZhZGVfb3V0KGFtb3VudCkNCglpZiAoc2VsZi5hID09IDApIHRoZW4NCgkJcmV0dXJuDQoJZW5kDQoNCglzZWxmLmEgPSBzZWxmLmEgLSBhbW91bnQNCg0KCWlmIChzZWxmLmEgPCAwKSB0aGVuDQoJCXNlbGYuYSA9IDANCgllbmQNCmVuZA0KDQotLS0gUmV0dXJucyB0cnVlIGlmIHRoZSBzaGFkZXIgaXMgaW52aXNpYmxlLg0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gc2hhZGVyX2M6aXNfaW52aXNpYmxlKCkNCglyZXR1cm4gc2VsZi5hID09IDANCmVuZA0KDQotLS0gUmV0dXJucyB0cnVlIGlmIHRoZSBzaGFkZXIgaXMgdmlzaWJsZS4NCi0tLSBAcmV0dXJuIGJvb2xlYW4NCmZ1bmN0aW9uIHNoYWRlcl9jOmlzX3Zpc2libGUoKQ0KCXJldHVybiBzZWxmLmEgPiAwDQplbmQNCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIGRlcGVuZGVuY3k6IGhhdm9jX3RpbWVyXzRfMV8wDQotLS0gVGltZXIgdGFibGUuDQpsb2NhbCB0aW1lciA9IHsNCgktLS0gQHR5cGUgZnVuKHN0YXJ0OmJvb2xlYW4sIGN1c3RvbTp0YWJsZSk6dGltZXJfc3RhbmRhcmRfYw0KCXN0YW5kYXJkID0gbmlsLA0KCS0tLSBAdHlwZSBmdW4oc3RhcnQ6Ym9vbGVhbiwgY291bnRfZnJvbTpudW1iZXIsIGN1c3RvbTp0YWJsZSk6dGltZXJfY291bnRkb3duX2MNCgljb3VudGRvd24gPSBuaWwsDQoJLS0tIEB0eXBlIGZ1bihzdGFydDpib29sZWFuLCBjdXN0b206dGFibGUpOnRpbWVyX3RpY2tfYw0KCXRpY2sgPSBuaWwNCn0NCg0KLS1yZWdpb24gdGltZXJfc3RhbmRhcmQNCi0tLSBAY2xhc3MgdGltZXJfc3RhbmRhcmRfYw0KLS0tIEBmaWVsZCBwdWJsaWMgc3RhcnRlZF9hdCBudW1iZXIgVGltZXIgd2FzIHN0YXJ0ZWQgYXQuDQotLS0gQGZpZWxkIHB1YmxpYyBwYXVzZWRfYXQgbnVtYmVyIFRpbWVyIHdhcyBwYXVzZWQgYXQuDQpsb2NhbCB0aW1lcl9zdGFuZGFyZF9jID0ge30NCmxvY2FsIHRpbWVyX3N0YW5kYXJkX210ID0gew0KCV9faW5kZXggPSB0aW1lcl9zdGFuZGFyZF9jLA0KCV9fY2FsbCA9IGZ1bmN0aW9uKHRpbWVyX3N0YW5kYXJkKQ0KCQlpZiAodGltZXJfc3RhbmRhcmQuc3RhcnRlZF9hdCA9PSBuaWwpIHRoZW4NCgkJCXJldHVybiAwDQoJCWVuZA0KDQoJCWlmICh0aW1lcl9zdGFuZGFyZC5wYXVzZWRfYXQgfj0gbmlsKSB0aGVuDQoJCQlyZXR1cm4gdGltZXJfc3RhbmRhcmQucGF1c2VkX2F0IC0gdGltZXJfc3RhbmRhcmQuc3RhcnRlZF9hdA0KCQllbmQNCg0KCQlyZXR1cm4gZ2xvYmFscy5yZWFsdGltZSgpIC0gdGltZXJfc3RhbmRhcmQuc3RhcnRlZF9hdA0KCWVuZA0KfQ0KDQotLS0gSW5zdGFudGlhdGUgdGltZXJfc3RhbmRhcmRfYy4NCi0tLSBAcGFyYW0gc3RhcnQgYm9vbGVhbg0KLS0tIEBwYXJhbSBjdXN0b20gdGFibGUNCi0tLSBAcmV0dXJuIHRpbWVyX3N0YW5kYXJkX2MNCmZ1bmN0aW9uIHRpbWVyX3N0YW5kYXJkX2MubmV3KHN0YXJ0LCBjdXN0b20pDQoJc3RhcnQgPSBzdGFydCBvciBmYWxzZQ0KDQoJbG9jYWwgcHJvcGVydGllcyA9IGN1c3RvbSBvciB7fQ0KDQoJcHJvcGVydGllcy5zdGFydGVkX2F0ID0gbmlsDQoJcHJvcGVydGllcy5wYXVzZWRfYXQgPSBuaWwNCg0KCWxvY2FsIHRpbWVyID0gc2V0bWV0YXRhYmxlKHByb3BlcnRpZXMsIHRpbWVyX3N0YW5kYXJkX210KQ0KDQoJaWYgKHN0YXJ0ID09IHRydWUpIHRoZW4NCgkJdGltZXI6c3RhcnQoKQ0KCWVuZA0KDQoJcmV0dXJuIHRpbWVyDQplbmQNCg0KLS0tIFJldHVybnMgdHJ1ZSBpZiB0aGUgdGltZXIgd2FzIHN0YXJ0ZWQuDQotLS0gQHJldHVybiBib29sZWFuDQpmdW5jdGlvbiB0aW1lcl9zdGFuZGFyZF9jOmhhc19zdGFydGVkKCkNCglyZXR1cm4gc2VsZi5zdGFydGVkX2F0IH49IG5pbA0KZW5kDQoNCi0tLSBSZXR1cm5zIHRydWUgaWYgdGhlIHRpbWVyIGlzIHBhdXNlZC4NCi0tLSBAcmV0dXJuIGJvb2xlYW4NCmZ1bmN0aW9uIHRpbWVyX3N0YW5kYXJkX2M6aXNfcGF1c2VkKCkNCglyZXR1cm4gc2VsZi5wYXVzZWRfYXQgfj0gbmlsDQplbmQNCg0KLS0tIEZpcmVzIHRoZSBldmVudCBjYWxsYmFjayBvbmNlIHRoZSB0aW1lciBoYXMgcmVhY2hlZCB0aGUgdGltZSBpdCB3YXMgdG9sZCB0byBjb3VudCB0by4NCi0tLSBAcGFyYW0gZmlyZV9hdCBudW1iZXINCi0tLSBAcGFyYW0gY2FsbGJhY2sgZnVuKHRpbWVyOiB0aW1lcl9zdGFuZGFyZF9jKTogdm9pZA0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gdGltZXJfc3RhbmRhcmRfYzpldmVudChmaXJlX2F0LCBjYWxsYmFjaykNCglpZiAoc2VsZigpID49IGZpcmVfYXQpIHRoZW4NCgkJY2FsbGJhY2soc2VsZikNCgllbmQNCmVuZA0KDQotLS0gUmV0dXJucyB0cnVlIGlmIHRoZSBzZWNvbmRzIGFyZ3VtZW50IGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgZWxhcHNlZCB0aW1lLg0KLS0tIEBwYXJhbSBzZWNvbmRzIG51bWJlcg0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gdGltZXJfc3RhbmRhcmRfYzplbGFwc2VkKHNlY29uZHMpDQoJcmV0dXJuIHNlbGYoKSA+PSBzZWNvbmRzDQplbmQNCg0KLS0tIFRlbGwgdGhlIHRpbWVyIHRvIHN0YXJ0Lg0KLS0tIENhbGxpbmcgdGhpcyB3aGlsZSB0aGUgdGltZXIgaGFzIGFscmVhZHkgc3RhcnRlZCBpcyBmdW5jdGlvbmFsbHkgZXF1aXZhbGVudCB0byBjYWxsaW5nIDpyZXN0YXJ0KCkuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiB0aW1lcl9zdGFuZGFyZF9jOnN0YXJ0KCkNCglzZWxmLnN0YXJ0ZWRfYXQgPSBnbG9iYWxzLnJlYWx0aW1lKCkNCmVuZA0KDQotLS0gVGVsbCB0aGUgdGltZXIgdG8gc3RvcC4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHRpbWVyX3N0YW5kYXJkX2M6c3RvcCgpDQoJc2VsZi5zdGFydGVkX2F0ID0gbmlsDQoJc2VsZi5wYXVzZWRfYXQgPSBuaWwNCmVuZA0KDQotLS0gVGVsbCB0aGUgdGltZXIgdG8gcmVzdGFydC4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHRpbWVyX3N0YW5kYXJkX2M6cmVzdGFydCgpDQoJc2VsZjpzdG9wKCkNCglzZWxmOnN0YXJ0KCkNCmVuZA0KDQotLS0gVGVsbCB0aGUgdGltZXIgdG8gcGF1c2UuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiB0aW1lcl9zdGFuZGFyZF9jOnBhdXNlKCkNCglpZiAoc2VsZi5zdGFydGVkX2F0ID09IG5pbCkgdGhlbg0KCQlyZXR1cm4NCgllbmQNCg0KCXNlbGYucGF1c2VkX2F0ID0gZ2xvYmFscy5yZWFsdGltZSgpDQplbmQNCg0KLS0tIFRlbGwgdGhlIHRpbWVyIHRvIHVucGF1c2UuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiB0aW1lcl9zdGFuZGFyZF9jOnVucGF1c2UoKQ0KCWlmIChzZWxmLnN0YXJ0ZWRfYXQgPT0gbmlsIG9yIHNlbGYucGF1c2VkX2F0ID09IG5pbCkgdGhlbg0KCQlyZXR1cm4NCgllbmQNCg0KCWxvY2FsIHBhdXNlZF9mb3IgPSBnbG9iYWxzLnJlYWx0aW1lKCkgLSBzZWxmLnBhdXNlZF9hdA0KDQoJc2VsZi5zdGFydGVkX2F0ID0gc2VsZi5zdGFydGVkX2F0ICsgcGF1c2VkX2Zvcg0KCXNlbGYucGF1c2VkX2F0ID0gbmlsDQplbmQNCg0KLS0tIFRlbGwgdGhlIHRpbWVyIHRvIHRvZ2dsZSBwYXVzZS4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHRpbWVyX3N0YW5kYXJkX2M6dG9nZ2xlX3BhdXNlKCkNCglpZiAoc2VsZi5wYXVzZWRfYXQgPT0gbmlsKSB0aGVuDQoJCXNlbGY6cGF1c2UoKQ0KCWVsc2UNCgkJc2VsZjp1bnBhdXNlKCkNCgllbmQNCmVuZA0KDQp0aW1lci5zdGFuZGFyZCA9IHRpbWVyX3N0YW5kYXJkX2MubmV3DQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiB0aW1lcl90aWNrDQotLS0gQGNsYXNzIHRpbWVyX3RpY2tfYw0KLS0tIEBmaWVsZCBwdWJsaWMgc3RhcnRlZF9hdCBudW1iZXIgVGltZXIgd2FzIHN0YXJ0ZWQgYXQuDQotLS0gQGZpZWxkIHB1YmxpYyBwYXVzZWRfYXQgbnVtYmVyIFRpbWVyIHdhcyBwYXVzZWQgYXQuDQpsb2NhbCB0aW1lcl90aWNrX2MgPSB7fQ0KbG9jYWwgdGltZXJfdGlja19tdCA9IHsNCglfX2luZGV4ID0gdGltZXJfdGlja19jLA0KCV9fY2FsbCA9IGZ1bmN0aW9uKHRpbWVyX3RpY2spDQoJCWlmICh0aW1lcl90aWNrLnN0YXJ0ZWRfYXQgPT0gbmlsKSB0aGVuDQoJCQlyZXR1cm4gMA0KCQllbmQNCg0KCQlpZiAodGltZXJfdGljay5wYXVzZWRfYXQgfj0gbmlsKSB0aGVuDQoJCQlyZXR1cm4gdGltZXJfdGljay5wYXVzZWRfYXQgLSB0aW1lcl90aWNrLnN0YXJ0ZWRfYXQNCgkJZW5kDQoNCgkJcmV0dXJuIGdsb2JhbHMudGlja2NvdW50KCkgLSB0aW1lcl90aWNrLnN0YXJ0ZWRfYXQNCgllbmQNCn0NCg0KLS0tIEluc3RhbnRpYXRlIHRpbWVyX3RpY2tfYy4NCi0tLSBAcGFyYW0gc3RhcnQgYm9vbGVhbg0KLS0tIEBwYXJhbSBjdXN0b20gdGFibGUNCi0tLSBAcmV0dXJuIHRpbWVyX3RpY2tfYw0KZnVuY3Rpb24gdGltZXJfdGlja19jLm5ldyhzdGFydCwgY3VzdG9tKQ0KCXN0YXJ0ID0gc3RhcnQgb3IgZmFsc2UNCg0KCWxvY2FsIHByb3BlcnRpZXMgPSBjdXN0b20gb3Ige30NCg0KCXByb3BlcnRpZXMuc3RhcnRlZF9hdCA9IG5pbA0KCXByb3BlcnRpZXMucGF1c2VkX2F0ID0gbmlsDQoNCglsb2NhbCB0aW1lciA9IHNldG1ldGF0YWJsZShwcm9wZXJ0aWVzLCB0aW1lcl90aWNrX210KQ0KDQoJaWYgKHN0YXJ0ID09IHRydWUpIHRoZW4NCgkJdGltZXI6c3RhcnQoKQ0KCWVuZA0KDQoJcmV0dXJuIHRpbWVyDQplbmQNCg0KLS0tIFJldHVybnMgdHJ1ZSBpZiB0aGUgdGltZXIgd2FzIHN0YXJ0ZWQuDQotLS0gQHJldHVybiBib29sZWFuDQpmdW5jdGlvbiB0aW1lcl90aWNrX2M6aGFzX3N0YXJ0ZWQoKQ0KCXJldHVybiBzZWxmLnN0YXJ0ZWRfYXQgfj0gbmlsDQplbmQNCg0KLS0tIFJldHVybnMgdHJ1ZSBpZiB0aGUgdGltZXIgaXMgcGF1c2VkLg0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gdGltZXJfdGlja19jOmlzX3BhdXNlZCgpDQoJcmV0dXJuIHNlbGYucGF1c2VkX2F0IH49IG5pbA0KZW5kDQoNCi0tLSBGaXJlcyB0aGUgZXZlbnQgY2FsbGJhY2sgb25jZSB0aGUgdGltZXIgaGFzIHJlYWNoZWQgdGhlIHRpbWUgaXQgd2FzIHRvbGQgdG8gY291bnQgdG8uDQotLS0gQHBhcmFtIGZpcmVfYXQgbnVtYmVyDQotLS0gQHBhcmFtIGNhbGxiYWNrIGZ1bih0aW1lcjogdGltZXJfdGlja19jKTogdm9pZA0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gdGltZXJfdGlja19jOmV2ZW50KGZpcmVfYXQsIGNhbGxiYWNrKQ0KCWlmIChzZWxmKCkgPj0gZmlyZV9hdCkgdGhlbg0KCQljYWxsYmFjayhzZWxmKQ0KCWVuZA0KZW5kDQoNCi0tLSBSZXR1cm5zIHRydWUgaWYgdGhlIHNlY29uZHMgYXJndW1lbnQgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBlbGFwc2VkIHRpbWUuDQotLS0gQHBhcmFtIHRpY2tzIG51bWJlcg0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gdGltZXJfc3RhbmRhcmRfYzplbGFwc2VkKHRpY2tzKQ0KCXJldHVybiBzZWxmKCkgPj0gdGlja3MNCmVuZA0KDQotLS0gVGVsbCB0aGUgdGltZXIgdG8gc3RhcnQuDQotLS0gQ2FsbGluZyB0aGlzIHdoaWxlIHRoZSB0aW1lciBoYXMgYWxyZWFkeSBzdGFydGVkIGlzIGZ1bmN0aW9uYWxseSBlcXVpdmFsZW50IHRvIGNhbGxpbmcgOnJlc3RhcnQoKS4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHRpbWVyX3RpY2tfYzpzdGFydCgpDQoJc2VsZi5zdGFydGVkX2F0ID0gZ2xvYmFscy50aWNrY291bnQoKQ0KZW5kDQoNCi0tLSBUZWxsIHRoZSB0aW1lciB0byBzdG9wLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gdGltZXJfdGlja19jOnN0b3AoKQ0KCXNlbGYuc3RhcnRlZF9hdCA9IG5pbA0KCXNlbGYucGF1c2VkX2F0ID0gbmlsDQplbmQNCg0KLS0tIFRlbGwgdGhlIHRpbWVyIHRvIHJlc3RhcnQuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiB0aW1lcl90aWNrX2M6cmVzdGFydCgpDQoJc2VsZjpzdG9wKCkNCglzZWxmOnN0YXJ0KCkNCmVuZA0KDQoNCi0tLSBUZWxsIHRoZSB0aW1lciB0byBwYXVzZS4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHRpbWVyX3RpY2tfYzpwYXVzZSgpDQoJaWYgKHNlbGYuc3RhcnRlZF9hdCA9PSBuaWwpIHRoZW4NCgkJcmV0dXJuDQoJZW5kDQoNCglzZWxmLnBhdXNlZF9hdCA9IGdsb2JhbHMudGlja2NvdW50KCkNCmVuZA0KDQotLS0gVGVsbCB0aGUgdGltZXIgdG8gdW5wYXVzZS4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHRpbWVyX3RpY2tfYzp1bnBhdXNlKCkNCglpZiAoc2VsZi5zdGFydGVkX2F0ID09IG5pbCBvciBzZWxmLnBhdXNlZF9hdCA9PSBuaWwpIHRoZW4NCgkJcmV0dXJuDQoJZW5kDQoNCglsb2NhbCBwYXVzZWRfZm9yID0gZ2xvYmFscy50aWNrY291bnQoKSAtIHNlbGYucGF1c2VkX2F0DQoNCglzZWxmLnN0YXJ0ZWRfYXQgPSBzZWxmLnN0YXJ0ZWRfYXQgKyBwYXVzZWRfZm9yDQoJc2VsZi5wYXVzZWRfYXQgPSBuaWwNCmVuZA0KDQotLS0gVGVsbCB0aGUgdGltZXIgdG8gdG9nZ2xlIHBhdXNlLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gdGltZXJfdGlja19jOnRvZ2dsZV9wYXVzZSgpDQoJaWYgKHNlbGYucGF1c2VkX2F0ID09IG5pbCkgdGhlbg0KCQlzZWxmOnBhdXNlKCkNCgllbHNlDQoJCXNlbGY6dW5wYXVzZSgpDQoJZW5kDQplbmQNCg0KdGltZXIudGljayA9IHRpbWVyX3RpY2tfYy5uZXcNCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIHRpbWVyX2NvdW50ZG93bg0KLS0tIEBjbGFzcyB0aW1lcl9jb3VudGRvd25fYw0KLS0tIEBmaWVsZCBwdWJsaWMgc3RhcnRlZF9hdCBudW1iZXIgVGltZXIgd2FzIHN0YXJ0ZWQgYXQuDQotLS0gQGZpZWxkIHB1YmxpYyBwYXVzZWRfYXQgbnVtYmVyIFRpbWVyIHdhcyBwYXVzZWQgYXQuDQotLS0gQGZpZWxkIHB1YmxpYyBleHBpcmVzX2F0IG51bWJlciBUaW1lciBleHBpcmVzIGF0Lg0KLS0tIEBmaWVsZCBwdWJsaWMgY291bnRfZnJvbSBudW1iZXIgVGltZXIgY291bnRzIGZyb20gdGhpcyB0byAwLg0KbG9jYWwgdGltZXJfY291bnRkb3duX2MgPSB7fQ0KbG9jYWwgdGltZXJfY291bnRkb3duX210ID0gew0KCV9faW5kZXggPSB0aW1lcl9jb3VudGRvd25fYywNCglfX2NhbGwgPSBmdW5jdGlvbih0aW1lcl9jb3VudGRvd24pDQoJCWlmICh0aW1lcl9jb3VudGRvd24uc3RhcnRlZF9hdCA9PSBuaWwpIHRoZW4NCgkJCXJldHVybiB0aW1lcl9jb3VudGRvd24uY291bnRfZnJvbQ0KCQllbmQNCg0KCQlpZiAodGltZXJfY291bnRkb3duLnBhdXNlZF9hdCB+PSBuaWwpIHRoZW4NCgkJCXJldHVybiB0aW1lcl9jb3VudGRvd24uZXhwaXJlc19hdCAtIHRpbWVyX2NvdW50ZG93bi5wYXVzZWRfYXQNCgkJZW5kDQoNCgkJcmV0dXJuIHRpbWVyX2NvdW50ZG93bi5leHBpcmVzX2F0IC0gZ2xvYmFscy5yZWFsdGltZSgpDQoJZW5kDQp9DQoNCi0tLSBJbnN0YW50aWF0ZSB0aW1lcl9zdGFuZGFyZF9jLg0KLS0tIEBwYXJhbSBzdGFydCBib29sZWFuDQotLS0gQHBhcmFtIGN1c3RvbSB0YWJsZQ0KLS0tIEByZXR1cm4gdGltZXJfY291bnRkb3duX2MNCmZ1bmN0aW9uIHRpbWVyX2NvdW50ZG93bl9jLm5ldyhzdGFydCwgY291bnRfZnJvbSwgY3VzdG9tKQ0KCXN0YXJ0ID0gc3RhcnQgb3IgZmFsc2UNCg0KCWxvY2FsIHByb3BlcnRpZXMgPSBjdXN0b20gb3Ige30NCg0KCXByb3BlcnRpZXMuc3RhcnRlZF9hdCA9IG5pbA0KCXByb3BlcnRpZXMucGF1c2VkX2F0ID0gbmlsDQoJcHJvcGVydGllcy5leHBpcmVzX2F0ID0gZ2xvYmFscy5yZWFsdGltZSgpICsgY291bnRfZnJvbQ0KCXByb3BlcnRpZXMuY291bnRfZnJvbSA9IGNvdW50X2Zyb20NCg0KCWxvY2FsIHRpbWVyID0gc2V0bWV0YXRhYmxlKHByb3BlcnRpZXMsIHRpbWVyX2NvdW50ZG93bl9tdCkNCg0KCWlmIChzdGFydCA9PSB0cnVlKSB0aGVuDQoJCXRpbWVyOnN0YXJ0KCkNCgllbmQNCg0KCXJldHVybiB0aW1lcg0KZW5kDQoNCi0tLSBSZXR1cm5zIHRydWUgaWYgdGhlIHRpbWVyIHdhcyBzdGFydGVkLg0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gdGltZXJfY291bnRkb3duX2M6aGFzX3N0YXJ0ZWQoKQ0KCXJldHVybiBzZWxmLnN0YXJ0ZWRfYXQgfj0gbmlsDQplbmQNCg0KLS0tIFJldHVybnMgdHJ1ZSBpZiB0aGUgdGltZXIgaXMgcGF1c2VkLg0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gdGltZXJfY291bnRkb3duX2M6aXNfcGF1c2VkKCkNCglyZXR1cm4gc2VsZi5wYXVzZWRfYXQgfj0gbmlsDQplbmQNCg0KLS0tIEZpcmVzIHRoZSBldmVudCBjYWxsYmFjayBvbmNlIHRoZSB0aW1lciBoYXMgcmVhY2hlZCB0aGUgdGltZSBpdCB3YXMgdG9sZCB0byBjb3VudCB0by4NCi0tLSBAcGFyYW0gZmlyZV9hdCBudW1iZXINCi0tLSBAcGFyYW0gY2FsbGJhY2sgZnVuKHRpbWVyOiB0aW1lcl9jb3VudGRvd25fYyk6IHZvaWQNCi0tLSBAcmV0dXJuIGJvb2xlYW4NCmZ1bmN0aW9uIHRpbWVyX2NvdW50ZG93bl9jOmV2ZW50KGZpcmVfYXQsIGNhbGxiYWNrKQ0KCWlmIChzZWxmKCkgPD0gZmlyZV9hdCkgdGhlbg0KCQljYWxsYmFjayhzZWxmKQ0KCWVuZA0KZW5kDQoNCi0tLSBSZXR1cm5zIHRydWUgaWYgdGhlIHRpbWVyIGlzIDAgb3IgbGVzcy4NCi0tLSBAcmV0dXJuIGJvb2xlYW4NCmZ1bmN0aW9uIHRpbWVyX2NvdW50ZG93bl9jOmV4cGlyZWQoKQ0KCXJldHVybiBzZWxmKCkgPD0gMA0KZW5kDQoNCi0tLSBUZWxsIHRoZSB0aW1lciB0byBzdGFydC4NCi0tLSBDYWxsaW5nIHRoaXMgd2hpbGUgdGhlIHRpbWVyIGhhcyBhbHJlYWR5IHN0YXJ0ZWQgaXMgZnVuY3Rpb25hbGx5IGVxdWl2YWxlbnQgdG8gY2FsbGluZyA6cmVzdGFydCgpLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gdGltZXJfY291bnRkb3duX2M6c3RhcnQoKQ0KCXNlbGYuc3RhcnRlZF9hdCA9IGdsb2JhbHMucmVhbHRpbWUoKQ0KCXNlbGYuZXhwaXJlc19hdCA9IGdsb2JhbHMucmVhbHRpbWUoKSArIHNlbGYuY291bnRfZnJvbQ0KZW5kDQoNCi0tLSBUZWxsIHRoZSB0aW1lciB0byBzdG9wLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gdGltZXJfY291bnRkb3duX2M6c3RvcCgpDQoJc2VsZi5zdGFydGVkX2F0ID0gbmlsDQoJc2VsZi5wYXVzZWRfYXQgPSBuaWwNCmVuZA0KDQotLS0gVGVsbCB0aGUgdGltZXIgdG8gcmVzdGFydC4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHRpbWVyX2NvdW50ZG93bl9jOnJlc3RhcnQoKQ0KCXNlbGY6c3RvcCgpDQoJc2VsZjpzdGFydCgpDQplbmQNCg0KDQotLS0gVGVsbCB0aGUgdGltZXIgdG8gcGF1c2UuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiB0aW1lcl9jb3VudGRvd25fYzpwYXVzZSgpDQoJaWYgKHNlbGYuc3RhcnRlZF9hdCA9PSBuaWwpIHRoZW4NCgkJcmV0dXJuDQoJZW5kDQoNCglzZWxmLnBhdXNlZF9hdCA9IGdsb2JhbHMucmVhbHRpbWUoKQ0KZW5kDQoNCi0tLSBUZWxsIHRoZSB0aW1lciB0byB1bnBhdXNlLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gdGltZXJfY291bnRkb3duX2M6dW5wYXVzZSgpDQoJaWYgKHNlbGYuc3RhcnRlZF9hdCA9PSBuaWwgb3Igc2VsZi5wYXVzZWRfYXQgPT0gbmlsKSB0aGVuDQoJCXJldHVybg0KCWVuZA0KDQoJbG9jYWwgcGF1c2VkX2ZvciA9IGdsb2JhbHMucmVhbHRpbWUoKSAtIHNlbGYucGF1c2VkX2F0DQoNCglzZWxmLnN0YXJ0ZWRfYXQgPSBwYXVzZWRfZm9yICsgc2VsZi5zdGFydGVkX2F0DQoJc2VsZi5leHBpcmVzX2F0ID0gcGF1c2VkX2ZvciArIHNlbGYuZXhwaXJlc19hdA0KCXNlbGYucGF1c2VkX2F0ID0gbmlsDQplbmQNCg0KLS0tIFRlbGwgdGhlIHRpbWVyIHRvIHRvZ2dsZSBwYXVzZS4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIHRpbWVyX2NvdW50ZG93bl9jOnRvZ2dsZV9wYXVzZSgpDQoJaWYgKHNlbGYucGF1c2VkX2F0ID09IG5pbCkgdGhlbg0KCQlzZWxmOnBhdXNlKCkNCgllbHNlDQoJCXNlbGY6dW5wYXVzZSgpDQoJZW5kDQplbmQNCg0KdGltZXIuY291bnRkb3duID0gdGltZXJfY291bnRkb3duX2MubmV3DQotLWVuZHJlZ2lvbg0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gZGVwZW5kZW5jeTogaGF2b2NfbWVudV8xXzNfMA0KLS1yZWdpb24gbWVudV9hc3NlcnQNCi0tLSBBc3NlcnQuDQotLS0gQHBhcmFtIGV4cHJlc3Npb24gYm9vbGVhbg0KLS0tIEBwYXJhbSBsZXZlbCBudW1iZXINCi0tLSBAcGFyYW0gbWVzc2FnZSBzdHJpbmcNCi0tLSBAdmFyYXJnIHN0cmluZw0KLS0tIEByZXR1cm4gdm9pZA0KbG9jYWwgZnVuY3Rpb24gbWVudV9hc3NlcnQoZXhwcmVzc2lvbiwgbGV2ZWwsIG1lc3NhZ2UsIC4uLikNCglpZiAobm90IGV4cHJlc3Npb24pIHRoZW4NCgkJZXJyb3Ioc3RyaW5nLmZvcm1hdChtZXNzYWdlLCAuLi4pLCBsZXZlbCkNCgllbmQNCmVuZA0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gbWVudV9tYXANCmxvY2FsIG1lbnVfbWFwID0gew0KCXJhZ2UgPSB7ImFpbWJvdCIsICJvdGhlciJ9LA0KCWFhID0geyJhbnRpLWFpbWJvdCBhbmdsZXMiLCAiZmFrZSBsYWciLCAib3RoZXIifSwNCglsZWdpdCA9IHsid2VhcG9uIHR5cGUiLCAiYWltYm90IiwgInRyaWdnZXJib3QiLCAib3RoZXIifSwNCgl2aXN1YWxzID0geyJwbGF5ZXIgZXNwIiwgIm90aGVyIGVzcCIsICJjb2xvcmVkIG1vZGVscyIsICJlZmZlY3RzIn0sDQoJbWlzYyA9IHsibWlzY2VsbGFuZW91cyIsICJzZXR0aW5ncyIsICJsdWEiLCAib3RoZXIifSwNCglza2lucyA9IHsid2VhcG9uIHNraW4iLCAia25pZmUgb3B0aW9ucyIsICJnbG92ZSBvcHRpb25zIn0sDQoJY29uZmlnID0geyJwcmVzZXRzIiwgImx1YSJ9LA0KCXBsYXllcnMgPSB7InBsYXllcnMiLCAiYWRqdXN0bWVudHMifSwNCglsdWEgPSB7ImEiLCAiYiJ9DQp9DQoNCmZvciB0YWIsIGNvbnRhaW5lcnMgaW4gcGFpcnMobWVudV9tYXApIGRvDQoJbWVudV9tYXBbdGFiXSA9IHt9DQoNCglmb3IgaT0xLCAjY29udGFpbmVycyBkbw0KCQltZW51X21hcFt0YWJdW2NvbnRhaW5lcnNbaV1dID0gdHJ1ZQ0KCWVuZA0KZW5kDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBtZW51X2l0ZW0NCi0tLSBAY2xhc3MgbWVudV9pdGVtX2MNCi0tLSBAZmllbGQgcHVibGljIHRhYiBzdHJpbmcNCi0tLSBAZmllbGQgcHVibGljIGNvbnRhaW5lciBzdHJpbmcNCi0tLSBAZmllbGQgcHVibGljIG5hbWUgc3RyaW5nDQotLS0gQGZpZWxkIHB1YmxpYyByZWZlcmVuY2UgbnVtYmVyDQotLS0gQGZpZWxkIHB1YmxpYyB2aXNpYmxlIGJvb2xlYW4NCi0tLSBAZmllbGQgcHVibGljIGhpZGRlbl92YWx1ZSBhbnkNCi0tLSBAZmllbGQgcHVibGljIGNoaWxkcmVuIHRhYmxlPG51bWJlciwgbWVudV9pdGVtX2M+DQotLS0gQGZpZWxkIHB1YmxpYyB1aV9jYWxsYmFjayBmdW5jdGlvbg0KLS0tIEBmaWVsZCBwdWJsaWMgZ2V0dGVyIHRhYmxlDQotLS0gQGZpZWxkIHB1YmxpYyBzZXR0ZXIgdGFibGUNCi0tLSBAZmllbGQgcHVibGljIHBhcmVudF92YWx1ZV9vcl9jYWxsYmFjayBhbnl8ZnVuY3Rpb24NCmxvY2FsIG1lbnVfaXRlbV9jID0ge30NCg0KbG9jYWwgbWVudV9pdGVtX210ID0gew0KCV9faW5kZXggPSBtZW51X2l0ZW1fYw0KfQ0KDQotLS0gQHBhcmFtIGl0ZW0gbWVudV9pdGVtX2MNCi0tLSBAdmFyYXJnIGFueQ0KLS0tIEByZXR1cm4gbWVudV9pdGVtX2N8YW55DQpmdW5jdGlvbiBtZW51X2l0ZW1fbXQuX19jYWxsKGl0ZW0sIC4uLikNCglsb2NhbCBhcmdzID0gey4uLn0NCg0KCWlmICgjYXJncyA9PSAwKSB0aGVuDQoJCXJldHVybiBpdGVtOmdldCgpDQoJZW5kDQoNCglsb2NhbCBkb191aV9zZXQgPSB7cGNhbGwoaXRlbS5zZXQsIGl0ZW0sIHVucGFjayhhcmdzKSl9DQoNCgltZW51X2Fzc2VydChkb191aV9zZXRbMV0sIDQsIGRvX3VpX3NldFsyXSkNCg0KCXJldHVybiBpdGVtDQplbmQNCg0KLS0tIENyZWF0ZSBhIG5ldyBtZW51X2l0ZW1fYy4NCi0tLSBAcGFyYW0gZWxlbWVudCBmdW5jdGlvbg0KLS0tIEBwYXJhbSB0YWIgc3RyaW5nDQotLS0gQHBhcmFtIGNvbnRhaW5lciBzdHJpbmcNCi0tLSBAcGFyYW0gbmFtZSBzdHJpbmcNCi0tLSBAdmFyYXJnIGFueQ0KLS0tIEByZXR1cm4gbWVudV9pdGVtX2MNCmZ1bmN0aW9uIG1lbnVfaXRlbV9jLm5ldyhlbGVtZW50LCB0YWIsIGNvbnRhaW5lciwgbmFtZSwgLi4uKQ0KCWxvY2FsIHJlZmVyZW5jZQ0KCWxvY2FsIGlzX21lbnVfcmVmZXJlbmNlID0gZmFsc2UNCg0KCWlmICgodHlwZShlbGVtZW50KSkgPT0gImZ1bmN0aW9uIikgdGhlbg0KCQlsb2NhbCBkb191aV9uZXcgPSB7IHBjYWxsKGVsZW1lbnQsIHRhYiwgY29udGFpbmVyLCBuYW1lLCAuLi4pfQ0KDQoJCW1lbnVfYXNzZXJ0KGRvX3VpX25ld1sxXSwgNCwgIkNhbm5vdCBjcmVhdGUgbWVudSBpdGVtIGJlY2F1c2U6ICVzIiwgZG9fdWlfbmV3WzJdKQ0KDQoJCXJlZmVyZW5jZSA9IGRvX3VpX25ld1syXQ0KCWVsc2UNCgkJcmVmZXJlbmNlID0gZWxlbWVudA0KCQlpc19tZW51X3JlZmVyZW5jZSA9IHRydWUNCgllbmQNCg0KCXJldHVybiBzZXRtZXRhdGFibGUoDQoJCXsNCgkJCXRhYiA9IHRhYiwNCgkJCWNvbnRhaW5lciA9IGNvbnRhaW5lciwNCgkJCW5hbWUgPSBuYW1lLA0KCQkJcmVmZXJlbmNlID0gcmVmZXJlbmNlLA0KCQkJdmlzaWJsZSA9IHRydWUsDQoJCQloaWRkZW5fdmFsdWUgPSBuaWwsDQoJCQljaGlsZHJlbiA9IHt9LA0KCQkJdWlfY2FsbGJhY2sgPSBuaWwsDQoJCQljYWxsYmFja3MgPSB7fSwNCgkJCWlzX21lbnVfcmVmZXJlbmNlID0gaXNfbWVudV9yZWZlcmVuY2UsDQoJCQlnZXR0ZXIgPSB7DQoJCQkJY2FsbGJhY2sgPSBuaWwsDQoJCQkJZGF0YSA9IG5pbA0KCQkJfSwNCgkJCXNldHRlciA9IHsNCgkJCQljYWxsYmFjayA9IG5pbCwNCgkJCQlkYXRhID0gbmlsDQoJCQl9LA0KCQkJcGFyZW50X3ZhbHVlX29yX2NhbGxiYWNrID0gbmlsDQoJCX0sDQoJCW1lbnVfaXRlbV9tdA0KCSkNCmVuZA0KDQotLS0gQHBhcmFtIHZhbHVlIGFueQ0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gbWVudV9pdGVtX2M6c2V0X2hpZGRlbl92YWx1ZSh2YWx1ZSkNCglzZWxmLmhpZGRlbl92YWx1ZSA9IHZhbHVlDQplbmQNCg0KLS0tIEB2YXJhcmcgYW55DQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBtZW51X2l0ZW1fYzpzZXQoLi4uKQ0KCWxvY2FsIGFyZ3MgPSB7Li4ufQ0KDQoJaWYgKHNlbGYuc2V0dGVyLmNhbGxiYWNrIH49IG5pbCkgdGhlbg0KCQlhcmdzID0gc2VsZi5zZXR0ZXIuY2FsbGJhY2sodW5wYWNrKGFyZ3MpKQ0KCWVuZA0KDQoJbG9jYWwgZG9fdWlfc2V0ID0ge3BjYWxsKHVpLnNldCwgc2VsZi5yZWZlcmVuY2UsIHVucGFjayhhcmdzKSl9DQoNCgltZW51X2Fzc2VydChkb191aV9zZXRbMV0sIDMsICJDYW5ub3Qgc2V0IHZhbHVlcyBvZiBtZW51IGl0ZW0gYmVjYXVzZTogJXMiLCBkb191aV9zZXRbMl0pDQplbmQNCg0KLS0tIEByZXR1cm4gYW55DQpmdW5jdGlvbiBtZW51X2l0ZW1fYzpnZXQoKQ0KCWlmIChzZWxmLnZpc2libGUgPT0gZmFsc2UgYW5kIHNlbGYuaGlkZGVuX3ZhbHVlIH49IG5pbCkgdGhlbg0KCQlyZXR1cm4gc2VsZi5oaWRkZW5fdmFsdWUNCgllbmQNCg0KCWxvY2FsIGdldCA9IHt1aS5nZXQoc2VsZi5yZWZlcmVuY2UpfQ0KDQoJaWYgKHNlbGYuZ2V0dGVyLmNhbGxiYWNrIH49IG5pbCkgdGhlbg0KCQlyZXR1cm4gc2VsZi5nZXR0ZXIuY2FsbGJhY2soZ2V0KQ0KCWVuZA0KDQoJcmV0dXJuIHVucGFjayhnZXQpDQplbmQNCg0KLS0tIEBwYXJhbSBjYWxsYmFjayBmdW5jdGlvbg0KLS0tIEBwYXJhbSBkYXRhIGFueQ0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gbWVudV9pdGVtX2M6c2V0X3NldHRlcl9jYWxsYmFjayhjYWxsYmFjaywgZGF0YSkNCgltZW51X2Fzc2VydCh0eXBlKGNhbGxiYWNrKSA9PSAiZnVuY3Rpb24iLCAzLCAiQ2Fubm90IHNldCBtZW51IGl0ZW0gc2V0dGVyIGNhbGxiYWNrOiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24uIikNCg0KCXNlbGYuc2V0dGVyLmNhbGxiYWNrID0gY2FsbGJhY2sNCglzZWxmLnNldHRlci5kYXRhID0gZGF0YQ0KZW5kDQoNCi0tLSBAcGFyYW0gY2FsbGJhY2sgZnVuY3Rpb24NCi0tLSBAcGFyYW0gZGF0YSBhbnkNCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIG1lbnVfaXRlbV9jOnNldF9nZXR0ZXJfY2FsbGJhY2soY2FsbGJhY2ssIGRhdGEpDQoJbWVudV9hc3NlcnQodHlwZShjYWxsYmFjaykgPT0gImZ1bmN0aW9uIiwgMywgIkNhbm5vdCBzZXQgbWVudSBpdGVtIGdldHRlciBjYWxsYmFjazogYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uLiIpDQoNCglzZWxmLmdldHRlci5jYWxsYmFjayA9IGNhbGxiYWNrDQoJc2VsZi5nZXR0ZXIuZGF0YSA9IGRhdGENCmVuZA0KDQotLS0gQHBhcmFtIGNoaWxkcmVuIHRhYmxlPGFueSwgbWVudV9pdGVtX2M+DQotLS0gQHBhcmFtIHZhbHVlX29yX2NhbGxiYWNrIGZ1bmN0aW9ufGFueQ0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gbWVudV9pdGVtX2M6YWRkX2NoaWxkcmVuKGNoaWxkcmVuLCB2YWx1ZV9vcl9jYWxsYmFjaykNCglpZiAodmFsdWVfb3JfY2FsbGJhY2sgPT0gbmlsKSB0aGVuDQoJCXZhbHVlX29yX2NhbGxiYWNrID0gdHJ1ZQ0KCWVuZA0KDQoJaWYgKGdldG1ldGF0YWJsZShjaGlsZHJlbikgPT0gbWVudV9pdGVtX210KSB0aGVuDQoJCWNoaWxkcmVuID0ge2NoaWxkcmVufQ0KCWVuZA0KDQoJZm9yIF8sIGNoaWxkIGluIHBhaXJzKGNoaWxkcmVuKSBkbw0KCQltZW51X2Fzc2VydChnZXRtZXRhdGFibGUoY2hpbGQpID09IG1lbnVfaXRlbV9tdCwgMywgIkNhbm5vdCBhZGQgY2hpbGQgdG8gbWVudSBpdGVtOiBjaGlsZHJlbiBtdXN0IGJlIG1lbnUgaXRlbSBvYmplY3RzLiBNYWtlIHN1cmUgeW91IGFyZSBub3QgdHJ5aW5nIHRvIHBhcmVudCBhIFVJIHJlZmVyZW5jZS4iKQ0KCQltZW51X2Fzc2VydChjaGlsZC5yZWZlcmVuY2Ugfj0gc2VsZi5yZWZlcmVuY2UsIDMsICJDYW5ub3QgcGFyZW50IGEgbWVudSBpdGVtIHRvIGlzZWxmLiIpDQoNCgkJY2hpbGQucGFyZW50X3ZhbHVlX29yX2NhbGxiYWNrID0gdmFsdWVfb3JfY2FsbGJhY2sNCgkJc2VsZi5jaGlsZHJlbltjaGlsZC5yZWZlcmVuY2VdID0gY2hpbGQNCgllbmQNCg0KCW1lbnVfaXRlbV9jLl9wcm9jZXNzX2NhbGxiYWNrcyhzZWxmKQ0KZW5kDQoNCi0tLSBAcGFyYW0gY2FsbGJhY2sgZnVuY3Rpb24NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIG1lbnVfaXRlbV9jOmFkZF9jYWxsYmFjayhjYWxsYmFjaykNCgltZW51X2Fzc2VydChzZWxmLmlzX21lbnVfcmVmZXJlbmNlID09IGZhbHNlLCAzLCAiQ2Fubm90IGFkZCBjYWxsYmFja3MgdG8gYnVpbHQtaW4gbWVudSBpdGVtcy4iKQ0KCW1lbnVfYXNzZXJ0KHR5cGUoY2FsbGJhY2spID09ICJmdW5jdGlvbiIsIDMsICJDYWxsYmFja3MgZm9yIG1lbnUgaXRlbXMgbXVzdCBiZSBmdW5jdGlvbnMuIikNCg0KCXRhYmxlLmluc2VydChzZWxmLmNhbGxiYWNrcywgY2FsbGJhY2spDQoNCgltZW51X2l0ZW1fYy5fcHJvY2Vzc19jYWxsYmFja3Moc2VsZikNCmVuZA0KDQotLS0gQHBhcmFtIGl0ZW0gbWVudV9pdGVtX2MNCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIG1lbnVfaXRlbV9jLl9wcm9jZXNzX2NhbGxiYWNrcyhpdGVtKQ0KCWxvY2FsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQ0KCQlmb3IgXywgY2hpbGQgaW4gcGFpcnMoaXRlbS5jaGlsZHJlbikgZG8NCgkJCWxvY2FsIGlzX2NoaWxkX3Zpc2libGUNCg0KCQkJaWYgKHR5cGUoY2hpbGQucGFyZW50X3ZhbHVlX29yX2NhbGxiYWNrKSA9PSAiZnVuY3Rpb24iKSB0aGVuDQoJCQkJaXNfY2hpbGRfdmlzaWJsZSA9IGNoaWxkLnBhcmVudF92YWx1ZV9vcl9jYWxsYmFjaygpDQoJCQllbHNlDQoJCQkJaXNfY2hpbGRfdmlzaWJsZSA9IGl0ZW06Z2V0KCkgPT0gY2hpbGQucGFyZW50X3ZhbHVlX29yX2NhbGxiYWNrDQoJCQllbmQNCg0KCQkJbG9jYWwgaXNfdmlzaWJsZSA9IChpc19jaGlsZF92aXNpYmxlID09IHRydWUpIGFuZCAoaXRlbS52aXNpYmxlID09IHRydWUpDQoJCQljaGlsZC52aXNpYmxlID0gaXNfdmlzaWJsZQ0KDQoJCQl1aS5zZXRfdmlzaWJsZShjaGlsZC5yZWZlcmVuY2UsIGlzX3Zpc2libGUpDQoNCgkJCWlmIChjaGlsZC51aV9jYWxsYmFjayB+PSBuaWwpIHRoZW4NCgkJCQljaGlsZC51aV9jYWxsYmFjaygpDQoJCQllbmQNCgkJZW5kDQoNCgkJZm9yIGkgPSAxLCAjaXRlbS5jYWxsYmFja3MgZG8NCgkJCWl0ZW0uY2FsbGJhY2tzW2ldKCkNCgkJZW5kDQoJZW5kDQoNCgl1aS5zZXRfY2FsbGJhY2soaXRlbS5yZWZlcmVuY2UsIGNhbGxiYWNrKQ0KCWl0ZW0udWlfY2FsbGJhY2sgPSBjYWxsYmFjaw0KDQoJY2FsbGJhY2soKQ0KZW5kDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBtZW51X21hbmFnZXINCi0tLSBAY2xhc3MgbWVudV9tYW5hZ2VyX2MNCi0tLSBAZmllbGQgcHVibGljIHRhYiBzdHJpbmcNCi0tLSBAZmllbGQgcHVibGljIGNvbnRhaW5lciBzdHJpbmcNCi0tLSBAZmllbGQgcHVibGljIGNoaWxkcmVuIHRhYmxlPG51bWJlciwgbWVudV9pdGVtX2M+DQpsb2NhbCBtZW51X21hbmFnZXJfYyA9IHt9DQoNCmxvY2FsIG1lbnVfbWFuYWdlcl9tdCA9IHsNCglfX2luZGV4ID0gbWVudV9tYW5hZ2VyX2MNCn0NCg0KLS0tIENyZWF0ZSBhIG5ldyBtZW51X21hbmFnZXJfYy4NCi0tLSBAcGFyYW0gdGFiIHN0cmluZw0KLS0tIEBwYXJhbSBjb250YWluZXIgc3RyaW5nDQotLS0gQHJldHVybiBtZW51X21hbmFnZXJfYw0KZnVuY3Rpb24gbWVudV9tYW5hZ2VyX2MubmV3KHRhYiwgY29udGFpbmVyKQ0KCW1lbnVfbWFuYWdlcl9jLl92YWxpZGF0ZV90YWJfY29udGFpbmVyKHRhYiwgY29udGFpbmVyKQ0KDQoJcmV0dXJuIHNldG1ldGF0YWJsZSgNCgkJew0KCQkJdGFiID0gdGFiLA0KCQkJY29udGFpbmVyID0gY29udGFpbmVyLA0KCQkJY2hpbGRyZW4gPSB7fQ0KCQl9LA0KCQltZW51X21hbmFnZXJfbXQNCgkpDQplbmQNCg0KLS0tIFNhdmVzIHRoZSB2YWx1ZXMgZm9yIG1lbnUgaXRlbXMgY3VycmVudGx5IGNyZWF0ZWQgdG8gdGhlIGRhdGFiYXNlLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gbWVudV9tYW5hZ2VyX2M6c2F2ZV90b19kYigpDQoJbG9jYWwgcHJlZml4ID0gc3RyaW5nLmZvcm1hdCgiJXNfJXMiLCBzZWxmLnRhYiwgc2VsZi5jb250YWluZXIpDQoNCglmb3IgXywgaXRlbSBpbiBwYWlycyhzZWxmLmNoaWxkcmVuKSBkbw0KCQlsb2NhbCBrZXkgPSBzdHJpbmcuZm9ybWF0KCIlc18lcyIsIHByZWZpeCwgaXRlbS5uYW1lKQ0KCQlsb2NhbCBkYXRhID0ge2l0ZW0oKX0NCg0KCQlkYXRhYmFzZS53cml0ZShrZXksIGRhdGEpDQoJZW5kDQplbmQNCg0KLS0tIExvYWRzIHRoZSB2YWx1ZXMgZm9yIG1lbnUgaXRlbXMgY3VycmVudGx5IGNyZWF0ZWQgZnJvbSB0byB0aGUgZGF0YWJhc2UuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBtZW51X21hbmFnZXJfYzpsb2FkX2Zyb21fZGIoKQ0KCWxvY2FsIHByZWZpeCA9IHN0cmluZy5mb3JtYXQoIiVzXyVzIiwgc2VsZi50YWIsIHNlbGYuY29udGFpbmVyKQ0KDQoJZm9yIF8sIGl0ZW0gaW4gcGFpcnMoc2VsZi5jaGlsZHJlbikgZG8NCgkJbG9jYWwga2V5ID0gc3RyaW5nLmZvcm1hdCgiJXNfJXMiLCBwcmVmaXgsIGl0ZW0ubmFtZSkNCgkJbG9jYWwgZGF0YSA9IGRhdGFiYXNlLnJlYWQoa2V5KQ0KDQoJCWlmIChkYXRhIH49IG5pbCkgdGhlbg0KCQkJaXRlbSh1bnBhY2soZGF0YSkpDQoJCWVuZA0KCWVuZA0KZW5kDQoNCi0tLSBAcGFyYW0gaXRlbSBtZW51X2l0ZW1fYw0KLS0tIEBwYXJhbSB2YWx1ZV9vcl9jYWxsYmFjayBmdW5jdGlvbnxhbnkNCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIG1lbnVfbWFuYWdlcl9jOnBhcmVudF9hbGxfdG8oaXRlbSwgdmFsdWVfb3JfY2FsbGJhY2spDQoJbG9jYWwgY2hpbGRyZW4gPSBzZWxmLmNoaWxkcmVuDQoNCgljaGlsZHJlbltpdGVtLnJlZmVyZW5jZV0gPSBuaWwNCg0KCWl0ZW06YWRkX2NoaWxkcmVuKGNoaWxkcmVuLCB2YWx1ZV9vcl9jYWxsYmFjaykNCmVuZA0KDQotLS0gQHBhcmFtIHRhYiBzdHJpbmcNCi0tLSBAcGFyYW0gY29udGFpbmVyIHN0cmluZw0KLS0tIEBwYXJhbSBuYW1lIHN0cmluZw0KLS0tIEByZXR1cm4gbWVudV9pdGVtX2MNCmZ1bmN0aW9uIG1lbnVfbWFuYWdlcl9jLnJlZmVyZW5jZSh0YWIsIGNvbnRhaW5lciwgbmFtZSkNCgltZW51X21hbmFnZXJfYy5fdmFsaWRhdGVfdGFiX2NvbnRhaW5lcih0YWIsIGNvbnRhaW5lcikNCg0KCWxvY2FsIGRvX3JlZmVyZW5jZSA9IHtwY2FsbCh1aS5yZWZlcmVuY2UsIHRhYiwgY29udGFpbmVyLCBuYW1lKX0NCg0KCW1lbnVfYXNzZXJ0KGRvX3JlZmVyZW5jZVsxXSwgMywgIkNhbm5vdCByZWZlcmVuY2UgR2FtZXNlbnNlIG1lbnUgaXRlbSBiZWNhdXNlOiAlcyIsIGRvX3JlZmVyZW5jZVsyXSkNCg0KCWxvY2FsIHJlZmVyZW5jZXMgPSB7c2VsZWN0KDIsIHVucGFjayhkb19yZWZlcmVuY2UpKX0NCglsb2NhbCBpdGVtcyA9IHt9DQoNCglmb3IgaSA9IDEsICNyZWZlcmVuY2VzIGRvDQoJCXRhYmxlLmluc2VydCgNCgkJCWl0ZW1zLA0KCQkJbWVudV9pdGVtX2MubmV3KA0KCQkJCXJlZmVyZW5jZXNbaV0sDQoJCQkJdGFiLA0KCQkJCWNvbnRhaW5lciwNCgkJCQluYW1lDQoJCQkpDQoJCSkNCgllbmQNCg0KCXJldHVybiB1bnBhY2soaXRlbXMpDQplbmQNCg0KLS0tIEBwYXJhbSBuYW1lIHN0cmluZw0KLS0tIEByZXR1cm4gbWVudV9pdGVtX2MNCmZ1bmN0aW9uIG1lbnVfbWFuYWdlcl9jOmNoZWNrYm94KG5hbWUpDQoJcmV0dXJuIHNlbGY6X2NyZWF0ZV9pdGVtKHVpLm5ld19jaGVja2JveCwgbmFtZSkNCmVuZA0KDQotLS0gQHBhcmFtIG5hbWUgc3RyaW5nDQotLS0gQHBhcmFtIG1pbiBudW1iZXINCi0tLSBAcGFyYW0gbWF4IG51bWJlcg0KLS0tIEBwYXJhbSBkZWZhdWx0X29yX29wdGlvbnMgbnVtYmVyfHRhYmxlPGFueSwgYW55Pg0KLS0tIEByZXR1cm4gbWVudV9pdGVtX2MNCmZ1bmN0aW9uIG1lbnVfbWFuYWdlcl9jOnNsaWRlcihuYW1lLCBtaW4sIG1heCwgZGVmYXVsdF9vcl9vcHRpb25zLCBzaG93X3Rvb2x0aXAsIHVuaXQsIHNjYWxlLCB0b29sdGlwcykNCglpZiAodHlwZShkZWZhdWx0X29yX29wdGlvbnMpID09ICJ0YWJsZSIpIHRoZW4NCgkJbG9jYWwgb3B0aW9ucyA9IGRlZmF1bHRfb3Jfb3B0aW9ucw0KDQoJCWRlZmF1bHRfb3Jfb3B0aW9ucyA9IG9wdGlvbnMuZGVmYXVsdA0KCQlzaG93X3Rvb2x0aXAgPSBvcHRpb25zLnNob3dfdG9vbHRpcA0KCQl1bml0ID0gb3B0aW9ucy51bml0DQoJCXNjYWxlID0gb3B0aW9ucy5zY2FsZQ0KCQl0b29sdGlwcyA9IG9wdGlvbnMudG9vbHRpcHMNCgllbmQNCg0KCWRlZmF1bHRfb3Jfb3B0aW9ucyA9IGRlZmF1bHRfb3Jfb3B0aW9ucyBvciBuaWwNCglzaG93X3Rvb2x0aXAgPSBzaG93X3Rvb2x0aXAgb3IgdHJ1ZQ0KCXVuaXQgPSB1bml0IG9yIG5pbA0KCXNjYWxlID0gc2NhbGUgb3IgMQ0KCXRvb2x0aXBzID0gdG9vbHRpcHMgb3IgbmlsDQoNCgltZW51X2Fzc2VydCh0eXBlKG1pbikgPT0gIm51bWJlciIsIDMsICJTbGlkZXIgbWluIHZhbHVlIG11c3QgYmUgYSBudW1iZXIuIikNCgltZW51X2Fzc2VydCh0eXBlKG1heCkgPT0gIm51bWJlciIsIDMsICJTbGlkZXIgbWF4IHZhbHVlIG11c3QgYmUgYSBudW1iZXIuIikNCgltZW51X2Fzc2VydChtaW4gPCBtYXgsIDMsICJTbGlkZXIgbWluIHZhbHVlIG11c3QgYmUgYmVsb3cgdGhlIG1heCB2YWx1ZS4iKQ0KDQoJaWYgKGRlZmF1bHRfb3Jfb3B0aW9ucyB+PSBuaWwpIHRoZW4NCgkJbWVudV9hc3NlcnQoZGVmYXVsdF9vcl9vcHRpb25zID49IG1pbiBhbmQgZGVmYXVsdF9vcl9vcHRpb25zIDw9IG1heCwgMywgIlNsaWRlciBkZWZhdWx0IG11c3QgYmUgYmV0d2VlbiBtaW4gYW5kIG1heCB2YWx1ZXMuIikNCgllbmQNCg0KCXJldHVybiBzZWxmOl9jcmVhdGVfaXRlbSh1aS5uZXdfc2xpZGVyLCBuYW1lLCBtaW4sIG1heCwgZGVmYXVsdF9vcl9vcHRpb25zLCBzaG93X3Rvb2x0aXAsIHVuaXQsIHNjYWxlLCB0b29sdGlwcykNCmVuZA0KDQotLS0gQHBhcmFtIG5hbWUgc3RyaW5nDQotLS0gQHZhcmFyZyBzdHJpbmcNCi0tLSBAcmV0dXJuIG1lbnVfaXRlbV9jDQpmdW5jdGlvbiBtZW51X21hbmFnZXJfYzpjb21ib2JveChuYW1lLCAuLi4pDQoJbG9jYWwgYXJncyA9IHsuLi59DQoNCglpZiAodHlwZShhcmdzWzFdKSA9PSAidGFibGUiKSB0aGVuDQoJCWFyZ3MgPSBhcmdzWzFdDQoJZW5kDQoNCglyZXR1cm4gc2VsZjpfY3JlYXRlX2l0ZW0odWkubmV3X2NvbWJvYm94LCBuYW1lLCBhcmdzKQ0KZW5kDQoNCi0tLSBAcGFyYW0gbmFtZSBzdHJpbmcNCi0tLSBAdmFyYXJnIHN0cmluZw0KLS0tIEByZXR1cm4gbWVudV9pdGVtX2MNCmZ1bmN0aW9uIG1lbnVfbWFuYWdlcl9jOm11bHRpc2VsZWN0KG5hbWUsIC4uLikNCglsb2NhbCBhcmdzID0gey4uLn0NCg0KCWlmICh0eXBlKGFyZ3NbMV0pID09ICJ0YWJsZSIpIHRoZW4NCgkJYXJncyA9IGFyZ3NbMV0NCgllbmQNCg0KCXJldHVybiBzZWxmOl9jcmVhdGVfaXRlbSh1aS5uZXdfbXVsdGlzZWxlY3QsIG5hbWUsIGFyZ3MpDQplbmQNCg0KLS0tIEBwYXJhbSBuYW1lIHN0cmluZw0KLS0tIEBwYXJhbSBpbmxpbmUgYm9vbGVhbg0KLS0tIEByZXR1cm4gbWVudV9pdGVtX2MNCmZ1bmN0aW9uIG1lbnVfbWFuYWdlcl9jOmhvdGtleShuYW1lLCBpbmxpbmUpDQoJaWYgKGlubGluZSA9PSBuaWwpIHRoZW4NCgkJaW5saW5lID0gZmFsc2UNCgllbmQNCg0KCW1lbnVfYXNzZXJ0KHR5cGUoaW5saW5lKSA9PSAiYm9vbGVhbiIsIDMsICJIb3RrZXkgaW5saW5lIGFyZ3VtZW50IG11c3QgYmUgYSBib29sZWFuLiIpDQoNCglyZXR1cm4gc2VsZjpfY3JlYXRlX2l0ZW0odWkubmV3X2hvdGtleSwgbmFtZSwgaW5saW5lKQ0KZW5kDQoNCi0tLSBAcGFyYW0gbmFtZSBzdHJpbmcNCi0tLSBAcGFyYW0gY2FsbGJhY2sgZnVuY3Rpb24NCi0tLSBAcmV0dXJuIG1lbnVfaXRlbV9jDQpmdW5jdGlvbiBtZW51X21hbmFnZXJfYzpidXR0b24obmFtZSwgY2FsbGJhY2spDQoJbWVudV9hc3NlcnQodHlwZShjYWxsYmFjaykgPT0gImZ1bmN0aW9uIiwgMywgIkNhbm5vdCBzZXQgYnV0dG9uIGNhbGxiYWNrIGJlY2F1c2UgdGhlIGNhbGxiYWNrIGFyZ3VtZW50IG11c3QgYmUgYSBmdW5jdGlvbi4iKQ0KDQoJcmV0dXJuIHNlbGY6X2NyZWF0ZV9pdGVtKHVpLm5ld19idXR0b24sIG5hbWUsIGNhbGxiYWNrKQ0KZW5kDQoNCi0tLSBAcGFyYW0gbmFtZSBzdHJpbmcNCi0tLSBAcGFyYW0gciBudW1iZXINCi0tLSBAcGFyYW0gZyBudW1iZXINCi0tLSBAcGFyYW0gYiBudW1iZXINCi0tLSBAcGFyYW0gYSBudW1iZXINCi0tLSBAcmV0dXJuIG1lbnVfaXRlbV9jDQpmdW5jdGlvbiBtZW51X21hbmFnZXJfYzpjb2xvcl9waWNrZXIobmFtZSwgciwgZywgYiwgYSkNCglyID0gciBvciAyNTUNCglnID0gZyBvciAyNTUNCgliID0gYiBvciAyNTUNCglhID0gYSBvciAyNTUNCg0KCW1lbnVfYXNzZXJ0KHR5cGUocikgPT0gIm51bWJlciIgYW5kIHIgPj0gMCBhbmQgciA8PSAyNTUsIDMsICJDYW5ub3Qgc2V0IGNvbG9yIHBpY2tlciByZWQgY2hhbm5lbCB2YWx1ZS4gSXQgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDI1NS4iKQ0KCW1lbnVfYXNzZXJ0KHR5cGUoZykgPT0gIm51bWJlciIgYW5kIGcgPj0gMCBhbmQgZyA8PSAyNTUsIDMsICJDYW5ub3Qgc2V0IGNvbG9yIHBpY2tlciBncmVlbiBjaGFubmVsIHZhbHVlLiBJdCBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMjU1LiIpDQoJbWVudV9hc3NlcnQodHlwZShiKSA9PSAibnVtYmVyIiBhbmQgYiA+PSAwIGFuZCBiIDw9IDI1NSwgMywgIkNhbm5vdCBzZXQgY29sb3IgcGlja2VyIGJsdWUgY2hhbm5lbCB2YWx1ZS4gSXQgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDI1NS4iKQ0KCW1lbnVfYXNzZXJ0KHR5cGUoYSkgPT0gIm51bWJlciIgYW5kIGEgPj0gMCBhbmQgYSA8PSAyNTUsIDMsICJDYW5ub3Qgc2V0IGNvbG9yIHBpY2tlciBhbHBoYSBjaGFubmVsIHZhbHVlLiBJdCBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMjU1LiIpDQoNCglyZXR1cm4gc2VsZjpfY3JlYXRlX2l0ZW0odWkubmV3X2NvbG9yX3BpY2tlciwgbmFtZSwgciwgZywgYiwgYSkNCmVuZA0KDQotLS0gQHBhcmFtIG5hbWUgc3RyaW5nDQotLS0gQHJldHVybiBtZW51X2l0ZW1fYw0KZnVuY3Rpb24gbWVudV9tYW5hZ2VyX2M6dGV4dGJveChuYW1lKQ0KCXJldHVybiBzZWxmOl9jcmVhdGVfaXRlbSh1aS5uZXdfdGV4dGJveCwgbmFtZSkNCmVuZA0KDQotLS0gQHBhcmFtIG5hbWUgc3RyaW5nDQotLS0gQHZhcmFyZyBzdHJpbmcNCi0tLSBAcmV0dXJuIG1lbnVfaXRlbV9jDQpmdW5jdGlvbiBtZW51X21hbmFnZXJfYzpsaXN0Ym94KG5hbWUsIC4uLikNCglsb2NhbCBhcmdzID0gey4uLn0NCg0KCWlmICh0eXBlKGFyZ3NbMV0pID09ICJ0YWJsZSIpIHRoZW4NCgkJYXJncyA9IGFyZ3NbMV0NCgllbmQNCg0KCWxvY2FsIGl0ZW0gPSBzZWxmOl9jcmVhdGVfaXRlbSh1aS5uZXdfbGlzdGJveCwgbmFtZSwgYXJncykNCg0KCWl0ZW06c2V0X2dldHRlcl9jYWxsYmFjaygNCgkJZnVuY3Rpb24oZ2V0KQ0KCQkJcmV0dXJuIGl0ZW0uZ2V0dGVyLmRhdGFbZ2V0ICsgMV0NCgkJZW5kLA0KCQlhcmdzDQoJKQ0KDQoJcmV0dXJuIGl0ZW0NCmVuZA0KDQotLS0gQHBhcmFtIG5hbWUgc3RyaW5nDQotLS0gQHJldHVybiBtZW51X2l0ZW1fYw0KZnVuY3Rpb24gbWVudV9tYW5hZ2VyX2M6bGFiZWwobmFtZSkNCgltZW51X2Fzc2VydCh0eXBlKG5hbWUpID09ICJzdHJpbmciLCAiTGFiZWwgbmFtZSBtdXN0IGJlIGEgc3RyaW5nLiIpDQoNCglyZXR1cm4gc2VsZjpfY3JlYXRlX2l0ZW0odWkubmV3X2xhYmVsLCBuYW1lKQ0KZW5kDQoNCi0tLSBAcGFyYW0gZWxlbWVudCBmdW5jdGlvbg0KLS0tIEBwYXJhbSBuYW1lIHN0cmluZw0KLS0tIEB2YXJhcmcgYW55DQotLS0gQHJldHVybiBtZW51X2l0ZW1fYw0KZnVuY3Rpb24gbWVudV9tYW5hZ2VyX2M6X2NyZWF0ZV9pdGVtKGVsZW1lbnQsIG5hbWUsIC4uLikNCgltZW51X2Fzc2VydCh0eXBlKG5hbWUpID09ICJzdHJpbmciIGFuZCBuYW1lIH49ICIiLCAzLCAiQ2Fubm90IGNyZWF0ZSBtZW51IGl0ZW06IG5hbWUgbXVzdCBiZSBhIG5vbi1lbXB0eSBzdHJpbmcuIikNCg0KCWxvY2FsIGl0ZW0gPSBtZW51X2l0ZW1fYy5uZXcoZWxlbWVudCwgc2VsZi50YWIsIHNlbGYuY29udGFpbmVyLCBuYW1lLCAuLi4pDQoJc2VsZi5jaGlsZHJlbltpdGVtLnJlZmVyZW5jZV0gPSBpdGVtDQoNCglyZXR1cm4gaXRlbQ0KZW5kDQoNCi0tLSBAcGFyYW0gdGFiIHN0cmluZw0KLS0tIEBwYXJhbSBjb250YWluZXIgc3RyaW5nDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBtZW51X21hbmFnZXJfYy5fdmFsaWRhdGVfdGFiX2NvbnRhaW5lcih0YWIsIGNvbnRhaW5lcikNCgltZW51X2Fzc2VydCh0eXBlKHRhYikgPT0gInN0cmluZyIgYW5kIHRhYiB+PSAiIiwgNCwgIkNhbm5vdCBjcmVhdGUgbWVudSBtYW5hZ2VyOiB0YWIgbmFtZSBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZy4iKQ0KCW1lbnVfYXNzZXJ0KHR5cGUoY29udGFpbmVyKSA9PSAic3RyaW5nIiBhbmQgY29udGFpbmVyIH49ICIiLCA0LCAiQ2Fubm90IGNyZWF0ZSBtZW51IG1hbmFnZXI6IHRhYiBuYW1lIG11c3QgYmUgYSBub24tZW1wdHkgc3RyaW5nLiIpDQoNCgl0YWIgPSB0YWI6bG93ZXIoKQ0KDQoJbWVudV9hc3NlcnQobWVudV9tYXBbdGFiXSB+PSBuaWwsIDQsICJDYW5ub3QgY3JlYXRlIG1lbnUgbWFuYWdlcjogdGFiIG5hbWUgZG9lcyBub3QgZXhpc3QuIikNCgltZW51X2Fzc2VydChtZW51X21hcFt0YWJdW2NvbnRhaW5lcjpsb3dlcigpXSB+PSBuaWwsIDQsICJDYW5ub3QgY3JlYXRlIG1lbnUgbWFuYWdlcjogY29udGFpbmVyIG5hbWUgZG9lcyBub3QgZXhpc3QuIikNCmVuZA0KLS1lbmRyZWdpb24NCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIGRlcGVuZGVuY3k6IGhhdm9jX2NvbnNvbGVfMV8wXzANCi0tcmVnaW9uIGNvbW1hbmQNCmxvY2FsIGNvbW1hbmRfYyA9IHt9DQpsb2NhbCBjb21tYW5kX210ID0ge19faW5kZXggPSBjb21tYW5kX2N9DQoNCi0tLSBJbnN0YW50aWF0ZSBhIGNvbW1hbmQgb2JqZWN0Lg0KZnVuY3Rpb24gY29tbWFuZF9jLm5ldyhuYW1lLCBkZXNjcmlwdGlvbiwgb3B0aW9ucywgb25faW5wdXQpDQoJbG9jYWwgc2F2ZV92YWx1ZQ0KCWxvY2FsIHBlcnNpc3RfdmFsdWUNCg0KCWlmIChvcHRpb25zLmRhdGF0eXBlIH49IG5pbCkgdGhlbg0KCQlpZiAodHlwZShvcHRpb25zLnNhdmVfdmFsdWUpID09ICJib29sZWFuIikgdGhlbg0KCQkJc2F2ZV92YWx1ZSA9IG9wdGlvbnMuc2F2ZV92YWx1ZQ0KCQllbHNlDQoJCQlzYXZlX3ZhbHVlID0gdHJ1ZQ0KCQllbmQNCg0KCQlpZiAoc2F2ZV92YWx1ZSA9PSB0cnVlIGFuZCB0eXBlKG9wdGlvbnMucGVyc2lzdF92YWx1ZSkgPT0gImJvb2xlYW4iKSB0aGVuDQoJCQlwZXJzaXN0X3ZhbHVlID0gb3B0aW9ucy5wZXJzaXN0X3ZhbHVlDQoJCWVsc2UNCgkJCXBlcnNpc3RfdmFsdWUgPSB0cnVlDQoJCWVuZA0KCWVuZA0KDQoJbG9jYWwgcHJvcGVydGllcyA9IHsNCgkJbmFtZSA9IG5hbWUsIC0tIENvbW1hbmQgbmFtZS4NCgkJZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbiwgLS0gQ29tbWFuZCBkZXNjcmlwdGlvbi4NCgkJb25faW5wdXQgPSBvbl9pbnB1dCwgLS0gQ29tbWFuZCBjYWxsYmFjay4NCgkJb25fcmVzZXQgPSBvcHRpb25zLm9uX3Jlc2V0IG9yIG5pbCwgLS0gQ29tbWFuZCBjYWxsYmFjayB3aGVuIGlucHV0IHZhbHVlIGlzIHJlc2V0Lg0KCQlkYXRhdHlwZSA9IG9wdGlvbnMuZGF0YXR5cGUgb3IgbmlsLCAtLSBDb21tYW5kIGRhdGF0eXBlLg0KCQlzYXZlX3ZhbHVlID0gc2F2ZV92YWx1ZSwgLS0gU2F2ZSB0aGUgaW5wdXQgdmFsdWUuDQoJCXBlcnNpc3RfdmFsdWUgPSBwZXJzaXN0X3ZhbHVlLCAtLSBQZXJzaXN0IHZhbHVlcyB0byBkYXRhYmFzZS4NCgkJdmFsdWUgPSBvcHRpb25zLmRlZmF1bHQgb3IgbmlsLCAtLSBDb21tYW5kIHZhbHVlLg0KCQlkZWZhdWx0ID0gb3B0aW9ucy5kZWZhdWx0IG9yIG5pbCwgLS0gQ29tbWFuZCBkZWZhdWx0IHZhbHVlLg0KCQlpbnB1dF92YWx1ZSA9IG5pbCwgLS0gTGFzdCB2YWx1ZSB0aGF0IHdhcyBhdHRlbXB0ZWQgdG8gYmUgc2V0Lg0KCQlzcGVjaWFsID0gb3B0aW9ucy5zcGVjaWFsIG9yIGZhbHNlIC0tIFdpbGwgc3VibWl0IGNvbnNvbGUgb2JqZWN0IGluc3RlYWQgb2YgaW5wdXQgdmFsdWVzIHRvIGNvbW1hbmQuDQoJfQ0KDQoJbG9jYWwgY29tbWFuZCA9IHNldG1ldGF0YWJsZShwcm9wZXJ0aWVzLCBjb21tYW5kX210KQ0KDQoJLS0gRmlyZSB0aGUgb25fbG9hZCBldmVudC4NCglpZiAob3B0aW9ucy5vbl9sb2FkIH49IG5pbCkgdGhlbg0KCQlvcHRpb25zLm9uX2xvYWQoY29tbWFuZCkNCgllbmQNCg0KCXJldHVybiBjb21tYW5kDQplbmQNCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIHN0YXRlDQpsb2NhbCBzdGF0ZV9jID0ge30NCmxvY2FsIHN0YXRlX210ID0ge19faW5kZXggPSBzdGF0ZV9jfQ0KDQotLS0gSW5zdGFudGlhdGUgYSBzdGF0ZSBvYmplY3QuDQpmdW5jdGlvbiBzdGF0ZV9jLm5ldygpDQoJbG9jYWwgcHJvcGVydGllcyA9IHsNCgkJcHJvYmxlbSA9IGZhbHNlLCAtLSBDb25zb2xlIGNyYXNoZWQgcHJvY2Vzc2luZyBhIGNvbW1hbmQuDQoJCXJlYXNvbiA9IG5pbCAtLSBSZWFzb24gZm9yIGNyYXNoIHRvIHByaW50IHRvIGNvbnNvbGUuDQoJfQ0KDQoJbG9jYWwgc3RhdGUgPSBzZXRtZXRhdGFibGUocHJvcGVydGllcywgc3RhdGVfbXQpDQoNCglyZXR1cm4gc3RhdGUNCmVuZA0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gY29uc29sZQ0KbG9jYWwgY29uc29sZV9jID0ge30NCmxvY2FsIGNvbnNvbGVfbXQgPSB7X19pbmRleCA9IGNvbnNvbGVfY30NCg0KLS0tIEluc3RhbnRpYXRlIGEgY29uc29sZSBvYmplY3QuDQpmdW5jdGlvbiBjb25zb2xlX2MubmV3KHByZWZpeCwgb3B0aW9ucykNCglsb2NhbCBwcm9wZXJ0aWVzID0gew0KCQlwcmVmaXggPSBwcmVmaXggYW5kIHByZWZpeCAuLiAiXyIgb3IgbmlsLCAtLSBDb21tYW5kIG5hbWUgcHJlZml4Lg0KCQlsb2dfcHJlZml4ID0gb3B0aW9ucy5sb2dfcHJlZml4IG9yIHN0cmluZy5mb3JtYXQoIlslc10iLCBwcmVmaXgpLCAtLSBMb2dnZXIgcHJlZml4Lg0KCQlsb2dfcHJlZml4X2NvbG9yID0gb3B0aW9ucy5sb2dfcHJlZml4X2NvbG9yIG9yIHsyMDAsIDIwMCwgMjAwfSwgLS0gTG9nIHByZWZpeCBjb2xvci4NCgkJZGVidWcgPSBmYWxzZSwgLS0gRW5hYmxlIG9yIGRpc2FibGUgZGVidWcgdHlwZSBsb2dzLg0KCQljb21tYW5kcyA9IHsNCgkJCVtwcmVmaXggLi4gIl9oZWxwIl0gPSBjb21tYW5kX2MubmV3KA0KCQkJCXByZWZpeCAuLiAiX2hlbHAiLA0KCQkJCSJEaXNwbGF5IGhlbHAgaW5mb3JtYXRpb24gZm9yIHRoaXMgY29uc29sZSBjb21tYW5kIGdyb3VwLiIsDQoJCQkJew0KCQkJCQlzcGVjaWFsID0gdHJ1ZQ0KCQkJCX0sDQoJCQkJZnVuY3Rpb24oY29uc29sZSkNCgkJCQkJY29uc29sZTpsb2coe30sICJDb21tYW5kIEhlbHAiKQ0KCQkJCQljb25zb2xlOmxvZyh7cHJlZml4ID0gZmFsc2V9LCAiVGhlIGZvbGxvd2luZyBsaXN0IGlzIGFsbCBvZiB0aGUgYXZhaWxhYmxlIGNvbW1hbmRzIGZvciB0aGlzIGNvbW1hbmQgZ3JvdXAuIikNCgkJCQkJY29uc29sZTpsb2coe3ByZWZpeCA9IGZhbHNlfSwgIiAiKQ0KDQoJCQkJCWZvciBfLCBjb21tYW5kIGluIHBhaXJzKGNvbnNvbGUuY29tbWFuZHMpIGRvDQoJCQkJCQlsb2NhbCB0aXRsZSA9IGNvbW1hbmQuZGF0YXR5cGUgfj0gbmlsIGFuZCBzdHJpbmcuZm9ybWF0KCIjICVzICggJXMgYXJnICkiLCBjb21tYW5kLm5hbWUsIGNvbW1hbmQuZGF0YXR5cGUpIG9yICIjICIgLi4gY29tbWFuZC5uYW1lDQoNCgkJCQkJCWNvbnNvbGU6bG9nKHtwcmVmaXggPSBmYWxzZX0sICItLS0tLS0tLS0tLS0tLS0tLS0tLSIpDQoJCQkJCQljb25zb2xlOmxvZyh7cHJlZml4ID0gZmFsc2V9LCB0aXRsZSkNCgkJCQkJCWNvbnNvbGU6bG9nKHtwcmVmaXggPSBmYWxzZX0sIGNvbW1hbmQuZGVzY3JpcHRpb24pDQoNCgkJCQkJCWlmIChjb21tYW5kLnNhdmVfdmFsdWUgPT0gdHJ1ZSBhbmQgKGNvbW1hbmQuc3BlY2lhbCA9PSBmYWxzZSBvciBjb21tYW5kLmRhdGF0eXBlIH49IG5pbCkpIHRoZW4NCgkJCQkJCQljb25zb2xlOmxvZyh7cHJlZml4ID0gZmFsc2V9LCBzdHJpbmcuZm9ybWF0KCItIGN1cnJlbnQgdmFsdWUgPSAlcyIsIGNvbW1hbmQudmFsdWUpKQ0KCQkJCQkJZW5kDQoNCgkJCQkJCWlmIChjb21tYW5kLmRlZmF1bHQgfj0gbmlsKSB0aGVuDQoJCQkJCQkJY29uc29sZTpsb2coe3ByZWZpeCA9IGZhbHNlfSwgc3RyaW5nLmZvcm1hdCgiLSBkZWZhdWx0IHZhbHVlID0gJXMiLCBjb21tYW5kLmRlZmF1bHQpKQ0KCQkJCQkJZW5kDQoNCgkJCQkJCWlmIChjb21tYW5kLmRhdGF0eXBlIH49IG5pbCkgdGhlbg0KCQkJCQkJCWlmIChjb21tYW5kLnNhdmVfdmFsdWUgPT0gdHJ1ZSBhbmQgY29tbWFuZC5wZXJzaXN0X3ZhbHVlID09IHRydWUpIHRoZW4NCgkJCQkJCQkJY29uc29sZTpsb2coe3ByZWZpeCA9IGZhbHNlfSwgIi0gcGVyc2lzdGVkID0gdHJ1ZSIpDQoJCQkJCQkJZWxzZQ0KCQkJCQkJCQljb25zb2xlOmxvZyh7cHJlZml4ID0gZmFsc2V9LCAiLSBwZXJzaXN0ZWQgPSBmYWxzZSIpDQoJCQkJCQkJZW5kDQoJCQkJCQllbmQNCg0KCQkJCQkJY29uc29sZTpsb2coe3ByZWZpeCA9IGZhbHNlfSwgIiAiKQ0KCQkJCQllbmQNCgkJCQllbmQNCgkJCSksDQoJCQlbcHJlZml4IC4uICJfcmVzZXQiXSA9IGNvbW1hbmRfYy5uZXcoDQoJCQkJcHJlZml4IC4uICJfcmVzZXQiLA0KCQkJCSJSZXNldCBhIGNvbW1hbmQgdG8gaXRzIGRlZmF1bHQgdmFsdWUuIiwNCgkJCQl7DQoJCQkJCXNwZWNpYWwgPSB0cnVlLA0KCQkJCQlzYXZlX3ZhbHVlID0gZmFsc2UsDQoJCQkJCWRhdGF0eXBlID0gInN0cmluZyINCgkJCQl9LA0KCQkJCWZ1bmN0aW9uKGNvbnNvbGUsIHZhbHVlKQ0KCQkJCQlpZiAodmFsdWUgPT0gbmlsKSB0aGVuDQoJCQkJCQljb25zb2xlOmxvZyh7Y29kZSA9IDF9LCAiVGhpcyBjb21tYW5kIHJlcXVpcmVzIGFuIGFyZ3VtZW50LiIpDQoNCgkJCQkJCXJldHVybg0KCQkJCQllbmQNCg0KCQkJCQlsb2NhbCBjb21tYW5kID0gY29uc29sZS5jb21tYW5kc1t2YWx1ZV0NCg0KCQkJCQlpZiAoY29tbWFuZCA9PSBuaWwpIHRoZW4NCgkJCQkJCWNvbnNvbGU6bG9nKHtjb2RlID0gMX0sICJDb21tYW5kIHdhcyBub3QgZm91bmQuIikNCg0KCQkJCQkJcmV0dXJuDQoJCQkJCWVuZA0KDQoJCQkJCWlmIChjb21tYW5kLmRlZmF1bHQgPT0gbmlsKSB0aGVuDQoJCQkJCQljb25zb2xlOmxvZyh7Y29kZSA9IDF9LCAiQ29tbWFuZCBkb2VzIG5vdCBoYXZlIGEgZGVmYXVsdCB2YWx1ZSB0byByZXNldCB0by4iKQ0KDQoJCQkJCQlyZXR1cm4NCgkJCQkJZW5kDQoNCgkJCQkJY29tbWFuZC52YWx1ZSA9IGNvbW1hbmQuZGVmYXVsdA0KDQoJCQkJCWNvbW1hbmQub25fcmVzZXQoY29tbWFuZCkNCg0KCQkJCQljb25zb2xlOmxvZyh7Y29kZSA9IDB9LCAiQ29tbWFuZCB3YXMgcmVzZXQgdG8gaXRzIGRlZmF1bHQgdmFsdWUgb2YgJyVzJy4iLCBjb21tYW5kLmRlZmF1bHQpDQoJCQkJZW5kDQoJCQkpDQoJCX0sDQoJCXN0YXRlID0gc3RhdGVfYy5uZXcoKSwNCgkJY2FzdCA9IHsNCgkJCS0tIENhc3QgdG8gc3RyaW5nLg0KCQkJc3RyaW5nID0gZnVuY3Rpb24odmFsdWUsIF8pDQoJCQkJcmV0dXJuIHZhbHVlDQoJCQllbmQsDQoJCQktLSBDYXN0IHRvIGludC4NCgkJCWludCA9IGZ1bmN0aW9uKHZhbHVlLCBzdGF0ZSwgY29tbWFuZCkNCgkJCQlsb2NhbCB2YWx1ZSA9IHRvbnVtYmVyKHZhbHVlKQ0KDQoJCQkJaWYgKHZhbHVlID09IG5pbCkgdGhlbg0KCQkJCQlzdGF0ZS5wcm9ibGVtID0gdHJ1ZQ0KCQkJCQlzdGF0ZS5yZWFzb24gPSBzdHJpbmcuZm9ybWF0KA0KCQkJCQkJIlRoZSBhcmd1bWVudCBnaXZlbiB0byAnJXMnIG11c3QgYmUgb2YgdGhlIHR5cGUgJXMuIiwNCgkJCQkJCWNvbW1hbmQubmFtZSwNCgkJCQkJCWNvbW1hbmQuZGF0YXR5cGUNCgkJCQkJKQ0KDQoJCQkJCXJldHVybiBuaWwNCgkJCQllbmQNCg0KCQkJCXJldHVybiBtYXRoLmZsb29yKHZhbHVlICsgMC41KQ0KCQkJZW5kLA0KCQkJLS0gQ2FzdCB0byBmbG9hdC4NCgkJCWZsb2F0ID0gZnVuY3Rpb24odmFsdWUsIHN0YXRlLCBjb21tYW5kKQ0KCQkJCWxvY2FsIHZhbHVlID0gdG9udW1iZXIodmFsdWUpDQoNCgkJCQlpZiAodmFsdWUgPT0gbmlsKSB0aGVuDQoJCQkJCXN0YXRlLnByb2JsZW0gPSB0cnVlDQoJCQkJCXN0YXRlLnJlYXNvbiA9IHN0cmluZy5mb3JtYXQoDQoJCQkJCQkiVGhlIGFyZ3VtZW50IGdpdmVuIHRvICclcycgbXVzdCBiZSBvZiB0aGUgdHlwZSAlcy4iLA0KCQkJCQkJY29tbWFuZC5uYW1lLA0KCQkJCQkJY29tbWFuZC5kYXRhdHlwZQ0KCQkJCQkpDQoNCgkJCQkJcmV0dXJuIG5pbA0KCQkJCWVuZA0KDQoJCQkJcmV0dXJuIHZhbHVlDQoJCQllbmQsDQoJCQktLSBDYXN0IHRvIGJvb2wuDQoJCQlib29sID0gZnVuY3Rpb24odmFsdWUsIF8pDQoJCQkJcmV0dXJuIHZhbHVlIGFuZCAxIG9yIDANCgkJCWVuZA0KCQl9DQoJfQ0KDQoJbG9jYWwgY29uc29sZSA9IHNldG1ldGF0YWJsZShwcm9wZXJ0aWVzLCBjb25zb2xlX210KQ0KDQoJLS0gU2V0dXAgZXZlbnRzLg0KCWNvbnNvbGU6c2V0dXBfZXZlbnRzKGNvbnNvbGUpDQoNCglyZXR1cm4gY29uc29sZQ0KZW5kDQoNCi0tLSBBc3NlcnQuDQpmdW5jdGlvbiBjb25zb2xlX2MuYXNzZXJ0KGV4cHJlc3Npb24sIGxldmVsLCBtZXNzYWdlLCAuLi4pDQoJaWYgKG5vdCBleHByZXNzaW9uKSB0aGVuDQoJCWVycm9yKHN0cmluZy5mb3JtYXQobWVzc2FnZSwgLi4uKSwgbGV2ZWwpDQoJZW5kDQplbmQNCg0KLS0tIFNldHVwIGdhbWUgZXZlbnRzLg0KZnVuY3Rpb24gY29uc29sZV9jOnNldHVwX2V2ZW50cyhjb25zb2xlKQ0KCS0tIEhvb2sgY29uc29sZSBpbnB1dCBldmVudC4NCgljbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJjb25zb2xlX2lucHV0IiwgZnVuY3Rpb24oY29uc29sZV9pbnB1dCkNCgkJLS0gUHJvY2VzcyBjb25zb2xlIGlucHV0Lg0KCQlyZXR1cm4gY29uc29sZTpwcm9jZXNzKGNvbnNvbGVfaW5wdXQpDQoJZW5kKQ0KDQoJLS0gSG9vayBzaHV0ZG93biBldmVudCBmb3IgZGF0YWJhc2Ugd3JpdGUuDQoJY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygic2h1dGRvd24iLCBmdW5jdGlvbigpDQoJCWZvciBfLCBjb21tYW5kIGluIHBhaXJzKGNvbnNvbGUuY29tbWFuZHMpIGRvDQoJCQktLSBJZiBub3QgYSBzcGVjaWFsIGNvbW1hbmQgYW5kIGlmIGNvbW1hbmQgaGFzIGFuIGFyZ3VtZW50Lg0KCQkJaWYgKGNvbW1hbmQuc3BlY2lhbCA9PSBmYWxzZSBvciBjb21tYW5kLmRhdGF0eXBlIH49IG5pbCkgdGhlbg0KDQoJCQkJLS0gU2F2ZSBjdXJyZW50IHZhbHVlIG9yIHBlcnNpc3QgZGVmYXVsdC4NCgkJCQlpZiAoY29tbWFuZC5wZXJzaXN0X3ZhbHVlID09IHRydWUpIHRoZW4NCgkJCQkJZGF0YWJhc2Uud3JpdGUoDQoJCQkJCQlzdHJpbmcuZm9ybWF0KCJoYXZvY19jb25zb2xlXyVzIiwgY29tbWFuZC5uYW1lKSwNCgkJCQkJCWNvbW1hbmQudmFsdWUNCgkJCQkJKQ0KCQkJCWVsc2UNCgkJCQkJZGF0YWJhc2Uud3JpdGUoDQoJCQkJCQlzdHJpbmcuZm9ybWF0KCJoYXZvY19jb25zb2xlXyVzIiwgY29tbWFuZC5uYW1lKSwNCgkJCQkJCWNvbW1hbmQuZGVmYXVsdA0KCQkJCQkpDQoJCQkJZW5kDQoNCgkJCWVuZA0KCQllbmQNCgllbmQpDQplbmQNCg0KLS0tIExvZyBtZXNzYWdlIHRvIGNvbnNvbGUuDQpmdW5jdGlvbiBjb25zb2xlX2M6bG9nKG9wdGlvbnMsIC4uLikNCgktLSBEbyBub3Qgb3V0cHV0IGRlYnVnIGxvZ3MgaWYgZGVidWdnaW5nIGlzIG5vdCBlbmFibGVkLg0KCWlmIChzZWxmLmRlYnVnID09IGZhbHNlIGFuZCBvcHRpb25zLmRlYnVnID09IHRydWUpIHRoZW4NCgkJcmV0dXJuDQoJZW5kDQoNCglsb2NhbCBwcmVmaXggPSBvcHRpb25zLnByZWZpeA0KCWxvY2FsIGNvZGUgPSB0eXBlKG9wdGlvbnMuY29kZSkgPT0gIm51bWJlciIgYW5kIG9wdGlvbnMuY29kZSBvciAtMQ0KDQoJLS0gUHJpbnQgcHJlZml4Lg0KCWlmIChwcmVmaXggPT0gbmlsIG9yIHByZWZpeCA9PSB0cnVlKSB0aGVuDQoJCWNsaWVudC5jb2xvcl9sb2coc2VsZi5sb2dfcHJlZml4X2NvbG9yWzFdLCBzZWxmLmxvZ19wcmVmaXhfY29sb3JbMl0sIHNlbGYubG9nX3ByZWZpeF9jb2xvclszXSwgc2VsZi5sb2dfcHJlZml4IC4uICIgXDAiKQ0KCWVuZA0KDQoJLS0gUHJpbnQgY29kZXMuDQoJaWYgKHNlbGYuc3RhdGUucHJvYmxlbSA9PSB0cnVlKSB0aGVuDQoJCWNsaWVudC5jb2xvcl9sb2coMjU1LCA3NSwgNzUsICJbQkFEIElOUFVUXSBcMCIpDQoJZWxzZWlmIChjb2RlID09IDApIHRoZW4NCgkJY2xpZW50LmNvbG9yX2xvZyg3NSwgMjU1LCA3NSwgIltTVUNDRVNTXSBcMCIpDQoJZWxzZWlmIChjb2RlID09IDEpIHRoZW4NCgkJY2xpZW50LmNvbG9yX2xvZygyNTUsIDc1LCA3NSwgIltFUlJPUl0gXDAiKQ0KCWVsc2VpZiAoY29kZSA9PSAyKSB0aGVuDQoJCWNsaWVudC5jb2xvcl9sb2coMjU1LCAxMjUsIDc1LCAiW1dBUk5JTkddIFwwIikNCgllbmQNCg0KCS0tIFByaW50IG1lc3NhZ2Ugc3RyaW5nLg0KCWNsaWVudC5jb2xvcl9sb2coMjQwLCAyNDAsIDI0MCwgc3RyaW5nLmZvcm1hdCguLi4pLCAiXDAiKQ0KDQoJLS0gQ29sb3IgdG9wLWxlZnQgbG9ncy4NCglpZiAoc2VsZi5zdGF0ZS5wcm9ibGVtID09IHRydWUpIHRoZW4NCgkJY2xpZW50LmNvbG9yX2xvZygyNTUsIDc1LCA3NSwgIiAiKQ0KCWVsc2VpZiAoY29kZSA9PSAwKSB0aGVuDQoJCWNsaWVudC5jb2xvcl9sb2coNzUsIDI1NSwgNzUsICIgIikNCgllbHNlaWYgKGNvZGUgPT0gMSkgdGhlbg0KCQljbGllbnQuY29sb3JfbG9nKDI1NSwgNzUsIDc1LCAiICIpDQoJZWxzZWlmIChjb2RlID09IDIpIHRoZW4NCgkJY2xpZW50LmNvbG9yX2xvZygyNTUsIDEyNSwgNzUsICIgIikNCgllbHNlDQoJCWNsaWVudC5jb2xvcl9sb2coMjQwLCAyNDAsIDI0MCwgIiAiKQ0KCWVuZA0KZW5kDQoNCi0tLSBBZGQgYSBjb25zb2xlIGNvbW1hbmQuDQpmdW5jdGlvbiBjb25zb2xlX2M6Y29tbWFuZChuYW1lLCBkZXNjcmlwdGlvbiwgb3B0aW9ucywgb25faW5wdXQpDQoJY29uc29sZV9jLmFzc2VydCh0eXBlKG5hbWUpID09ICJzdHJpbmciLCAyLCAiQ29tbWFuZCBuYW1lIG11c3QgYmUgc3RyaW5ncy4iKQ0KCWNvbnNvbGVfYy5hc3NlcnQodHlwZShkZXNjcmlwdGlvbikgPT0gInN0cmluZyIsIDIsICJDb21tYW5kIGRlc2NyaXB0aW9uIG11c3QgYmUgc3RyaW5ncy4iKQ0KCWNvbnNvbGVfYy5hc3NlcnQoDQoJCXR5cGUob3B0aW9ucykgPT0gInRhYmxlIiBvciB0eXBlKG9wdGlvbnMpID09ICJuaWwiLA0KCQkyLA0KCQkiQ29tbWFuZCBvcHRpb25zIG11c3QgYmUgYSB0YWJsZSBvciBuaWwuIg0KCSkNCgljb25zb2xlX2MuYXNzZXJ0KHR5cGUob25faW5wdXQpID09ICJmdW5jdGlvbiIsIDIsICJDb21tYW5kIGNhbGxiYWNrcyBtdXN0IGJlIGZ1bmN0aW9ucy4iKQ0KDQoJLS0gQ3JlYXRlIHRoZSBjb21tYW5kLg0KCWxvY2FsIGNvbW1hbmQgPSBjb21tYW5kX2MubmV3KA0KCQlzZWxmLnByZWZpeCAuLiBuYW1lLA0KCQlkZXNjcmlwdGlvbiwNCgkJb3B0aW9ucywNCgkJb25faW5wdXQNCgkpDQoNCgktLSBVcGRhdGUgY29tbWFuZCBmcm9tIGRhdGFiYXNlLg0KCWlmIChjb21tYW5kLnNwZWNpYWwgPT0gZmFsc2Ugb3IgY29tbWFuZC5kYXRhdHlwZSB+PSBuaWwpIHRoZW4NCgkJLS0gUmVhZCBmcm9tIGRhdGFiYXNlLg0KCQlsb2NhbCB2YWx1ZSA9IGRhdGFiYXNlLnJlYWQoDQoJCQlzdHJpbmcuZm9ybWF0KCJoYXZvY19jb25zb2xlXyVzIiwgY29tbWFuZC5uYW1lKQ0KCQkpDQoNCgkJLS0gT25seSB1cGRhdGUgaWYgYSB2YWx1ZSBleGlzdHMuDQoJCWlmICh2YWx1ZSB+PSBuaWwpIHRoZW4NCgkJCWNvbW1hbmQudmFsdWUgPSB2YWx1ZQ0KCQllbmQNCg0KCWVuZA0KDQoJLS0gQWRkIHRoZSBjb21tYW5kLg0KCXNlbGYuY29tbWFuZHNbc2VsZi5wcmVmaXggLi4gbmFtZV0gPSBjb21tYW5kDQplbmQNCg0KLS0tIFByb2Nlc3MgY29uc29sZSBpbnB1dC4NCi0tLSBSZXR1cm5zIHRydWUgaWYgY29tbWFuZCB3YXMgZm91bmQuIEZhbHNlIGlmIG5vdC4NCmZ1bmN0aW9uIGNvbnNvbGVfYzpwcm9jZXNzKGNvbnNvbGVfaW5wdXQpDQoJbG9jYWwgY29tbWFuZCA9IHNlbGY6X2Zvcm1hdF9jb25zb2xlX2lucHV0KGNvbnNvbGVfaW5wdXQpDQoNCgktLSBEbyBub3QgcHJvY2VzcyBmYXVsdHkgY29uc29sZSBpbnB1dC4NCglpZiAoc2VsZi5zdGF0ZS5wcm9ibGVtID09IHRydWUpIHRoZW4NCgkJLS0gUHJpbnQgcHJvYmxlbSB0byBjb25zb2xlLg0KCQlzZWxmOmxvZyh7fSwgc2VsZi5zdGF0ZS5yZWFzb24pDQoNCgkJLS0gUmVzZXQgc3RhdGUuDQoJCXNlbGYuc3RhdGUucHJvYmxlbSA9IGZhbHNlDQoNCgkJLS0gQ29uc29sZSBjb21tYW5kIHdhcyBmb3VuZC4NCgkJLS0gQnV0IGRvIG5vdCBjb250aW51ZSBwcm9jZXNzaW5nIHRoZSBjb25zb2xlIGlucHV0Lg0KCQlyZXR1cm4gdHJ1ZQ0KCWVuZA0KDQoJaWYgKGNvbW1hbmQgPT0gbmlsKSB0aGVuDQoJCS0tIENvbnNvbGUgY29tbWFuZCB3YXMgbm90IGZvdW5kLg0KCQlyZXR1cm4gZmFsc2UNCgllbmQNCg0KCS0tIElnbm9yZSBzcGVjaWFsIGNvbW1hbmRzLg0KCWlmIChjb21tYW5kLnNwZWNpYWwgPT0gZmFsc2UpIHRoZW4NCgkJLS0gVXBkYXRlIGNvbW1hbmQncyBjdXJyZW50IHZhbHVlLg0KCQlpZiAoY29tbWFuZC5zYXZlX3ZhbHVlID09IHRydWUpIHRoZW4NCgkJCWNvbW1hbmQudmFsdWUgPSBjb21tYW5kLmlucHV0X3ZhbHVlDQoJCWVuZA0KDQoJCS0tIENhbGwgdGhlIGNvbW1hbmQncyBjYWxsYmFjay4NCgkJY29tbWFuZC5vbl9pbnB1dChjb21tYW5kLmlucHV0X3ZhbHVlKQ0KCWVuZA0KDQoJLS0gQ29tbWFuZCB3YXMgZm91bmQgYW5kIGV4ZWN1dGVkLg0KCXJldHVybiB0cnVlDQplbmQNCg0KLS0tIFJldHVybnMgY29tbWFuZCBuYW1lIGFuZCBjb21tYW5kIGFyZ3VtZW50IChpZiBhcHBsaWNhYmxlKS4NCmZ1bmN0aW9uIGNvbnNvbGVfYzpfZm9ybWF0X2NvbnNvbGVfaW5wdXQoY29uc29sZV9pbnB1dCkNCglsb2NhbCBpID0gMQ0KCWxvY2FsIG5hbWUNCglsb2NhbCBhcmd1bWVudA0KDQoJLS0gSSBoYXRlIHRoaXMgY29kZSB0b28uDQoJZm9yIGNvbXBvbmVudCBpbiBzdHJpbmcuZ21hdGNoKGNvbnNvbGVfaW5wdXQsICIlUysiKSBkbw0KCQktLSBTZXQgY29tbWFuZCBuYW1lLg0KCQlpZiAoaSA9PSAxKSB0aGVuDQoJCQluYW1lID0gY29tcG9uZW50DQoJCWVsc2UNCgkJCWlmIChpID09IDIpIHRoZW4NCgkJCQktLSBGaXJzdCBhcmd1bWVudCBjb21wb25lbnQuDQoJCQkJYXJndW1lbnQgPSBjb21wb25lbnQNCgkJCWVsc2UNCgkJCQktLSBPdGhlciBhcmd1bWVudCBjb21wb25lbnRzLg0KCQkJCWFyZ3VtZW50ID0gYXJndW1lbnQgLi4gIiAiIC4uIGNvbXBvbmVudA0KCQkJZW5kDQoJCWVuZA0KDQoJCWkgPSBpICsgMQ0KCWVuZA0KDQoJLS0gR2V0IHRoZSBjb21tYW5kIHByb3ZpZGVkLg0KCWxvY2FsIGNvbW1hbmQgPSBzZWxmLmNvbW1hbmRzW25hbWVdDQoNCgktLSBJbnZhbGlkIGNvbW1hbmQgbmFtZS4NCglpZiAoY29tbWFuZCA9PSBuaWwpIHRoZW4NCgkJcmV0dXJuIG5pbA0KCWVuZA0KDQoJLS0gUnVuIHNwZWNpYWwgY29tbWFuZCBjYWxsYmFjayBhbmQgcmV0dXJuLg0KCWlmIChjb21tYW5kLnNwZWNpYWwgPT0gdHJ1ZSkgdGhlbg0KCQljb21tYW5kLm9uX2lucHV0KHNlbGYsIGFyZ3VtZW50KQ0KDQoJCXJldHVybiBjb21tYW5kDQoJZW5kDQoNCgktLSBBcmd1bWVudCB3YXMgZXhwZWN0ZWQuDQoJaWYgKGNvbW1hbmQuZGF0YXR5cGUgfj0gbmlsIGFuZCBhcmd1bWVudCA9PSBuaWwpIHRoZW4NCgkJc2VsZi5zdGF0ZS5wcm9ibGVtID0gdHJ1ZQ0KCQlzZWxmLnN0YXRlLnJlYXNvbiA9IHN0cmluZy5mb3JtYXQoDQoJCQkiQ29tbWFuZCAnJXMnIGV4cGVjdHMgYW4gYXJndW1lbnQgdG8gYmUgZ2l2ZW4gKCVzKS4iLA0KCQkJY29tbWFuZC5uYW1lLA0KCQkJY29tbWFuZC5kYXRhdHlwZQ0KCQkpDQoNCgkJcmV0dXJuIG5pbA0KCWVuZA0KDQoJaWYgKGNvbW1hbmQuZGF0YXR5cGUgfj0gbmlsIGFuZCBhcmd1bWVudCB+PSBuaWwpIHRoZW4NCgkJLS0gQ2FzdCBhcmd1bWVudCB0byBjb21tYW5kIGRhdGF0eXBlLg0KCQlhcmd1bWVudCA9IHNlbGYuY2FzdFtjb21tYW5kLmRhdGF0eXBlXShhcmd1bWVudCwgc2VsZi5zdGF0ZSwgY29tbWFuZCkNCg0KCQktLSBTZXQgbGFzdCBhdHRlbXB0ZWQgdmFsdWUuDQoJCWNvbW1hbmQuaW5wdXRfdmFsdWUgPSBhcmd1bWVudA0KCWVuZA0KDQoJcmV0dXJuIGNvbW1hbmQNCmVuZA0KLS1lbmRyZWdpb24NCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIGZwcw0KLS0tIEBjbGFzcyBmcHNfYw0KLS0tIEBmaWVsZCBwdWJsaWMgZnJhbWV0aW1lcyB0YWJsZTxudW1iZXIsIG51bWJlcj4NCi0tLSBAZmllbGQgcHVibGljIGZwc19wcmV2IG51bWJlcg0KLS0tIEBmaWVsZCBwdWJsaWMgdmFsdWVfcHJldiBudW1iZXINCi0tLSBAZmllbGQgcHVibGljIGxhc3RfdXBkYXRlX3RpbWUgbnVtYmVyDQotLS0gQGZpZWxkIHB1YmxpYyB0aW1lciB0aW1lcl90aWNrX2MNCmxvY2FsIGZwc19jID0ge30NCmxvY2FsIGZwc19tdCA9IHsNCglfX2luZGV4ID0gZnBzX2MsDQoJLS0tIFJldHVybiB0aGUgY3VycmVudCBGUFMuDQoJLS0tIEBwYXJhbSBmcHMgZnBzX2MNCgktLS0gQHJldHVybiBudW1iZXINCglfX2NhbGwgPSBmdW5jdGlvbihmcHMpDQoJCXJldHVybiBmcHM6Z2V0KCkNCgllbmQNCn0NCg0KLS0tIEluc3RhbnRpYXRlIGEgZnBzIG9iamVjdC4NCi0tLSBAcmV0dXJuIGZwc19jDQpmdW5jdGlvbiBmcHNfYy5uZXcoKQ0KCWxvY2FsIHByb3BlcnRpZXMgPSB7DQoJCWZyYW1ldGltZXMgPSB7fSwNCgkJZnBzX3ByZXYgPSAwLA0KCQl2YWx1ZV9wcmV2ID0ge30sDQoJCWxhc3RfdXBkYXRlX3RpbWUgPSAwLA0KCQl0aW1lciA9IHRpbWVyX3RpY2tfYy5uZXcodHJ1ZSkNCgl9DQoNCglsb2NhbCBmcHMgPSBzZXRtZXRhdGFibGUocHJvcGVydGllcywgZnBzX210KQ0KDQoJcmV0dXJuIGZwcw0KZW5kDQoNCi0tLSBHZXQgdGhlIGN1cnJlbnQgRlBTLg0KLS0tIEByZXR1cm4gbnVtYmVyDQpmdW5jdGlvbiBmcHNfYzpnZXQoKQ0KCWxvY2FsIHJ0LCBmdCA9IGdsb2JhbHMucmVhbHRpbWUoKSwgZ2xvYmFscy5hYnNvbHV0ZWZyYW1ldGltZSgpDQoNCglpZiBmdCA+IDAgdGhlbg0KCQl0YWJsZS5pbnNlcnQoc2VsZi5mcmFtZXRpbWVzLCAxLCBmdCkNCgllbmQNCg0KCWxvY2FsIGNvdW50ID0gI3NlbGYuZnJhbWV0aW1lcw0KDQoJaWYgY291bnQgPT0gMCB0aGVuDQoJCXJldHVybiAwDQoJZW5kDQoNCglsb2NhbCBhY2N1bSA9IDANCglsb2NhbCBpID0gMA0KDQoJd2hpbGUgYWNjdW0gPCAwLjUgZG8NCgkJaSA9IGkgKyAxDQoJCWFjY3VtID0gYWNjdW0gKyBzZWxmLmZyYW1ldGltZXNbaV0NCg0KCQlpZiBpID49IGNvdW50IHRoZW4NCgkJCWJyZWFrDQoJCWVuZA0KCWVuZA0KDQoJYWNjdW0gPSBhY2N1bSAvIGkNCg0KCXdoaWxlIGkgPCBjb3VudCBkbw0KCQlpID0gaSArIDENCg0KCQl0YWJsZS5yZW1vdmUoc2VsZi5mcmFtZXRpbWVzKQ0KCWVuZA0KDQoJbG9jYWwgZnBzID0gMSAvIGFjY3VtDQoJbG9jYWwgdGltZV9zaW5jZV91cGRhdGUgPSBydCAtIHNlbGYubGFzdF91cGRhdGVfdGltZQ0KDQoJaWYgbWF0aC5hYnMoZnBzIC0gc2VsZi5mcHNfcHJldikgPiA0IG9yIHRpbWVfc2luY2VfdXBkYXRlID4gMSB0aGVuDQoJCXNlbGYuZnBzX3ByZXYgPSBmcHMNCgkJc2VsZi5sYXN0X3VwZGF0ZV90aW1lID0gcnQNCgllbHNlDQoJCWZwcyA9IHNlbGYuZnBzX3ByZXYNCgllbmQNCg0KCXJldHVybiBtYXRoLmZsb29yKGZwcyArIDAuNSkNCmVuZA0KLS1lbmRyZWdpb24NCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIGlsbHVzaW9uX3JlbmRlcmVyDQotLS0gQGNsYXNzIGlsbHVzaW9uX3JlbmRlcmVyX2MNCmxvY2FsIGlsbHVzaW9uX3JlbmRlcmVyX2MgPSB7fQ0KDQotLS0gUmVuZGVyIGEgcmVjdGFuZ2xlIHBhcnRpY2xlLg0KLS0tIEBwYXJhbSBwYXJ0aWNsZSBpbGx1c2lvbl9wYXJ0aWNsZV9jDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9yZW5kZXJlcl9jLnJlY3RhbmdsZShwYXJ0aWNsZSkNCgktLSBEZWZpbmUgdGhlIHNjYWxlcyBhdCB3aGljaCB0byByZW5kZXIgdGhlIHBhcnRpY2xlLg0KCWxvY2FsIGRyYXdfZGltZW5zaW9ucyA9IHZlY3RvcigNCgkJcGFydGljbGUud2lkdGggLyAocGFydGljbGUucmVsYXRpb25fY2FtZXJhX2Rpc3RhbmNlIC8gMTAwKSwNCgkJcGFydGljbGUuaGVpZ2h0IC8gKHBhcnRpY2xlLnJlbGF0aW9uX2NhbWVyYV9kaXN0YW5jZSAvIDEwMCksDQoJCTANCgkpDQoNCgktLSBDZW50ZXItYWxpZ24gdGhlIHBhcnRpY2xlIGJhc2VkIG9uIHRoZSBkcmF3IGRpbWVuc2lvbnMuDQoJcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMgPSBwYXJ0aWNsZS5zY3JlZW5fZGltZW5zaW9ucyAtIChkcmF3X2RpbWVuc2lvbnMgLyAyKQ0KDQoJLS0gUmVuZGVyLg0KCXJlbmRlcmVyLnJlY3RhbmdsZSgNCgkJcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueCwgcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueSwNCgkJZHJhd19kaW1lbnNpb25zLngsIGRyYXdfZGltZW5zaW9ucy55LA0KCQlwYXJ0aWNsZS5zaGFkZXIuciwgcGFydGljbGUuc2hhZGVyLmcsIHBhcnRpY2xlLnNoYWRlci5iLCBwYXJ0aWNsZS5zaGFkZXIuYQ0KCSkNCmVuZA0KDQotLS0gUmVuZGVyIGEgdGV4dHVyZSBwYXJ0aWNsZS4NCi0tLSBAcGFyYW0gcGFydGljbGUgaWxsdXNpb25fcGFydGljbGVfYw0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fcmVuZGVyZXJfYy50ZXh0dXJlKHBhcnRpY2xlKQ0KCS0tIERlZmluZSB0aGUgc2NhbGVzIGF0IHdoaWNoIHRvIHJlbmRlciB0aGUgcGFydGljbGUuDQoJbG9jYWwgZHJhd19kaW1lbnNpb25zID0gdmVjdG9yKA0KCQlwYXJ0aWNsZS53aWR0aCAvIChwYXJ0aWNsZS5yZWxhdGlvbl9jYW1lcmFfZGlzdGFuY2UgLyAxMDApLA0KCQlwYXJ0aWNsZS5oZWlnaHQgLyAocGFydGljbGUucmVsYXRpb25fY2FtZXJhX2Rpc3RhbmNlIC8gMTAwKSwNCgkJMA0KCSkNCg0KCS0tIENlbnRlci1hbGlnbiB0aGUgcGFydGljbGUgYmFzZWQgb24gdGhlIGRyYXcgZGltZW5zaW9ucy4NCglwYXJ0aWNsZS5zY3JlZW5fZGltZW5zaW9ucyA9IHBhcnRpY2xlLnNjcmVlbl9kaW1lbnNpb25zIC0gKGRyYXdfZGltZW5zaW9ucyAvIDIpDQoNCgktLSBSZW5kZXIuDQoJcmVuZGVyZXIudGV4dHVyZSgNCgkJcGFydGljbGUudGV4dHVyZSwNCgkJcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueCwgcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueSwNCgkJZHJhd19kaW1lbnNpb25zLngsIGRyYXdfZGltZW5zaW9ucy55LA0KCQlwYXJ0aWNsZS5zaGFkZXIuciwgcGFydGljbGUuc2hhZGVyLmcsIHBhcnRpY2xlLnNoYWRlci5iLCBwYXJ0aWNsZS5zaGFkZXIuYSwNCgkJImYiDQoJKQ0KZW5kDQoNCi0tLSBSZW5kZXIgYSBjaXJjbGUgcGFydGljbGUuDQotLS0gQHBhcmFtIHBhcnRpY2xlIGlsbHVzaW9uX3BhcnRpY2xlX2MNCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGlsbHVzaW9uX3JlbmRlcmVyX2MuY2lyY2xlKHBhcnRpY2xlKQ0KCWxvY2FsIHJhZGl1cyA9IG1hdGgubWF4KDAuNSwgcGFydGljbGUucmFkaXVzIC8gKHBhcnRpY2xlLnJlbGF0aW9uX2NhbWVyYV9kaXN0YW5jZSAvIDEwMCkpDQoNCglpZiAocmFkaXVzID49IDIpIHRoZW4NCgkJcmVuZGVyZXIuY2lyY2xlKA0KCQkJcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueCwgcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueSwNCgkJCXBhcnRpY2xlLnNoYWRlci5yLCBwYXJ0aWNsZS5zaGFkZXIuZywgcGFydGljbGUuc2hhZGVyLmIsIHBhcnRpY2xlLnNoYWRlci5hLA0KCQkJcmFkaXVzLCBwYXJ0aWNsZS5zdGFydF9kZWdyZWVzLCBwYXJ0aWNsZS5wZXJjZW50YWdlDQoJCSkNCgllbHNlDQoJCXJlbmRlcmVyLnJlY3RhbmdsZSgNCgkJCXBhcnRpY2xlLnNjcmVlbl9kaW1lbnNpb25zLngsIHBhcnRpY2xlLnNjcmVlbl9kaW1lbnNpb25zLnksDQoJCQlyYWRpdXMgKiAyLCByYWRpdXMgKiAyLA0KCQkJcGFydGljbGUuc2hhZGVyLnIsIHBhcnRpY2xlLnNoYWRlci5nLCBwYXJ0aWNsZS5zaGFkZXIuYiwgcGFydGljbGUuc2hhZGVyLmENCgkJKQ0KCWVuZA0KZW5kDQoNCi0tLSBSZW5kZXIgYSBjaXJjbGUgb3V0bGluZSBwYXJ0aWNsZS4NCi0tLSBAcGFyYW0gcGFydGljbGUgaWxsdXNpb25fcGFydGljbGVfYw0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fcmVuZGVyZXJfYy5jaXJjbGVfb3V0bGluZShwYXJ0aWNsZSkNCglsb2NhbCByYWRpdXMgPSBwYXJ0aWNsZS5yYWRpdXMgLyAocGFydGljbGUucmVsYXRpb25fY2FtZXJhX2Rpc3RhbmNlIC8gMTAwKQ0KDQoJaWYgKHJhZGl1cyA+PSAyKSB0aGVuDQoJCXJlbmRlcmVyLmNpcmNsZV9vdXRsaW5lKA0KCQkJcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueCwgcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueSwNCgkJCXBhcnRpY2xlLnNoYWRlci5yLCBwYXJ0aWNsZS5zaGFkZXIuZywgcGFydGljbGUuc2hhZGVyLmIsIHBhcnRpY2xlLnNoYWRlci5hLA0KCQkJcmFkaXVzLCBwYXJ0aWNsZS5zdGFydF9kZWdyZWVzLCBwYXJ0aWNsZS5wZXJjZW50YWdlLCBwYXJ0aWNsZS50aGlja25lc3MNCgkJKQ0KCWVsc2UNCgkJcmVuZGVyZXIucmVjdGFuZ2xlKA0KCQkJcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueCwgcGFydGljbGUuc2NyZWVuX2RpbWVuc2lvbnMueSwNCgkJCXJhZGl1cyAqIDIsIHJhZGl1cyAqIDIsDQoJCQlwYXJ0aWNsZS5zaGFkZXIuciwgcGFydGljbGUuc2hhZGVyLmcsIHBhcnRpY2xlLnNoYWRlci5iLCBwYXJ0aWNsZS5zaGFkZXIuYQ0KCQkpDQoJZW5kDQplbmQNCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIGlsbHVzaW9uX3BhcnRpY2xlDQotLS0gQGNsYXNzIGlsbHVzaW9uX3BhcnRpY2xlX2MNCi0tLSBAZmllbGQgcHVibGljIGlkIG51bWJlciBQYXJ0aWNsZSBJRC4NCi0tLSBAZmllbGQgcHVibGljIHNoYXJlZCBpbGx1c2lvbl9zaGFyZWRfYyBJbGx1c2lvbiBzaGFyZWQgcHJvcGVydGllcy4NCi0tLSBAZmllbGQgcHVibGljIHNpbXVsYXRpb24gaWxsdXNpb25fc2ltdWxhdGlvbl9jIElsbHVzaW9uIHNpbXVsYXRpb24gcHJvcGVydGllcy4NCi0tLSBAZmllbGQgcHVibGljIGhvb2sgaWxsdXNpb25faG9va19jIFRoZSBwYXJ0aWNsZSdzIGhvb2suDQotLS0gQGZpZWxkIHB1YmxpYyBvcmlnaW4gdmVjdG9yX29sZF9jIE9yaWdpbiB2ZWN0b3IuDQotLS0gQGZpZWxkIHB1YmxpYyBzaGFkZXIgc2hhZGVyX2MgUGFydGljbGUgc2hhZGVyLg0KLS0tIEBmaWVsZCBwdWJsaWMgdHlwZSBzdHJpbmcgUGFydGljbGUgdHlwZSAocmVjdGFuZ2xlLCB0ZXh0dXJlLCBjaXJjbGUsIGNpcmNsZV9vdXRsaW5lKS4NCi0tLSBAZmllbGQgcHVibGljIHdpZHRoIG51bWJlciBCYXNlIHBhcnRpY2xlIHdpZHRoIChzaGFwZSByZWN0YW5ndWxhcikuDQotLS0gQGZpZWxkIHB1YmxpYyBoZWlnaHQgbnVtYmVyIEJhc2UgcGFydGljbGUgaGVpZ2h0IChzaGFwZSByZWN0YW5ndWxhcikuDQotLS0gQGZpZWxkIHB1YmxpYyB0ZXh0dXJlIG51bWJlciBQYXJ0aWNsZSB0ZXh0dXJlICh0eXBlIHRleHR1cmUpLg0KLS0tIEBmaWVsZCBwdWJsaWMgcmFkaXVzIG51bWJlciBQYXJ0aWNsZSBiYXNlIHJhZGl1cyAoc2hhcGUgY2lyY3VsYXIpLg0KLS0tIEBmaWVsZCBwdWJsaWMgc3RhcnRfZGVncmVlcyBudW1iZXIgUGFydGljbGUgYmFzZSBzdGFydCBkZWdyZWVzIChzaGFwZSBjaXJjdWxhcikuDQotLS0gQGZpZWxkIHB1YmxpYyBwZXJjZW50YWdlIG51bWJlciBQYXJ0aWNsZSBiYXNlIHBlcmNlbnRhZ2UgKHNoYXBlIGNpcmN1bGFyKS4NCi0tLSBAZmllbGQgcHVibGljIHRoaWNrbmVzcyBudW1iZXIgUGFydGljbGUgYmFzZSB0aGlja25lc3MgKHR5cGUgY2lyY2xlX291dGxpbmUpLg0KLS0tIEBmaWVsZCBwdWJsaWMgb25zY3JlZW4gYm9vbGVhbiBQYXJ0aWNsZSBpcyBvbiB0aGUgcGxheWVyJ3Mgc2NyZWVuIChhY2NvcmRpbmcgdG8gd29ybGQtdG8tc2NyZWVuIGFuZCBza2lwX29mZnNjcmVlbikuDQotLS0gQGZpZWxkIHB1YmxpYyBvY2NsdWRlZCBib29sZWFuIFBhcnRpY2xlIGlzIGJlaGluZCBjb3Zlci4NCi0tLSBAZmllbGQgcHVibGljIGR5aW5nIGJvb2xlYW4gUGFydGljbGUgaXMgY3VycmVudGx5IGluIHRoZSBkeWluZyBzdGF0ZS4NCi0tLSBAZmllbGQgcHVibGljIGRlYWQgYm9vbGVhbiBQYXJ0aWNsZSBpcyBkZWFkIGFuZCBpcyByZWFkeSB0byBiZSByZW1vdmVkLg0KLS0tIEBmaWVsZCBwdWJsaWMgbGlmZXNwYW4gbnVtYmVyIFBhcnRpY2xlIGxpZmVzcGFuLiBTZXQgdG8gbmlsIGZvciBubyBkZWF0aCAoZGVmYXVsdHMgdG8gbmlsKS4NCi0tLSBAZmllbGQgcHJpdmF0ZSBsaWZlc3Bhbl90aW1lciB0aW1lcl9zdGFuZGFyZF9jIFBhcnRpY2xlIGxpZmVzcGFuIHRpbWVyLg0KLS0tIEBmaWVsZCBwdWJsaWMgYWx3YXlzX3Zpc2libGUgYm9vbGVhbiBQYXJ0aWNsZSBzaG91bGQgYmUgdmlzaWJsZSBldmVuIGlmIG9jY2x1ZGVkLg0KLS0tIEBmaWVsZCBwdWJsaWMgc2tpcF9vZmZzY3JlZW4gYm9vbGVhbiBTa2lwIHBhcnRpY2xlcyB0aGF0IGFyZSBvZmZzY3JlZW4gZXZlbiBpZiB0aGV5IGNvdWxkIGJlIHJlbmRlcmVkIG90aGVyd2lzZS4gR29vZCBmb3IgcGVyZm9ybWFuY2UuDQotLS0gQGZpZWxkIHB1YmxpYyBtYXhfcmVuZGVyX2Rpc3RhbmNlIG51bWJlciBUaGUgZmFydGhlc3QgYXdheSBhIHBhcnRpY2xlIGNhbiBiZSBhbmQgc3RpbGwgYmUgcmVuZGVyZWQuDQotLS0gQGZpZWxkIHB1YmxpYyBvbl9mcmFtZSBmdW4ocGFydGljbGU6aWxsdXNpb25fcGFydGljbGVfYyk6IHZvaWQgRmlyZWQgZWFjaCBmcmFtZS4NCi0tLSBAZmllbGQgcHVibGljIG9uX3RpY2sgZnVuKHBhcnRpY2xlOmlsbHVzaW9uX3BhcnRpY2xlX2MpOiB2b2lkIEZpcmVkIGVhY2ggdGljay4NCi0tLSBAZmllbGQgcHVibGljIG9uX2tpbGwgZnVuKHBhcnRpY2xlOmlsbHVzaW9uX3BhcnRpY2xlX2MpOiB2b2lkIEZpcmVkIHdoZW4gYSBwYXJ0aWNsZSBpcyBraWxsZWQuDQotLS0gQGZpZWxkIHB1YmxpYyBvbl9kZWFkIGZ1bihwYXJ0aWNsZTppbGx1c2lvbl9wYXJ0aWNsZV9jKTogdm9pZCBGaXJlZCB3aGVuIGEgcGFydGljbGUgaXMgZGVhZC4NCi0tLSBAZmllbGQgcHVibGljIGZhZGVfdGltZSBudW1iZXIgU2Vjb25kcyB0aGF0IGEgcGFydGljbGUgc2hvdWxkIHRha2UgdG8gZmFkZSBvdXQgb24gZGVhdGguDQotLS0gQGZpZWxkIHByaXZhdGUgZGVhdGhfdGltZXIgdGltZXJfc3RhbmRhcmRfYyBUaW1lciB0aGF0IGNvdW50cyBob3cgbG9uZyB0aGUgcGFydGljbGUgaGFzIGJlZW4gZHlpbmcgZm9yLg0KLS0tIEBmaWVsZCBwcml2YXRlIGFscGhhX2F0X2RlYXRoIG51bWJlciBVc2VkIGZvciBmYWRpbmcgdGhlIHBhcnRpY2xlIG91dCBvbiBkZWF0aC4NCi0tLSBAZmllbGQgcHVibGljIHJlbGF0aW9uX2NhbWVyYV9kaXN0YW5jZSBudW1iZXIgRGlzdGFuY2UgYmV0d2VlbiB0aGUgcGFydGljbGUgYW5kIHRoZSBjYW1lcmEuDQotLS0gQGZpZWxkIHB1YmxpYyBzY3JlZW5fZGltZW5zaW9ucyB2ZWN0b3Jfb2xkX2MgUGFydGljbGUgcG9zaXRpb24gb25zY3JlZW4uDQotLS0gQGZpZWxkIHB1YmxpYyBhbmltYXRvciBpbGx1c2lvbl9hbmltYXRvcl9jIElsbHVzaW9uIGFuaW1hdG9yIGN1c3RvbSBwcm9wZXJ0eSAobXVzdCBiZSBkZWNsYXJlZCkuDQpsb2NhbCBpbGx1c2lvbl9wYXJ0aWNsZV9jID0ge30NCmxvY2FsIGlsbHVzaW9uX3BhcnRpY2xlX210ID0geyBfX2luZGV4ID0gaWxsdXNpb25fcGFydGljbGVfYyB9DQoNCi0tLSBJbnN0YW50aWF0ZSBhbiBvYmplY3Qgb2YgaWxsdXNpb25fcGFydGljbGVfYy4NCi0tLSBAcGFyYW0gaWQgbnVtYmVyDQotLS0gQHBhcmFtIHNoYXJlZCBpbGx1c2lvbl9zaGFyZWRfYw0KLS0tIEBwYXJhbSBob29rIGlsbHVzaW9uX2hvb2tfYw0KLS0tIEByZXR1cm4gaWxsdXNpb25fcGFydGljbGVfYw0KZnVuY3Rpb24gaWxsdXNpb25fcGFydGljbGVfYy5uZXcoaWQsIHNoYXJlZCwgc2ltdWxhdGlvbiwgaG9vaykNCglyZXR1cm4gc2V0bWV0YXRhYmxlKHsNCgkJLS0gTWV0YS4NCgkJaWQgPSBpZCwNCgkJc2hhcmVkID0gc2hhcmVkLA0KCQlzaW11bGF0aW9uID0gc2ltdWxhdGlvbiwNCgkJaG9vayA9IGhvb2ssDQoJCS0tIEdlbmVyYWwgcHJvcGVydGllcy4NCgkJb3JpZ2luID0gbmlsLA0KCQlzaGFkZXIgPSBuaWwsDQoJCXR5cGUgPSAiY2lyY2xlIiwNCgkJLS0gUGFydGljbGUgdHlwZSBvcHRpb25zLg0KCQl3aWR0aCA9IDUsDQoJCWhlaWdodCA9IDUsDQoJCXRleHR1cmUgPSAwLA0KCQlyYWRpdXMgPSA1LA0KCQlzdGFydF9kZWdyZWVzID0gMCwNCgkJcGVyY2VudGFnZSA9IDEsDQoJCXRoaWNrbmVzcyA9IDEsDQoJCS0tIFN0YXRlcy4NCgkJb25zY3JlZW4gPSBmYWxzZSwNCgkJb2NjbHVkZWQgPSB0cnVlLA0KCQlkeWluZyA9IGZhbHNlLA0KCQlkZWFkID0gZmFsc2UsDQoJCS0tIExpZmVzcGFuLg0KCQlsaWZlc3BhbiA9IG5pbCwNCgkJbGlmZXNwYW5fdGltZXIgPSB0aW1lcl9zdGFuZGFyZF9jLm5ldyh0cnVlKSwNCgkJLS0gUmVuZGVyaW5nIG9wdGlvbnMuDQoJCWFsd2F5c192aXNpYmxlID0gZmFsc2UsDQoJCXNraXBfb2Zmc2NyZWVuID0gdHJ1ZSwNCgkJbWF4X3JlbmRlcl9kaXN0YW5jZSA9IDgxOTIsDQoJCS0tIFBhcnRpY2xlIGV2ZW50IGNhbGxiYWNrcy4NCgkJb25fZnJhbWUgPSBuaWwsDQoJCW9uX3RpY2sgPSBuaWwsDQoJCW9uX2tpbGwgPSBuaWwsDQoJCW9uX2RlYWQgPSBuaWwsDQoJCS0tIFBhcnRpY2xlIGRlYXRoIHByb3BlcnRpZXMuDQoJCWZhZGVfdGltZSA9IDAsDQoJCWRlYXRoX3RpbWVyID0gdGltZXJfc3RhbmRhcmRfYy5uZXcoZmFsc2UpLA0KCQlhbHBoYV9hdF9kZWF0aCA9IG5pbCwNCgkJLS0gUGFydGljbGUtY2FtZXJhIHJlbGF0aW9uc2hpcCBwcm9wZXJ0aWVzLg0KCQlyZWxhdGlvbl9jYW1lcmFfZGlzdGFuY2UgPSAwLA0KCQktLSBSZW5kZXIuDQoJCXNjcmVlbl9kaW1lbnNpb25zID0gdmVjdG9yKDAsIDAsIDApDQoJfSwgaWxsdXNpb25fcGFydGljbGVfbXQpDQplbmQNCg0KLS0tIEtpbGwgdGhlIHBhcnRpY2xlLg0KLS0tIEBwYXJhbSBleHBlZGl0ZV9mYWRlX3RpbWUgYm9vbGVhbg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fcGFydGljbGVfYzpraWxsKGV4cGVkaXRlX2ZhZGVfdGltZSkNCgktLSBQYXJ0aWNsZSBoYXMgYWxyZWFkeSBiZWVuIGtpbGxlZC4NCglpZiAoc2VsZi5keWluZyA9PSB0cnVlKSB0aGVuDQoJCXJldHVybg0KCWVuZA0KDQoJLS0gRmFkZS1vdXQgY2FuIGJlIHVzZWQuDQoJaWYgKHNlbGYuZmFkZV90aW1lIH49IG5pbCBhbmQgc2VsZi5mYWRlX3RpbWUgPiAwKSB0aGVuDQoJCS0tIE1ha2UgdGhlIGZhZGUgb3V0IGZhc3Rlci4NCgkJaWYgKGV4cGVkaXRlX2ZhZGVfdGltZSA9PSB0cnVlKSB0aGVuDQoJCQlzZWxmLmZhZGVfdGltZSA9IHNlbGYuZmFkZV90aW1lIC8gMg0KCQllbmQNCg0KCQlzZWxmLmR5aW5nID0gdHJ1ZQ0KCQlzZWxmLmFscGhhX2F0X2RlYXRoID0gc2VsZi5zaGFkZXIuYQ0KDQoJCXNlbGYuZGVhdGhfdGltZXI6c3RhcnQoKQ0KCWVsc2UNCgkJc2VsZi5kZWFkID0gdHJ1ZQ0KCWVuZA0KDQoJLS0gRmlyZSBvbl9raWxsIGV2ZW50Lg0KCWlmIChzZWxmLm9uX2tpbGwgfj0gbmlsKSB0aGVuDQoJCXNlbGYub25fa2lsbChzZWxmKQ0KCWVuZA0KZW5kDQoNCi0tLSBLaWxsIHRoZSBwYXJ0aWNsZSBpZiBpdCBpcyBpbnZpc2libGUuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9wYXJ0aWNsZV9jOmtpbGxfaW52aXNpYmxlKCkNCglpZiAoc2VsZi5zaGFkZXIuYSA9PSAwKSB0aGVuDQoJCXNlbGYuZGVhZCA9IHRydWUNCgllbmQNCmVuZA0KDQotLS0gS2lsbCB0aGUgcGFydGljbGUgaWYgaXQgaXMgb2NjbHVkZWQuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9wYXJ0aWNsZV9jOmtpbGxfb2NjbHVkZWQoKQ0KCWlmIChzZWxmLm9jY2x1ZGVkID09IHRydWUpIHRoZW4NCgkJc2VsZi5kZWFkID0gdHJ1ZQ0KCWVuZA0KZW5kDQoNCi0tLSBLaWxsIHRoZSBwYXJ0aWNsZSBpZiBpdCBpcyBvZmYtc2NyZWVuLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fcGFydGljbGVfYzpraWxsX29mZnNjcmVlbigpDQoJaWYgKHNlbGYub25zY3JlZW4gPT0gZmFsc2UpIHRoZW4NCgkJc2VsZi5kZWFkID0gdHJ1ZQ0KCWVuZA0KZW5kDQoNCi0tLSBQcm9jZXNzIHBhcnRpY2xlIGZyYW1lLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fcGFydGljbGVfYzpwcm9jZXNzKCkNCgktLSBEZXRlcm1pbmUgYW5kIHVwZGF0ZSB0aGUgZGlzdGFuY2Ugb2YgcGFydGljbGUgdG8gdGhlIGNhbWVyYS4NCglzZWxmLnJlbGF0aW9uX2NhbWVyYV9kaXN0YW5jZSA9IHNlbGYub3JpZ2luOmRpc3RhbmNlKHNlbGYuc2hhcmVkLnBsYXllcl9jYW1lcmFfcG9zaXRpb24pDQoNCgktLSBQcm9jZXNzIHRoZSBsaWZlc3BhbiBvZiB0aGUgcGFydGljbGUuDQoJc2VsZjpwcm9jZXNzX2xpZmVzcGFuKCkNCg0KCS0tIFByb2Nlc3MgZGVhdGggaWYgdGhlIHBhcnRpY2xlIGlzIGRlYWQuDQoJc2VsZjpwcm9jZXNzX2RlYXRoKCkNCg0KCS0tIEZpcmUgb25fZnJhbWUgZXZlbnQuDQoJaWYgKHNlbGYub25fZnJhbWUgfj0gbmlsKSB0aGVuDQoJCXNlbGYub25fZnJhbWUoc2VsZikNCgllbmQNCg0KCS0tIFByb2Nlc3MgdGljayBmb3IgdGhpcyBmcmFtZS4NCglpZiAoc2VsZi5vbl90aWNrIH49IG5pbCBhbmQgc2VsZi5ob29rLnRpY2tfdGhpc19mcmFtZSA9PSB0cnVlKSB0aGVuDQoJCXNlbGYub25fdGljayhzZWxmKQ0KCWVuZA0KDQoJLS0gU2V0IHNjcmVlbiBwb3NpdGlvbiBvZiBwYXJ0aWNsZS4NCglzZWxmLnNjcmVlbl9kaW1lbnNpb25zID0gc2VsZi5vcmlnaW46dG9fc2NyZWVuKCkNCg0KCS0tIFNraXAgb2Zmc2NyZWVuIHBhcnRpY2xlcy4NCglpZiAoc2VsZi5za2lwX29mZnNjcmVlbiA9PSB0cnVlIGFuZCBzZWxmLnNjcmVlbl9kaW1lbnNpb25zIH49IG5pbCkgdGhlbg0KCQlpZiAoDQoJCQlzZWxmLnNjcmVlbl9kaW1lbnNpb25zLnggPCAwIG9yDQoJCQlzZWxmLnNjcmVlbl9kaW1lbnNpb25zLnggPiBzZWxmLnNoYXJlZC5yZXNvbHV0aW9uLnggb3INCgkJCXNlbGYuc2NyZWVuX2RpbWVuc2lvbnMueSA8IDAgb3INCgkJCXNlbGYuc2NyZWVuX2RpbWVuc2lvbnMueSA+IHNlbGYuc2hhcmVkLnJlc29sdXRpb24ueQ0KCQkpIHRoZW4NCgkJCXNlbGYuc2NyZWVuX2RpbWVuc2lvbnMgPSBuaWwNCgkJZW5kDQoJZW5kDQoNCgktLSBQYXJ0aWNsZSBpcyBub3Qgb25zY3JlZW4uDQoJaWYgKHNlbGYuc2NyZWVuX2RpbWVuc2lvbnMgPT0gbmlsKSB0aGVuDQoJCXNlbGYub25zY3JlZW4gPSBmYWxzZQ0KDQoJCXJldHVybg0KCWVsc2UNCgkJc2VsZi5vbnNjcmVlbiA9IHRydWUNCgllbmQNCg0KCS0tIFBhcnRpY2xlIGlzIGJleW9uZCB0aGUgbWF4aW11bSByZW5kZXIgZGlzdGFuY2UuDQoJaWYgKHNlbGYucmVsYXRpb25fY2FtZXJhX2Rpc3RhbmNlID4gc2VsZi5tYXhfcmVuZGVyX2Rpc3RhbmNlKSB0aGVuDQoJCXJldHVybg0KCWVuZA0KDQoJLS0gUGFydGljbGUgaXMgaW52aXNpYmxlLg0KCWlmIChzZWxmLnNoYWRlci5hID09IDApIHRoZW4NCgkJcmV0dXJuDQoJZW5kDQoNCgktLSBQcm9jZXNzIHZpc2NoZWNrLg0KCWlmIChzZWxmLmFsd2F5c192aXNpYmxlID09IHRydWUpIHRoZW4NCgkJc2VsZi5vY2NsdWRlZCA9IGZhbHNlDQoJZWxzZQ0KCQlpZiAoc2VsZi5zaW11bGF0aW9uLnZpc2NoZWNrX3RoaXNfZnJhbWUgPT0gdHJ1ZSkgdGhlbg0KCQkJc2VsZjpwcm9jZXNzX3Zpc2NoZWNrKCkNCgkJZW5kDQoJZW5kDQoNCgktLSBQYXJ0aWNsZSBpcyBvY2NsdWRlZC4NCglpZiAoc2VsZi5vY2NsdWRlZCA9PSB0cnVlKSB0aGVuDQoJCXJldHVybg0KCWVuZA0KDQoJLS0gUmVuZGVyIHBhcnRpY2xlLg0KCXNlbGY6cmVuZGVyKCkNCmVuZA0KDQotLS0gUHJvY2VzcyBwYXJ0aWNsZSB2aXNjaGVjay4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGlsbHVzaW9uX3BhcnRpY2xlX2M6cHJvY2Vzc192aXNjaGVjaygpDQoJbG9jYWwgdHJhY2VfZnJhY3Rpb24gPSAwDQoNCgktLSBQcm9jZXNzIHZpc2NoZWNrIGZvciBmaXJzdCBhbmQgdGhpcmRwZXJzb24uDQoJLS0gV2UgZG9uJ3Qgd2FudCB0byBpZ25vcmUgdGhlIGxvY2FsIHBsYXllciBpbiB0aGlyZHBlcnNvbi4NCglpZiAoc2VsZi5zaGFyZWQuaXNfdGhpcmRwZXJzb24gPT0gdHJ1ZSkgdGhlbg0KCQl0cmFjZV9mcmFjdGlvbiA9IHNlbGYuc2hhcmVkLnBsYXllcl9jYW1lcmFfcG9zaXRpb246dHJhY2VfbGluZV90byhzZWxmLm9yaWdpbikNCgllbHNlDQoJCXRyYWNlX2ZyYWN0aW9uID0gc2VsZi5zaGFyZWQucGxheWVyX2NhbWVyYV9wb3NpdGlvbjp0cmFjZV9saW5lX3RvKHNlbGYub3JpZ2luLCBzZWxmLnNoYXJlZC5wbGF5ZXJfZWlkKQ0KCWVuZA0KDQoJc2VsZi5vY2NsdWRlZCA9IHRyYWNlX2ZyYWN0aW9uIDwgMQ0KZW5kDQoNCi0tLSBQcm9jZXNzIHRoZSBwYXJ0aWNsZSdzIGxpZmVzcGFuLg0KLS0tIEBwcml2YXRlDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9wYXJ0aWNsZV9jOnByb2Nlc3NfbGlmZXNwYW4oKQ0KCS0tIFBhcnRpY2xlIGlzIGFscmVhZHkgZHlpbmcsIG9yIGhhcyBubyBsaWZlc3Bhbi4NCglpZiAoc2VsZi5keWluZyA9PSB0cnVlIG9yIHNlbGYubGlmZXNwYW4gPT0gbmlsKSB0aGVuDQoJCXJldHVybg0KCWVuZA0KDQoJLS0gS2lsbCB0aGUgcGFydGljbGUgb25jZSBpdCBoYXMgZXhwaXJlZC4NCglzZWxmLmxpZmVzcGFuX3RpbWVyOmV2ZW50KHNlbGYubGlmZXNwYW4sIGZ1bmN0aW9uKCkNCgkJc2VsZjpraWxsKCkNCgllbmQpDQplbmQNCg0KLS0tIEZhZGUgdGhlIHBhcnRpY2xlIG91dCBpZiBpdCBpcyBkeWluZy4NCi0tLSBAcHJpdmF0ZQ0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fcGFydGljbGVfYzpwcm9jZXNzX2RlYXRoKCkNCgktLSBQYXJ0aWNsZSBpcyBub3QgeWV0IGR5aW5nLg0KCWlmIChzZWxmLmR5aW5nID09IGZhbHNlKSB0aGVuDQoJCXJldHVybg0KCWVuZA0KDQoJLS0gS2lsbCB0aGUgcGFydGljbGUgb25jZSBpdCBoYXMgZmluaXNoZWQgZHlpbmcuDQoJc2VsZi5kZWF0aF90aW1lcjpldmVudChzZWxmLmZhZGVfdGltZSwgZnVuY3Rpb24oKQ0KCQlzZWxmLmRlYWQgPSB0cnVlDQoNCgkJcmV0dXJuDQoJZW5kKQ0KDQoJLS0gRmFkZSBvdXQgdGhlIHBhcnRpY2xlIGxpbmVhciB0byB0aGUgZGVhdGggdGltZXIuDQoJc2VsZi5zaGFkZXIuYSA9IHNlbGYuYWxwaGFfYXRfZGVhdGggKiAoMCAtIChzZWxmLmRlYXRoX3RpbWVyKCkgLSBzZWxmLmZhZGVfdGltZSkgLyBzZWxmLmZhZGVfdGltZSkNCmVuZA0KDQotLS0gUmVuZGVyIHRoZSBwYXJ0aWNsZS4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGlsbHVzaW9uX3BhcnRpY2xlX2M6cmVuZGVyKCkNCgktLSBTeW5jaHJvbmlzZSB0aGUgc2hhZGVyJ3MgUkdCL0hTTCBjb2xvdXIgc3BhY2VzLg0KCXNlbGYuc2hhZGVyOnVwZGF0ZV9zcGFjZXMoKQ0KDQoJLS0gUmVuZGVyIHRoZSBwYXJ0aWNsZS4NCglpbGx1c2lvbl9yZW5kZXJlcl9jW3NlbGYudHlwZV0oc2VsZikNCmVuZA0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gaWxsdXNpb25fc2hhcmVkDQotLS0gQGNsYXNzIGlsbHVzaW9uX3NoYXJlZF9jDQotLS0gQGZpZWxkIHB1YmxpYyBwbGF5ZXJfZWlkIG51bWJlciBQbGF5ZXIgZW50aXR5IGluZGV4Lg0KLS0tIEBmaWVsZCBwdWJsaWMgaXNfdGhpcmRwZXJzb24gYm9vbGVhbiBQbGF5ZXIgaXMgaW4gdGhpcmRwZXJzb24uDQotLS0gQGZpZWxkIHB1YmxpYyBpc19kZWFkIGJvb2xlYW4gUGxheWVyIGlzIGRlYWQuDQotLS0gQGZpZWxkIHB1YmxpYyBpc19zY29wZWQgYm9vbGVhbiBQbGF5ZXIgaXMgc2NvcGVkIGluLg0KLS0tIEBmaWVsZCBwdWJsaWMgaXNfZmFrZV9kdWNraW5nIGJvb2xlYW4gUGxheWVyIGlzIGZha2UgZHVja2luZy4NCi0tLSBAZmllbGQgcHVibGljIHBsYXllcl9vcmlnaW4gdmVjdG9yX29sZF9jIFBsYXllciBhYnNvbHV0ZSBvcmlnaW4uDQotLS0gQGZpZWxkIHB1YmxpYyBwbGF5ZXJfZXllX3Bvc2l0aW9uIHZlY3Rvcl9vbGRfYyBQbGF5ZXIgZXllIHBvc2l0aW9uLg0KLS0tIEBmaWVsZCBwdWJsaWMgcGxheWVyX2NhbWVyYV9wb3NpdGlvbiB2ZWN0b3Jfb2xkX2MgUGxheWVyIGNhbWVyYSBwb3NpdGlvbi4NCi0tLSBAZmllbGQgcHVibGljIHBsYXllcl9jYW1lcmFfYW5nbGVzIGFuZ2xlX29sZF9jIFBsYXllciBjYW1lcmEgYW5nbGVzLg0KLS0tIEBmaWVsZCBwdWJsaWMgcGxheWVyX3NwZWVkIG51bWJlciBQbGF5ZXIgc3BlZWQgKG1hZ25pdHVkZSBvZiBtX3ZlY1ZlbG9jaXR5KS4NCi0tLSBAZmllbGQgcHVibGljIHBsYXllcl92ZWxvY2l0eSB2ZWN0b3Jfb2xkX2MgUGxheWVyIHZlY3RvciB2ZWxvY2l0eSAobV92ZWNWZWxvY2l0eSkuDQotLS0gQGZpZWxkIHB1YmxpYyByZXNvbHV0aW9uIHZlY3Rvcl9vbGRfYyBTY3JlZW4gcmVzb2x1dGlvbi4NCi0tLSBAZmllbGQgcHVibGljIGNhbWVyYV9hc3BlY3QgbnVtYmVyIENhbWVyYSBhc3BlY3QuDQotLS0gQGZpZWxkIHB1YmxpYyBmb3YgbnVtYmVyIENhbWVyYSBmaWVsZCBvZiB2aWV3Lg0KLS0tIEBmaWVsZCBwdWJsaWMgc2NvcGVfZm92IG51bWJlciBDYW1lcmEgc2NvcGVkIGZpZWxkIG9mIHZpZXcuDQotLS0gQGZpZWxkIHB1YmxpYyBzY29wZV9sZXZlbCBib29sZWFuIFBsYXllciBzY29wZSBsZXZlbC4NCi0tLSBAZmllbGQgcHVibGljIHpvb21fbW9kaWZpZXIgbnVtYmVyIEdhbWVzZW5zZSB6b29tIG1vZGlmaWVyLg0KLS0tIEBmaWVsZCBwdWJsaWMgb2JzZXJ2ZXJfZWlkIG51bWJlciBPYnNlcnZlciBlbnRpdHkgaW5kZXguDQotLS0gQGZpZWxkIHB1YmxpYyBvYnNlcnZlcl9tb2RlIG51bWJlciBPYnNlcnZlciBtb2RlLiAwID0gQWxpdmUsIDEgPSBEZWF0aCBjYW0sIDIgPSBGcmVlemUgY2FtLCAzID0gRml4ZWQgY2FtLCA0ID0gRmlyc3QgcGVyc29uIHNwZWN0YXRvciwgNSA9IFRoaXJkIHBlcnNvbiBzcGVjdGF0b3IsIDYgPSBGcmVlIG1vZGUuDQotLS0gQGZpZWxkIHB1YmxpYyBvYnNlcnZpbmdfdGVhbSBudW1iZXIgVGhlIHRlYW0gdGhlIHBsYXllciBpcyBvbiBvciBzcGVjdGF0aW5nLg0KLS0tIEBmaWVsZCBwdWJsaWMgb2JzZXJ2aW5nX3NlbGYgYm9vbGVhbiBQbGF5ZXIgaXMgb2JzZXJ2aW5nIHRoZW1zZWxmLg0KbG9jYWwgaWxsdXNpb25fc2hhcmVkX2MgPSB7fQ0KbG9jYWwgaWxsdXNpb25fc2hhcmVkX210ID0geyBfX2luZGV4ID0gaWxsdXNpb25fc2hhcmVkX2MgfQ0KDQotLS0gSW5zdGFudGlhdGUgYW4gb2JqZWN0IG9mIHNoYXJlZF9jLg0KLS0tIEByZXR1cm4gaWxsdXNpb25fc2hhcmVkX2MNCmZ1bmN0aW9uIGlsbHVzaW9uX3NoYXJlZF9jLm5ldygpDQoJcmV0dXJuIHNldG1ldGF0YWJsZSh7DQoJCS0tIFBsYXllciBnZW5lcmFsLg0KCQlwbGF5ZXJfZWlkID0gbmlsLA0KCQktLSBQbGF5ZXIgc3RhdGVzLg0KCQlpc190aGlyZHBlcnNvbiA9IG5pbCwNCgkJaXNfZGVhZCA9IG5pbCwNCgkJaXNfc2NvcGVkID0gbmlsLA0KCQlpc19mYWtlX2R1Y2tpbmcgPSBuaWwsDQoJCS0tIFBsYXllciB2ZWN0b3JzLCBhbmdsZXMsIGFuZCBtb3Rpb24uDQoJCXBsYXllcl9vcmlnaW4gPSB2ZWN0b3IoMCwgMCwgMCksDQoJCXBsYXllcl9leWVfcG9zaXRpb24gPSB2ZWN0b3IoMCwgMCwgMCksDQoJCXBsYXllcl9jYW1lcmFfcG9zaXRpb24gPSB2ZWN0b3IoMCwgMCwgMCksDQoJCXBsYXllcl9jYW1lcmFfYW5nbGVzID0gYW5nbGUoMCwgMCwgMCksDQoJCXBsYXllcl9zcGVlZCA9IG5pbCwNCgkJcGxheWVyX3ZlbG9jaXR5ID0gdmVjdG9yKDAsIDAsIDApLA0KCQktLSBTY3JlZW4uDQoJCXJlc29sdXRpb24gPSB2ZWN0b3IoMCwgMCwgMCksDQoJCWNhbWVyYV9hc3BlY3QgPSBuaWwsDQoJCWZvdiA9IG5pbCwNCgkJc2NvcGVfZm92ID0gbmlsLA0KCQlzY29wZV9sZXZlbCA9IG5pbCwNCgkJem9vbV9tb2RpZmllciA9IG5pbCwNCgkJLS0gT2JzZXJ2ZXIuDQoJCW9ic2VydmVyX2VpZCA9IG5pbCwNCgkJb2JzZXJ2ZXJfbW9kZSA9IG5pbCwNCgkJb2JzZXJ2aW5nX3RlYW0gPSBuaWwsDQoJCW9ic2VydmluZ19zZWxmID0gbmlsLA0KCX0sIGlsbHVzaW9uX3NoYXJlZF9tdCkNCmVuZA0KDQotLS0gVXBkYXRlcyBhbGwgc2hhcmVkIHByb3BlcnRpZXMgZnJvbSB0aGUgZ2FtZS4NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGlsbHVzaW9uX3NoYXJlZF9jOnN5bmMoKQ0KCS0tIFVwZGF0ZSBwbGF5ZXIgZW50aXR5IGluZGV4Lg0KCXNlbGYucGxheWVyX2VpZCA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkNCg0KCS0tIFBsYXllciBpcyBmYWtlIGR1Y2tpbmcuDQoJc2VsZi5pc19mYWtlX2R1Y2tpbmcgPSB1aS5nZXQodWkucmVmZXJlbmNlKCJyYWdlIiwgIm90aGVyIiwgImR1Y2sgcGVlayBhc3Npc3QiKSkNCg0KCS0tIFBsYXllciBhYnNvbHV0ZSBvcmlnaW4uDQoJc2VsZi5wbGF5ZXJfb3JpZ2luKGVudGl0eS5nZXRfcHJvcChzZWxmLnBsYXllcl9laWQsICJtX3ZlY0Fic09yaWdpbiIpKQ0KDQoJLS0gQ29ycmVjdCBmb3IgZmFrZSBkdWNraW5nIGluIGV5ZSBwb3NpdGlvbiB2ZWN0b3IuDQoJaWYgKHNlbGYuaXNfZmFrZV9kdWNraW5nID09IHRydWUpIHRoZW4NCgkJc2VsZi5wbGF5ZXJfZXllX3Bvc2l0aW9uID0gc2VsZi5wbGF5ZXJfb3JpZ2luOmNsb25lX29mZnNldCgwLCAwLCA0NikNCgllbHNlDQoJCXNlbGYucGxheWVyX2V5ZV9wb3NpdGlvbihjbGllbnQuZXllX3Bvc2l0aW9uKCkpDQoJZW5kDQoNCgktLSBVcGRhdGUgY2FtZXJhIHBvc2l0aW9uLg0KCXNlbGYucGxheWVyX2NhbWVyYV9wb3NpdGlvbihjbGllbnQuY2FtZXJhX3Bvc2l0aW9uKCkpDQoNCgktLSBVcGRhdGUgY2FtZXJhIGFuZ2xlcy4NCglzZWxmLnBsYXllcl9jYW1lcmFfYW5nbGVzKGNsaWVudC5jYW1lcmFfYW5nbGVzKCkpDQoNCgktLSBVcGRhdGUgcGxheWVyIHZlbG9jaXR5Lg0KCXNlbGYucGxheWVyX3ZlbG9jaXR5KGVudGl0eS5nZXRfcHJvcChzZWxmLnBsYXllcl9laWQsICJtX3ZlY1ZlbG9jaXR5IikpDQoNCgktLSBVcGRhdGUgcGxheWVyIHNwZWVkLg0KCXNlbGYucGxheWVyX3NwZWVkID0gc2VsZi5wbGF5ZXJfdmVsb2NpdHk6bWFnbml0dWRlKCkNCg0KCS0tIENvbXBlbnNhdGUgZm9yIGZha2UgZHVja2luZy4NCglpZiAoc2VsZi5pc19mYWtlX2R1Y2tpbmcgPT0gdHJ1ZSkgdGhlbg0KCQlsb2NhbCBfLCB0aGlyZHBlcnNvbl9ob3RrZXkgPSB1aS5yZWZlcmVuY2UoInZpc3VhbHMiLCAiZWZmZWN0cyIsICJGb3JjZSB0aGlyZCBwZXJzb24gKGFsaXZlKSIpDQoNCgkJc2VsZi5pc190aGlyZHBlcnNvbiA9IHVpLmdldCh0aGlyZHBlcnNvbl9ob3RrZXkpDQoJZWxzZQ0KCQktLSBVcGRhdGUgaXMgdGhpcmRwZXJzb24uDQoJCXNlbGYuaXNfdGhpcmRwZXJzb24gPSBzZWxmLnBsYXllcl9leWVfcG9zaXRpb246ZGlzdGFuY2Uoc2VsZi5wbGF5ZXJfY2FtZXJhX3Bvc2l0aW9uKSA+IDUNCgllbmQNCg0KCS0tIFVwZGF0ZSByZXNvbHV0aW9uLg0KCXNlbGYucmVzb2x1dGlvbihjbGllbnQuc2NyZWVuX3NpemUoKSkNCg0KCS0tIFVwZGF0ZSBjYW1lcmEgYXNwZWN0Lg0KCXNlbGYuY2FtZXJhX2FzcGVjdCA9IHNlbGYucmVzb2x1dGlvbi54IC8gc2VsZi5yZXNvbHV0aW9uLnkNCg0KCS0tIFVwZGF0ZSBmaWVsZCBvZiB2aWV3Lg0KCXNlbGYuZm92ID0gdWkuZ2V0KHVpLnJlZmVyZW5jZSgibWlzYyIsICJtaXNjZWxsYW5lb3VzIiwgIm92ZXJyaWRlIGZvdiIpKQ0KDQoJLS0gVXBkYXRlIHNjb3BlZCBmaWVsZCBvZiB2aWV3Lg0KCXNlbGYuc2NvcGVfZm92ID0gZW50aXR5LmdldF9wcm9wKHNlbGYucGxheWVyX2VpZCwgIm1faUZPViIpDQoNCgktLSBDb3JyZWN0IHVuc2NvcGVkIGZpZWxkIG9mIHZpZXcuDQoJaWYgKHNlbGYuc2NvcGVfZm92ID09IDAgb3Igc2VsZi5zY29wZV9mb3YgPT0gOTApIHRoZW4NCgkJc2VsZi5zY29wZV9mb3YgPSBzZWxmLmZvdg0KCWVuZA0KDQoJLS0gVXBkYXRlIGlzIHNjb3BlZC4NCglzZWxmLmlzX3Njb3BlZCA9IGVudGl0eS5nZXRfcHJvcChzZWxmLnBsYXllcl9laWQsICJtX2JJc1Njb3BlZCIpID09IDEgYW5kIHRydWUgb3IgZmFsc2UNCg0KCS0tIFVwZGF0ZSBzY29wZSBsZXZlbC4NCglzZWxmLnNjb3BlX2xldmVsID0gMA0KDQoJLS0gU2V0IHNjb3BlIGxldmVscy4NCglpZiAoc2VsZi5pc19zY29wZWQgPT0gdHJ1ZSBhbmQgc2VsZi5zY29wZV9mb3YgPT0gNDApIHRoZW4NCgkJc2VsZi5zY29wZV9sZXZlbCA9IDENCgllbHNlaWYgKHNlbGYuaXNfc2NvcGVkID09IHRydWUgYW5kIHNlbGYuc2NvcGVfZm92ID09IDE1KSB0aGVuDQoJCXNlbGYuc2NvcGVfbGV2ZWwgPSAyDQoJZW5kDQoNCgktLSBVcGRhdGUgem9vbSBtb2RpZmllci4NCglzZWxmLnpvb21fbW9kaWZpZXIgPSB1aS5nZXQodWkucmVmZXJlbmNlKCJtaXNjIiwgIm1pc2NlbGxhbmVvdXMiLCAib3ZlcnJpZGUgem9vbSBmb3YiKSkNCg0KCS0tIFVwZGF0ZSBvYnNlcnZlciBtb2RlLg0KCXNlbGYub2JzZXJ2ZXJfbW9kZSA9IGVudGl0eS5nZXRfcHJvcChzZWxmLnBsYXllcl9laWQsICJtX2lPYnNlcnZlck1vZGUiKQ0KDQoJLS0gR2V0IHRoZSBvYnNlcnZlciB0YXJnZXQuIERlZmF1bHQgdG8gbG9jYWwgcGxheWVyIHVubGVzcyB0aGV5IGFyZSBzcGVjdGF0aW5nLg0KCWxvY2FsIG9ic2VydmVyX3RhcmdldCA9IHNlbGYucGxheWVyX2VpZA0KDQoJLS0gUGxheWVyIGlzIHZpZXdpbmcgdGhlbXNlbHZlcy4NCglsb2NhbCBvYnNlcnZpbmdfc2VsZiA9IHRydWUNCg0KCS0tIFNldCB0aGUgb2JzZXJ2ZXIgdGFyZ2V0IHRvIHRoZSBzcGVjdGF0ZWQgcGxheWVyLg0KCWlmIChzZWxmLm9ic2VydmVyX21vZGUgPT0gNCBvciBzZWxmLm9ic2VydmVyX21vZGUgPT0gNSkgdGhlbg0KCQlvYnNlcnZlcl90YXJnZXQgPSBlbnRpdHkuZ2V0X3Byb3Aoc2VsZi5wbGF5ZXJfZWlkLCAibV9oT2JzZXJ2ZXJUYXJnZXQiKQ0KCQlvYnNlcnZpbmdfc2VsZiA9IGZhbHNlDQoNCgkJLS0gRml4IGV5ZSBwb3MuDQoJCWxvY2FsIHgsIHksIHogPSBlbnRpdHkuZ2V0X3Byb3Aob2JzZXJ2ZXJfdGFyZ2V0LCAibV92ZWNBYnNPcmlnaW4iKQ0KDQoJCWlmICh4IH49IG5pbCkgdGhlbg0KCQkJbG9jYWwgZHVja19hbW91bnQgPSBlbnRpdHkuZ2V0X3Byb3Aoc2VsZi5wbGF5ZXJfZWlkLCAibV9mbER1Y2tBbW91bnQiKQ0KDQoJCQl6ID0geiArICg0NiArICgxIC0gZHVja19hbW91bnQpICogMTgpDQoNCgkJCXNlbGYucGxheWVyX2V5ZV9wb3NpdGlvbih4LCB5LCB6KQ0KCQkJc2VsZi5wbGF5ZXJfb3JpZ2luKGVudGl0eS5nZXRfcHJvcChvYnNlcnZlcl90YXJnZXQsICJtX3ZlY0Fic09yaWdpbiIpKQ0KCQkJc2VsZi5wbGF5ZXJfdmVsb2NpdHkoZW50aXR5LmdldF9wcm9wKG9ic2VydmVyX3RhcmdldCwgIm1fdmVjVmVsb2NpdHkiKSkNCg0KCQkJc2VsZi5wbGF5ZXJfc3BlZWQgPSBzZWxmLnBsYXllcl92ZWxvY2l0eTptYWduaXR1ZGUoKQ0KCQllbmQNCgllbmQNCg0KCS0tIFNldCBvYnNlcnZpbmcgc2VsZi4NCglzZWxmLm9ic2VydmluZ19zZWxmID0gb2JzZXJ2aW5nX3NlbGYNCg0KCS0tIEdldCB0aGUgb2JzZXJ2ZXIgdGVhbS4NCglsb2NhbCBvYnNlcnZlcl90ZWFtID0gZW50aXR5LmdldF9wcm9wKG9ic2VydmVyX3RhcmdldCwgIm1faVRlYW1OdW0iKQ0KDQoJLS0gU2V0IHRoZSBzaGFyZWQgb2JzZXJ2ZXIgdGFyZ2V0Lg0KCXNlbGYub2JzZXJ2ZXJfZWlkID0gb2JzZXJ2ZXJfdGFyZ2V0DQoNCgktLSBTZXQgdGhlIHNoYXJlZCBvYnNlcnZlciB0ZWFtLg0KCXNlbGYub2JzZXJ2aW5nX3RlYW0gPSBvYnNlcnZlcl90ZWFtDQoNCgktLSBVcGRhdGUgaXMgZGVhZC4NCglzZWxmLmlzX2RlYWQgPSBzZWxmLm9ic2VydmVyX21vZGUgfj0gMA0KZW5kDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBpbGx1c2lvbl9zaW11bGF0aW9uDQotLS0gQGNsYXNzIGlsbHVzaW9uX3NpbXVsYXRpb25fYw0KLS0tIEBmaWVsZCBwdWJsaWMgZnJhbWV0aW1lIG51bWJlciBTaW11bGF0aW9uIGN1cnJlbnQgZnJhbWV0aW1lLg0KLS0tIEBmaWVsZCBwdWJsaWMgZGVsdGEgbnVtYmVyIFNpbXVsYXRpb24gZnJhbWUgZGlmZmVyZW5jZS4NCi0tLSBAZmllbGQgcHVibGljIGZyYW1lIG51bWJlciBTaW11bGF0aW9uIGN1cnJlbnQgZnJhbWUuDQotLS0gQGZpZWxkIHB1YmxpYyBmcHMgZnBzX2MgU2ltdWxhdGlvbiBGUFMuDQotLS0gQGZpZWxkIHB1YmxpYyB2aXNjaGVja19pbnRlcnZhbCBudW1iZXIgVHJhY2UgbGluZSBpbnRlcnZhbC4NCi0tLSBAZmllbGQgcHVibGljIHZpc2NoZWNrX3RoaXNfZnJhbWUgYm9vbGVhbiBQZXJmb3JtIHRyYWNlIGxpbmVzIHRoaXMgZnJhbWUuDQpsb2NhbCBpbGx1c2lvbl9zaW11bGF0aW9uX2MgPSB7fQ0KbG9jYWwgaWxsdXNpb25fc2ltdWxhdGlvbl9tdCA9IHsgX19pbmRleCA9IGlsbHVzaW9uX3NpbXVsYXRpb25fYyB9DQoNCi0tLSBJbnN0YW50aWF0ZSBhbiBvYmplY3Qgb2YgaWxsdXNpb25fc2ltdWxhdGlvbl9jLg0KLS0tIEByZXR1cm4gaWxsdXNpb25fc2ltdWxhdGlvbl9jDQpmdW5jdGlvbiBpbGx1c2lvbl9zaW11bGF0aW9uX2MubmV3KCkNCglyZXR1cm4gc2V0bWV0YXRhYmxlKHsNCgkJZnJhbWV0aW1lID0gMCwNCgkJZGVsdGEgPSAwLA0KCQlmcmFtZSA9IDAsDQoJCWZwcyA9IGZwc19jLm5ldygpLA0KCQl2aXNjaGVja19pbnRlcnZhbCA9IDAsDQoJCXZpc2NoZWNrX3RoaXNfZnJhbWUgPSBuaWwNCgl9LCBpbGx1c2lvbl9zaW11bGF0aW9uX210KQ0KZW5kDQoNCi0tLSBVcGRhdGUgc2ltdWxhdGlvbiBwcm9wZXJ0aWVzLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fc2ltdWxhdGlvbl9jOnN5bmMoKQ0KCXNlbGYuZnJhbWV0aW1lID0gZ2xvYmFscy5hYnNvbHV0ZWZyYW1ldGltZSgpDQoJc2VsZi5kZWx0YSA9IGdsb2JhbHMuYWJzb2x1dGVmcmFtZXRpbWUoKSAqIDEwMA0KCXNlbGYuZnJhbWUgPSBzZWxmLmZyYW1lICsgMQ0KDQoJc2VsZjp1cGRhdGVfdmlzY2hlY2soKQ0KZW5kDQoNCi0tLSBVcGRhdGUgdmlzY2hlY2sgcHJvcGVydGllcy4NCi0tLQ0KLS0tIEF0IGhpZ2hlciBGUFMgdGhpcyB3aWxsIGNhdXNlIHBhcnRpY2xlcyB0byBza2lwIGRvaW5nIHZpc2NoZWNraW5nIG1vcmUgb2Z0ZW4uDQotLS0gVGhpcyBpcyBwb3RlbnRpYWxseSB0aGUgc3R1cGlkZXN0IEZQUyBvcHRpbWl6YXRpb24gaW4gdGhpcyBwcm9qZWN0LiBJdCBpcyBsaXRlcmFsbHkgZGVzaWduZWQgdG8gbWFrZQ0KLS0tIHlvdXIgRlBTIHdvcnNlIHRoZSBsb3dlciB5b3VyIEZQUyBnZXRzLiBIb3dldmVyIGl0IGFsc28gd29ya3Mgd29uZGVyZnVsbHkuDQotLS0NCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGlsbHVzaW9uX3NpbXVsYXRpb25fYzp1cGRhdGVfdmlzY2hlY2soKQ0KCS0tIERldGVybWluZSB0aGUgaW50ZXJ2YWwgYXQgd2hpY2ggdG8gcHJvY2VzcyB2aXNjaGVja2luZy4NCglsb2NhbCB2aXNjaGVja19pbnRlcnZhbCA9IG1hdGgubWF4KDEsIG1hdGguZmxvb3Ioc2VsZi5mcHMoKSAvIDY2KSkNCg0KCS0tIFVwZGF0ZSBpbnRlcnZhbC4NCglzZWxmLnZpc2NoZWNrX2ludGVydmFsID0gdmlzY2hlY2tfaW50ZXJ2YWwNCg0KCS0tIFVwZGF0ZSB3aGV0aGVyIHZpc2NoZWNraW5nIG9jY3VycyBvbiB0aGUgY3VycmVudCBmcmFtZS4NCglzZWxmLnZpc2NoZWNrX3RoaXNfZnJhbWUgPSBzZWxmLmZyYW1lICUgdmlzY2hlY2tfaW50ZXJ2YWwgPT0gMA0KZW5kDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBpbGx1c2lvbl9wYXJ0aWNsZV9tYW5hZ2VyDQotLS0gQGNsYXNzIGlsbHVzaW9uX3BhcnRpY2xlX21hbmFnZXJfYw0KLS0tIEBmaWVsZCBwdWJsaWMgcGFydGljbGVzIHRhYmxlPG51bWJlciwgaWxsdXNpb25fcGFydGljbGVfYz4gUGFydGljbGUgdGFibGUuDQotLS0gQGZpZWxkIHB1YmxpYyB0b3RhbF9zcGF3bmVkIG51bWJlciBUb3RhbCBwYXJ0aWNsZXMgc3Bhd25lZC4NCi0tLSBAZmllbGQgcHVibGljIHRvdGFsX2FsaXZlIG51bWJlciBUb3RhbCBwYXJ0aWNsZXMgYWxpdmUuDQotLS0gQGZpZWxkIHB1YmxpYyBzb2Z0X2xpbWl0IG51bWJlciBMaW1pdCBvZiBwYXJ0aWNsZXMgKGtpbGwgcGFydGljbGVzIHdpdGggZmFkZV90aW1lKS4NCi0tLSBAZmllbGQgcHVibGljIGhhcmRfbGltaXQgbnVtYmVyIEhhcmQgbGltaXQgb2YgcGFydGljbGVzIChwcmV2ZW50cyBzcGF3bmluZywgZG9lcyBub3QgcmVzcGVjdCBmYWRlX3RpbWUpLg0KLS0tIEBmaWVsZCBwdWJsaWMgdW5jdWxsZWQgbnVtYmVyIFRoZSBudW1iZXIgb2YgcGFydGljbGVzIHRoaXMgZnJhbWUgdGhhdCBhcmUgbm90IGN1bGxlZC4NCmxvY2FsIGlsbHVzaW9uX3BhcnRpY2xlX21hbmFnZXJfYyA9IHt9DQpsb2NhbCBpbGx1c2lvbl9wYXJ0aWNsZV9tYW5hZ2VyX210ID0geyBfX2luZGV4ID0gaWxsdXNpb25fcGFydGljbGVfbWFuYWdlcl9jIH0NCg0KLS0tIEluc3RhbnRpYXRlIGFuIG9iamVjdCBvZiBwYXJ0aWNsZV9tYW5hZ2VyX2MuDQotLS0gQHJldHVybiBpbGx1c2lvbl9wYXJ0aWNsZV9tYW5hZ2VyX2MNCmZ1bmN0aW9uIGlsbHVzaW9uX3BhcnRpY2xlX21hbmFnZXJfYy5uZXcoKQ0KCXJldHVybiBzZXRtZXRhdGFibGUoew0KCQlwYXJ0aWNsZXMgPSB7fSwNCgkJdG90YWxfc3Bhd25lZCA9IDAsDQoJCXRvdGFsX2FsaXZlID0gMCwNCgkJdW5jdWxsZWQgPSAwLA0KCQlzb2Z0X2xpbWl0ID0gNTEyLA0KCQloYXJkX2xpbWl0ID0gMTAyNCwNCgkJY3VsbF9uZXh0X3BhcnRpY2xlID0gZmFsc2UsDQoJCWN1bGxfcGFydGljbGVfbW9kZSA9IDANCgl9LCBpbGx1c2lvbl9wYXJ0aWNsZV9tYW5hZ2VyX210KQ0KZW5kDQoNCi0tLSBQcm9jZXNzIHBhcnRpY2xlcyBmb3IgdGhlIGN1cnJlbnQgZnJhbWUuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9wYXJ0aWNsZV9tYW5hZ2VyX2M6cHJvY2VzcygpDQoJLS0gTnVtYmVyIG9mIGFsaXZlIHBhcnRpY2xlcyB0aGlzIGZyYW1lLg0KCWxvY2FsIHVuY3VsbGVkID0gc2VsZi50b3RhbF9hbGl2ZQ0KDQoJLS0gQWdlLWFzY2VuZGluZyBvcmRlcmVkIHBhcnRpY2xlIHByb2Nlc3NpbmcgZm9yIGN1bGxpbmcgcGFydGljbGVzLg0KCWZvciBfLCBwYXJ0aWNsZSBpbiBwYWlycyhzZWxmOm9yZGVyX2Zvcl9jdWxsaW5nKCkpIGRvDQoJCWlmICh1bmN1bGxlZCA+IHNlbGYuaGFyZF9saW1pdCkgdGhlbg0KCQkJLS0gUGFydGljbGUgbXVzdCBiZSByZW1vdmVkIGltbWVkaWF0ZWx5Lg0KCQkJc2VsZjpyZW1vdmUocGFydGljbGUpDQoNCgkJCXVuY3VsbGVkID0gdW5jdWxsZWQgLSAxDQoJCWVsc2VpZiAodW5jdWxsZWQgPiBzZWxmLnNvZnRfbGltaXQpIHRoZW4NCgkJCS0tIFBhcnRpY2xlIG1heSBiZSBraWxsZWQgaW4gdGhlIHN0YW5kYXJkIHdheS4NCgkJCS0tIEV4cGVkaXRlIHRoZSBmYWRlLW91dCB0aW1lIGZvciB0aGUgcGFydGljbGUgdG8gaW1wcm92ZSBwZXJmb3JtYW5jZS4NCgkJCXBhcnRpY2xlOmtpbGwodHJ1ZSkNCg0KCQkJdW5jdWxsZWQgPSB1bmN1bGxlZCAtIDENCgkJZW5kDQoJZW5kDQoNCgktLSBEaXN0YW5jZS1kZXNjZW5kaW5nIG9yZGVyZWQgcGFydGljbGUgcHJvY2Vzc2luZyBmb3IgcmVuZGVyaW5nIHBhcnRpY2xlcy4NCglmb3IgXywgcGFydGljbGUgaW4gcGFpcnMoc2VsZjpvcmRlcl9mb3JfcmVuZGVyaW5nKCkpIGRvDQoJCWlmIChwYXJ0aWNsZS5kZWFkID09IHRydWUpIHRoZW4NCgkJCS0tIFBhcnRpY2xlIGlzIGRlYWQgYW5kIHNob3VsZCBiZSByZW1vdmVkIHRoaXMgZnJhbWUuDQoJCQlzZWxmOnJlbW92ZShwYXJ0aWNsZSkNCgkJZWxzZQ0KCQkJLS0gUHJvY2VzcyBhbmQgcmVuZGVyIHRoZSBwYXJ0aWNsZS4NCgkJCXBhcnRpY2xlOnByb2Nlc3MoKQ0KCQllbmQNCgllbmQNCmVuZA0KDQotLS0gQWRkIGEgcGFydGljbGUuDQotLS0gQHBhcmFtIHBhcnRpY2xlIGlsbHVzaW9uX3BhcnRpY2xlX2MNCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGlsbHVzaW9uX3BhcnRpY2xlX21hbmFnZXJfYzphZGQocGFydGljbGUpDQoJc2VsZi5wYXJ0aWNsZXNbcGFydGljbGUuaWRdID0gcGFydGljbGUNCglzZWxmLnRvdGFsX3NwYXduZWQgPSBzZWxmLnRvdGFsX3NwYXduZWQgKyAxDQoJc2VsZi50b3RhbF9hbGl2ZSA9IHNlbGYudG90YWxfYWxpdmUgKyAxDQoNCglwYXJ0aWNsZS5ob29rOmFkZChwYXJ0aWNsZSkNCmVuZA0KDQotLS0gUmVtb3ZlIHRoZSBwYXJ0aWNsZS4NCi0tLSBAcGFyYW0gcGFydGljbGUgaWxsdXNpb25fcGFydGljbGVfYw0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fcGFydGljbGVfbWFuYWdlcl9jOnJlbW92ZShwYXJ0aWNsZSkNCglzZWxmLnBhcnRpY2xlc1twYXJ0aWNsZS5pZF0gPSBuaWwNCglzZWxmLnRvdGFsX2FsaXZlID0gc2VsZi50b3RhbF9hbGl2ZSAtIDENCgkNCglwYXJ0aWNsZS5ob29rOnJlbW92ZShwYXJ0aWNsZSkNCmVuZA0KDQotLS0gUmV0dXJucyBhbGwgcGFydGljbGVzIG9yZGVyZWQgYnkgZmFydGhlc3QtY2xvc2VzdC4NCi0tLSBAcmV0dXJuIHRhYmxlPG51bWJlciwgaWxsdXNpb25fcGFydGljbGVfYz4NCmZ1bmN0aW9uIGlsbHVzaW9uX3BhcnRpY2xlX21hbmFnZXJfYzpvcmRlcl9mb3JfcmVuZGVyaW5nKCkNCglsb2NhbCBvcmRlcmVkID0ge30NCg0KCWZvciBfLCBwYXJ0aWNsZSBpbiBzcGFpcnMoc2VsZi5wYXJ0aWNsZXMsIGZ1bmN0aW9uKHBhcnRpY2xlcywgYSwgYikNCgkJcmV0dXJuIHBhcnRpY2xlc1tiXS5yZWxhdGlvbl9jYW1lcmFfZGlzdGFuY2UgPCBwYXJ0aWNsZXNbYV0ucmVsYXRpb25fY2FtZXJhX2Rpc3RhbmNlDQoJZW5kKSBkbw0KCQl0YWJsZS5pbnNlcnQob3JkZXJlZCwgcGFydGljbGUpDQoJZW5kDQoNCglyZXR1cm4gb3JkZXJlZA0KZW5kDQoNCi0tLSBSZXR1cm5zIGFsbCBwYXJ0aWNsZXMgb3JkZXJlZCBieSBvbGRlc3QteW91bmdlc3QuDQotLS0gQHJldHVybiB0YWJsZTxudW1iZXIsIGlsbHVzaW9uX3BhcnRpY2xlX2M+DQpmdW5jdGlvbiBpbGx1c2lvbl9wYXJ0aWNsZV9tYW5hZ2VyX2M6b3JkZXJfZm9yX2N1bGxpbmcoKQ0KCWxvY2FsIG9yZGVyZWQgPSB7fQ0KDQoJZm9yIF8sIHBhcnRpY2xlIGluIHNwYWlycyhzZWxmLnBhcnRpY2xlcywgZnVuY3Rpb24ocGFydGljbGVzLCBhLCBiKQ0KCQlyZXR1cm4gcGFydGljbGVzW2JdLmlkID4gcGFydGljbGVzW2FdLmlkDQoJZW5kKSBkbw0KCQl0YWJsZS5pbnNlcnQob3JkZXJlZCwgcGFydGljbGUpDQoJZW5kDQoNCglyZXR1cm4gb3JkZXJlZA0KZW5kDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBpbGx1c2lvbl9zdGF0ZQ0KLS0tIEBjbGFzcyBpbGx1c2lvbl9zdGF0ZV9jDQotLS0gQGZpZWxkIHB1YmxpYyBjb25uZWN0ZWQgYm9vbGVhbiBQbGF5ZXIgaXMgY29ubmVjdGVkIHRvIGEgc2VydmVyIGFuZCBpcyBpbi1nYW1lLg0KLS0tIEBmaWVsZCBwdWJsaWMgY3Jhc2hlZCBib29sZWFuIEVuZ2luZSBoYXMgY3Jhc2hlZCBhbmQgY2Fubm90IGJlIHVzZWQuDQotLS0gQGZpZWxkIHB1YmxpYyBlbmFibGVkIGJvb2xlYW4gRW5naW5lIGlzIGVuYWJsZWQgYW5kIGNhbiBiZSB1c2VkLg0KbG9jYWwgaWxsdXNpb25fc3RhdGVfYyA9IHt9DQpsb2NhbCBpbGx1c2lvbl9zdGF0ZV9tdCA9IHsgX19pbmRleCA9IGlsbHVzaW9uX3N0YXRlX2MgfQ0KDQotLS0gSW5zdGFudGlhdGUgYW4gb2JqZWN0IG9mIGlsbHVzaW9uX3N0YXRlX2MuDQotLS0gQHJldHVybiBpbGx1c2lvbl9zdGF0ZV9jDQpmdW5jdGlvbiBpbGx1c2lvbl9zdGF0ZV9jLm5ldygpDQoJcmV0dXJuIHNldG1ldGF0YWJsZSh7DQoJCWNvbm5lY3RlZCA9IGZhbHNlLA0KCQljcmFzaGVkID0gZmFsc2UsDQoJCWVuYWJsZWQgPSB0cnVlDQoJfSwgaWxsdXNpb25fc3RhdGVfbXQpDQplbmQNCg0KLS0tIFVwZGF0ZSB0aGUgY29ubmVjdGVkIHN0YXRlLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fc3RhdGVfYzpzeW5jKCkNCglzZWxmLmNvbm5lY3RlZCA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgfj0gbmlsDQplbmQNCg0KLS0tIFJldHVybnMgdHJ1ZSBpZiBJbGx1c2lvbiBtYXkgYmUgdXNlZCBhdCB0aGlzIHRpbWUuDQotLS0gQHJldHVybiBib29sZWFuDQpmdW5jdGlvbiBpbGx1c2lvbl9zdGF0ZV9jOmF2YWlsYWJsZSgpDQoJcmV0dXJuIHNlbGYuY29ubmVjdGVkID09IHRydWUgYW5kIHNlbGYuY3Jhc2hlZCA9PSBmYWxzZSBhbmQgc2VsZi5lbmFibGVkID09IHRydWUNCmVuZA0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gaWxsdXNpb25faG9vaw0KLS0tIEBjbGFzcyBpbGx1c2lvbl9ob29rX2MNCi0tLSBAZmllbGQgcHVibGljIG5hbWUgc3RyaW5nIEhvb2sgbmFtZS4NCi0tLSBAZmllbGQgcHVibGljIHBhcnRpY2xlcyB0YWJsZTxudW1iZXIsIGlsbHVzaW9uX3BhcnRpY2xlX2M+IFBhcnRpY2xlIHRhYmxlLg0KLS0tIEBmaWVsZCBwdWJsaWMgdG90YWxfc3Bhd25lZCBudW1iZXIgVG90YWwgcGFydGljbGVzIHNwYXduZWQuDQotLS0gQGZpZWxkIHB1YmxpYyB0b3RhbF9hbGl2ZSBudW1iZXIgVG90YWwgcGFydGljbGVzIGFsaXZlLg0KLS0tIEBmaWVsZCBwdWJsaWMgdGlja19pbnRlcnZhbCBudW1iZXIgVGljayBpbnRlcnZhbCBvZiBhbGwgcGFydGljbGVzIGJlbG9uZ2luZyB0byB0aGUgaG9vayAoZGVmYXVsdCAwLjAzMTI1LCBvciAzMiB0aWNrcyBwZXIgc2Vjb25kKS4NCi0tLSBAZmllbGQgcHVibGljIHRpY2tfaW50ZXJ2YWxfdGltZXIgdGltZXJfc3RhbmRhcmRfYyBUaWNrIGludGVydmFsIHRpbWVyLg0KLS0tIEBmaWVsZCBwdWJsaWMgdGlja190aGlzX2ZyYW1lIGJvb2xlYW4gUHJvY2VzcyB0aWNrcyBmb3IgcGFydGljbGVzIHRoaXMgZnJhbWUuDQpsb2NhbCBpbGx1c2lvbl9ob29rX2MgPSB7fQ0KbG9jYWwgaWxsdXNpb25faG9va19tdCA9IHsgX19pbmRleCA9IGlsbHVzaW9uX2hvb2tfYyB9DQoNCi0tLSBJbnN0YW50aWF0ZSBhbiBvYmplY3Qgb2YgaWxsdXNpb25faG9va19jLg0KLS0tIEBwYXJhbSBuYW1lIHN0cmluZw0KLS0tIEByZXR1cm4gaWxsdXNpb25faG9va19jDQpmdW5jdGlvbiBpbGx1c2lvbl9ob29rX2MubmV3KG5hbWUpDQoJcmV0dXJuIHNldG1ldGF0YWJsZSh7DQoJCW5hbWUgPSBuYW1lLA0KCQlwYXJ0aWNsZXMgPSB7fSwNCgkJdG90YWxfc3Bhd25lZCA9IDAsDQoJCXRvdGFsX2FsaXZlID0gMCwNCgkJdGlja19pbnRlcnZhbCA9IDAuMDMxMjUsDQoJCXRpY2tfaW50ZXJ2YWxfdGltZXIgPSB0aW1lcl9zdGFuZGFyZF9jLm5ldyh0cnVlKSwNCgkJdGlja190aGlzX2ZyYW1lID0gZmFsc2UNCgl9LCBpbGx1c2lvbl9ob29rX210KQ0KZW5kDQoNCi0tLSBBZGQgYSBwYXJ0aWNsZS4NCi0tLSBAcGFyYW0gcGFydGljbGUgaWxsdXNpb25fcGFydGljbGVfYw0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25faG9va19jOmFkZChwYXJ0aWNsZSkNCglzZWxmLnBhcnRpY2xlc1twYXJ0aWNsZS5pZF0gPSBwYXJ0aWNsZQ0KCXNlbGYudG90YWxfc3Bhd25lZCA9IHNlbGYudG90YWxfc3Bhd25lZCArIDENCglzZWxmLnRvdGFsX2FsaXZlID0gc2VsZi50b3RhbF9hbGl2ZSArIDENCmVuZA0KDQotLS0gUmVtb3ZlIGEgcGFydGljbGUuDQotLS0gQHBhcmFtIHBhcnRpY2xlIGlsbHVzaW9uX3BhcnRpY2xlX2MNCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGlsbHVzaW9uX2hvb2tfYzpyZW1vdmUocGFydGljbGUpDQoJc2VsZi5wYXJ0aWNsZXNbcGFydGljbGUuaWRdID0gbmlsDQoJc2VsZi50b3RhbF9hbGl2ZSA9IHNlbGYudG90YWxfYWxpdmUgLSAxDQplbmQNCg0KLS0tIEN1bGxzIHRoZSBmaXJzdCBwYXJ0aWNsZSBpbiB0aGUgcGFydGljbGUgcmVuZGVyIHF1ZXVlIHRoYXQgaXMgbm90IGR5aW5nLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25faG9va19jOmN1bGwoKQ0KCWZvciBfLCBwYXJ0aWNsZSBpbiBwYWlycyhzZWxmLnBhcnRpY2xlcykgZG8NCgkJaWYgKHBhcnRpY2xlLmR5aW5nID09IGZhbHNlKSB0aGVuDQoJCQlwYXJ0aWNsZTpraWxsKCkNCg0KCQkJYnJlYWsNCgkJZW5kDQoJZW5kDQplbmQNCg0KLS0tIFNldHMgdGlja190aGlzX2ZyYW1lIHRvIHRydWUgaWYgb25fdGljayBjYW4gYmUgcHJvY2Vzc2VkIHRoaXMgZnJhbWUuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9ob29rX2M6dXBkYXRlX3RpY2tfdGhpc19mcmFtZSgpIA0KCXNlbGYudGlja19pbnRlcnZhbF90aW1lcjpldmVudChzZWxmLnRpY2tfaW50ZXJ2YWwsIGZ1bmN0aW9uKCkNCgkJc2VsZi50aWNrX3RoaXNfZnJhbWUgPSB0cnVlDQoNCgkJc2VsZi50aWNrX2ludGVydmFsX3RpbWVyOnJlc3RhcnQoKQ0KDQoJCXJldHVybg0KCWVuZCkNCg0KCXNlbGYudGlja190aGlzX2ZyYW1lID0gZmFsc2UNCmVuZA0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gaWxsdXNpb25faG9va19tYW5hZ2VyDQotLS0gQGNsYXNzIGlsbHVzaW9uX2hvb2tfbWFuYWdlcl9jDQotLS0gQGZpZWxkIHB1YmxpYyBob29rcyB0YWJsZSA8bnVtYmVyLCBpbGx1c2lvbl9ob29rX2M+DQpsb2NhbCBpbGx1c2lvbl9ob29rX21hbmFnZXJfYyA9IHt9DQpsb2NhbCBpbGx1c2lvbl9ob29rX21hbmFnZXJfbXQgPSB7IF9faW5kZXggPSBpbGx1c2lvbl9ob29rX21hbmFnZXJfYyB9DQoNCi0tLSBJbnN0YW50aWF0ZSBhbiBvYmplY3Qgb2YgaWxsdXNpb25faG9va19tYW5hZ2VyX2MuDQotLS0gQHJldHVybiBpbGx1c2lvbl9ob29rX21hbmFnZXJfYw0KZnVuY3Rpb24gaWxsdXNpb25faG9va19tYW5hZ2VyX2MubmV3KCkNCglyZXR1cm4gc2V0bWV0YXRhYmxlKHsNCgkJaG9va3MgPSB7fQ0KCX0sIGlsbHVzaW9uX2hvb2tfbWFuYWdlcl9tdCkNCmVuZA0KDQotLS0gQ3JlYXRlIGEgbmV3IGhvb2suDQotLS0gQHBhcmFtIGhvb2tfbmFtZSBzdHJpbmcNCi0tLSBAcmV0dXJuIGlsbHVzaW9uX2hvb2tfYw0KZnVuY3Rpb24gaWxsdXNpb25faG9va19tYW5hZ2VyX2M6Y3JlYXRlKGhvb2tfbmFtZSkNCglsb2NhbCBob29rID0gaWxsdXNpb25faG9va19jLm5ldyhob29rX25hbWUpDQoNCgl0YWJsZS5pbnNlcnQoc2VsZi5ob29rcywgaG9vaykNCg0KCXJldHVybiBob29rDQplbmQNCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIGlsbHVzaW9uX2RlYnVnX3BhbmVsDQotLS0gQGNsYXNzIGlsbHVzaW9uX2RlYnVnX3BhbmVsX2MNCi0tLSBAZmllbGQgcHVibGljIGVuYWJsZWQgYm9vbGVhbg0KLS0tIEBmaWVsZCBwdWJsaWMgc2hhcmVkIGlsbHVzaW9uX3NoYXJlZF9jDQotLS0gQGZpZWxkIHB1YmxpYyBncm91cHMgdGFibGUNCi0tLSBAZmllbGQgcHVibGljIGNvbG9ycyB0YWJsZTxzdHJpbmcsIHNoYWRlcl9jPg0KbG9jYWwgaWxsdXNpb25fZGVidWdfcGFuZWxfYyA9IHt9DQpsb2NhbCBpbGx1c2lvbl9kZWJ1Z19wYW5lbF9tdCA9IHsgX19pbmRleCA9IGlsbHVzaW9uX2RlYnVnX3BhbmVsX2MgfQ0KDQotLS0gSW5zdGFudGlhdGUgYW4gb2JqZWN0IG9mIGlsbHVzaW9uX2RlYnVnX3BhbmVsX2MuDQotLS0gQHJldHVybiBpbGx1c2lvbl9kZWJ1Z19wYW5lbF9jDQpmdW5jdGlvbiBpbGx1c2lvbl9kZWJ1Z19wYW5lbF9jLm5ldyhzaGFyZWQpDQoJcmV0dXJuIHNldG1ldGF0YWJsZSh7DQoJCWVuYWJsZWQgPSBmYWxzZSwNCgkJc2hhcmVkID0gc2hhcmVkLA0KCQlncm91cHMgPSB7fSwNCgkJY29sb3JzID0gew0KCQkJdGhlbWUgPSBzaGFkZXJfYy5yZ2IoMjE5LCAxODQsIDMpLA0KCQkJYmx1ZSA9IHNoYWRlcl9jLnJnYigxOCwgMjE3LCAyNTUpLA0KCQkJcHVycGxlID0gc2hhZGVyX2MucmdiKDE3MywgMTUzLCAyNTUpLA0KCQkJbm9ybWFsID0gc2hhZGVyX2MucmdiKDIzNSwgMjM1LCAyMzUpLA0KCQkJZ29vZCA9IHNoYWRlcl9jLnJnYigxMzgsIDI1NSwgNzcpLA0KCQkJbm90aWNlID0gc2hhZGVyX2MucmdiKDIxOSwgMTg0LCAzKSwNCgkJCXdhcm5pbmcgPSBzaGFkZXJfYy5yZ2IoMjU1LCAxNjMsIDcxKSwNCgkJCWVycm9yID0gc2hhZGVyX2MucmdiKDI1NSwgNzEsIDcxKQ0KCQl9DQoJfSwgaWxsdXNpb25fZGVidWdfcGFuZWxfbXQpDQplbmQNCg0KLS0tIFJlbmRlciBhIGRlYnVnIGxpbmUuDQotLS0gQHBhcmFtIGdyb3VwIHN0cmluZw0KLS0tIEBwYXJhbSB0aXRsZSBzdHJpbmcNCi0tLSBAcGFyYW0gY29sb3Igc3RyaW5nDQotLS0gQHZhcmFyZyBzdHJpbmcNCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGlsbHVzaW9uX2RlYnVnX3BhbmVsX2M6bGluZShncm91cCwgdGl0bGUsIGNvbG9yLCB0ZXh0KQ0KCWlmIChzZWxmLmdyb3Vwc1tncm91cF0gPT0gbmlsKSB0aGVuDQoJCXNlbGYuZ3JvdXBzW2dyb3VwXSA9IHt9DQoJZW5kDQoNCglzZWxmLmdyb3Vwc1tncm91cF1bdGl0bGVdID0gew0KCQl0aXRsZSA9IHRpdGxlLA0KCQljb2xvciA9IHNlbGYuY29sb3JzW2NvbG9yXSwNCgkJdGV4dCA9IHRleHQNCgl9DQplbmQNCg0KLS0tIFJlbmRlciB0aGUgZGVidWcgcGFuZWwuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9kZWJ1Z19wYW5lbF9jOnJlbmRlcigpDQoJLS0gUGFuZWwgaXMgbm90IGVuYWJsZWQuDQoJaWYgKHNlbGYuZW5hYmxlZCA9PSBmYWxzZSkgdGhlbg0KCQlyZXR1cm4NCgllbmQNCg0KCWxvY2FsIHdpbmRvd19wb3NpdGlvbiA9IHZlY3RvcigNCgkJc2VsZi5zaGFyZWQucmVzb2x1dGlvbi54IC8gNSwNCgkJMTgwDQoJKQ0KDQoJbG9jYWwgd2luZG93X2RpbWVuc2lvbnMgPSB2ZWN0b3IoNDAwLCAwKQ0KDQoJc2VsZjpyZW5kZXJfbGluZShzaGFkZXJfYy5yZ2IoMjAsIDIwLCAyMCwgMjQwKSwgd2luZG93X3Bvc2l0aW9uLCB3aW5kb3dfZGltZW5zaW9ucywgew0KCQl0aXRsZSA9ICJIYXZvYyBJbGx1c2lvbiBEZWJ1ZyBQYW5lbCIsDQoJCWNvbG9yID0gc2VsZi5jb2xvcnNbInRoZW1lIl0sDQoJCXRleHQgPSAiIg0KCX0pDQoNCgl3aW5kb3dfcG9zaXRpb24ueSA9IHdpbmRvd19wb3NpdGlvbi55ICsgMjANCg0KCWZvciBncm91cF9uYW1lLCBncm91cCBpbiBwYWlycyhzZWxmLmdyb3VwcykgZG8NCgkJc2VsZjpyZW5kZXJfbGluZShzaGFkZXJfYy5yZ2IoMjAsIDIwLCAyMCwgMjAwKSwgd2luZG93X3Bvc2l0aW9uLCB3aW5kb3dfZGltZW5zaW9ucywgew0KCQkJdGl0bGUgPSBncm91cF9uYW1lLA0KCQkJY29sb3IgPSBzZWxmLmNvbG9yc1sibm9ybWFsIl0sDQoJCQl0ZXh0ID0gIiINCgkJfSkNCg0KCQl3aW5kb3dfcG9zaXRpb24ueSA9IHdpbmRvd19wb3NpdGlvbi55ICsgMjANCg0KCQlsb2NhbCBsaW5lX2luZGV4ID0gMA0KDQoJCWZvciBfLCBsaW5lIGluIHBhaXJzKGdyb3VwKSBkbw0KCQkJbGluZV9pbmRleCA9IGxpbmVfaW5kZXggKyAxDQoNCgkJCWxvY2FsIGxpbmVfc2hhZGVyDQoNCgkJCWlmIChsaW5lX2luZGV4ICUgMiA9PSAwKSB0aGVuDQoJCQkJbGluZV9zaGFkZXIgPSBzaGFkZXJfYy5yZ2IoMjAsIDIwLCAyMCwgMTAwKQ0KCQkJZWxzZQ0KCQkJCWxpbmVfc2hhZGVyID0gc2hhZGVyX2MucmdiKDIwLCAyMCwgMjAsIDUwKQ0KCQkJZW5kDQoNCgkJCXNlbGY6cmVuZGVyX2xpbmUobGluZV9zaGFkZXIsIHdpbmRvd19wb3NpdGlvbiwgd2luZG93X2RpbWVuc2lvbnMsIGxpbmUpDQoNCgkJCXdpbmRvd19wb3NpdGlvbi55ID0gd2luZG93X3Bvc2l0aW9uLnkgKyAyMA0KCQllbmQNCgllbmQNCmVuZA0KDQotLS0gUmVuZGVyIGEgbGluZS4NCi0tLSBAcGFyYW0gYmFja2dyb3VuZCBzaGFkZXJfYw0KLS0tIEBwYXJhbSBsaW5lIHRhYmxlDQpmdW5jdGlvbiBpbGx1c2lvbl9kZWJ1Z19wYW5lbF9jOnJlbmRlcl9saW5lKGJhY2tncm91bmQsIHdpbmRvd19wb3NpdGlvbiwgd2luZG93X2RpbWVuc2lvbnMsIGxpbmUpDQoJcmVuZGVyZXIucmVjdGFuZ2xlKA0KCQl3aW5kb3dfcG9zaXRpb24ueCwgd2luZG93X3Bvc2l0aW9uLnksDQoJCXdpbmRvd19kaW1lbnNpb25zLngsIDIwLA0KCQliYWNrZ3JvdW5kLnIsIGJhY2tncm91bmQuZywgYmFja2dyb3VuZC5iLCBiYWNrZ3JvdW5kLmENCgkpDQoNCglyZW5kZXJlci50ZXh0KA0KCQl3aW5kb3dfcG9zaXRpb24ueCArIDEwLCB3aW5kb3dfcG9zaXRpb24ueSArIDQsDQoJCWxpbmUuY29sb3IuciwgbGluZS5jb2xvci5nLCBsaW5lLmNvbG9yLmIsIGxpbmUuY29sb3IuYSwNCgkJImwiLCAwLA0KCQlsaW5lLnRpdGxlDQoJKQ0KDQoJcmVuZGVyZXIudGV4dCgNCgkJd2luZG93X3Bvc2l0aW9uLnggKyB3aW5kb3dfZGltZW5zaW9ucy54IC0gMTAsIHdpbmRvd19wb3NpdGlvbi55ICsgNCwNCgkJbGluZS5jb2xvci5yLCBsaW5lLmNvbG9yLmcsIGxpbmUuY29sb3IuYiwgbGluZS5jb2xvci5hLA0KCQkiciIsIDAsDQoJCWxpbmUudGV4dA0KCSkNCmVuZA0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gaWxsdXNpb25fYW5pbWF0b3INCi0tLSBAY2xhc3MgaWxsdXNpb25fYW5pbWF0b3JfYw0KLS0tIEBmaWVsZCBwcml2YXRlIHBhcnRpY2xlIGlsbHVzaW9uX3BhcnRpY2xlX2MgUGFydGljbGUgdG8gYW5pbWF0ZS4NCi0tLSBAZmllbGQgcHJpdmF0ZSBmbG9hdF90aW1lciB0aW1lcl9zdGFuZGFyZF9jIFRpbWVzIGZsb2F0aW5nIGFuaW1hdGlvbnMgYXMgdGhleSByZXF1aXJlIGNvbnNpc3RlbnQgdGltaW5nLg0KLS0tIEBmaWVsZCBwdWJsaWMgb3JiaXRfYW5nbGUgYW5nbGVfb2xkX2MgQ3VycmVudCBvcmJpdCB5YXcuDQpsb2NhbCBpbGx1c2lvbl9hbmltYXRvcl9jID0ge30NCmxvY2FsIGlsbHVzaW9uX2FuaW1hdG9yX210ID0geyBfX2luZGV4ID0gaWxsdXNpb25fYW5pbWF0b3JfYyB9DQoNCi0tLSBDcmVhdGVzIGEgbmV3IGFuaW1hdG9yIGluc3RhbmNlLg0KLS0tIEBwYXJhbSBwYXJ0aWNsZSBpbGx1c2lvbl9wYXJ0aWNsZV9jDQotLS0gQHJldHVybiB2b2lkDQpsb2NhbCBmdW5jdGlvbiBpbGx1c2lvbl9hbmltYXRvcihwYXJ0aWNsZSkNCglyZXR1cm4gc2V0bWV0YXRhYmxlKHsNCgkJcGFydGljbGUgPSBwYXJ0aWNsZSwNCgkJZmxvYXRfdGltZXIgPSB0aW1lcl9zdGFuZGFyZF9jLm5ldyh0cnVlKSwNCgkJb3JiaXRfYW5nbGUgPSBhbmdsZSgwLCAwLCAwKQ0KCX0sIGlsbHVzaW9uX2FuaW1hdG9yX210KQ0KZW5kDQoNCi0tLSBPcmJpdCBhIGdpdmVuIHRhcmdldCB2ZWN0b3IgYXQgYSBnaXZlbiBpZGVhbCBvcmJpdCBkaXN0YW5jZS4gT3B0aW9uYWwgY29sbGlzaW9uIGRldGVjdGlvbiB0aGF0IGR5bmFtaWNhbGx5IHJlZHVjZXMgdGhlIG9yYml0IGRpc3RhbmNlLg0KLS0tIEBwYXJhbSBjZW50ZXJfdmVjdG9yIHZlY3Rvcl9vbGRfYw0KLS0tIEBwYXJhbSBwYXJ0aWNsZV9zcGVlZCBudW1iZXINCi0tLSBAcGFyYW0gaWRlYWxfZGlzdGFuY2UgbnVtYmVyDQotLS0gQHBhcmFtIG9wdGlvbnMgdGFibGU8c3RyaW5nLCBhbnk+DQpmdW5jdGlvbiBpbGx1c2lvbl9hbmltYXRvcl9jOm9yYml0KGNlbnRlcl92ZWN0b3IsIHBhcnRpY2xlX3NwZWVkLCBpZGVhbF9kaXN0YW5jZSwgb3B0aW9ucykNCglvcHRpb25zID0gb3B0aW9ucyBvciB7fQ0KDQoJbG9jYWwgb3JiaXRfdmVjdG9yID0gc2VsZjpnZXRfb3JiaXRfdmVjdG9yKA0KCQljZW50ZXJfdmVjdG9yLA0KCQlvcHRpb25zLnNwZWVkLA0KCQlpZGVhbF9kaXN0YW5jZSwNCgkJb3B0aW9ucy50cmFjZXMsDQoJCW9wdGlvbnMuY29sbGlzaW9uLA0KCQlvcHRpb25zLmlnbm9yZQ0KCSkNCg0KCXNlbGY6bW92ZV90YXJnZXQob3JiaXRfdmVjdG9yLCBwYXJ0aWNsZV9zcGVlZCkNCmVuZA0KDQotLS0gT3JiaXQgYSBnaXZlbiB0YXJnZXQgdmVjdG9yIGF0IGEgZ2l2ZW4gaWRlYWwgb3JiaXQgZGlzdGFuY2UgYW5kIGVhc2UgdGhlIG1vdmVtZW50LiBPcHRpb25hbCBjb2xsaXNpb24gZGV0ZWN0aW9uIHRoYXQgZHluYW1pY2FsbHkgcmVkdWNlcyB0aGUgb3JiaXQgZGlzdGFuY2UuDQotLS0gQHBhcmFtIGNlbnRlcl92ZWN0b3IgdmVjdG9yX29sZF9jDQotLS0gQHBhcmFtIHBhcnRpY2xlX3NwZWVkIG51bWJlcg0KLS0tIEBwYXJhbSByaWdpZGl0eSBudW1iZXINCi0tLSBAcGFyYW0gaWRlYWxfZGlzdGFuY2UgbnVtYmVyDQotLS0gQHBhcmFtIG9wdGlvbnMgdGFibGU8c3RyaW5nLCBhbnk+DQpmdW5jdGlvbiBpbGx1c2lvbl9hbmltYXRvcl9jOm9yYml0X2Vhc2luZyhjZW50ZXJfdmVjdG9yLCBwYXJ0aWNsZV9zcGVlZCwgcmlnaWRpdHksIGlkZWFsX2Rpc3RhbmNlLCBvcHRpb25zKQ0KCW9wdGlvbnMgPSBvcHRpb25zIG9yIHt9DQoNCglsb2NhbCBvcmJpdF92ZWN0b3IgPSBzZWxmOmdldF9vcmJpdF92ZWN0b3IoDQoJCWNlbnRlcl92ZWN0b3IsDQoJCW9wdGlvbnMuc3BlZWQsDQoJCWlkZWFsX2Rpc3RhbmNlLA0KCQlvcHRpb25zLnRyYWNlcywNCgkJb3B0aW9ucy5jb2xsaXNpb24sDQoJCW9wdGlvbnMuaWdub3JlDQoJKQ0KDQoJc2VsZjptb3ZlX3RhcmdldF9lYXNpbmcob3JiaXRfdmVjdG9yLCBwYXJ0aWNsZV9zcGVlZCwgcmlnaWRpdHkpDQplbmQNCg0KLS0tIFJldHVybnMgdGhlIGN1cnJlbnQgb3JiaXQgdmVjdG9yIGZvciB0aGlzIGFuaW1hdG9yJ3MgY3VycmVudCBpbnN0YW5jZS4NCi0tLSBAcGFyYW0gY2VudGVyX3ZlY3RvciB2ZWN0b3Jfb2xkX2MNCi0tLSBAcGFyYW0gb3JiaXRfc3BlZWQgbnVtYmVyDQotLS0gQHBhcmFtIGlkZWFsX2Rpc3RhbmNlIG51bWJlcg0KLS0tIEBwYXJhbSBvcmJpdF90cmFjZXMgbnVtYmVyDQotLS0gQHBhcmFtIGFkanVzdF9vcmJpdCBib29sZWFuDQotLS0gQHBhcmFtIGlnbm9yZV9lbnRpdHlfdHJhY2UgbnVtYmVyDQpmdW5jdGlvbiBpbGx1c2lvbl9hbmltYXRvcl9jOmdldF9vcmJpdF92ZWN0b3IoY2VudGVyX3ZlY3Rvciwgb3JiaXRfc3BlZWQsIGlkZWFsX2Rpc3RhbmNlLCBvcmJpdF90cmFjZXMsIGFkanVzdF9vcmJpdCwgaWdub3JlX2VudGl0eV90cmFjZSkNCglvcmJpdF9zcGVlZCA9IG9yYml0X3NwZWVkIG9yIDENCglvcmJpdF90cmFjZXMgPSBvcmJpdF90cmFjZXMgb3IgMjQNCg0KCS0tIER5bmFtaWNhbGx5IGFkanVzdCBvcmJpdCBkaXN0YW5jZSBiYXNlZCBvbiB3YWxscyB0aGF0IHRoZSBwYXJ0aWNsZSB3b3VsZCBvdGhlcndpc2UgcGFzcyB0aHJvdWdoLg0KCWlmIChhZGp1c3Rfb3JiaXQgPT0gdHJ1ZSkgdGhlbg0KCQktLSBUaGlzIHdpbGwgYmUgdGhlIGRpc3RhbmNlIHRoZSBwYXJ0aWNsZSB3aWxsIG9yYml0IGF0Lg0KCQlsb2NhbCBsb3dlc3RfZGlzdGFuY2UgPSBpZGVhbF9kaXN0YW5jZQ0KDQoJCS0tIERldGVybWluZSB0aGUgcmVhbCBvcmJpdCBkaXN0YW5jZSBiYXNlZCBvbiBjb2xsaXNpb25zLg0KCQlmb3IgaSA9IDEsIG9yYml0X3RyYWNlcyBkbw0KCQkJbG9jYWwgb3JiaXRfYW5nbGUgPSBhbmdsZSgwLCAzNjAgLyBvcmJpdF90cmFjZXMgKiBpLCAwKQ0KCQkJbG9jYWwgb3JiaXRfdmVjdG9yID0gY2VudGVyX3ZlY3RvciArIG9yYml0X2FuZ2xlOnRvX2ZvcndhcmRfdmVjdG9yKCkgKiBpZGVhbF9kaXN0YW5jZQ0KCQkJbG9jYWwgY29sbGlzaW9uX3RyYWNlID0gY2VudGVyX3ZlY3Rvcjp0cmFjZV9saW5lX3RvKG9yYml0X3ZlY3RvciwgaWdub3JlX2VudGl0eV90cmFjZSkNCgkJCWxvY2FsIHRyYWNlZF9kaXN0YW5jZSA9IGlkZWFsX2Rpc3RhbmNlICogY29sbGlzaW9uX3RyYWNlDQoNCgkJCS0tIFRoaXMgdHJhY2Ugd2FzIHNob3J0ZXIgdGhhbiB0aGUgcHJldmlvdXMuDQoJCQlpZiAodHJhY2VkX2Rpc3RhbmNlIDwgbG93ZXN0X2Rpc3RhbmNlKSB0aGVuDQoJCQkJbG93ZXN0X2Rpc3RhbmNlID0gdHJhY2VkX2Rpc3RhbmNlDQoJCQllbmQNCgkJZW5kDQoNCgkJLS0gTW92ZSB0aGUgY3VycmVudCBvcmJpdCB5YXcuDQoJCXNlbGYub3JiaXRfYW5nbGUueSA9IChzZWxmLm9yYml0X2FuZ2xlLnkgKyBvcmJpdF9zcGVlZCAqIHNlbGYucGFydGljbGUuc2ltdWxhdGlvbi5kZWx0YSkgJSAzNjANCg0KCQktLSBEZXRlcm1pbmUgdGhlIGN1cnJlbnQgdGFyZ2V0IHZlY3Rvci4NCgkJcmV0dXJuIGNlbnRlcl92ZWN0b3IgKyAoc2VsZi5vcmJpdF9hbmdsZTp0b19mb3J3YXJkX3ZlY3RvcigpICogbG93ZXN0X2Rpc3RhbmNlKQ0KCWVuZA0KZW5kDQoNCi0tLSBGbG9hdGluZyBhbmltYXRpb24gb24gdGhlIFggYXhpcy4NCi0tLSBAcGFyYW0gYW1wbGl0dWRlIG51bWJlcg0KLS0tIEBwYXJhbSBmcmVxdWVuY3kgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9hbmltYXRvcl9jOmZsb2F0X3goYW1wbGl0dWRlLCBmcmVxdWVuY3kpDQoJc2VsZi5wYXJ0aWNsZS5vcmlnaW4ueCA9IHNlbGYucGFydGljbGUub3JpZ2luLnggKw0KCQltYXRoLnNpbihzZWxmLmZsb2F0X3RpbWVyKCkgKiBtYXRoLnBpICogZnJlcXVlbmN5KSAqIGFtcGxpdHVkZSAqIHNlbGYucGFydGljbGUuc2ltdWxhdGlvbi5kZWx0YQ0KZW5kDQoNCi0tLSBGbG9hdGluZyBhbmltYXRpb24gb24gdGhlIFkgYXhpcy4NCi0tLSBAcGFyYW0gYW1wbGl0dWRlIG51bWJlcg0KLS0tIEBwYXJhbSBmcmVxdWVuY3kgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9hbmltYXRvcl9jOmZsb2F0X3koYW1wbGl0dWRlLCBmcmVxdWVuY3kpDQoJc2VsZi5wYXJ0aWNsZS5vcmlnaW4ueSA9IHNlbGYucGFydGljbGUub3JpZ2luLnkgKw0KCQltYXRoLnNpbihzZWxmLmZsb2F0X3RpbWVyKCkgKiBtYXRoLnBpICogZnJlcXVlbmN5KSAqIGFtcGxpdHVkZSAqIHNlbGYucGFydGljbGUuc2ltdWxhdGlvbi5kZWx0YQ0KZW5kDQoNCi0tLSBGbG9hdGluZyBhbmltYXRpb24gb24gdGhlIFogYXhpcy4NCi0tLSBAcGFyYW0gYW1wbGl0dWRlIG51bWJlcg0KLS0tIEBwYXJhbSBmcmVxdWVuY3kgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9hbmltYXRvcl9jOmZsb2F0X3ooYW1wbGl0dWRlLCBmcmVxdWVuY3kpDQoJc2VsZi5wYXJ0aWNsZS5vcmlnaW4ueiA9IHNlbGYucGFydGljbGUub3JpZ2luLnogKw0KCQltYXRoLnNpbihzZWxmLmZsb2F0X3RpbWVyKCkgKiBtYXRoLnBpICogZnJlcXVlbmN5KSAqIGFtcGxpdHVkZSAqIHNlbGYucGFydGljbGUuc2ltdWxhdGlvbi5kZWx0YQ0KZW5kDQoNCi0tLSBNb3ZlIGF0IGEgZ2l2ZW4gc3BlZWQgdG93YXJkIGEgdGFyZ2V0IHZlY3Rvci4NCi0tLSBAcGFyYW0gdGFyZ2V0X3ZlY3RvciB2ZWN0b3Jfb2xkX2MNCi0tLSBAcGFyYW0gc3BlZWQgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9hbmltYXRvcl9jOm1vdmVfdGFyZ2V0KHRhcmdldF92ZWN0b3IsIHNwZWVkKQ0KCXNlbGYucGFydGljbGUub3JpZ2luID0gc2VsZi5wYXJ0aWNsZS5vcmlnaW4gKyAodGFyZ2V0X3ZlY3RvciAtIHNlbGYucGFydGljbGUub3JpZ2luKSAqIHNwZWVkICogc2VsZi5wYXJ0aWNsZS5zaW11bGF0aW9uLmRlbHRhDQplbmQNCg0KLS0tIE1vdmUgYXQgYSBnaXZlbiBzcGVlZCwgd2l0aCBlYXNpbmcgYXQgYSBnaXZlbiByaWdpZGl0eSwgdG93YXJkIGEgdGFyZ2V0IHZlY3Rvci4NCi0tLSBAcGFyYW0gdGFyZ2V0X3ZlY3RvciB2ZWN0b3Jfb2xkX2MNCi0tLSBAcGFyYW0gc3BlZWQgbnVtYmVyDQotLS0gQHBhcmFtIHJpZ2lkaXR5IG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fYW5pbWF0b3JfYzptb3ZlX3RhcmdldF9lYXNpbmcodGFyZ2V0X3ZlY3Rvciwgc3BlZWQsIHJpZ2lkaXR5KQ0KCXNlbGYucGFydGljbGUub3JpZ2luID0gc2VsZi5wYXJ0aWNsZS5vcmlnaW4gKyAodGFyZ2V0X3ZlY3RvciAtIHNlbGYucGFydGljbGUub3JpZ2luKSAqIHJpZ2lkaXR5ICogc3BlZWQgKiBzZWxmLnBhcnRpY2xlLnNpbXVsYXRpb24uZGVsdGENCmVuZA0KDQotLS0gTW92ZSBhdCBhIGdpdmVuIHNwZWVkIHRvd2FyZCBhIGZvcndhcmQgdmVjdG9yLg0KLS0tIEBwYXJhbSBmb3J3YXJkX3ZlY3RvciB2ZWN0b3Jfb2xkX2MNCi0tLSBAcGFyYW0gc3BlZWQgbnVtYmVyDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9hbmltYXRvcl9jOm1vdmVfZm9yd2FyZChmb3J3YXJkX3ZlY3Rvciwgc3BlZWQpDQoJc2VsZi5wYXJ0aWNsZS5vcmlnaW4gPSBzZWxmLnBhcnRpY2xlLm9yaWdpbiArIGZvcndhcmRfdmVjdG9yICogc3BlZWQgKiBzZWxmLnBhcnRpY2xlLnNpbXVsYXRpb24uZGVsdGENCmVuZA0KDQotLS0gTW92ZSBhdCBhIGdpdmVuIHNwZWVkLCB3aXRoIGVhc2luZyBhdCBhIGdpdmVuIHJpZ2lkaXR5LCB0b3dhcmQgYSBmb3J3YXJkIHZlY3Rvci4NCi0tLSBAcGFyYW0gZm9yd2FyZF92ZWN0b3IgdmVjdG9yX29sZF9jDQotLS0gQHBhcmFtIHNwZWVkIG51bWJlcg0KLS0tIEBwYXJhbSByaWdpZGl0eSBudW1iZXINCi0tLSBAcmV0dXJuIHZvaWQNCmZ1bmN0aW9uIGlsbHVzaW9uX2FuaW1hdG9yX2M6bW92ZV9mb3J3YXJkX2Vhc2luZyhmb3J3YXJkX3ZlY3Rvciwgc3BlZWQsIHJpZ2lkaXR5KQ0KCXNlbGYucGFydGljbGUub3JpZ2luID0gc2VsZi5wYXJ0aWNsZS5vcmlnaW4gKyBmb3J3YXJkX3ZlY3RvciAqIHJpZ2lkaXR5ICogc3BlZWQgKiBzZWxmLnBhcnRpY2xlLnNpbXVsYXRpb24uZGVsdGENCmVuZA0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gaWxsdXNpb24NCi0tLSBAY2xhc3MgaWxsdXNpb25fYw0KLS0tIEBmaWVsZCBwdWJsaWMgdmVyc2lvbiBzdHJpbmcgSWxsdXNpb24gdmVyc2lvbiAoU2VtVmVyIDIuMCkuDQotLS0gQGZpZWxkIHB1YmxpYyBlbmFibGVkIGJvb2xlYW4NCi0tLSBAZmllbGQgcHVibGljIHNoYXJlZCBpbGx1c2lvbl9zaGFyZWRfYyBJbGx1c2lvbiBzaGFyZWQgcHJvcGVydGllcy4NCi0tLSBAZmllbGQgcHVibGljIHNpbXVsYXRpb24gaWxsdXNpb25fc2ltdWxhdGlvbl9jIElsbHVzaW9uIHNpbXVsYXRpb24gcHJvcGVydGllcy4NCi0tLSBAZmllbGQgcHVibGljIHBhcnRpY2xlX21hbmFnZXIgaWxsdXNpb25fcGFydGljbGVfbWFuYWdlcl9jIElsbHVzaW9uIHBhcnRpY2xlIG1hbmFnZXIuDQotLS0gQGZpZWxkIHB1YmxpYyBob29rX21hbmFnZXIgaWxsdXNpb25faG9va19tYW5hZ2VyX2MgSWxsdXNpb24gaG9vayBtYW5hZ2VyLg0KLS0tIEBmaWVsZCBwdWJsaWMgc3RhdGUgaWxsdXNpb25fc3RhdGVfYyBJbGx1c2lvbiBzdGF0ZSBtYW5hZ2VyLg0KLS0tIEBmaWVsZCBwdWJsaWMgY29uc29sZSBjb25zb2xlX2MgSWxsdXNpb24gY29uc29sZS4NCi0tLSBAZmllbGQgcHVibGljIHBhbmljIHBhbmljX2MgSWxsdXNpb24gcGFuaWMgbW9kdWxlLg0KLS0tIEBmaWVsZCBwdWJsaWMgZGVidWdfcGFuZWwgaWxsdXNpb25fZGVidWdfcGFuZWxfYyBJbGx1c2lvbiBkZWJ1ZyBwYW5lbC4NCmxvY2FsIGlsbHVzaW9uX2MgPSB7fQ0KbG9jYWwgaWxsdXNpb25fbXQgPSB7IF9faW5kZXggPSBpbGx1c2lvbl9jIH0NCg0KLS0tIEluc3RhbnRpYXRlIGFuIG9iamVjdCBvZiBpbGx1c2lvbl9jLg0KLS0tIEByZXR1cm4gaWxsdXNpb25fYw0KZnVuY3Rpb24gaWxsdXNpb25fYy5uZXcoKQ0KCWxvY2FsIHNoYXJlZCA9IGlsbHVzaW9uX3NoYXJlZF9jLm5ldygpDQoNCglyZXR1cm4gc2V0bWV0YXRhYmxlKHsNCgkJdmVyc2lvbiA9ICIxLjAuMSIsDQoJCXNoYXJlZCA9IHNoYXJlZCwNCgkJc2ltdWxhdGlvbiA9IGlsbHVzaW9uX3NpbXVsYXRpb25fYy5uZXcoKSwNCgkJcGFydGljbGVfbWFuYWdlciA9IGlsbHVzaW9uX3BhcnRpY2xlX21hbmFnZXJfYy5uZXcoKSwNCgkJaG9va19tYW5hZ2VyID0gaWxsdXNpb25faG9va19tYW5hZ2VyX2MubmV3KCksDQoJCXN0YXRlID0gaWxsdXNpb25fc3RhdGVfYy5uZXcoKSwNCgkJY29uc29sZSA9IGNvbnNvbGVfYy5uZXcoImlsbHUiLCB7DQoJCQlsb2dfcHJlZml4ID0gIltJbGx1c2lvbl0iLA0KCQkJbG9nX3ByZWZpeF9jb2xvciA9IHsyNDAsIDIwNiwgNzJ9DQoJCX0pLA0KCQlwYW5pYyA9IHBhbmljX2MubmV3KGZ1bmN0aW9uKGNvbnNvbGUsIHN0YXRlKQ0KCQkJY29uc29sZTpsb2coe2NvZGUgPSAxfSwgIlRoZSByZW5kZXIgZW5naW5lIGVuY291bnRlcmVkIGEgZmF0YWwgZXJyb3IgYW5kIGhhcyBiZWVuIHNodXQgZG93bi4iKQ0KDQoJCQlzdGF0ZS5jcmFzaGVkID0gdHJ1ZQ0KCQllbmQpLA0KCQlkZWJ1Z19wYW5lbCA9IGlsbHVzaW9uX2RlYnVnX3BhbmVsX2MubmV3KHNoYXJlZCkNCgl9LCBpbGx1c2lvbl9tdCk6aW5pdCgpDQplbmQNCg0KLS0tIGlsbHVzaW9uX2MgY29uc3RydWN0b3IgbWV0aG9kLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fYzppbml0KCkNCgktLSBVcGRhdGUgc3RhdGUuDQoJc2VsZi5zdGF0ZTpzeW5jKCkNCg0KCS0tIFVwZGF0ZSBzaW11bGF0aW9uLg0KCXNlbGYuc2ltdWxhdGlvbjpzeW5jKCkNCg0KCS0tIFVwZGF0ZSBzaGFyZWQgcHJvcGVydGllcy4NCglzZWxmLnNoYXJlZDpzeW5jKCkNCg0KCXJldHVybiBzZWxmDQplbmQNCg0KLS0tIFByb2Nlc3MgdGhlIGN1cnJlbnQgZnJhbWUuDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9jOnByb2Nlc3MoKQ0KCS0tIFVwZGF0ZSBzdGF0ZS4NCglzZWxmLnN0YXRlOnN5bmMoKQ0KDQoJLS0gRW5naW5lIGlzIG5vdCBhdmFpbGFibGUgZm9yIHVzZS4NCglpZiAoc2VsZi5zdGF0ZTphdmFpbGFibGUoKSA9PSBmYWxzZSkgdGhlbg0KCQlyZXR1cm4NCgllbmQNCg0KCS0tIFVwZGF0ZSBzaW11bGF0aW9uLg0KCXNlbGYuc2ltdWxhdGlvbjpzeW5jKCkNCg0KCS0tIFVwZGF0ZSBzaGFyZWQgcHJvcGVydGllcy4NCglzZWxmLnNoYXJlZDpzeW5jKCkNCgkNCgktLSBQcm9jZXNzIGFsbCBob29rIHRpY2sgcmF0ZXMuDQoJc2VsZjpwcm9jZXNzX2hvb2tfdGlja19yYXRlKCkNCg0KCS0tIFByb2Nlc3MgcGFydGljbGUgZnJhbWVzIGFuZCB0aWNrcy4NCglzZWxmLnBhcnRpY2xlX21hbmFnZXI6cHJvY2VzcygpDQoNCgktLSBTZXQgZGVidWcgbGluZXMuDQoJc2VsZjpkZWJ1Z19saW5lcygpDQoNCgktLSBSZW5kZXIgZGVidWcgcGFuZWwuDQoJc2VsZi5kZWJ1Z19wYW5lbDpyZW5kZXIoKQ0KZW5kDQoNCi0tLSBQcm9jZXNzIHRoZSBjdXJyZW50IHRpY2suDQotLS0gQHJldHVybiB2b2lkDQpmdW5jdGlvbiBpbGx1c2lvbl9jOnByb2Nlc3NfaG9va190aWNrX3JhdGUoKQ0KCWZvciBfLCBob29rIGluIHBhaXJzIChzZWxmLmhvb2tfbWFuYWdlci5ob29rcykgZG8NCgkJaG9vazp1cGRhdGVfdGlja190aGlzX2ZyYW1lKCkNCgllbmQNCmVuZA0KDQotLS0gU2V0IGRlYnVnIGxpbmVzLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fYzpkZWJ1Z19saW5lcygpDQoJc2VsZi5kZWJ1Z19wYW5lbDpsaW5lKCJwbGF5ZXIiLCAiZW50aXR5IGluZGV4IiwgIm5vcm1hbCIsIHNlbGYuc2hhcmVkLnBsYXllcl9laWQpDQoNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInBsYXllciBzdGF0ZXMiLCAiaXMgdGhpcmRwZXJzb24iLCAibm9ybWFsIiwgc2VsZi5zaGFyZWQuaXNfdGhpcmRwZXJzb24gYW5kICJ5ZXMiIG9yICJubyIpDQoJc2VsZi5kZWJ1Z19wYW5lbDpsaW5lKCJwbGF5ZXIgc3RhdGVzIiwgImlzIGRlYWQiLCAibm9ybWFsIiwgc2VsZi5zaGFyZWQuaXNfZGVhZCBhbmQgInllcyIgb3IgIm5vIikNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInBsYXllciBzdGF0ZXMiLCAiaXMgc2NvcGVkIiwgIm5vcm1hbCIsIHNlbGYuc2hhcmVkLmlzX3Njb3BlZCBhbmQgInllcyIgb3IgIm5vIikNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInBsYXllciBzdGF0ZXMiLCAiaXMgZmFrZSBkdWNraW5nIiwgIm5vcm1hbCIsIHNlbGYuc2hhcmVkLmlzX2Zha2VfZHVja2luZyBhbmQgInllcyIgb3IgIm5vIikNCg0KCXNlbGYuZGVidWdfcGFuZWw6bGluZSgicGxheWVyIHdvcmxkIGluZm8iLCAib3JpZ2luIiwgIm5vcm1hbCIsIHNlbGYuc2hhcmVkLnBsYXllcl9vcmlnaW46cm91bmRlZF96ZXJvKCkpDQoJc2VsZi5kZWJ1Z19wYW5lbDpsaW5lKCJwbGF5ZXIgd29ybGQgaW5mbyIsICJleWUgcG9zaXRpb24iLCAibm9ybWFsIiwgc2VsZi5zaGFyZWQucGxheWVyX2V5ZV9wb3NpdGlvbjpyb3VuZGVkX3plcm8oKSkNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInBsYXllciB3b3JsZCBpbmZvIiwgImNhbWVyYSBwb3NpdGlvbiIsICJub3JtYWwiLCBzZWxmLnNoYXJlZC5wbGF5ZXJfY2FtZXJhX3Bvc2l0aW9uOnJvdW5kZWRfemVybygpKQ0KCXNlbGYuZGVidWdfcGFuZWw6bGluZSgicGxheWVyIHdvcmxkIGluZm8iLCAiY2FtZXJhIGFuZ2xlcyIsICJub3JtYWwiLCBzZWxmLnNoYXJlZC5wbGF5ZXJfY2FtZXJhX2FuZ2xlczpyb3VuZGVkX3plcm8oKSkNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInBsYXllciB3b3JsZCBpbmZvIiwgInNwZWVkIiwgIm5vcm1hbCIsIG1hdGgucm91bmQoc2VsZi5zaGFyZWQucGxheWVyX3NwZWVkLCAwKSkNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInBsYXllciB3b3JsZCBpbmZvIiwgInZlbG9jaXR5IHZlY3RvciIsICJub3JtYWwiLCBzZWxmLnNoYXJlZC5wbGF5ZXJfdmVsb2NpdHk6cm91bmRlZF96ZXJvKCkpDQoNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInNjcmVlbiIsICJyZXNvbHV0aW9uIiwgIm5vcm1hbCIsIHN0cmluZy5mb3JtYXQoIiVzeCVzIiwgc2VsZi5zaGFyZWQucmVzb2x1dGlvbi54LCBzZWxmLnNoYXJlZC5yZXNvbHV0aW9uLnkpKQ0KCXNlbGYuZGVidWdfcGFuZWw6bGluZSgic2NyZWVuIiwgImNhbWVyYSBhc3BlY3QiLCAibm9ybWFsIiwgbWF0aC5yb3VuZChzZWxmLnNoYXJlZC5jYW1lcmFfYXNwZWN0LCA0KSkNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInNjcmVlbiIsICJmaWVsZCBvZiB2aWV3IiwgIm5vcm1hbCIsIG1hdGgucm91bmQoc2VsZi5zaGFyZWQuZm92LCAwKSkNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInNjcmVlbiIsICJzY29wZWQgZmllbGQgb2YgdmlldyIsICJub3JtYWwiLCBtYXRoLnJvdW5kKHNlbGYuc2hhcmVkLnNjb3BlX2ZvdiwgMCkpDQoJc2VsZi5kZWJ1Z19wYW5lbDpsaW5lKCJzY3JlZW4iLCAic2NvcGUgbGV2ZWwiLCAibm9ybWFsIiwgc2VsZi5zaGFyZWQuc2NvcGVfbGV2ZWwpDQoJc2VsZi5kZWJ1Z19wYW5lbDpsaW5lKCJzY3JlZW4iLCAic2NvcGVkIGZpZWxkIG9mIHZpZXcgbW9kaWZpZXIiLCAibm9ybWFsIiwgbWF0aC5yb3VuZChzZWxmLnNoYXJlZC56b29tX21vZGlmaWVyLCAwKSkNCg0KCXNlbGYuZGVidWdfcGFuZWw6bGluZSgib2JzZXJ2ZXIiLCAiZW50aXR5IGluZGV4IiwgIm5vcm1hbCIsIHNlbGYuc2hhcmVkLm9ic2VydmVyX2VpZCkNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoIm9ic2VydmVyIiwgIm1vZGUiLCAibm9ybWFsIiwgc2VsZi5zaGFyZWQub2JzZXJ2ZXJfbW9kZSkNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoIm9ic2VydmVyIiwgInRlYW0iLCAibm9ybWFsIiwgc2VsZi5zaGFyZWQub2JzZXJ2aW5nX3RlYW0pDQoJc2VsZi5kZWJ1Z19wYW5lbDpsaW5lKCJvYnNlcnZlciIsICJvYnNlcnZpbmcgc2VsZiIsICJub3JtYWwiLCBzZWxmLnNoYXJlZC5vYnNlcnZpbmdfc2VsZiBhbmQgInllcyIgb3IgIm5vIikNCg0KCXNlbGYuZGVidWdfcGFuZWw6bGluZSgicGFydGljbGUgbWFuYWdlciIsICJ0b3RhbCBzcGF3bmVkIiwgIm5vcm1hbCIsIHNlbGYucGFydGljbGVfbWFuYWdlci50b3RhbF9zcGF3bmVkKQ0KDQoJbG9jYWwgdG90YWxfYWxpdmVfY29sb3IgPSAibm9ybWFsIg0KDQoJaWYgKHNlbGYucGFydGljbGVfbWFuYWdlci50b3RhbF9hbGl2ZSA+PSBzZWxmLnBhcnRpY2xlX21hbmFnZXIuaGFyZF9saW1pdCkgdGhlbg0KCQl0b3RhbF9hbGl2ZV9jb2xvciA9ICJ3YXJuaW5nIg0KCWVsc2VpZiAoc2VsZi5wYXJ0aWNsZV9tYW5hZ2VyLnRvdGFsX2FsaXZlID49IHNlbGYucGFydGljbGVfbWFuYWdlci5zb2Z0X2xpbWl0KSB0aGVuDQoJCXRvdGFsX2FsaXZlX2NvbG9yID0gIm5vdGljZSINCgllbmQNCg0KCXNlbGYuZGVidWdfcGFuZWw6bGluZSgicGFydGljbGUgbWFuYWdlciIsICJ0b3RhbCBhbGl2ZSIsIHRvdGFsX2FsaXZlX2NvbG9yLCBzZWxmLnBhcnRpY2xlX21hbmFnZXIudG90YWxfYWxpdmUpDQoNCglsb2NhbCBzb2Z0X2xpbWl0X2NvbG9yID0gIm5vcm1hbCINCg0KCWlmIChzZWxmLnBhcnRpY2xlX21hbmFnZXIuc29mdF9saW1pdCA+PSA4MTkyKSB0aGVuDQoJCXNvZnRfbGltaXRfY29sb3IgPSAiZXJyb3IiDQoJZWxzZWlmIChzZWxmLnBhcnRpY2xlX21hbmFnZXIuc29mdF9saW1pdCA+PSA0MDk2KSB0aGVuDQoJCXNvZnRfbGltaXRfY29sb3IgPSAid2FybmluZyINCgllbHNlaWYgKHNlbGYucGFydGljbGVfbWFuYWdlci5zb2Z0X2xpbWl0ID49IDIwNDgpIHRoZW4NCgkJc29mdF9saW1pdF9jb2xvciA9ICJub3RpY2UiDQoJZW5kDQoNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInBhcnRpY2xlIG1hbmFnZXIiLCAic29mdCBsaW1pdCIsIHNvZnRfbGltaXRfY29sb3IsIHNlbGYucGFydGljbGVfbWFuYWdlci5zb2Z0X2xpbWl0KQ0KDQoJbG9jYWwgaGFyZF9saW1pdF9jb2xvciA9ICJub3JtYWwiDQoNCglpZiAoc2VsZi5wYXJ0aWNsZV9tYW5hZ2VyLmhhcmRfbGltaXQgPj0gODE5MikgdGhlbg0KCQloYXJkX2xpbWl0X2NvbG9yID0gImVycm9yIg0KCWVsc2VpZiAoc2VsZi5wYXJ0aWNsZV9tYW5hZ2VyLmhhcmRfbGltaXQgPj0gNDA5NikgdGhlbg0KCQloYXJkX2xpbWl0X2NvbG9yID0gIndhcm5pbmciDQoJZWxzZWlmIChzZWxmLnBhcnRpY2xlX21hbmFnZXIuaGFyZF9saW1pdCA+PSAyMDQ4KSB0aGVuDQoJCWhhcmRfbGltaXRfY29sb3IgPSAibm90aWNlIg0KCWVuZA0KDQoJc2VsZi5kZWJ1Z19wYW5lbDpsaW5lKCJwYXJ0aWNsZSBtYW5hZ2VyIiwgImhhcmQgbGltaXQiLCBoYXJkX2xpbWl0X2NvbG9yLCBzZWxmLnBhcnRpY2xlX21hbmFnZXIuaGFyZF9saW1pdCkNCg0KCXNlbGYuZGVidWdfcGFuZWw6bGluZSgic2ltdWxhdGlvbiIsICJmcmFtZXRpbWUiLCAibm9ybWFsIiwgbWF0aC5yb3VuZChzZWxmLnNpbXVsYXRpb24uZnJhbWV0aW1lLCA0KSkNCglzZWxmLmRlYnVnX3BhbmVsOmxpbmUoInNpbXVsYXRpb24iLCAiZGVsdGEiLCAibm9ybWFsIiwgbWF0aC5yb3VuZChzZWxmLnNpbXVsYXRpb24uZGVsdGEsIDQpKQ0KCXNlbGYuZGVidWdfcGFuZWw6bGluZSgic2ltdWxhdGlvbiIsICJmcmFtZSIsICJub3JtYWwiLCBzZWxmLnNpbXVsYXRpb24uZnJhbWUpDQoJc2VsZi5kZWJ1Z19wYW5lbDpsaW5lKCJzaW11bGF0aW9uIiwgImZwcyIsICJub3JtYWwiLCBzZWxmLnNpbXVsYXRpb24uZnBzKCkpDQoJc2VsZi5kZWJ1Z19wYW5lbDpsaW5lKCJzaW11bGF0aW9uIiwgInZpc2NoZWNrIGludGVydmFsIiwgIm5vcm1hbCIsIHNlbGYuc2ltdWxhdGlvbi52aXNjaGVja19pbnRlcnZhbCkNCg0KCWZvciBfLCBob29rIGluIHBhaXJzKHNlbGYuaG9va19tYW5hZ2VyLmhvb2tzKSBkbw0KCQlzZWxmLmRlYnVnX3BhbmVsOmxpbmUoImhvb2sgbWFuYWdlciIsIGhvb2submFtZSwgIm5vcm1hbCIsIHN0cmluZy5mb3JtYXQoDQoJCQkiJXMgdG90YWwgfCAlcyBhbGl2ZSIsDQoJCQlob29rLnRvdGFsX3NwYXduZWQsDQoJCQlob29rLnRvdGFsX2FsaXZlDQoJCSkpDQoJZW5kDQplbmQNCi0tZW5kcmVnaW9uDQoNCi0tcmVnaW9uIHNldHVwDQotLSBNYWluIElsbHVzaW9uIGluc3RhbmNlLg0KbG9jYWwgaWxsdXNpb24gPSBpbGx1c2lvbl9jLm5ldygpDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBpbGx1c2lvbl93cmFwcGVyDQotLS0gQGNsYXNzIGlsbHVzaW9uX3dyYXBwZXJfYw0KLS0tIEBmaWVsZCBwdWJsaWMgaG9vayBpbGx1c2lvbl9ob29rX2MgSWxsdXNpb24gd3JhcHBlcidzIGhvb2suDQotLS0gQGZpZWxkIHB1YmxpYyB0aW1lcl9zdGFuZGFyZCB0aW1lcl9zdGFuZGFyZF9jIElsbHVzaW9uIHRpbWVyIHN0YW5kYXJkLg0KLS0tIEBmaWVsZCBwdWJsaWMgdGltZXJfdGljayB0aW1lcl90aWNrX2MgSWxsdXNpb24gdGltZXIgdGljay4NCi0tLSBAZmllbGQgcHVibGljIHRpbWVyX2NvdW50ZG93biB0aW1lcl9jb3VudGRvd25fYyBJbGx1c2lvbiB0aW1lciBjb3VudGRvd24uDQotLS0gQGZpZWxkIHB1YmxpYyB2ZWN0b3IgZnVuKHg6IG51bWJlciwgeTogbnVtYmVyLCB6OiBudW1iZXIpOiB2ZWN0b3Jfb2xkX2MgSWxsdXNpb24gdmVjdG9yIGZ1bmN0aW9uLg0KLS0tIEBmaWVsZCBwdWJsaWMgYW5nbGUgZnVuKHA6IG51bWJlciwgeTogbnVtYmVyLCByOiBudW1iZXIpOiBhbmdsZV9vbGRfYyBJbGx1c2lvbiBhbmdsZSBmdW5jdGlvbi4NCi0tLSBAZmllbGQgcHVibGljIHNoYWRlciBzaGFkZXJfYyBJbGx1c2lvbiBzaGFkZXIuDQotLS0gQGZpZWxkIHB1YmxpYyBhbmltYXRvciBpbGx1c2lvbl9hbmltYXRvcl9jIElsbHVzaW9uIGFuaW1hdG9yIGhlbHBlci4NCi0tLSBAZmllbGQgcHVibGljIHNoYXJlZCBpbGx1c2lvbl9zaGFyZWRfYyBJbGx1c2lvbiBzaGFyZWQgcHJvcGVydGllcy4NCi0tLSBAZmllbGQgcHVibGljIHNpbXVsYXRpb24gaWxsdXNpb25fc2ltdWxhdGlvbl9jIElsbHVzaW9uIHNpbXVsYXRpb24gcHJvcGVydGllcy4NCmxvY2FsIGlsbHVzaW9uX3dyYXBwZXJfYyA9IHt9DQpsb2NhbCBpbGx1c2lvbl93cmFwcGVyX210ID0geyBfX2luZGV4ID0gaWxsdXNpb25fd3JhcHBlcl9jIH0NCg0KLS0tIEluc3RhbnRpYXRlIGFuIG9iamVjdCBvZiBpbGx1c2lvbl93cmFwcGVyX2MuDQotLS0gQHBhcmFtIGhvb2sgaWxsdXNpb25faG9va19jDQotLS0gQHJldHVybiBpbGx1c2lvbl93cmFwcGVyX2MNCmZ1bmN0aW9uIGlsbHVzaW9uX3dyYXBwZXJfYy5uZXcoaG9vaykNCglyZXR1cm4gc2V0bWV0YXRhYmxlKHsNCgkJaG9vayA9IGhvb2ssDQoJCXRpbWVyX3N0YW5kYXJkID0gdGltZXIuc3RhbmRhcmQsDQoJCXRpbWVyX3RpY2sgPSB0aW1lci50aWNrLA0KCQl0aW1lcl9jb3VudGRvd25fYyA9IHRpbWVyLmNvdW50ZG93biwNCgkJdmVjdG9yID0gdmVjdG9yLA0KCQlhbmdsZSA9IGFuZ2xlLA0KCQlzaGFkZXIgPSBzaGFkZXJfYywNCgkJYW5pbWF0b3IgPSBpbGx1c2lvbl9hbmltYXRvciwNCgkJc2hhcmVkID0gaWxsdXNpb24uc2hhcmVkLA0KCQlzaW11bGF0aW9uID0gaWxsdXNpb24uc2ltdWxhdGlvbg0KCX0sIGlsbHVzaW9uX3dyYXBwZXJfbXQpDQplbmQNCg0KLS0tIENyZWF0ZSBhIHBhcnRpY2xlLg0KLS0tIEByZXR1cm4gaWxsdXNpb25fcGFydGljbGVfY3xuaWwNCmZ1bmN0aW9uIGlsbHVzaW9uX3dyYXBwZXJfYzpjcmVhdGUoKQ0KCS0tIFBhcnRpY2xlIElELg0KCWxvY2FsIHBhcnRpY2xlX2lkID0gaWxsdXNpb24ucGFydGljbGVfbWFuYWdlci50b3RhbF9zcGF3bmVkICsgMQ0KDQoJLS0gQ3JlYXRlIHRoZSBwYXJ0aWNsZS4NCglsb2NhbCBwYXJ0aWNsZSA9IGlsbHVzaW9uX3BhcnRpY2xlX2MubmV3KHBhcnRpY2xlX2lkLCBpbGx1c2lvbi5zaGFyZWQsIGlsbHVzaW9uLnNpbXVsYXRpb24sIHNlbGYuaG9vaykNCg0KCS0tIEFkZCB0aGUgcGFydGljbGUgdG8gdGhlIHBhcnRpY2xlIG1hbmFnZXIgYW5kIGhvb2suDQoJaWxsdXNpb24ucGFydGljbGVfbWFuYWdlcjphZGQocGFydGljbGUpDQoNCglyZXR1cm4gcGFydGljbGUNCmVuZA0KDQotLS0gUmVtb3ZlcyBhbGwgcGFydGljbGVzLg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fd3JhcHBlcl9jOndpcGUoKQ0KCWZvciBfLCBwYXJ0aWNsZSBpbiBwYWlycyhzZWxmLmhvb2sucGFydGljbGVzKSBkbw0KCQlzZWxmLmhvb2s6cmVtb3ZlKHBhcnRpY2xlKQ0KCQlpbGx1c2lvbi5wYXJ0aWNsZV9tYW5hZ2VyOnJlbW92ZShwYXJ0aWNsZSkNCgllbmQNCmVuZA0KDQotLS0gUmV0dXJucyB0cnVlIGlmIElsbHVzaW9uIGlzIGF2YWlsYWJsZSBmb3IgdXNlLg0KLS0tIEByZXR1cm4gYm9vbGVhbg0KZnVuY3Rpb24gaWxsdXNpb25fd3JhcHBlcl9jOmF2YWlsYWJsZSgpDQoJcmV0dXJuIGlsbHVzaW9uLnN0YXRlOmF2YWlsYWJsZSgpDQplbmQNCg0KLS0tIFNldCB0aGUgb25fdGljayBpbnRlcnZhbCBmb3IgcGFydGljbGVzIGluIHNlY29uZHMuDQotLS0gQHBhcmFtIGludGVydmFsIG51bWJlcg0KLS0tIEByZXR1cm4gdm9pZA0KZnVuY3Rpb24gaWxsdXNpb25fd3JhcHBlcl9jOnNldF90aWNrX2ludGVydmFsKGludGVydmFsKQ0KCXNlbGYuaG9vay50aWNrX2ludGVydmFsID0gaW50ZXJ2YWwNCmVuZA0KLS1lbmRyZWdpb24NCg0KLS1yZWdpb24gbWVudQ0KbG9jYWwgbWVudSA9IG1lbnVfbWFuYWdlcl9jLm5ldygiY29uZmlnIiwgInByZXNldHMiKQ0KDQptZW51OmxhYmVsKCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIpDQptZW51OmxhYmVsKHN0cmluZy5mb3JtYXQoIkhhdm9jIElsbHVzaW9uIC0gdiVzIiwgaWxsdXNpb24udmVyc2lvbikpDQoNCmxvY2FsIGVuYWJsZV9pbGx1c2lvbiA9IG1lbnU6Y2hlY2tib3goIkVuYWJsZSBIYXZvYyBJbGx1c2lvbiIpDQoNCmVuYWJsZV9pbGx1c2lvbih0cnVlKQ0KDQplbmFibGVfaWxsdXNpb246YWRkX2NhbGxiYWNrKGZ1bmN0aW9uKCkNCglpbGx1c2lvbi5zdGF0ZS5lbmFibGVkID0gZW5hYmxlX2lsbHVzaW9uKCkNCmVuZCkNCg0KbG9jYWwgc29mdF9saW1pdCA9IG1lbnU6c2xpZGVyKA0KCSJTb2Z0IHBhcnRpY2xlIGxpbWl0IiwNCgk1LA0KCTEzLA0KCXsNCgkJZGVmYXVsdCA9IDEwLA0KCQl0b29sdGlwcyA9IHsNCgkJCVs1XSA9ICIzMiIsDQoJCQlbNl0gPSAiNjQiLA0KCQkJWzddID0gIjEyOCIsDQoJCQlbOF0gPSAiMjU2IiwNCgkJCVs5XSA9ICI1MTIiLA0KCQkJWzEwXSA9ICIxMDI0IiwNCgkJCVsxMV0gPSAiMjA0OCIsDQoJCQlbMTJdID0gIjQwOTYiLA0KCQkJWzEzXSA9ICI4MTkyIg0KCQl9DQoJfQ0KKQ0KDQpsb2NhbCBoYXJkX2xpbWl0ID0gbWVudTpzbGlkZXIoDQoJIkhhcmQgcGFydGljbGUgbGltaXQiLA0KCTUsDQoJMTMsDQoJew0KCQlkZWZhdWx0ID0gMTEsDQoJCXRvb2x0aXBzID0gew0KCQkJWzVdID0gIjMyIiwNCgkJCVs2XSA9ICI2NCIsDQoJCQlbN10gPSAiMTI4IiwNCgkJCVs4XSA9ICIyNTYiLA0KCQkJWzldID0gIjUxMiIsDQoJCQlbMTBdID0gIjEwMjQiLA0KCQkJWzExXSA9ICIyMDQ4IiwNCgkJCVsxMl0gPSAiNDA5NiIsDQoJCQlbMTNdID0gIjgxOTIiDQoJCX0NCgl9DQopDQoNCnNvZnRfbGltaXQ6YWRkX2NhbGxiYWNrKGZ1bmN0aW9uKCkNCglsb2NhbCBzb2Z0ID0gc29mdF9saW1pdCgpDQoJbG9jYWwgaGFyZCA9IGhhcmRfbGltaXQoKQ0KDQoJaWYgKHNvZnQgPiBoYXJkKSB0aGVuDQoJCWhhcmRfbGltaXQoc29mdCkNCgllbmQNCg0KCWlsbHVzaW9uLnBhcnRpY2xlX21hbmFnZXIuc29mdF9saW1pdCA9IDIgXiBzb2Z0DQplbmQpDQoNCmhhcmRfbGltaXQ6YWRkX2NhbGxiYWNrKGZ1bmN0aW9uKCkNCglsb2NhbCBzb2Z0ID0gc29mdF9saW1pdCgpDQoJbG9jYWwgaGFyZCA9IGhhcmRfbGltaXQoKQ0KDQoJaWYgKGhhcmQgPCBzb2Z0KSB0aGVuDQoJCXNvZnRfbGltaXQoaGFyZCkNCgllbmQNCg0KCWlsbHVzaW9uLnBhcnRpY2xlX21hbmFnZXIuaGFyZF9saW1pdCA9IDIgXiBoYXJkDQplbmQpDQoNCmxvY2FsIGVuYWJsZV9kZWJ1Z19wYW5lbCA9IG1lbnU6Y2hlY2tib3goIkVuYWJsZSBkZWJ1ZyBwYW5lbCIpDQoNCmVuYWJsZV9kZWJ1Z19wYW5lbDphZGRfY2FsbGJhY2soZnVuY3Rpb24oKQ0KCWlsbHVzaW9uLmRlYnVnX3BhbmVsLmVuYWJsZWQgPSBlbmFibGVfZGVidWdfcGFuZWwoKQ0KZW5kKQ0KDQplbmFibGVfaWxsdXNpb246YWRkX2NoaWxkcmVuKHsNCglzb2Z0X2xpbWl0LA0KCWhhcmRfbGltaXQsDQoJZW5hYmxlX2RlYnVnX3BhbmVsDQp9KQ0KDQptZW51OmxvYWRfZnJvbV9kYigpDQotLWVuZHJlZ2lvbg0KDQotLXJlZ2lvbiBtYWluDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludCIsIGZ1bmN0aW9uKCkNCgktLSBJbGx1c2lvbiBpcyBpbiBwYW5pYyBtb2RlLg0KCWlmIChpbGx1c2lvbi5wYW5pYzp0ZXN0KGlsbHVzaW9uLmNvbnNvbGUsIGlsbHVzaW9uLnN0YXRlKSA9PSBmYWxzZSkgdGhlbg0KCQlyZXR1cm4NCgllbmQNCg0KCS0tIEJlZ2luIHBhbmljIHRlc3QuDQoJaWxsdXNpb24ucGFuaWM6c3RhcnQoKQ0KDQoJLS0gUHJvY2VzcyBjdXJyZW50IGVuZ2luZSBmcmFtZS4NCglpbGx1c2lvbjpwcm9jZXNzKCkNCg0KCS0tIENvbXBsZXRlIHBhbmljIHRlc3QuDQoJaWxsdXNpb24ucGFuaWM6c3RvcCgpDQplbmQpDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBsYXllcl9jb25uZWN0X2Z1bGwiLCBmdW5jdGlvbigpDQoJaWYgKGlsbHVzaW9uLnN0YXRlOmF2YWlsYWJsZSgpID09IGZhbHNlKSB0aGVuDQoJCXJldHVybg0KCWVuZA0KDQoJLS0gUmVtb3ZlIGFsbCBwYXJ0aWNsZXMuDQoJZm9yIF8sIGhvb2sgaW4gcGFpcnMoaWxsdXNpb24uaG9va19tYW5hZ2VyLmhvb2tzKSBkbw0KCQlmb3IgXywgcGFydGljbGUgaW4gcGFpcnMoaG9vay5wYXJ0aWNsZXMpIGRvDQoJCQlpbGx1c2lvbi5wYXJ0aWNsZV9tYW5hZ2VyOnJlbW92ZShwYXJ0aWNsZSkNCgkJZW5kDQoJZW5kDQplbmQpDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInNodXRkb3duIiwgZnVuY3Rpb24oKQ0KCW1lbnU6c2F2ZV90b19kYigpDQplbmQpDQoNCg0KLS0tIEBwYXJhbSBob29rX25hbWUgc3RyaW5nDQotLS0gQHJldHVybiBpbGx1c2lvbl93cmFwcGVyX2MNCnJldHVybiBmdW5jdGlvbihob29rX25hbWUpDQoJbG9jYWwgaG9vayA9IGlsbHVzaW9uLmhvb2tfbWFuYWdlcjpjcmVhdGUoaG9va19uYW1lKQ0KDQoJcmV0dXJuIGlsbHVzaW9uX3dyYXBwZXJfYy5uZXcoaG9vaykNCmVuZA0KLS1lbmRyZWdpb24NCg==]])
	return loadstring(string)()(param)
end

--region dependencies
--region dependency: havoc_menu_1_3_0
--region menu_assert
--- Assert.
--- @param expression boolean
--- @param level number
--- @param message string
--- @vararg string
--- @return void
local function menu_assert(expression, level, message, ...)
	if (not expression) then
		error(string.format(message, ...), level)
	end
end
--endregion

--region menu_map
local menu_map = {
	rage = {"aimbot", "other"},
	aa = {"anti-aimbot angles", "fake lag", "other"},
	legit = {"weapon type", "aimbot", "triggerbot", "other"},
	visuals = {"player esp", "other esp", "colored models", "effects"},
	misc = {"miscellaneous", "settings", "lua", "other"},
	skins = {"weapon skin", "knife options", "glove options"},
	config = {"presets", "lua"},
	players = {"players", "adjustments"},
	lua = {"a", "b"}
}

for tab, containers in pairs(menu_map) do
	menu_map[tab] = {}

	for i=1, #containers do
		menu_map[tab][containers[i]] = true
	end
end
--endregion

--region menu_item
--- @class menu_item_c
--- @field public tab string
--- @field public container string
--- @field public name string
--- @field public reference number
--- @field public visible boolean
--- @field public hidden_value any
--- @field public children table<number, menu_item_c>
--- @field public ui_callback function
--- @field public getter table
--- @field public setter table
--- @field public parent_value_or_callback any|function
local menu_item_c = {}

local menu_item_mt = {
	__index = menu_item_c
}

--- @param item menu_item_c
--- @vararg any
--- @return menu_item_c|any
function menu_item_mt.__call(item, ...)
	local args = {...}

	if (#args == 0) then
		return item:get()
	end

	local do_ui_set = {pcall(item.set, item, unpack(args))}

	menu_assert(do_ui_set[1], 4, do_ui_set[2])

	return item
end

--- Create a new menu_item_c.
--- @param element function
--- @param tab string
--- @param container string
--- @param name string
--- @vararg any
--- @return menu_item_c
function menu_item_c.new(element, tab, container, name, ...)
	local reference
	local is_menu_reference = false

	if ((type(element)) == "function") then
		local do_ui_new = { pcall(element, tab, container, name, ...)}

		menu_assert(do_ui_new[1], 4, "Cannot create menu item because: %s", do_ui_new[2])

		reference = do_ui_new[2]
	else
		reference = element
		is_menu_reference = true
	end

	return setmetatable(
		{
			tab = tab,
			container = container,
			name = name,
			reference = reference,
			visible = true,
			hidden_value = nil,
			children = {},
			ui_callback = nil,
			callbacks = {},
			is_menu_reference = is_menu_reference,
			getter = {
				callback = nil,
				data = nil
			},
			setter = {
				callback = nil,
				data = nil
			},
			parent_value_or_callback = nil
		},
		menu_item_mt
	)
end

--- @param value any
--- @return void
function menu_item_c:set_hidden_value(value)
	self.hidden_value = value
end

--- @vararg any
--- @return void
function menu_item_c:set(...)
	local args = {...}

	if (self.setter.callback ~= nil) then
		args = self.setter.callback(unpack(args))
	end

	local do_ui_set = {pcall(ui.set, self.reference, unpack(args))}

	menu_assert(do_ui_set[1], 3, "Cannot set values of menu item because: %s", do_ui_set[2])
end

--- @return any
function menu_item_c:get()
	if (self.visible == false and self.hidden_value ~= nil) then
		return self.hidden_value
	end

	local get = {ui.get(self.reference)}

	if (self.getter.callback ~= nil) then
		return self.getter.callback(get)
	end

	return unpack(get)
end

--- @param callback function
--- @param data any
--- @return void
function menu_item_c:set_setter_callback(callback, data)
	menu_assert(type(callback) == "function", 3, "Cannot set menu item setter callback: argument must be a function.")

	self.setter.callback = callback
	self.setter.data = data
end

--- @param callback function
--- @param data any
--- @return void
function menu_item_c:set_getter_callback(callback, data)
	menu_assert(type(callback) == "function", 3, "Cannot set menu item getter callback: argument must be a function.")

	self.getter.callback = callback
	self.getter.data = data
end

--- @param children table<any, menu_item_c>
--- @param value_or_callback function|any
--- @return void
function menu_item_c:add_children(children, value_or_callback)
	if (value_or_callback == nil) then
		value_or_callback = true
	end

	if (getmetatable(children) == menu_item_mt) then
		children = {children}
	end

	for _, child in pairs(children) do
		menu_assert(getmetatable(child) == menu_item_mt, 3, "Cannot add child to menu item: children must be menu item objects. Make sure you are not trying to parent a UI reference.")
		menu_assert(child.reference ~= self.reference, 3, "Cannot parent a menu item to iself.")

		child.parent_value_or_callback = value_or_callback
		self.children[child.reference] = child
	end

	menu_item_c._process_callbacks(self)
end

--- @param callback function
--- @return void
function menu_item_c:add_callback(callback)
	menu_assert(self.is_menu_reference == false, 3, "Cannot add callbacks to built-in menu items.")
	menu_assert(type(callback) == "function", 3, "Callbacks for menu items must be functions.")

	table.insert(self.callbacks, callback)

	menu_item_c._process_callbacks(self)
end

--- @param item menu_item_c
--- @return void
function menu_item_c._process_callbacks(item)
	local callback = function()
		for _, child in pairs(item.children) do
			local is_child_visible

			if (type(child.parent_value_or_callback) == "function") then
				is_child_visible = child.parent_value_or_callback()
			else
				is_child_visible = item:get() == child.parent_value_or_callback
			end

			local is_visible = (is_child_visible == true) and (item.visible == true)
			child.visible = is_visible

			ui.set_visible(child.reference, is_visible)

			if (child.ui_callback ~= nil) then
				child.ui_callback()
			end
		end

		for i = 1, #item.callbacks do
			item.callbacks[i]()
		end
	end

	ui.set_callback(item.reference, callback)
	item.ui_callback = callback

	callback()
end
--endregion

--region menu_manager
--- @class menu_manager_c
--- @field public tab string
--- @field public container string
--- @field public children table<number, menu_item_c>
local menu_manager_c = {}

local menu_manager_mt = {
	__index = menu_manager_c
}

--- Create a new menu_manager_c.
--- @param tab string
--- @param container string
--- @return menu_manager_c
function menu_manager_c.new(tab, container)
	menu_manager_c._validate_tab_container(tab, container)

	return setmetatable(
		{
			tab = tab,
			container = container,
			children = {}
		},
		menu_manager_mt
	)
end

--- Saves the values for menu items currently created to the database.
--- @return void
function menu_manager_c:save_to_db()
	local prefix = string.format("%s_%s", self.tab, self.container)

	for _, item in pairs(self.children) do
		local key = string.format("%s_%s", prefix, item.name)
		local data = {item()}

		database.write(key, data)
	end
end

--- Loads the values for menu items currently created from to the database.
--- @return void
function menu_manager_c:load_from_db()
	local prefix = string.format("%s_%s", self.tab, self.container)

	for _, item in pairs(self.children) do
		local key = string.format("%s_%s", prefix, item.name)
		local data = database.read(key)

		if (data ~= nil) then
			item(unpack(data))
		end
	end
end

--- @param item menu_item_c
--- @param value_or_callback function|any
--- @return void
function menu_manager_c:parent_all_to(item, value_or_callback)
	local children = self.children

	children[item.reference] = nil

	item:add_children(children, value_or_callback)
end

--- @param tab string
--- @param container string
--- @param name string
--- @return menu_item_c
function menu_manager_c.reference(tab, container, name)
	menu_manager_c._validate_tab_container(tab, container)

	local do_reference = {pcall(ui.reference, tab, container, name)}

	menu_assert(do_reference[1], 3, "Cannot reference Gamesense menu item because: %s", do_reference[2])

	local references = {select(2, unpack(do_reference))}
	local items = {}

	for i = 1, #references do
		table.insert(
			items,
			menu_item_c.new(
				references[i],
				tab,
				container,
				name
			)
		)
	end

	return unpack(items)
end

--- @param name string
--- @return menu_item_c
function menu_manager_c:checkbox(name)
	return self:_create_item(ui.new_checkbox, name)
end

--- @param name string
--- @param min number
--- @param max number
--- @param default_or_options number|table<any, any>
--- @return menu_item_c
function menu_manager_c:slider(name, min, max, default_or_options, show_tooltip, unit, scale, tooltips)
	if (type(default_or_options) == "table") then
		local options = default_or_options

		default_or_options = options.default
		show_tooltip = options.show_tooltip
		unit = options.unit
		scale = options.scale
		tooltips = options.tooltips
	end

	default_or_options = default_or_options or nil
	show_tooltip = show_tooltip or true
	unit = unit or nil
	scale = scale or 1
	tooltips = tooltips or nil

	menu_assert(type(min) == "number", 3, "Slider min value must be a number.")
	menu_assert(type(max) == "number", 3, "Slider max value must be a number.")
	menu_assert(min < max, 3, "Slider min value must be below the max value.")

	if (default_or_options ~= nil) then
		menu_assert(default_or_options >= min and default_or_options <= max, 3, "Slider default must be between min and max values.")
	end

	return self:_create_item(ui.new_slider, name, min, max, default_or_options, show_tooltip, unit, scale, tooltips)
end

--- @param name string
--- @vararg string
--- @return menu_item_c
function menu_manager_c:combobox(name, ...)
	local args = {...}

	if (type(args[1]) == "table") then
		args = args[1]
	end

	return self:_create_item(ui.new_combobox, name, args)
end

--- @param name string
--- @vararg string
--- @return menu_item_c
function menu_manager_c:multiselect(name, ...)
	local args = {...}

	if (type(args[1]) == "table") then
		args = args[1]
	end

	return self:_create_item(ui.new_multiselect, name, args)
end

--- @param name string
--- @param inline boolean
--- @return menu_item_c
function menu_manager_c:hotkey(name, inline)
	if (inline == nil) then
		inline = false
	end

	menu_assert(type(inline) == "boolean", 3, "Hotkey inline argument must be a boolean.")

	return self:_create_item(ui.new_hotkey, name, inline)
end

--- @param name string
--- @param callback function
--- @return menu_item_c
function menu_manager_c:button(name, callback)
	menu_assert(type(callback) == "function", 3, "Cannot set button callback because the callback argument must be a function.")

	return self:_create_item(ui.new_button, name, callback)
end

--- @param name string
--- @param r number
--- @param g number
--- @param b number
--- @param a number
--- @return menu_item_c
function menu_manager_c:color_picker(name, r, g, b, a)
	r = r or 255
	g = g or 255
	b = b or 255
	a = a or 255

	menu_assert(type(r) == "number" and r >= 0 and r <= 255, 3, "Cannot set color picker red channel value. It must be between 0 and 255.")
	menu_assert(type(g) == "number" and g >= 0 and g <= 255, 3, "Cannot set color picker green channel value. It must be between 0 and 255.")
	menu_assert(type(b) == "number" and b >= 0 and b <= 255, 3, "Cannot set color picker blue channel value. It must be between 0 and 255.")
	menu_assert(type(a) == "number" and a >= 0 and a <= 255, 3, "Cannot set color picker alpha channel value. It must be between 0 and 255.")

	return self:_create_item(ui.new_color_picker, name, r, g, b, a)
end

--- @param name string
--- @return menu_item_c
function menu_manager_c:textbox(name)
	return self:_create_item(ui.new_textbox, name)
end

--- @param name string
--- @vararg string
--- @return menu_item_c
function menu_manager_c:listbox(name, ...)
	local args = {...}

	if (type(args[1]) == "table") then
		args = args[1]
	end

	local item = self:_create_item(ui.new_listbox, name, args)

	item:set_getter_callback(
		function(get)
			return item.getter.data[get + 1]
		end,
		args
	)

	return item
end

--- @param name string
--- @return menu_item_c
function menu_manager_c:label(name)
	menu_assert(type(name) == "string", "Label name must be a string.")

	return self:_create_item(ui.new_label, name)
end

--- @param element function
--- @param name string
--- @vararg any
--- @return menu_item_c
function menu_manager_c:_create_item(element, name, ...)
	menu_assert(type(name) == "string" and name ~= "", 3, "Cannot create menu item: name must be a non-empty string.")

	local item = menu_item_c.new(element, self.tab, self.container, name, ...)
	self.children[item.reference] = item

	return item
end

--- @param tab string
--- @param container string
--- @return void
function menu_manager_c._validate_tab_container(tab, container)
	menu_assert(type(tab) == "string" and tab ~= "", 4, "Cannot create menu manager: tab name must be a non-empty string.")
	menu_assert(type(container) == "string" and container ~= "", 4, "Cannot create menu manager: tab name must be a non-empty string.")

	tab = tab:lower()

	menu_assert(menu_map[tab] ~= nil, 4, "Cannot create menu manager: tab name does not exist.")
	menu_assert(menu_map[tab][container:lower()] ~= nil, 4, "Cannot create menu manager: container name does not exist.")
end
--endregion
--endregion

--region dependency: havoc_binary_1_0_0
--- @class bin_c
--- @field public hex string
--- @field public bin string
--- @field public exe function
--- @field public byte_count number
--- @field public suffixes_short table<number, string>
--- @field public suffixes_long table<number, string>
local bin_c = {}
local bin_mt = {
	__index = bin_c,
	--- @param bin bin_c
	--- @vararg any
	__call = function(bin, ...)
		if (bin.is_executable == true) then
			pcall(bin.exe(), ...)
		else
			return bin.bin
		end
	end
}

--- Instantiate an object of bytecode_c.
--- @param hex string
--- @param is_executable boolean
--- @return bin_c
function bin_c.new(hex, is_executable, format)
	return setmetatable({
		hex = hex,
		bin = nil,
		exe = nil,
		byte_count = nil,
		suffixes_short = { "B", "KB", "MB", "GB", "TB" },
		suffixes_long = { "bytes", "kilobytes", "megabytes", "gigabytes", "terabytes" },
		is_executable = is_executable or false
	}, bin_mt):init(format)
end

--- bytecode_c constructor method.
--- @param format boolean
--- @return bin_c
function bin_c:init(format)
	self.bin = type(format) ~= "number" and self:to_bin(self.hex) or self:to_binf(self.hex, format)
	self.byte_count = self.bin:len()

	if (self.is_executable) then
		local exe, err = loadstring(self.bin)

		assert(err == nil, string.format("Could not load binary: %s", err))

		self.exe = exe
	end

	return self
end

--- Returns the size of the binary data. If precision is nil an integer is returned, else a formatted string.
--- @param precision number|nil
--- @return string|number
function bin_c:size(precision, long_suffix_name)
	if (precision == nil) then
		return self.byte_count
	end

	local base = math.log(self.byte_count, 10) / math.log(1024, 10)
	local size = 1024 ^ (base - math.floor(base))
	local rounded = 10 ^ (precision or 0)

	size = math.floor(size * rounded + 0.5) / rounded

	local suffixes = self.suffixes_short

	if (long_suffix_name == true) then
		suffixes = self.suffixes_long
	end

	return string.format("%s %s", size, suffixes[math.floor(base) + 1])
end

--- Convert hex to binary data.
--- @return string
function bin_c:to_bin(hex)
	return (hex:gsub('..', function (cc)
		return string.char(tonumber(cc, 16))
	end))
end

--- Convert hex to binary data.
--- @param hex string
--- @param format number
--- @return string
function bin_c:to_binf(hex, format)
	local i = 1

	return (hex:gsub('..', function (cc)
		local byte

		if (i % format == 0) then
			byte = 255 - tonumber(cc, 16)
		else
			byte = tonumber(cc, 16)
		end

		i = i + 1

		return string.char(byte)
	end))
end

--- Convert binary to hex string.
--- @return string
function bin_c:to_hex()
	return (self.bin:gsub('.', function (c)
		return string.format('%02X', string.byte(c))
	end))
end
--endregion
--endregion

--region illusion
local illusion = load_illu("havoc weather")
--endregion

--region orb_manager
--- @class orb_manager_c
--- @field public orb illusion_particle_c
--- @field public shader shader_c
--- @field public rainbow boolean
--- @field public rainbow_speed number
--- @field public radius number
--- @field public orbit_height number
--- @field public trail_fade_time number
local orb_manager_c = {}
local orb_manager_mt = { __index = orb_manager_c }

--- Instantiate an object of orb_manager_c.
--- @return orb_manager_c
function orb_manager_c.new()
	return setmetatable({
		orb = nil,
		shader = illusion.shader.rgb(255, 255, 150, 255),
		rainbow = false,
		rainbow_speed = 1,
		radius = 30,
		orbit_height = 32,
		trail_fade_time = 1
	}, orb_manager_mt)
end

--- Spawn the orb.
--- @return void
function orb_manager_c:spawn_orb()
	if (self.orb ~= nil and self.orb.dead == false) then
		return
	end

	local orb = illusion:create()

	orb.type = "circle"
	orb.origin = illusion.shared.player_origin:clone_offset()
	orb.radius = self.radius
	orb.shader = self.shader
	orb.animator = illusion.animator(orb)
	orb.skip_offscreen = false

	orb.on_dead = function()
		self.orb = nil
	end

	orb.on_frame = function()
		if (self.rainbow == true) then
			orb.shader:shift_hue(self.rainbow_speed * illusion.simulation.delta)
		end

		orb.animator:orbit_easing(
			illusion.shared.player_origin:clone_offset(0, 0, self.orbit_height),
			4, 0.005, 64,
			{
				speed = 1.25,
				traces = 64,
				collision = true,
				ignore = illusion.shared.player_eid
			}
		)

		orb.animator:float_z(0.5, 1)

		if (self.trail_fade_time > 0) then
			local trail = illusion:create()
			local trail_shader = orb.shader:clone()

			trail_shader.a = 5

			trail.type = "circle"
			trail.origin = orb.origin:clone()
			trail.radius = orb.radius
			trail.shader = trail_shader
			trail.lifespan = 0
			trail.fade_time = self.trail_fade_time
			trail.skip_offscreen = true

			trail.on_frame = function()
				trail.radius = trail.radius + 1 * illusion.simulation.delta
			end
		end
	end

	self.orb = orb
end

function orb_manager_c:kill_orb()
	if (self.orb ~= nil) then
		self.orb.dead = true
		self.orb = nil
	end
end
--endregion

--region setup
local orb_manager = orb_manager_c.new()
--endregion

--region menu
local menu = menu_manager_c.new("config", "presets")

menu:label("--------------------------------------------------")
menu:label("Havoc Orb Pet - v1.0.3-beta")

local enable_script = menu:checkbox("Enable script")

enable_script:add_callback(function()
	orb_manager:kill_orb()
end)

local orb_color = menu:color_picker("Orb color", 255, 255, 150, 255)

orb_color:add_callback(function()
	local r, g, b, a = orb_color()

	orb_manager.shader(r, g, b, a)
end)

local orb_rainbow = menu:checkbox("Orb rainbow")

orb_rainbow:add_callback(function()
	orb_manager.rainbow = orb_rainbow()
end)

local orb_rainbow_speed = menu:slider("Rainbow speed", 1, 10, {
	unit = "x"
})

orb_rainbow_speed:add_callback(function()
	orb_manager.rainbow_speed = orb_rainbow_speed() * 0.05
end)

local orb_radius = menu:slider("Orb radius", 10, 40, {
	default = 30,
	unit = "x"
})

orb_radius:add_callback(function()
	orb_manager.radius = orb_radius()

	orb_manager:kill_orb()
end)

local orb_trail_fade_time = menu:slider("Orb trail fade speed", 0, 20, {
	default = 5,
	unit = "s",
	scale = 0.1
})

orb_trail_fade_time:add_callback(function()
	orb_manager.trail_fade_time = orb_trail_fade_time() * 0.1
end)

enable_script:add_children({
	orb_color,
	orb_rainbow,
	orb_rainbow_speed,
	orb_radius,
	orb_trail_fade_time
})

menu:load_from_db()
--endregion

--region main
client.set_event_callback("paint", function()
	if (illusion:available() == false or enable_script() == false) then
		return
	end

	orb_manager:spawn_orb()
end)

client.set_event_callback("player_spawn", function(data)
	if (entity.get_local_player() ~= client.userid_to_entindex(data.userid)) then
		return
	end

	if (illusion:available() == true and enable_script() == true) then
		orb_manager:kill_orb()
	end
end)

client.set_event_callback("shutdown", function()
	menu:save_to_db()
end)
--endregion

--region dependencies
--- Convert hex to binary data.
--- @return string
local function hex_to_bin(hex)
	return (hex:gsub('..', function (cc)
		return string.char(tonumber(cc, 16))
	end))
end

--region dependency: havoc_menu_1_3_0
--region menu_assert
--- Assert.
--- @param expression boolean
--- @param level number
--- @param message string
--- @vararg string
--- @return void
local function menu_assert(expression, level, message, ...)
	if (not expression) then
		error(string.format(message, ...), level)
	end
end
--endregion

--region menu_map
local menu_map = {
	rage = {"aimbot", "other"},
	aa = {"anti-aimbot angles", "fake lag", "other"},
	legit = {"weapon type", "aimbot", "triggerbot", "other"},
	visuals = {"player esp", "other esp", "colored models", "effects"},
	misc = {"miscellaneous", "settings", "lua", "other"},
	skins = {"weapon skin", "knife options", "glove options"},
	config = {"presets", "lua"},
	players = {"players", "adjustments"},
	lua = {"a", "b"}
}

for tab, containers in pairs(menu_map) do
	menu_map[tab] = {}

	for i=1, #containers do
		menu_map[tab][containers[i]] = true
	end
end
--endregion

--region menu_item
--- @class menu_item_c
--- @field public tab string
--- @field public container string
--- @field public name string
--- @field public reference number
--- @field public visible boolean
--- @field public hidden_value any
--- @field public children table<number, menu_item_c>
--- @field public ui_callback function
--- @field public getter table
--- @field public setter table
--- @field public parent_value_or_callback any|function
local menu_item_c = {}

local menu_item_mt = {
	__index = menu_item_c
}

--- @param item menu_item_c
--- @vararg any
--- @return menu_item_c|any
function menu_item_mt.__call(item, ...)
	local args = {...}

	if (#args == 0) then
		return item:get()
	end

	local do_ui_set = {pcall(item.set, item, unpack(args))}

	menu_assert(do_ui_set[1], 4, do_ui_set[2])

	return item
end

--- Create a new menu_item_c.
--- @param element function
--- @param tab string
--- @param container string
--- @param name string
--- @vararg any
--- @return menu_item_c
function menu_item_c.new(element, tab, container, name, ...)
	local reference
	local is_menu_reference = false

	if ((type(element)) == "function") then
		local do_ui_new = { pcall(element, tab, container, name, ...)}

		menu_assert(do_ui_new[1], 4, "Cannot create menu item because: %s", do_ui_new[2])

		reference = do_ui_new[2]
	else
		reference = element
		is_menu_reference = true
	end

	return setmetatable(
		{
			tab = tab,
			container = container,
			name = name,
			reference = reference,
			visible = true,
			hidden_value = nil,
			children = {},
			ui_callback = nil,
			callbacks = {},
			is_menu_reference = is_menu_reference,
			getter = {
				callback = nil,
				data = nil
			},
			setter = {
				callback = nil,
				data = nil
			},
			parent_value_or_callback = nil
		},
		menu_item_mt
	)
end

--- @param value any
--- @return void
function menu_item_c:set_hidden_value(value)
	self.hidden_value = value
end

--- @vararg any
--- @return void
function menu_item_c:set(...)
	local args = {...}

	if (self.setter.callback ~= nil) then
		args = self.setter.callback(unpack(args))
	end

	local do_ui_set = {pcall(ui.set, self.reference, unpack(args))}

	menu_assert(do_ui_set[1], 3, "Cannot set values of menu item because: %s", do_ui_set[2])
end

--- @return any
function menu_item_c:get()
	if (self.visible == false and self.hidden_value ~= nil) then
		return self.hidden_value
	end

	local get = {ui.get(self.reference)}

	if (self.getter.callback ~= nil) then
		return self.getter.callback(get)
	end

	return unpack(get)
end

--- @param callback function
--- @param data any
--- @return void
function menu_item_c:set_setter_callback(callback, data)
	menu_assert(type(callback) == "function", 3, "Cannot set menu item setter callback: argument must be a function.")

	self.setter.callback = callback
	self.setter.data = data
end

--- @param callback function
--- @param data any
--- @return void
function menu_item_c:set_getter_callback(callback, data)
	menu_assert(type(callback) == "function", 3, "Cannot set menu item getter callback: argument must be a function.")

	self.getter.callback = callback
	self.getter.data = data
end

--- @param children table<any, menu_item_c>
--- @param value_or_callback function|any
--- @return void
function menu_item_c:add_children(children, value_or_callback)
	if (value_or_callback == nil) then
		value_or_callback = true
	end

	if (getmetatable(children) == menu_item_mt) then
		children = {children}
	end

	for _, child in pairs(children) do
		menu_assert(getmetatable(child) == menu_item_mt, 3, "Cannot add child to menu item: children must be menu item objects. Make sure you are not trying to parent a UI reference.")
		menu_assert(child.reference ~= self.reference, 3, "Cannot parent a menu item to iself.")

		child.parent_value_or_callback = value_or_callback
		self.children[child.reference] = child
	end

	menu_item_c._process_callbacks(self)
end

--- @param callback function
--- @return void
function menu_item_c:add_callback(callback)
	menu_assert(self.is_menu_reference == false, 3, "Cannot add callbacks to built-in menu items.")
	menu_assert(type(callback) == "function", 3, "Callbacks for menu items must be functions.")

	table.insert(self.callbacks, callback)

	menu_item_c._process_callbacks(self)
end

--- @param item menu_item_c
--- @return void
function menu_item_c._process_callbacks(item)
	local callback = function()
		for _, child in pairs(item.children) do
			local is_child_visible

			if (type(child.parent_value_or_callback) == "function") then
				is_child_visible = child.parent_value_or_callback()
			else
				is_child_visible = item:get() == child.parent_value_or_callback
			end

			local is_visible = (is_child_visible == true) and (item.visible == true)
			child.visible = is_visible

			ui.set_visible(child.reference, is_visible)

			if (child.ui_callback ~= nil) then
				child.ui_callback()
			end
		end

		for i = 1, #item.callbacks do
			item.callbacks[i]()
		end
	end

	ui.set_callback(item.reference, callback)
	item.ui_callback = callback

	callback()
end
--endregion

--region menu_manager
--- @class menu_manager_c
--- @field public tab string
--- @field public container string
--- @field public children table<number, menu_item_c>
local menu_manager_c = {}

local menu_manager_mt = {
	__index = menu_manager_c
}

--- Create a new menu_manager_c.
--- @param tab string
--- @param container string
--- @return menu_manager_c
function menu_manager_c.new(tab, container)
	menu_manager_c._validate_tab_container(tab, container)

	return setmetatable(
		{
			tab = tab,
			container = container,
			children = {}
		},
		menu_manager_mt
	)
end

--- Saves the values for menu items currently created to the database.
--- @return void
function menu_manager_c:save_to_db()
	local prefix = string.format("%s_%s", self.tab, self.container)

	for _, item in pairs(self.children) do
		local key = string.format("%s_%s", prefix, item.name)
		local data = {item()}

		database.write(key, data)
	end
end

--- Loads the values for menu items currently created from to the database.
--- @return void
function menu_manager_c:load_from_db()
	local prefix = string.format("%s_%s", self.tab, self.container)

	for _, item in pairs(self.children) do
		local key = string.format("%s_%s", prefix, item.name)
		local data = database.read(key)

		if (data ~= nil) then
			item(unpack(data))
		end
	end
end

--- @param item menu_item_c
--- @param value_or_callback function|any
--- @return void
function menu_manager_c:parent_all_to(item, value_or_callback)
	local children = self.children

	children[item.reference] = nil

	item:add_children(children, value_or_callback)
end

--- @param tab string
--- @param container string
--- @param name string
--- @return menu_item_c
function menu_manager_c.reference(tab, container, name)
	menu_manager_c._validate_tab_container(tab, container)

	local do_reference = {pcall(ui.reference, tab, container, name)}

	menu_assert(do_reference[1], 3, "Cannot reference Gamesense menu item because: %s", do_reference[2])

	local references = {select(2, unpack(do_reference))}
	local items = {}

	for i = 1, #references do
		table.insert(
			items,
			menu_item_c.new(
				references[i],
				tab,
				container,
				name
			)
		)
	end

	return unpack(items)
end

--- @param name string
--- @return menu_item_c
function menu_manager_c:checkbox(name)
	return self:_create_item(ui.new_checkbox, name)
end

--- @param name string
--- @param min number
--- @param max number
--- @param default_or_options number|table<any, any>
--- @return menu_item_c
function menu_manager_c:slider(name, min, max, default_or_options, show_tooltip, unit, scale, tooltips)
	if (type(default_or_options) == "table") then
		local options = default_or_options

		default_or_options = options.default
		show_tooltip = options.show_tooltip
		unit = options.unit
		scale = options.scale
		tooltips = options.tooltips
	end

	default_or_options = default_or_options or nil
	show_tooltip = show_tooltip or true
	unit = unit or nil
	scale = scale or 1
	tooltips = tooltips or nil

	menu_assert(type(min) == "number", 3, "Slider min value must be a number.")
	menu_assert(type(max) == "number", 3, "Slider max value must be a number.")
	menu_assert(min < max, 3, "Slider min value must be below the max value.")

	if (default_or_options ~= nil) then
		menu_assert(default_or_options >= min and default_or_options <= max, 3, "Slider default must be between min and max values.")
	end

	return self:_create_item(ui.new_slider, name, min, max, default_or_options, show_tooltip, unit, scale, tooltips)
end

--- @param name string
--- @vararg string
--- @return menu_item_c
function menu_manager_c:combobox(name, ...)
	local args = {...}

	if (type(args[1]) == "table") then
		args = args[1]
	end

	return self:_create_item(ui.new_combobox, name, args)
end

--- @param name string
--- @vararg string
--- @return menu_item_c
function menu_manager_c:multiselect(name, ...)
	local args = {...}

	if (type(args[1]) == "table") then
		args = args[1]
	end

	return self:_create_item(ui.new_multiselect, name, args)
end

--- @param name string
--- @param inline boolean
--- @return menu_item_c
function menu_manager_c:hotkey(name, inline)
	if (inline == nil) then
		inline = false
	end

	menu_assert(type(inline) == "boolean", 3, "Hotkey inline argument must be a boolean.")

	return self:_create_item(ui.new_hotkey, name, inline)
end

--- @param name string
--- @param callback function
--- @return menu_item_c
function menu_manager_c:button(name, callback)
	menu_assert(type(callback) == "function", 3, "Cannot set button callback because the callback argument must be a function.")

	return self:_create_item(ui.new_button, name, callback)
end

--- @param name string
--- @param r number
--- @param g number
--- @param b number
--- @param a number
--- @return menu_item_c
function menu_manager_c:color_picker(name, r, g, b, a)
	r = r or 255
	g = g or 255
	b = b or 255
	a = a or 255

	menu_assert(type(r) == "number" and r >= 0 and r <= 255, 3, "Cannot set color picker red channel value. It must be between 0 and 255.")
	menu_assert(type(g) == "number" and g >= 0 and g <= 255, 3, "Cannot set color picker green channel value. It must be between 0 and 255.")
	menu_assert(type(b) == "number" and b >= 0 and b <= 255, 3, "Cannot set color picker blue channel value. It must be between 0 and 255.")
	menu_assert(type(a) == "number" and a >= 0 and a <= 255, 3, "Cannot set color picker alpha channel value. It must be between 0 and 255.")

	return self:_create_item(ui.new_color_picker, name, r, g, b, a)
end

--- @param name string
--- @return menu_item_c
function menu_manager_c:textbox(name)
	return self:_create_item(ui.new_textbox, name)
end

--- @param name string
--- @vararg string
--- @return menu_item_c
function menu_manager_c:listbox(name, ...)
	local args = {...}

	if (type(args[1]) == "table") then
		args = args[1]
	end

	local item = self:_create_item(ui.new_listbox, name, args)

	item:set_getter_callback(
		function(get)
			return item.getter.data[get + 1]
		end,
		args
	)

	return item
end

--- @param name string
--- @return menu_item_c
function menu_manager_c:label(name)
	menu_assert(type(name) == "string", "Label name must be a string.")

	return self:_create_item(ui.new_label, name)
end

--- @param element function
--- @param name string
--- @vararg any
--- @return menu_item_c
function menu_manager_c:_create_item(element, name, ...)
	menu_assert(type(name) == "string" and name ~= "", 3, "Cannot create menu item: name must be a non-empty string.")

	local item = menu_item_c.new(element, self.tab, self.container, name, ...)
	self.children[item.reference] = item

	return item
end

--- @param tab string
--- @param container string
--- @return void
function menu_manager_c._validate_tab_container(tab, container)
	menu_assert(type(tab) == "string" and tab ~= "", 4, "Cannot create menu manager: tab name must be a non-empty string.")
	menu_assert(type(container) == "string" and container ~= "", 4, "Cannot create menu manager: tab name must be a non-empty string.")

	tab = tab:lower()

	menu_assert(menu_map[tab] ~= nil, 4, "Cannot create menu manager: tab name does not exist.")
	menu_assert(menu_map[tab][container:lower()] ~= nil, 4, "Cannot create menu manager: container name does not exist.")
end
--endregion
--endregion
--endregion

--region emmydoc
--- @class weather_mode_c
--- @field public render fun(self: weather_mode_c, boundary_manager: weather_boundary_manager_c): void
--endregion

--region setup

--endregion

--region weather_boundary
--- @class weather_boundary_c
--- @field public sky_z number
--- @field public cull_z number
local weather_boundary_c = {}
local weather_boundary_mt = { __index = weather_boundary_c }

--- Instantiate an object of weather_boundary_c.
--- @return weather_boundary_c
local function weather_boundary(sky_z, cull_z)
	return weather_boundary_c.new(sky_z, cull_z)
end

--- Instantiate an object of weather_boundary_c.
--- @return weather_boundary_c
function weather_boundary_c.new(sky_z)
	return setmetatable({
		sky_z = sky_z
	}, weather_boundary_mt)
end
--endregion

--region weather_boundary_manager
--- @class weather_boundary_manager_c
--- @field public current weather_boundary_c
--- @field public default weather_boundary_c
--- @field public boundaries table<string, weather_boundary_c>
local weather_boundary_manager_c = {}
local weather_boundary_manager_mt = { __index = weather_boundary_manager_c }

--- Instantiate an object of weather_boundary_manager_c.
--- @return weather_boundary_manager_c
function weather_boundary_manager_c.new()
	return setmetatable({
		current = nil,
		default = weather_boundary(1000),
		boundaries = {
			["de_dust2"] = weather_boundary(710),
			["de_mirage"] = weather_boundary(1200),
			["de_mirage_scrimmagemap"] = weather_boundary(1200),
			["de_inferno"] = weather_boundary(570),
			["de_vertigo"] = weather_boundary(12800),
			["de_cbble"] = weather_boundary(1200),
			["de_cache"] = weather_boundary(2400),
			["de_train"] = weather_boundary(1000),
			["de_overpass"] = weather_boundary(1000),
			["de_nuke"] = weather_boundary(700),
			["de_canals"] = weather_boundary(1000),
			["cs_agency"] = weather_boundary(1000),
			["cs_office"] = weather_boundary(650),
			["cs_italy"] = weather_boundary(840),
			["cs_assault"] = weather_boundary(630),
			["workshop/141243798/aim_ag_texture2"] = weather_boundary(1000)
		}
	}, weather_boundary_manager_mt)
end

--- Update current boundary.
--- @return void
function weather_boundary_manager_c:sync()
	local map = globals.mapname()

	if (self.boundaries[map] ~= nil) then
		self.current = self.boundaries[map]
	else
		self.current = self.default
	end
end
--endregion

--region weather_mode_snow
--- @class weather_mode_snow_c : weather_mode_c
--- @field public shader shader_c
--- @field public max_snowflakes number
--- @field public sticky boolean
--- @field public speed number
--- @field public density number
--- @field public radius number
--- @field public texture string
local weather_mode_snow_c = {}
local weather_mode_snow_mt = { __index = weather_mode_snow_c }

--- Instantiate an object of weather_mode_snow_c.
--- @return weather_mode_snow_c
function weather_mode_snow_c.new()
	return setmetatable({
		shader = illusion.shader.rgb(220, 220, 220, 200),
		max_snowflakes = 2048,
		sticky = false,
		speed = 1,
		density = 1,
		radius = 1000,
		texture = renderer.load_png(
			hex_to_bin("89504E470D0A1A0A0000000D4948445200000020000000200806000000737A7AF4000000097048597300000B1300000B1301009A9C18000005B869545874584D4C3A636F6D2E61646F62652E786D7000000000003C3F787061636B657420626567696E3D22EFBBBF222069643D2257354D304D7043656869487A7265537A4E54637A6B633964223F3E203C783A786D706D65746120786D6C6E733A783D2261646F62653A6E733A6D6574612F2220783A786D70746B3D2241646F626520584D5020436F726520352E362D633134322037392E3136303932342C20323031372F30372F31332D30313A30363A33392020202020202020223E203C7264663A52444620786D6C6E733A7264663D22687474703A2F2F7777772E77332E6F72672F313939392F30322F32322D7264662D73796E7461782D6E7323223E203C7264663A4465736372697074696F6E207264663A61626F75743D222220786D6C6E733A786D703D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F2220786D6C6E733A786D704D4D3D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F6D6D2F2220786D6C6E733A73744576743D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F73547970652F5265736F757263654576656E74232220786D6C6E733A64633D22687474703A2F2F7075726C2E6F72672F64632F656C656D656E74732F312E312F2220786D6C6E733A70686F746F73686F703D22687474703A2F2F6E732E61646F62652E636F6D2F70686F746F73686F702F312E302F2220786D703A43726561746F72546F6F6C3D2241646F62652050686F746F73686F702043432032303138202857696E646F7773292220786D703A437265617465446174653D22323032302D30322D32315431343A31343A30325A2220786D703A4D65746164617461446174653D22323032302D30322D32315431343A31343A30325A2220786D703A4D6F64696679446174653D22323032302D30322D32315431343A31343A30325A2220786D704D4D3A496E7374616E636549443D22786D702E6969643A30306161336432652D613865362D346134662D383934382D6539303737306465663930642220786D704D4D3A446F63756D656E7449443D2261646F62653A646F6369643A70686F746F73686F703A34626131363065372D623332372D323034632D383162332D6266616139313135646332382220786D704D4D3A4F726967696E616C446F63756D656E7449443D22786D702E6469643A35666235316332612D626661642D363334332D393536662D373461653835613633633531222064633A666F726D61743D22696D6167652F706E67222070686F746F73686F703A436F6C6F724D6F64653D2233223E203C786D704D4D3A486973746F72793E203C7264663A5365713E203C7264663A6C692073744576743A616374696F6E3D2263726561746564222073744576743A696E7374616E636549443D22786D702E6969643A35666235316332612D626661642D363334332D393536662D373461653835613633633531222073744576743A7768656E3D22323032302D30322D32315431343A31343A30325A222073744576743A736F6674776172654167656E743D2241646F62652050686F746F73686F702043432032303138202857696E646F777329222F3E203C7264663A6C692073744576743A616374696F6E3D227361766564222073744576743A696E7374616E636549443D22786D702E6969643A30306161336432652D613865362D346134662D383934382D653930373730646566393064222073744576743A7768656E3D22323032302D30322D32315431343A31343A30325A222073744576743A736F6674776172654167656E743D2241646F62652050686F746F73686F702043432032303138202857696E646F777329222073744576743A6368616E6765643D222F222F3E203C2F7264663A5365713E203C2F786D704D4D3A486973746F72793E203C2F7264663A4465736372697074696F6E3E203C2F7264663A5244463E203C2F783A786D706D6574613E203C3F787061636B657420656E643D2272223F3E6C771F590000039C4944415458857D97DB6EE34610440F4949966427B0B38B0DF2FFDF9687204836F6AE645D28310F532516C794090C78999EAEEA9EBE0C9B611898B99AEAB9D33DC7005C35E6945866A8E627B28B3B0B9B785E68B47A6F43F60A5C80FE0E09349F649A94AD09CC81AF281E48F64D7CBB4AAE9FD193E0E92D630C8B6A01715F000F15C94B05D26ADE6017115BE8DE03A718267CDB969AC010CFE9FA7BFBDCC558486609AC818DF4EC8157E00DD801E75460F6B6BA0D651B8AFB3390AE61F95263254FADE3DB167892DC0FCD77D23121610209BE14F8B316DA43197C26B910F03648747A5E89700B1C04DAC7B8024D6E81C197C0AFC03759B1128095276107A9EF4BA601E7BDB7CC56644EF66A6E81493C48F05924BE00BF01BF842B1D2F4EC19B45FA7E1450236FD6DBF32E129318B05B2DF40CFC01FC2E12CF2261AFD8C29F1ABBCAE256641E34325E9CDA7DBD0526B011E837013FEAFE157891458D2CDF5302ED2DC681317BDE436F578DBE4EC356632DA01779C304BEE8DDCA0679E4451EF80EFC2D12C81B75A66521BAE579CB94C446EEF6FE3D5102D3E06D28EA98A6AF951F98A65FD6915B45AC83D0D67F95C54EB1273DCFF50E18EBC26380ED80FFB426ABDF4045808AC0A3ACB7A5DEAFEC90F565EBBCFE0AFC139EB2D56E5E177F4F0104B4D6B713A5789CF5DC33F682B9B29C8D6A4BD93E181B92091C18BBE7AD195DC3824E8B8E1ACB20602559156B1203633372ADF0FD1C046E8019206D2C3C31160C77352BFBEC2062B00BA3CB2DB79351FE36D441E54AD60B7C4389E4BD166F6445C6CCDC29C9D5D0E48FD2B7D7FA0F41E88526E105EF942D78A554AF0B63DBB5AC53D1BD04C9FD4B295006AEC12194D5EDF64829AF0F8CDB74151103A46B5DE9DC824FC09F944C781378069FAF2109B8B1D86D6F017ED216B807F4B2C6444CC27DE20CFC45A9038E23EBCD986B6A02B6FC49EF07016F9946B6099CB46610F0637875C71874E79033F8E448E668DD53F66ECDD8705E194B2A8C4DC635C256B9DDBA2A129EF329C8D973BBCCD685E24869282B79A1AB1664B4F733734E631FE77AC6F3E025E46FC7F3DC027BE19D123C277901226FF998E70647962F6488097C9767538749906968A0462EF381631932067520E631DD043A8ABB3B4A0CFD642C6235099AF835CBE29279ED54AC49641A7A6E113A06C640CDEA99DB36CC11A8C9F8CCE0EFA9A42690E0931F9099F759027987B1D4D6F39FFD74D61DD6E035E10F049248DDFBE7BECD593F37F7E9FBDC09E7DE5FEE674A9B99F97BD744EE7F21E2A5CE065149E30000000049454E44AE426082"),
			32,
			32
		)
	}, weather_mode_snow_mt)
end




--- Render snow.
--- @param boundary weather_boundary_c
--- @return void
function weather_mode_snow_c:render(boundary)
	if (illusion.hook.total_alive > self.max_snowflakes) then
		illusion.hook:cull()
	end

	if (boundary == nil) then
		return
	end

	local spawn_margin = client.random_int(self.density, 40)

	if (spawn_margin > self.density) then
		return
	end

	for _ = 1, self.density do
		local spawn_vector = illusion.shared.player_camera_position + illusion.vector(
			client.random_float(-self.radius, self.radius),
			client.random_float(-self.radius, self.radius),
			client.random_float(-self.radius, self.radius) / 2
		)

		local sky_vector = illusion.vector(spawn_vector.x, spawn_vector.y, boundary.sky_z)
		local can_spawn_trace = sky_vector:trace_line_to(spawn_vector)

		if (can_spawn_trace == 1) then
			local snowflake = illusion:create()

			local size = client.random_int(8, 22)

			snowflake.origin = spawn_vector
			snowflake.shader = self.shader:clone()
			snowflake.type = "texture"
			snowflake.texture = self.texture
			snowflake.width = size
			snowflake.height = size
			snowflake.fade_time = 2
			snowflake.landed = false
			snowflake.landing_vector = illusion.vector(0, 0, 0)
			snowflake.floating_vector = illusion.vector(0, 0, -0.25)
			snowflake.floating_timer = illusion.timer_tick(true, {
				adjust_after = client.random_int(16, 32)
			})

			local impact_trace_vector = snowflake.origin:clone_offset(0, 0, -32768)
			local floor_trace = snowflake.origin:trace_line_to(impact_trace_vector)

			snowflake.impact_z = snowflake.origin.z - (32768 * floor_trace) + 1
			snowflake.shader.a = 0
			snowflake.target_alpha = 100

			snowflake.on_frame = function()
				if (snowflake.origin.z <= snowflake.impact_z) then
					if (self.sticky == true) then
						local impact_trace_vector = snowflake.origin:clone_offset(0, 0, -32768)
						local floor_trace = snowflake.origin:trace_line_to(impact_trace_vector)

						snowflake.origin.z = snowflake.origin.z - (32768 * floor_trace) + 1
						snowflake.landed = true

						snowflake:kill()
					else
						snowflake:kill()
					end
				end

				snowflake.shader.a = snowflake.shader.a + (snowflake.target_alpha - snowflake.shader.a) * 0.02 * illusion.simulation.delta

				if (snowflake.relation_camera_distance > self.radius) then
					snowflake.fade_time = 0.25

					snowflake:kill()
				end

				if (snowflake.landed == true and snowflake.occluded == true) then
					snowflake.dead = true

					return
				end

				snowflake.floating_timer:event(snowflake.floating_timer.adjust_after, function(timer)
					snowflake.floating_vector(
						client.random_float(-0.1, 0.1),
						client.random_float(-0.1, 0.1),
						client.random_float(-0.33, -0.45)
					)

					timer:restart()
				end)

				if (snowflake.landed == false) then
					snowflake.origin = snowflake.origin + snowflake.floating_vector * self.speed * illusion.simulation.delta
				end
			end
		end
	end
end
--endregion

--region weather_mode_rain
--- @class weather_mode_rain_c
--- @field public shader shader_c
--- @field public max_droplets number
--- @field public splash boolean
--- @field public storm boolean
--- @field public speed number
--- @field public density number
--- @field public radius number
--- @field public texture number
--- @field public sound_indoors string
--- @field public sound_indoors_length number
--- @field public sound_outdoors string
--- @field public sound_outdoors_length number
--- @field public sound_state number
--- @field public sound_timer timer_standard_c
--- @field public storm_timer timer_standard_c
--- @field public storm_interval number
--- @field public storm_sounds table<number, string>
local weather_mode_rain_c = {}
local weather_mode_rain_mt = { __index = weather_mode_rain_c }

--- Instantiate an object of weather_mode_rain_c.
--- @return weather_mode_rain_c
function weather_mode_rain_c.new()
	return setmetatable({
		shader = illusion.shader.rgb(220, 220, 220, 200),
		max_droplets = 2048,
		splash = false,
		storm = false,
		speed = 1,
		density = 1,
		radius = 1000,
		texture = renderer.load_png(
			hex_to_bin("89504E470D0A1A0A0000000D4948445200000020000000200806000000737A7AF4000000097048597300000B1300000B1301009A9C18000005B869545874584D4C3A636F6D2E61646F62652E786D7000000000003C3F787061636B657420626567696E3D22EFBBBF222069643D2257354D304D7043656869487A7265537A4E54637A6B633964223F3E203C783A786D706D65746120786D6C6E733A783D2261646F62653A6E733A6D6574612F2220783A786D70746B3D2241646F626520584D5020436F726520352E362D633134322037392E3136303932342C20323031372F30372F31332D30313A30363A33392020202020202020223E203C7264663A52444620786D6C6E733A7264663D22687474703A2F2F7777772E77332E6F72672F313939392F30322F32322D7264662D73796E7461782D6E7323223E203C7264663A4465736372697074696F6E207264663A61626F75743D222220786D6C6E733A786D703D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F2220786D6C6E733A786D704D4D3D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F6D6D2F2220786D6C6E733A73744576743D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F73547970652F5265736F757263654576656E74232220786D6C6E733A64633D22687474703A2F2F7075726C2E6F72672F64632F656C656D656E74732F312E312F2220786D6C6E733A70686F746F73686F703D22687474703A2F2F6E732E61646F62652E636F6D2F70686F746F73686F702F312E302F2220786D703A43726561746F72546F6F6C3D2241646F62652050686F746F73686F702043432032303138202857696E646F7773292220786D703A437265617465446174653D22323032302D30322D32315431363A31323A35365A2220786D703A4D65746164617461446174653D22323032302D30322D32315431363A31323A35365A2220786D703A4D6F64696679446174653D22323032302D30322D32315431363A31323A35365A2220786D704D4D3A496E7374616E636549443D22786D702E6969643A38613834393765352D626166362D303834622D393137312D6230666565383737343963382220786D704D4D3A446F63756D656E7449443D2261646F62653A646F6369643A70686F746F73686F703A38636461633430622D626639332D363434372D383831622D3762326361666562376664302220786D704D4D3A4F726967696E616C446F63756D656E7449443D22786D702E6469643A37376131653737312D653832332D303734302D383831332D363030326433333230336561222064633A666F726D61743D22696D6167652F706E67222070686F746F73686F703A436F6C6F724D6F64653D2233223E203C786D704D4D3A486973746F72793E203C7264663A5365713E203C7264663A6C692073744576743A616374696F6E3D2263726561746564222073744576743A696E7374616E636549443D22786D702E6969643A37376131653737312D653832332D303734302D383831332D363030326433333230336561222073744576743A7768656E3D22323032302D30322D32315431363A31323A35365A222073744576743A736F6674776172654167656E743D2241646F62652050686F746F73686F702043432032303138202857696E646F777329222F3E203C7264663A6C692073744576743A616374696F6E3D227361766564222073744576743A696E7374616E636549443D22786D702E6969643A38613834393765352D626166362D303834622D393137312D623066656538373734396338222073744576743A7768656E3D22323032302D30322D32315431363A31323A35365A222073744576743A736F6674776172654167656E743D2241646F62652050686F746F73686F702043432032303138202857696E646F777329222073744576743A6368616E6765643D222F222F3E203C2F7264663A5365713E203C2F786D704D4D3A486973746F72793E203C2F7264663A4465736372697074696F6E3E203C2F7264663A5244463E203C2F783A786D706D6574613E203C3F787061636B657420656E643D2272223F3ED197373F00000389494441545885AD97E98B134110C57F994CB29BF5BE454444C1F38320827FBF20E80741BC581014F15A4557DC5537D766C60F55CFAE4C3A876843339D9EE9AE57AF5E55775A755DB3626B79D7B808EFEA4C5FA9957F69BC05B4432F80891B9C00953F05EABF0090E102E8021BC0217F96C010F8E57D08EC7BAF5601B12A8002E80167814BC079E000C6C208F802BC013E00BBC1F05210AD251A10E56BC065E0B683D8F039E960047C0636BDEF02035258E61A59C640E1002E007781336EBC0774FC5D0DAC3BA09E1BDCF4F9214B44B908408131701CF3FCA41BE8B9C192941513FFFE347007D3C36B7F17C3B1320009AF0B5C07CEB951795A329D96ED303E85B13500DE93B224CBC422000546F95537DC73E31D123BF17BEDB78E89F42EA68D2D920E66F4900320CFD6816B58CAC9F36EC3DBB859B3305D02F680FBC0986926B28B9ADE9FF24D1473C5BD9DE9DA47A2ED3AE02BC04D52CAC6B0651988DE5F74EF253CD1DF6E782A6AE5A1DA1A56906E605AF89563211782C2115F08C6957A62208660127AC574EEAF0187B1506E619A986A3906DAC0112CFDD68371E57E1460158CAA046B8C8FBB98288F61056AE2EBEB268078D81C6D78AFCAD74C3FD129060462ECDF08C0012CA3DEADC280EAFE5AA337BD97F06ADFA772C30A53E1731DEF27984DDFB91A101325497851C54D35D70DA302B7EF0C94CE42172B50D910105E8CFC593450B7C25CD31B1956C9AD9D919839029ECD82582E7F3A882ACCC968AC05310C311B34370AA075304547B321A8801FC0374CBD15D30255A169C65AE21B07C07A5F033B195B330094567DEC827185945A02D0710002D12209509EC530D4BEDF57DF6B612112957DE02D563C8E010749421300658680B7C2FA71188FB09BD2B7E0E09FD63C0B847EDF17BCC0A81B908A8BA82DE73C239021567C5E6207D30C03B9C34874F68157C0334C134392C09A47712C4C72A08F89F939C6669FD9F3222B42A1DF03B681A75859D671DCC5A82F49028CE578E46B777CED131F8F03032B01C03DD8021EB861D12F9A551D2B2C4C3F81EFD82DF909F0D0D7EF916ACB549B7723129523DFF02D70CF8DDC726F0E926EC6637FB78309EE31F008F8E873732FA78B2EA5AA647BFE7BE2463E61D7B473D87D41FF0DBE63A9BB895D48B77D6EC082ABF9B2FF059068EF615E1FC56EC84ACF0860DBFB2E26BA3E4BAEE5AB0050EB90727F23FC96810189B1217362FE2F002095E29214BE588A15B6FDECEAFF002002C9B5C99CF9B9ED370E884DE1503DBCF60000000049454E44AE426082"),
			32, 32
		),
		texture_splash = renderer.load_png(
			hex_to_bin("89504E470D0A1A0A0000000D4948445200000040000000400806000000AA6971DE000000097048597300000B1300000B1301009A9C18000005B869545874584D4C3A636F6D2E61646F62652E786D7000000000003C3F787061636B657420626567696E3D22EFBBBF222069643D2257354D304D7043656869487A7265537A4E54637A6B633964223F3E203C783A786D706D65746120786D6C6E733A783D2261646F62653A6E733A6D6574612F2220783A786D70746B3D2241646F626520584D5020436F726520352E362D633134322037392E3136303932342C20323031372F30372F31332D30313A30363A33392020202020202020223E203C7264663A52444620786D6C6E733A7264663D22687474703A2F2F7777772E77332E6F72672F313939392F30322F32322D7264662D73796E7461782D6E7323223E203C7264663A4465736372697074696F6E207264663A61626F75743D222220786D6C6E733A786D703D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F2220786D6C6E733A786D704D4D3D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F6D6D2F2220786D6C6E733A73744576743D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F73547970652F5265736F757263654576656E74232220786D6C6E733A64633D22687474703A2F2F7075726C2E6F72672F64632F656C656D656E74732F312E312F2220786D6C6E733A70686F746F73686F703D22687474703A2F2F6E732E61646F62652E636F6D2F70686F746F73686F702F312E302F2220786D703A43726561746F72546F6F6C3D2241646F62652050686F746F73686F702043432032303138202857696E646F7773292220786D703A437265617465446174653D22323032302D30322D32315431363A33343A32325A2220786D703A4D65746164617461446174653D22323032302D30322D32315431363A33343A32325A2220786D703A4D6F64696679446174653D22323032302D30322D32315431363A33343A32325A2220786D704D4D3A496E7374616E636549443D22786D702E6969643A32313430303431662D356135382D633834382D613631382D3237623139613935303866382220786D704D4D3A446F63756D656E7449443D2261646F62653A646F6369643A70686F746F73686F703A62323963346530652D396132642D396434632D396539622D3366623163343131363730612220786D704D4D3A4F726967696E616C446F63756D656E7449443D22786D702E6469643A65353562643366612D646239612D626434372D613766372D626666613330623766666332222064633A666F726D61743D22696D6167652F706E67222070686F746F73686F703A436F6C6F724D6F64653D2233223E203C786D704D4D3A486973746F72793E203C7264663A5365713E203C7264663A6C692073744576743A616374696F6E3D2263726561746564222073744576743A696E7374616E636549443D22786D702E6969643A65353562643366612D646239612D626434372D613766372D626666613330623766666332222073744576743A7768656E3D22323032302D30322D32315431363A33343A32325A222073744576743A736F6674776172654167656E743D2241646F62652050686F746F73686F702043432032303138202857696E646F777329222F3E203C7264663A6C692073744576743A616374696F6E3D227361766564222073744576743A696E7374616E636549443D22786D702E6969643A32313430303431662D356135382D633834382D613631382D323762313961393530386638222073744576743A7768656E3D22323032302D30322D32315431363A33343A32325A222073744576743A736F6674776172654167656E743D2241646F62652050686F746F73686F702043432032303138202857696E646F777329222073744576743A6368616E6765643D222F222F3E203C2F7264663A5365713E203C2F786D704D4D3A486973746F72793E203C2F7264663A4465736372697074696F6E3E203C2F7264663A5244463E203C2F783A786D706D6574613E203C3F787061636B657420656E643D2272223F3E24463DFA00000A1A49444154789CED9B4B931BC7118413AF5DEC4B222D4B21877DB0C3FFFFB7F8AEA342175B266592E22EB00B0C7CE8FAB6B36B7A805598340E62474C0C76D0D35D9595F56A90B3C3E1A0DFF3989F5B80738F2F009C5B80738F2F009C5B80738F2F009C5B80738F2F009C5B80738FDF3D00CBCFB0E66CE279AFE6CE73FFEF75F9A70460D6F97C9878360552EFBDCF3A669FA8199AA57B1E539B9C52F8B303F12918E0CAFBE5C21F34ED0207D55894E7E5755E2A8BEF7B74FCAF00B8F273FB3B07D783A4C1049A6BAC3877E6FA1EA714996220EF4EBEFF5B01E851DC959FDBC540005764D69923B5203908A7E471E601AE2B3E09C44B0198525C1A2BBF501F80855A4BCF357693998AE283C68065E15D79F65CD8F383A4BDADE7FB3C8F97009051CECFA6ACEF735C719E0F9D39EE22CE86299998BB9074197780DEDBB55305033924FD3606B8A2F9B95B73B0EF5C49369E759E3940AEE02916B0F74A05800BB5000C929E246D55400088E7BD4E0130B73BF45AD8F739F77B00EBE57B0F7C53236792AC7866E14245F1B50A081803EAAFE2D9D6DE01A0C33100DCC7FDCA11DF237783AEA669EECAF552616648968981EF2F43F955DA47F11DC6039C3D32BFC405D8C0FDDBFD9C057BA3A78883C09C0CE8A0D6ADA698806CB8C03CC9B28A0BD6B2E6A34EB880A714689F534C56205BD69575257A8AFB1A598EDEDF9E6D16F6B997EE566AE5D9DB9CDD4B5D60A60216966110709C0928742C0066803D76E422E8987C3093BBEFE577408229CF31E21800F8251B788A41002CE0BE9FD39EB323E7EA5ED19219E60A4F819899335576C36664989D62C0422D7A59509E43330422200E1ABB80B3466A15CD2ED4AB21DCF7310C167560F71A83CA7806E1140019842CD05225FDF0FD53CCD985405E8038A310D653965B55B6C7C1DE95C60064DFF7CA6FE83C63DD4906E4E0E72EB04C9B918397A1AC67899D29E491D9D329B122C712D9775E58F17E0E7C5201DFEF0AB9A804B97CCD511DE05658C50217F1F9226DE896CBE530C3B3C790E6B8D573B597FDDCC159A8CF4A674066D74E6310468590FB9D47CC8BB8433984D9D95C8F115EA1796DAFA4B407AF1C5C5D6907CB1527FFE7F77D1F62C15E8519F9F3900120B55CC67515176C98DBA20C82E08DFAD5E04CB5F0C8A9AE67654FA1288F82280E33BDC061DD2C5F6E8C9E5499F0CC002F47E7B1F8B5A45BDBC885F4F2D2CBD041D2261647B0BD6AAA04845E60935A2AF3DC0F4FB03AAC5C18580E9483E2DDE0A3522C700678CEBF08E56F0CE51CCD5DF04135E03441C6BE47084044303E63B51CECDC4DBCF5BDB2BD9CEABCE37D81EFEFD74054771088EC572A29CE2B3CA5BFF93C84504E2F170AC53C306500A178AF46C0FF61DB75C88862BE3E7A7840F654E84C6C825ADE88F4D6BC60CA7BDFEDAC60DE4EE3E2833D006D66EF23A8BBA3ECBE5431CAA5A4BB586FA31A27646BED356EA6DC58DD34E829EA4AD25771DFAAF8CE46C5C250CE11F540B6EA80E6A931BB48CFE23091B5884B4B15EB5FA9D6243080C30FA982EF4CED1E8BF50AA1A55D9736790820F6AAFEF5A83662D37ACE544F61B2C51F6D2F773F7CDC031ECF00601DCA03060AAF92D2CE0A1FEE7A870C008A7A9E64518AA007B5810936902601CD69CB203B50327B9384353DB87AF6212E916DD66AA33E3588376CBD33C551E384805E457186F6A036DDDCABB518F44748D075C1519840B831C173DB9B81200EF1FC4A35355FAA329298451F020004620F86B9D7183180A8FD10D7372A686FD5162252EBFB5EDBE7392B8D0F252F54D9E5C50CE0CD6D1D800000AAD37B55EAEFD2FA80A600C9D9C598650010F8295EDAC6465E58E00A87F81E9FA71A5CABB51A96FC3500DD98C230008B61E5B55A6AE36254A4C4945CE878FAF560FAA4B67043F96E0C20AF0200C1C4EB0347125FC52A44682C7BAD6A95B58AD53C45A138BE7B1BEF38E8346607559A03E02E9E7977CAC577CE4EE9880B301C042F5B3D4D52E4CC55AB32CE06F0E35B9554FA2EE6C00E2F750755DA3B03FC470CACE5054F6ED9798E4C7EF899DBEF0684A9039147156B3DAA46783A2F504581B5DAD3575CE246A560B9B7EFBCB0F2D27565FBE03E5856AA75BC9F4778A6401E82E226299A83E1F3C800E006A4BC7B9540486BEC822108E078EF8F3B385DBD9D252BF04E3E5663AE57787BB5A740B00F0571BD7B5577E15D6749370DCA2630E951D21B49DF8570772AD6A62AE41468616B2118D6CCBF12B9153CF8E5F8E225BA579399F2B06F21E98FF1CE1B55236D553311EC694038752AFC93A4BFDACB37269C1F92621D365AC7DC07038436165FCE00486D0A23CFF39C0AD12BC5755CB72A86C2551EE2BD5580B1521B789FC71400B8C22640F8BB6A0ABB50419677E90FFCDCF0328482211CB000508EF2043D5C83FC0EB083EDB133402F555CF40F925EC7BABFC6A500C2DD8678F1DC801DFB6548B1E93F257DAFE2D300E0940559F23FFE483487AA7EB6E8D520B47F527BB099B340CE48CB00F91B0341927E0E59F7AAC1D09BB3E6A8BE7724E6A90216BC95F4B501E6399C792B7B4F2AC1E841B59BDCD93B589EF4E8458C778B588D20EABF035EABB6C5F41F39DAE31254A2B9F53ECA0094DC49FA45D29F54ADE7C5898387D07B49FF96F441D247BB3C8350DD512C7947475C21F3C0943B95DAE246C520CE2CAF157027FA1A0C9019F0E27F20F13140C0CF39FF736A2D6CFEBBD8FC7D5C1F43103F15BE92F42AEE7E62EB20905261CE9D6A36E2C076AD36C079254BC60200FF61F42800078D177C1B9B7BA383E07EDAC2465B55CB7B2B0C536870A0EF6073A0AE779A9E1DBC9374B7F1633AB73E4775F9ACB20B8017395877AF42E70F2A14ECC50B9446591A20ACC17E5E2D7AE7E73D0765382E83E0AC7308E03EA8A65352E33CF6DFA836600EC0D134E8CA4BAD2F6D54A8FD75087FAD36806DED7D3A4A0F7EBE270D14C18C96D52B44AFE0FCD71DFEFEA89A16E95C893F43527E14FCA600C860402D3A2B7CFB4A25EDBC32657F515BB030BC7A5BABB8D14A05C8D701C0569531B275908F1AC0CFFDEEE3BE8BCF1C9951083DA8753F6FB0BA00B8F5B30B1007EE55F2EC9F5522F177F1EE077B871E9C135B7CF22200E344E74EF5C0E59D09896BF9AF515BD5DA833D38779CA9E6FB57F1F97D007AAF5A5F781DD105C0477601A9FAD5BF54AAC3BFC44501443F0E1539D18545372AF1E356B5F5F5361A1F86FAACC5418B1F99C9D6262EAC542CFEB34A3F400AA61FE88EA918E07F135DF1BF77927E0885D62A4D08F97AAD36AFFB2F37D4EC37AAE9CD0B1E3ABB0B559A13673C2B11937017C6A38AD57F54C958EF5553E028FF4F01A0CE24367DB4BFDF48FA870AC27F53B1EC526DE0F3DF181671E7C4C7031E41F252B5F627357E1580B0E683DAFA8377B72A31E86DDCFFA3EAFFA3DCEF63EAFF0B787ACB2741A4322CFA5AD2B7AA960271FF199BAE8DA80F3B9E548FC989E65E0841792F68B6AA391ECB6EE2EFFBB87B3ACE3FD2BC0880291088E8E46BFC94084C4E3ED81C82199F09705EBC60552A41A9B59CD7043BFB7BB0EF0F36C74BDF49E54F01D003219FD86476E4F337BECFEDA8FF2822B59560562ADF65F386F47DFEAC63CA4BD27F0114056BB4984CEE060000000049454E44AE426082"),
			64, 64
		),
		sound_indoors = "ambient/weather/aztec_int_rain_lp_01.wav",
		sound_indoors_length = 5,
		sound_outdoors = "ambient/weather/aztec_rain_lp_01.wav",
		sound_outdoors_length = 2,
		sound_state = nil,
		sound_timer = illusion.timer_standard(true),
		storm_timer = illusion.timer_standard(true),
		storm_interval = client.random_int(10, 70),
		storm_sounds = {
			"ambient/weather/thunderstorm/lightning_strike_1.wav",
			"ambient/weather/thunderstorm/lightning_strike_2.wav",
			"ambient/weather/thunderstorm/lightning_strike_3.wav",
			"ambient/weather/thunderstorm/lightning_strike_4.wav",
			"ambient/weather/thunderstorm/thunder_1.wav",
			"ambient/weather/thunderstorm/thunder_2.wav",
			"ambient/weather/thunderstorm/thunder_3.wav",
			"ambient/weather/thunderstorm/thunder_far_away_1.wav",
			"ambient/weather/thunderstorm/thunder_far_away_2.wav",
			"ambient/weather/thunder_distant_03.wav",
			"ambient/weather/thunder_distant_04.wav",
			"ambient/weather/thunder_distant_05.wav",
		}
	}, weather_mode_rain_mt)
end

--- Render rain.
--- @param boundary weather_boundary_c
--- @return void
function weather_mode_rain_c:render(boundary)
	if (illusion.hook.total_alive > self.max_droplets) then
		illusion.hook:cull()
	end

	if (boundary == nil) then
		return
	end

	self.storm_timer:event(self.storm_interval, function()
		self.storm_timer:restart()
		self.storm_interval = client.random_int(10, 70)

		client.exec(string.format("playvol %s 1", self.storm_sounds[client.random_int(1, #self.storm_sounds)]))
	end)

	local sky_pos = illusion.shared.player_origin:clone()

	sky_pos.z = boundary.sky_z

	local sound_state = illusion.shared.player_origin:trace_line_to(sky_pos, illusion.shared.observer_eid) == 1 and 1 or 0
	local force_sound_refresh = false

	if (sound_state ~= self.sound_state) then
		force_sound_refresh = true
	end

	self.sound_state = sound_state

	local sound
	local sound_length

	if (self.sound_state == 0) then
		sound = self.sound_indoors
		sound_length = self.sound_indoors_length
	else
		sound = self.sound_outdoors
		sound_length = self.sound_outdoors_length
	end

	if (force_sound_refresh == true or self.sound_timer:elapsed(sound_length) == true) then
		self.sound_timer:restart()

		client.exec(string.format("play %s", sound))
	end

	local spawn_margin = client.random_int(self.density, 40)

	if (spawn_margin > self.density) then
		return
	end

	for _ = 1, self.density do
		local spawn_vector = illusion.shared.player_camera_position + illusion.vector(
			client.random_float(-self.radius, self.radius),
			client.random_float(-self.radius, self.radius),
			client.random_float(-self.radius, self.radius) / 2
		)

		local sky_vector = illusion.vector(spawn_vector.x, spawn_vector.y, boundary.sky_z)
		local can_spawn_trace = sky_vector:trace_line_to(spawn_vector)

		if (can_spawn_trace == 1) then
			local droplet = illusion:create()

			local size = client.random_int(10, 15)

			droplet.origin = spawn_vector
			droplet.shader = self.shader:clone()
			droplet.type = "texture"
			droplet.texture = self.texture
			droplet.width = size
			droplet.height = size
			droplet.fade_time = 2
			droplet.landed = false
			droplet.landing_vector = illusion.vector(0, 0, 0)
			droplet.floating_vector = illusion.vector(0, 0, -2)
			droplet.floating_timer = illusion.timer_tick(true, {
				adjust_after = client.random_int(16, 32)
			})

			local impact_trace_vector = droplet.origin:clone_offset(0, 0, -32768)
			local floor_trace = droplet.origin:trace_line_to(impact_trace_vector)

			droplet.impact_z = droplet.origin.z - (32768 * floor_trace) + 1
			droplet.shader.a = 0
			droplet.target_alpha = 100

			droplet.on_frame = function()
				if (droplet.origin.z <= droplet.impact_z) then
					if (self.splash == true) then
						droplet.dead = true
						droplet.landed = true

						local impact_trace_vector = droplet.origin:clone_offset(0, 0, -32768)
						local floor_trace = droplet.origin:trace_line_to(impact_trace_vector)
						local splash_pos = droplet.origin:clone()

						splash_pos.z = splash_pos.z - (32768 * floor_trace) + 1

						local sky_pos = splash_pos:clone()

						sky_pos.z = boundary.sky_z

						if (splash_pos:trace_line_to(sky_pos) ~= 1) then
							return
						end

						local width = client.random_int(5, 10)
						local height = client.random_int(5, 15)
						local splash = illusion:create()

						splash.origin = splash_pos
						splash.shader = self.shader:clone()
						splash.shader.a = 100
						splash.type = "texture"
						splash.texture = self.texture_splash
						splash.width = width
						splash.height = height
						splash.on_frame = function()
							splash:kill_invisible()

							splash.shader:fade_out(5 * illusion.simulation.delta)

							splash.origin.z = splash.origin.z + 0.33 * illusion.simulation.delta
							splash.width = splash.width + 8 * illusion.simulation.delta
							splash.height = splash.height + 6 * illusion.simulation.delta
						end
					else
						droplet.dead = true
					end
				end

				droplet.shader.a = droplet.shader.a + (droplet.target_alpha - droplet.shader.a) * 0.06 * illusion.simulation.delta

				if (droplet.relation_camera_distance > self.radius) then
					droplet.fade_time = 0.1

					droplet:kill()
				end

				if (droplet.landed == true and droplet.occluded == true) then
					droplet.dead = true

					return
				end

				droplet.floating_timer:event(droplet.floating_timer.adjust_after, function(timer)
					droplet.floating_vector(
						client.random_float(-0.1, 0.1),
						client.random_float(-0.1, 0.1)
					)

					timer:restart()
				end)

				if (droplet.landed == false) then
					droplet.origin = droplet.origin + droplet.floating_vector * self.speed * illusion.simulation.delta
				end
			end
		end
	end
end
--endregion

--region weather
--- @class weather_c
--- @field public current_mode weather_mode_c
--- @field public boundary_manager weather_boundary_manager_c
--- @field public snow weather_mode_snow_c
local weather_c = {}
local weather_mt = { __index = weather_c }

--- Instantiate an object of weather_c.
--- @return weather_c
function weather_c.new()
	return setmetatable({
		enabled = false,
		current_mode = nil,
		boundary_manager = weather_boundary_manager_c.new(),
		snow = weather_mode_snow_c.new(),
		rain = weather_mode_rain_c.new()
	}, weather_mt)
end

--- Render current weather mode.
--- @return void
function weather_c:render()
	if (self.enabled == false) then
		return
	end

	self.current_mode:render(self.boundary_manager.current)
end
--endregion

--region menu_setup
local menu = menu_manager_c.new("config", "presets")

menu:label("--------------------------------------------------")
menu:label("Havoc Weather - v1.1.2")

local enable_script = menu:checkbox("Enable script")(true)
local weather_mode = menu:combobox("Weather mode", {"none", "snow", "rain"})("snow")
local snow_shader = menu:color_picker("Snow shader", 200, 200, 200, 100)
local snow_sticky = menu:checkbox("Sticky snow")(true)
local snow_speed = menu:slider("Snow speed", 1, 5, {
	default = 2,
	unit = "x"
})

local snow_density = menu:slider("Snow density", 1, 40, {
	default = 15,
	unit = "x"
})

local snow_radius = menu:slider("Snow radius", 5, 25, {
	default = 15,
	scale = 100
})

weather_mode:add_children(
	{
		snow_shader,
		snow_speed,
		snow_sticky,
		snow_density,
		snow_radius
	},
	function()
		return weather_mode() == "snow"
	end
)

local rain_shader = menu:color_picker("Droplet shader", 200, 200, 200, 100)

local rain_splash = menu:checkbox("Droplet splash")(true)

local rain_storm = menu:checkbox("Thunder and lightning")(true)

local rain_speed = menu:slider("Droplet speed", 1, 5, {
	default = 4,
	unit = "x"
})

local rain_density = menu:slider("Droplet density", 1, 50, {
	default = 20,
	unit = "x"
})

local rain_radius = menu:slider("Droplet radius", 5, 25, {
	default = 8,
	scale = 100
})

weather_mode:add_children(
	{
		rain_shader,
		rain_splash,
		rain_storm,
		rain_speed,
		rain_density,
		rain_radius
	},
	function()
		return weather_mode() == "rain"
	end
)

enable_script:add_children({
	weather_mode
})

menu:load_from_db()
--endregion

--region main
local weather = weather_c.new()

if (illusion:available() == true) then
	weather.boundary_manager:sync()
end

client.set_event_callback("level_init", function()
	weather.boundary_manager:sync()
end)

client.set_event_callback("paint", function()
	if (illusion:available() == false) then
		return
	end

	weather:render()
end)

client.set_event_callback("shutdown", function()
	client.exec(string.format("play %s", "bot/null.wav"))
	menu:save_to_db()
end)
--endregion

--region menu_callbacks
enable_script:add_callback(function()
	weather.enabled = enable_script()
	client.exec(string.format("play %s", "bot/null.wav"))
end)

weather_mode:add_callback(function()
	illusion:wipe()
	client.exec(string.format("play %s", "bot/null.wav"))

	if (weather_mode() == "none") then
		weather.enabled = false

		return
	end

	weather.enabled = true
	weather.current_mode = weather[weather_mode()]
end)

snow_shader:add_callback(function()
	local r, g, b, a = snow_shader()

	weather.snow.shader:set_r(r)
	weather.snow.shader:set_g(g)
	weather.snow.shader:set_b(b)
	weather.snow.shader:set_a(a)
end)

snow_sticky:add_callback(function()
	weather.snow.sticky = snow_sticky()
end)

snow_speed:add_callback(function()
	weather.snow.speed = snow_speed()
end)

snow_density:add_callback(function()
	weather.snow.density = snow_density()
end)

snow_radius:add_callback(function()
	weather.snow.radius = snow_radius() * 100
end)

rain_shader:add_callback(function()
	local r, g, b, a = rain_shader()

	weather.rain.shader:set_r(r)
	weather.rain.shader:set_g(g)
	weather.rain.shader:set_b(b)
	weather.rain.shader:set_a(a)
end)

rain_splash:add_callback(function()
	weather.rain.splash = rain_splash()
end)

rain_storm:add_callback(function()
	weather.rain.storm = rain_storm()
end)

rain_speed:add_callback(function()
	weather.rain.speed = rain_speed()
end)

rain_density:add_callback(function()
	weather.rain.density = rain_density()
end)

rain_radius:add_callback(function()
	weather.rain.radius = rain_radius() * 100
end)
--endregion
									client.color_log(0,255,255," [ YDL Loader ]  \0")
									client.color_log(255,255,0,"havoc_vision_weather\0")
									client.color_log(255,255,255," Successful loaded from YDL Server.")

